{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u5173\u4e8e\u6211 \u8fd9\u91cc\u8bb0\u5f55\u4e00\u4e9b\u81ea\u5df1\u5e73\u65f6\u5de5\u4f5c\u3001\u751f\u6d3b\u4e2d\u6298\u817e\u7684\u4e00\u4e9b\u4e1c\u897f\uff0c\u4ee5\u671f\u65e5\u79ef\u6708\u7d2f\u805a\u6c99\u6210\u5854 o( \uffe3\ufe36\uffe3 )o Icefairy@2021","title":"\u5173\u4e8e\u6211"},{"location":"#_1","text":"\u8fd9\u91cc\u8bb0\u5f55\u4e00\u4e9b\u81ea\u5df1\u5e73\u65f6\u5de5\u4f5c\u3001\u751f\u6d3b\u4e2d\u6298\u817e\u7684\u4e00\u4e9b\u4e1c\u897f\uff0c\u4ee5\u671f\u65e5\u79ef\u6708\u7d2f\u805a\u6c99\u6210\u5854 o( \uffe3\ufe36\uffe3 )o Icefairy@2021","title":"\u5173\u4e8e\u6211"},{"location":"docker/K3S%E5%AE%89%E8%A3%85/","text":"\u5728\u7ebf\u5b89\u88c5 K3S\u4f5c\u4e3a\u4e00\u79cd\u8f7b\u91cf\u5316\u7684k8s\u65b9\u6848\u5728\u7b80\u5355\u7684\u73af\u5883\u4e2d\u975e\u5e38\u4fbf\u4e8e\u90e8\u7f72 curl -sfL http://rancher-mirror.cnrancher.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn sh - \u5c31\u8fd9\u4e48\u4e00\u884c\u547d\u4ee4\u5c31\u53ef\u4ee5\u5b89\u88c5\u6210\u529f\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u4f7f\u7528 kubectl \u4e4b\u7c7b\u7684\u547d\u4ee4\u5566\u3002 \u79bb\u7ebf\u5b89\u88c5 \u79bb\u7ebf\u73af\u5883\u7684\u5347\u7ea7\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6b65\u9aa4\u5b8c\u6210\uff1a \u4ece K3s GitHub Release \u9875\u9762\u4e0b\u8f7d\u8981\u5347\u7ea7\u5230\u7684 K3s \u7248\u672c\u3002\u5c06 tar \u6587\u4ef6\u653e\u5728\u6bcf\u4e2a\u8282\u70b9\u7684 /var/lib/rancher/k3s/agent/images/ \u76ee\u5f55\u4e0b\u3002\u5220\u9664\u65e7\u7684 tar \u6587\u4ef6\u3002 \u590d\u5236\u5e76\u66ff\u6362\u6bcf\u4e2a\u8282\u70b9\u4e0a /usr/local/bin \u4e2d\u7684\u65e7 K3s \u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\u590d\u5236 https://get.k3s.io \u7684\u5b89\u88c5\u811a\u672c\uff08\u56e0\u4e3a\u5b83\u53ef\u80fd\u5728\u4e0a\u6b21\u53d1\u5e03\u540e\u53d1\u751f\u4e86\u53d8\u5316\uff09\u3002\u518d\u6b21\u8fd0\u884c\u811a\u672c\u3002 \u91cd\u542f K3s \u670d\u52a1\u3002","title":"K3S\u5b89\u88c5"},{"location":"docker/K3S%E5%AE%89%E8%A3%85/#_1","text":"K3S\u4f5c\u4e3a\u4e00\u79cd\u8f7b\u91cf\u5316\u7684k8s\u65b9\u6848\u5728\u7b80\u5355\u7684\u73af\u5883\u4e2d\u975e\u5e38\u4fbf\u4e8e\u90e8\u7f72 curl -sfL http://rancher-mirror.cnrancher.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn sh - \u5c31\u8fd9\u4e48\u4e00\u884c\u547d\u4ee4\u5c31\u53ef\u4ee5\u5b89\u88c5\u6210\u529f\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u4f7f\u7528 kubectl \u4e4b\u7c7b\u7684\u547d\u4ee4\u5566\u3002","title":"\u5728\u7ebf\u5b89\u88c5"},{"location":"docker/K3S%E5%AE%89%E8%A3%85/#_2","text":"\u79bb\u7ebf\u73af\u5883\u7684\u5347\u7ea7\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6b65\u9aa4\u5b8c\u6210\uff1a \u4ece K3s GitHub Release \u9875\u9762\u4e0b\u8f7d\u8981\u5347\u7ea7\u5230\u7684 K3s \u7248\u672c\u3002\u5c06 tar \u6587\u4ef6\u653e\u5728\u6bcf\u4e2a\u8282\u70b9\u7684 /var/lib/rancher/k3s/agent/images/ \u76ee\u5f55\u4e0b\u3002\u5220\u9664\u65e7\u7684 tar \u6587\u4ef6\u3002 \u590d\u5236\u5e76\u66ff\u6362\u6bcf\u4e2a\u8282\u70b9\u4e0a /usr/local/bin \u4e2d\u7684\u65e7 K3s \u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\u590d\u5236 https://get.k3s.io \u7684\u5b89\u88c5\u811a\u672c\uff08\u56e0\u4e3a\u5b83\u53ef\u80fd\u5728\u4e0a\u6b21\u53d1\u5e03\u540e\u53d1\u751f\u4e86\u53d8\u5316\uff09\u3002\u518d\u6b21\u8fd0\u884c\u811a\u672c\u3002 \u91cd\u542f K3s \u670d\u52a1\u3002","title":"\u79bb\u7ebf\u5b89\u88c5"},{"location":"docker/docker%E5%AE%B9%E5%99%A8%E7%9B%B8%E5%85%B3/","text":"docker\u5bb9\u5668\u76f8\u5173 \u5728docker\u7684php:fpm\u955c\u50cf\u4e2d\u5b89\u88c5pdo_mysql\u6269\u5c55:docker-php-ext-install pdo_mysql","title":"docker\u5bb9\u5668\u76f8\u5173"},{"location":"docker/docker%E5%AE%B9%E5%99%A8%E7%9B%B8%E5%85%B3/#docker","text":"\u5728docker\u7684php:fpm\u955c\u50cf\u4e2d\u5b89\u88c5pdo_mysql\u6269\u5c55:docker-php-ext-install pdo_mysql","title":"docker\u5bb9\u5668\u76f8\u5173"},{"location":"docker/seaweedfs%E4%BD%9C%E4%B8%BA%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%8F%92%E4%BB%B6/","text":"\u5b89\u88c5\u63d2\u4ef6 \u5728\u7ebf\u5b89\u88c5 #HOST\u7684\u503c\u662ffiler\u7684\u5730\u5740\u548c\u7aef\u53e3\uff0c\u4e0d\u5e26http\u524d\u7f00 docker plugin install --alias seaweedfs katharostech/seaweedfs-volume-plugin HOST=localhost:8888 #\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u4f1a\u8be2\u95ee\u662f\u5426\u5141\u8bb8\u7533\u8bf7\u7684\u6743\u9650\uff0c\u8f93\u5165Y\u56de\u8f66\u8fdb\u884c\u786e\u8ba4 docker plugin ls #\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u7ed3\u679c ID NAME DESCRIPTION ENABLED 4a08a23cf2eb seaweedfs:latest SeaweedFS volume plugin for Docker true \u79bb\u7ebf\u5b89\u88c5 \u5728\u6709\u7f51\u7edc\u7684\u73af\u5883\u4e0b\u5b89\u88c5\u597d\u63d2\u4ef6\uff0c\u5c06\u63d2\u4ef6\u76ee\u5f55\uff08 /var/lib/docker/plugin/* \uff09\u76f4\u63a5\u6253\u5305\u8d77\u6765\u62ff\u5230\u79bb\u7ebf\u73af\u5883\u4e0b\u89e3\u538b\u5230\u5bf9\u5e94\u76ee\u5f55\uff0c\u7136\u540e systemctl restart docker \u6765\u91cd\u542f\u5bb9\u5668\u540e\u7aef\u670d\u52a1\u5373\u53ef\u901a\u8fc7 docker pulgin ls \u770b\u5230\u8be5\u63d2\u4ef6\u4e86\u3002 \u521b\u5efa\u5b58\u50a8\u5377 #\u521b\u5efa\u4e00\u4e2a\u6301\u4e45\u5316\u5b58\u50a8\u5377 docker volume create --driver seaweedfs weed-vol #\u8be5\u76ee\u5f55\u5b58\u50a8\u4e8e\uff1ahttp://localhost:8888/docker/volumes/weedvol/ \u4f7f\u7528 docker run -it --rm -v weed-vol:/data alpine sh cd /data cp -r /etc/* ./ ls -alh du . -hs \u6ce8\u610f\u4e8b\u9879 \u751f\u4ea7\u73af\u5883\u4e2d\u5efa\u8baeseaweedfs\u96c6\u7fa4\u4f7f\u7528\u591a\u4e2avolume\u6765\u63d0\u5347\u5e76\u53d1\u8bfb\u5199\u901f\u5ea6\u3002 \u5982\u679c\u60f3\u5c06docker\u7684volume\u7ed1\u5b9a\u5230\u4e0d\u540c\u7684seaweedfs filer\u7684\u8bdd\u4ee5\u53e6\u5916\u7684\u540d\u79f0\u518d\u5b89\u88c5\u4e00\u4e2a\u63d2\u4ef6\uff0c\u521b\u5efa\u5bb9\u5668\u5b58\u50a8\u5377\u65f6\u5019\u4f7f\u7528\u53e6\u4e00\u4e2a\u540d\u5b57\u4f5c\u4e3a --driver \u7684\u503c\u5373\u53ef\u3002 \u63d2\u4ef6\u901a\u8fc7 host \u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u8fdb\u884c\u901a\u4fe1\u3002","title":"Seaweedfs\u4f5c\u4e3a\u5206\u5e03\u5f0f\u5b58\u50a8\u63d2\u4ef6"},{"location":"docker/seaweedfs%E4%BD%9C%E4%B8%BA%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%8F%92%E4%BB%B6/#_1","text":"","title":"\u5b89\u88c5\u63d2\u4ef6"},{"location":"docker/seaweedfs%E4%BD%9C%E4%B8%BA%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%8F%92%E4%BB%B6/#_2","text":"#HOST\u7684\u503c\u662ffiler\u7684\u5730\u5740\u548c\u7aef\u53e3\uff0c\u4e0d\u5e26http\u524d\u7f00 docker plugin install --alias seaweedfs katharostech/seaweedfs-volume-plugin HOST=localhost:8888 #\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u4f1a\u8be2\u95ee\u662f\u5426\u5141\u8bb8\u7533\u8bf7\u7684\u6743\u9650\uff0c\u8f93\u5165Y\u56de\u8f66\u8fdb\u884c\u786e\u8ba4 docker plugin ls #\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u7ed3\u679c ID NAME DESCRIPTION ENABLED 4a08a23cf2eb seaweedfs:latest SeaweedFS volume plugin for Docker true","title":"\u5728\u7ebf\u5b89\u88c5"},{"location":"docker/seaweedfs%E4%BD%9C%E4%B8%BA%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%8F%92%E4%BB%B6/#_3","text":"\u5728\u6709\u7f51\u7edc\u7684\u73af\u5883\u4e0b\u5b89\u88c5\u597d\u63d2\u4ef6\uff0c\u5c06\u63d2\u4ef6\u76ee\u5f55\uff08 /var/lib/docker/plugin/* \uff09\u76f4\u63a5\u6253\u5305\u8d77\u6765\u62ff\u5230\u79bb\u7ebf\u73af\u5883\u4e0b\u89e3\u538b\u5230\u5bf9\u5e94\u76ee\u5f55\uff0c\u7136\u540e systemctl restart docker \u6765\u91cd\u542f\u5bb9\u5668\u540e\u7aef\u670d\u52a1\u5373\u53ef\u901a\u8fc7 docker pulgin ls \u770b\u5230\u8be5\u63d2\u4ef6\u4e86\u3002","title":"\u79bb\u7ebf\u5b89\u88c5"},{"location":"docker/seaweedfs%E4%BD%9C%E4%B8%BA%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%8F%92%E4%BB%B6/#_4","text":"#\u521b\u5efa\u4e00\u4e2a\u6301\u4e45\u5316\u5b58\u50a8\u5377 docker volume create --driver seaweedfs weed-vol #\u8be5\u76ee\u5f55\u5b58\u50a8\u4e8e\uff1ahttp://localhost:8888/docker/volumes/weedvol/","title":"\u521b\u5efa\u5b58\u50a8\u5377"},{"location":"docker/seaweedfs%E4%BD%9C%E4%B8%BA%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%8F%92%E4%BB%B6/#_5","text":"docker run -it --rm -v weed-vol:/data alpine sh cd /data cp -r /etc/* ./ ls -alh du . -hs","title":"\u4f7f\u7528"},{"location":"docker/seaweedfs%E4%BD%9C%E4%B8%BA%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%8F%92%E4%BB%B6/#_6","text":"\u751f\u4ea7\u73af\u5883\u4e2d\u5efa\u8baeseaweedfs\u96c6\u7fa4\u4f7f\u7528\u591a\u4e2avolume\u6765\u63d0\u5347\u5e76\u53d1\u8bfb\u5199\u901f\u5ea6\u3002 \u5982\u679c\u60f3\u5c06docker\u7684volume\u7ed1\u5b9a\u5230\u4e0d\u540c\u7684seaweedfs filer\u7684\u8bdd\u4ee5\u53e6\u5916\u7684\u540d\u79f0\u518d\u5b89\u88c5\u4e00\u4e2a\u63d2\u4ef6\uff0c\u521b\u5efa\u5bb9\u5668\u5b58\u50a8\u5377\u65f6\u5019\u4f7f\u7528\u53e6\u4e00\u4e2a\u540d\u5b57\u4f5c\u4e3a --driver \u7684\u503c\u5373\u53ef\u3002 \u63d2\u4ef6\u901a\u8fc7 host \u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u8fdb\u884c\u901a\u4fe1\u3002","title":"\u6ce8\u610f\u4e8b\u9879"},{"location":"linux/centos7_selinux/","text":"\u4fee\u590dCentos7\u7684SELINUX\u9519\u8bef \u95ee\u9898\u539f\u56e0\uff1a\u4fee\u6539selinux\u914d\u7f6e\u65f6\u4f7f\u7528\u4e86\u9519\u8bef\u7684\u914d\u7f6e\u6ca1\u6709\u68c0\u67e5\u5230\u76f4\u63a5\u91cd\u542f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u670d\u52a1\u5668\u65e0\u6cd5\u542f\u52a8\uff08\u505c\u7559\u5728\u542f\u52a8\u8fdb\u5ea6\u6761\u52a0\u8f7d\u7684\u5730\u65b9\uff09 \u89e3\u51b3\u529e\u6cd5\uff1a\u5f3a\u5236\u91cd\u542f\u7684\u540c\u65f6\uff0c\u901a\u8fc7\u4e91\u5e73\u53f0\u7684vnc\u529f\u80fd\uff0c\u5728grub\u542f\u52a8\u83dc\u5355\u5904\u6309E\u8fdb\u5165\u7f16\u8f91\uff0c\u5728linux16\u5f00\u5934\u90a3\u884c\u7684\u6700\u672b\u5c3e \u52a0\u5165 \u7a7a\u683cselinux=0 \u6309Ctrl+x\u6267\u884c\u542f\u52a8\uff0c\u8fdb\u5165\u7cfb\u7edf\u540e\u4fee\u590d\u9519\u8bef\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u518d reboot \u91cd\u542f\u6d4b\u8bd5\uff0c\u80fd\u6b63\u5e38\u8fdb\u5165\u7cfb\u7edf\uff0c\u6b64\u65f6\u4fee\u590d\u5b8c\u6210\u3002 \u6b63\u786e\u7684selinux\u8bbe\u7f6e\u4f8b\u5b50\u5982\u4e0b: cat /etc/selinux/config #\u5f00\u542f SELINUX=enforcing SELINUXTYPE=targeted #\u5173\u95ed SELINUX=disabled SELINUXTYPE=targeted","title":"\u4fee\u590dCentos7\u7684SELINUX\u9519\u8bef"},{"location":"linux/centos7_selinux/#centos7selinux","text":"\u95ee\u9898\u539f\u56e0\uff1a\u4fee\u6539selinux\u914d\u7f6e\u65f6\u4f7f\u7528\u4e86\u9519\u8bef\u7684\u914d\u7f6e\u6ca1\u6709\u68c0\u67e5\u5230\u76f4\u63a5\u91cd\u542f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u670d\u52a1\u5668\u65e0\u6cd5\u542f\u52a8\uff08\u505c\u7559\u5728\u542f\u52a8\u8fdb\u5ea6\u6761\u52a0\u8f7d\u7684\u5730\u65b9\uff09 \u89e3\u51b3\u529e\u6cd5\uff1a\u5f3a\u5236\u91cd\u542f\u7684\u540c\u65f6\uff0c\u901a\u8fc7\u4e91\u5e73\u53f0\u7684vnc\u529f\u80fd\uff0c\u5728grub\u542f\u52a8\u83dc\u5355\u5904\u6309E\u8fdb\u5165\u7f16\u8f91\uff0c\u5728linux16\u5f00\u5934\u90a3\u884c\u7684\u6700\u672b\u5c3e \u52a0\u5165 \u7a7a\u683cselinux=0 \u6309Ctrl+x\u6267\u884c\u542f\u52a8\uff0c\u8fdb\u5165\u7cfb\u7edf\u540e\u4fee\u590d\u9519\u8bef\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u518d reboot \u91cd\u542f\u6d4b\u8bd5\uff0c\u80fd\u6b63\u5e38\u8fdb\u5165\u7cfb\u7edf\uff0c\u6b64\u65f6\u4fee\u590d\u5b8c\u6210\u3002 \u6b63\u786e\u7684selinux\u8bbe\u7f6e\u4f8b\u5b50\u5982\u4e0b: cat /etc/selinux/config #\u5f00\u542f SELINUX=enforcing SELINUXTYPE=targeted #\u5173\u95ed SELINUX=disabled SELINUXTYPE=targeted","title":"\u4fee\u590dCentos7\u7684SELINUX\u9519\u8bef"},{"location":"linux/centos7%E5%8D%95%E7%94%A8%E6%88%B7%E6%A8%A1%E5%BC%8F/","text":"Centos7\u5355\u7528\u6237\u6a21\u5f0f \u5355\u7528\u6237\u6a21\u5f0f\u4e3b\u8981\u7528\u4e8e\u91cd\u7f6eroot\u5bc6\u7801\u7b49\u64cd\u4f5c \u542f\u52a8\u65f6\u5019\u5728grub\u7684\u542f\u52a8\u754c\u9762\u9009\u62e9\u5185\u6838\u7248\u672c\u65f6\u5019\u6309E\u8fdb\u5165\u7f16\u8f91\u6a21\u5f0f \u5728linux16\u5f00\u5934\u7684\u90a3\u884c\u672b\u5c3e\u51fa\u52a0\u4e0a \u7a7a\u683cinit=/bin/bash \u6309Ctrl+x\u542f\u52a8\u5373\u53ef\u8fdb\u5165\u5355\u7528\u6237\u6a21\u5f0f\uff0c\u6b64\u65f6\u53ef\u4ee5\u5bf9\u7cfb\u7edf\u5404\u5206\u533a\u5185\u5bb9\u8fdb\u884c\u4fee\u6539\u5305\u62ec\u5f3a\u5236\u91cd\u7f6eroot\u5bc6\u7801\u7b49\u64cd\u4f5c\u3002","title":"Centos7\u5355\u7528\u6237\u6a21\u5f0f"},{"location":"linux/centos7%E5%8D%95%E7%94%A8%E6%88%B7%E6%A8%A1%E5%BC%8F/#centos7","text":"\u5355\u7528\u6237\u6a21\u5f0f\u4e3b\u8981\u7528\u4e8e\u91cd\u7f6eroot\u5bc6\u7801\u7b49\u64cd\u4f5c \u542f\u52a8\u65f6\u5019\u5728grub\u7684\u542f\u52a8\u754c\u9762\u9009\u62e9\u5185\u6838\u7248\u672c\u65f6\u5019\u6309E\u8fdb\u5165\u7f16\u8f91\u6a21\u5f0f \u5728linux16\u5f00\u5934\u7684\u90a3\u884c\u672b\u5c3e\u51fa\u52a0\u4e0a \u7a7a\u683cinit=/bin/bash \u6309Ctrl+x\u542f\u52a8\u5373\u53ef\u8fdb\u5165\u5355\u7528\u6237\u6a21\u5f0f\uff0c\u6b64\u65f6\u53ef\u4ee5\u5bf9\u7cfb\u7edf\u5404\u5206\u533a\u5185\u5bb9\u8fdb\u884c\u4fee\u6539\u5305\u62ec\u5f3a\u5236\u91cd\u7f6eroot\u5bc6\u7801\u7b49\u64cd\u4f5c\u3002","title":"Centos7\u5355\u7528\u6237\u6a21\u5f0f"},{"location":"linux/centos_update_gcc/","text":"CentOS\u5b8c\u7f8e\u5347\u7ea7gcc\u7248\u672c\u65b9\u6cd5 \u5728\u67d0\u4e9b\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u9700\u8981\u7279\u5b9a\u7684gcc\u7248\u672c\u652f\u6301\uff0c\u4f46\u662f\u8f7b\u6613\u4e0d\u8981\u53bb\u7f16\u8bd1gcc\uff0c\u6211\u8fd9\u91cc\u63a8\u8350\u4f7f\u7528\u7ea2\u5e3d\u63d0\u4f9b\u7684\u5f00\u53d1\u5de5\u5177\u5305\u6765\u7ba1\u7406gcc\u7248\u672c\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u968f\u65f6\u5207\u6362\u7248\u672c\uff0c\u5e76\u4e14\u53ef\u4ee5\u5e76\u5b58\u591a\u4e2a\u7248\u672c\uff0c\u4e0d\u7834\u574f\u539f\u6709gcc\u73af\u5883\u3002 \u7ea2\u5e3d\u5b98\u65b9Developer Toolset\u6587\u6863\u5730\u5740\uff1ahttps://access.redhat.com/documentation/en-us/red_hat_developer_toolset/8/ devtoolset\u5bf9\u5e94gcc\u7684\u7248\u672c: devtoolset-3\u5bf9\u5e94gcc4.x.x\u7248\u672c devtoolset-4\u5bf9\u5e94gcc5.x.x\u7248\u672c devtoolset-6\u5bf9\u5e94gcc6.x.x\u7248\u672c devtoolset-7\u5bf9\u5e94gcc7.x.x\u7248\u672c 1\u3001\u5b89\u88c5devtoolset\u5305 yum install centos-release-scl yum install devtoolset-4 2\u3001\u6fc0\u6d3bgcc\u7248\u672c\uff0c\u4f7f\u5176\u751f\u6548 scl enable devtoolset-4 bash source /opt/rh/devtoolset-4/enable \u6ce8\u610f\uff1a\u6b64\u65f6\u901a\u8fc7gcc --version\u547d\u4ee4\u53ef\u4ee5\u770b\u5230\uff0cgcc\u7248\u672c\u5df2\u7ecf\u53d8\u62105.3.1\uff0c\u503c\u5f97\u6ce8\u610f\u7684\u662f\u8fd9\u4ec5\u4ec5\u5728\u5f53\u524dbash\u751f\u6548\uff0c\u5982\u679c\u9700\u8981\u6c38\u4e45\u751f\u6548\uff0c\u53ef\u4ee5\u8bf7\u81ea\u884c\u6dfb\u52a0\u73af\u5883\u53d8\u91cf\u3002","title":"CentOS\u5b8c\u7f8e\u5347\u7ea7gcc\u7248\u672c\u65b9\u6cd5"},{"location":"linux/centos_update_gcc/#centosgcc","text":"\u5728\u67d0\u4e9b\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u9700\u8981\u7279\u5b9a\u7684gcc\u7248\u672c\u652f\u6301\uff0c\u4f46\u662f\u8f7b\u6613\u4e0d\u8981\u53bb\u7f16\u8bd1gcc\uff0c\u6211\u8fd9\u91cc\u63a8\u8350\u4f7f\u7528\u7ea2\u5e3d\u63d0\u4f9b\u7684\u5f00\u53d1\u5de5\u5177\u5305\u6765\u7ba1\u7406gcc\u7248\u672c\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u968f\u65f6\u5207\u6362\u7248\u672c\uff0c\u5e76\u4e14\u53ef\u4ee5\u5e76\u5b58\u591a\u4e2a\u7248\u672c\uff0c\u4e0d\u7834\u574f\u539f\u6709gcc\u73af\u5883\u3002 \u7ea2\u5e3d\u5b98\u65b9Developer Toolset\u6587\u6863\u5730\u5740\uff1ahttps://access.redhat.com/documentation/en-us/red_hat_developer_toolset/8/ devtoolset\u5bf9\u5e94gcc\u7684\u7248\u672c: devtoolset-3\u5bf9\u5e94gcc4.x.x\u7248\u672c devtoolset-4\u5bf9\u5e94gcc5.x.x\u7248\u672c devtoolset-6\u5bf9\u5e94gcc6.x.x\u7248\u672c devtoolset-7\u5bf9\u5e94gcc7.x.x\u7248\u672c 1\u3001\u5b89\u88c5devtoolset\u5305 yum install centos-release-scl yum install devtoolset-4 2\u3001\u6fc0\u6d3bgcc\u7248\u672c\uff0c\u4f7f\u5176\u751f\u6548 scl enable devtoolset-4 bash source /opt/rh/devtoolset-4/enable \u6ce8\u610f\uff1a\u6b64\u65f6\u901a\u8fc7gcc --version\u547d\u4ee4\u53ef\u4ee5\u770b\u5230\uff0cgcc\u7248\u672c\u5df2\u7ecf\u53d8\u62105.3.1\uff0c\u503c\u5f97\u6ce8\u610f\u7684\u662f\u8fd9\u4ec5\u4ec5\u5728\u5f53\u524dbash\u751f\u6548\uff0c\u5982\u679c\u9700\u8981\u6c38\u4e45\u751f\u6548\uff0c\u53ef\u4ee5\u8bf7\u81ea\u884c\u6dfb\u52a0\u73af\u5883\u53d8\u91cf\u3002","title":"CentOS\u5b8c\u7f8e\u5347\u7ea7gcc\u7248\u672c\u65b9\u6cd5"},{"location":"linux/cron/","text":"cron\u5b9a\u65f6\u4efb\u52a1\u5e38\u89c1\u95ee\u9898 \u4e0d\u8981\u5047\u5b9acron\u77e5\u9053\u6240\u9700\u8981\u7684\u7279\u6b8a\u73af\u5883\uff0c\u5b83\u5176\u5b9e\u5e76\u4e0d\u77e5\u9053\u3002\u6240\u4ee5\u4f60\u8981\u4fdd\u8bc1\u5728shell\u811a\u672c\u4e2d\u63d0\u4f9b\u6240\u6709\u5fc5\u8981\u7684\u8def\u5f84\u548c\u73af\u5883\u53d8\u91cf\uff0c\u9664\u4e86\u4e00\u4e9b\u81ea\u52a8\u8bbe\u7f6e\u7684\u5168\u5c40\u53d8\u91cf\u3002 \u5982\u679ccron\u4e0d\u80fd\u8fd0\u884c\u76f8\u5e94\u7684\u811a\u672c\uff0c\u7528\u6237\u5c06\u4f1a\u6536\u5230\u4e00\u4e2a\u90ae\u4ef6\u8bf4\u660e\u5176\u4e2d\u7684\u539f\u56e0\uff08cat /var/main/root\uff09","title":"cron\u5b9a\u65f6\u4efb\u52a1\u5e38\u89c1\u95ee\u9898"},{"location":"linux/cron/#cron","text":"\u4e0d\u8981\u5047\u5b9acron\u77e5\u9053\u6240\u9700\u8981\u7684\u7279\u6b8a\u73af\u5883\uff0c\u5b83\u5176\u5b9e\u5e76\u4e0d\u77e5\u9053\u3002\u6240\u4ee5\u4f60\u8981\u4fdd\u8bc1\u5728shell\u811a\u672c\u4e2d\u63d0\u4f9b\u6240\u6709\u5fc5\u8981\u7684\u8def\u5f84\u548c\u73af\u5883\u53d8\u91cf\uff0c\u9664\u4e86\u4e00\u4e9b\u81ea\u52a8\u8bbe\u7f6e\u7684\u5168\u5c40\u53d8\u91cf\u3002 \u5982\u679ccron\u4e0d\u80fd\u8fd0\u884c\u76f8\u5e94\u7684\u811a\u672c\uff0c\u7528\u6237\u5c06\u4f1a\u6536\u5230\u4e00\u4e2a\u90ae\u4ef6\u8bf4\u660e\u5176\u4e2d\u7684\u539f\u56e0\uff08cat /var/main/root\uff09","title":"cron\u5b9a\u65f6\u4efb\u52a1\u5e38\u89c1\u95ee\u9898"},{"location":"linux/net_safe/","text":"\u7f51\u7edc\u5b89\u5168\u9632\u62a4 \u4f7f\u7528iptables\u5bf9\u4e3b\u673a\u4e0a\u67d0\u4e2a\u670d\u52a1\u8fdb\u884c\u8bbf\u95ee\u9650\u5236 \u5982\u679c\u53ef\u4ee5\u7684\u8bdd\u5c3d\u53ef\u80fd\u4ece\u6e90\u5934\u89e3\u51b3\uff0c\u5b9e\u5728\u4e0d\u65b9\u4fbf\u4ece\u6e90\u5934\u89e3\u51b3\u7684\u8bdd\u53ef\u4ee5\u4f7f\u7528\u6b64\u65b9\u6cd5\u8fdb\u884c\u8bbf\u95ee\u9650\u5236\uff0c\u907f\u514d\u88ab\u5176\u4ed6\u8f6f\u4ef6\u626b\u63cf\u51fa\u5404\u79cd\u201c\u6f0f\u6d1e\u201c \u4e3b\u673a\u6a21\u5f0f \u4f8b\u5982\u672c\u673a\u76f4\u63a5\u8fd0\u884ctomcat\u4f4d\u4e8e8080\u7aef\u53e3\uff0c\u5df2\u77e5\u53ef\u80fd\u6b63\u5e38\u8bbf\u95ee\u7684\u5ba2\u6237ip\u6765\u6e90\u4e3a\uff1a192.168.123.0/24 \u7981\u6b62\u5176\u4ed6ip\u6bb5\u8bbf\u95ee\uff0c\u5219\u53ef\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u5b9e\u73b0 #\u5148\u7981\u6b62\u5168\u90e8\u8bbf\u95ee iptables -I INPUT -p tcp -m tcp --dport 8080 --src 0.0.0.0/0 -j DROP #\u5141\u8bb8\u5408\u6cd5\u5730\u5740 iptables -I INPUT -p tcp -m tcp --dport 8080 --src 192.168.123.0/24 -j ACCEPT #\u4fdd\u5b58\u89c4\u5219 iptables-save > /etc/iptables.save #\u52a0\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d chmod +x /etc/rc.d/rc.local echo 'iptables-restore < /etc/iptables.save' >> /etc/rc.d/rc.local \u5bb9\u5668\u6a21\u5f0f \u5982\u679c\u662f\u8981\u5bf9\u4f4d\u4e8e\u5bb9\u5668\u4e2d\u7684\u670d\u52a1\u8fdb\u884c\u9632\u62a4\u9700\u8981\u6307\u5b9a\u5bb9\u5668\u4e13\u5c5e\u7684\u89c4\u5219\u94fe\uff0c\u5982\u4e0b #\u5148\u7981\u6b62\u5168\u90e8\u8bbf\u95ee iptables -I DOCKER -p tcp -m tcp --dport 8080 --src 0.0.0.0/0 -j DROP #\u5141\u8bb8\u5408\u6cd5\u5730\u5740 iptables -I DOCKER -p tcp -m tcp --dport 8080 --src 192.168.123.0/24 -j ACCEPT #\u4fdd\u5b58\u89c4\u5219 iptables-save > /etc/iptables.save #\u52a0\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d chmod +x /etc/rc.d/rc.local echo 'iptables-restore < /etc/iptables.save' >> /etc/rc.d/rc.local","title":"\u7f51\u7edc\u5b89\u5168\u9632\u62a4"},{"location":"linux/net_safe/#_1","text":"","title":"\u7f51\u7edc\u5b89\u5168\u9632\u62a4"},{"location":"linux/net_safe/#iptables","text":"\u5982\u679c\u53ef\u4ee5\u7684\u8bdd\u5c3d\u53ef\u80fd\u4ece\u6e90\u5934\u89e3\u51b3\uff0c\u5b9e\u5728\u4e0d\u65b9\u4fbf\u4ece\u6e90\u5934\u89e3\u51b3\u7684\u8bdd\u53ef\u4ee5\u4f7f\u7528\u6b64\u65b9\u6cd5\u8fdb\u884c\u8bbf\u95ee\u9650\u5236\uff0c\u907f\u514d\u88ab\u5176\u4ed6\u8f6f\u4ef6\u626b\u63cf\u51fa\u5404\u79cd\u201c\u6f0f\u6d1e\u201c","title":"\u4f7f\u7528iptables\u5bf9\u4e3b\u673a\u4e0a\u67d0\u4e2a\u670d\u52a1\u8fdb\u884c\u8bbf\u95ee\u9650\u5236"},{"location":"linux/net_safe/#_2","text":"\u4f8b\u5982\u672c\u673a\u76f4\u63a5\u8fd0\u884ctomcat\u4f4d\u4e8e8080\u7aef\u53e3\uff0c\u5df2\u77e5\u53ef\u80fd\u6b63\u5e38\u8bbf\u95ee\u7684\u5ba2\u6237ip\u6765\u6e90\u4e3a\uff1a192.168.123.0/24 \u7981\u6b62\u5176\u4ed6ip\u6bb5\u8bbf\u95ee\uff0c\u5219\u53ef\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u5b9e\u73b0 #\u5148\u7981\u6b62\u5168\u90e8\u8bbf\u95ee iptables -I INPUT -p tcp -m tcp --dport 8080 --src 0.0.0.0/0 -j DROP #\u5141\u8bb8\u5408\u6cd5\u5730\u5740 iptables -I INPUT -p tcp -m tcp --dport 8080 --src 192.168.123.0/24 -j ACCEPT #\u4fdd\u5b58\u89c4\u5219 iptables-save > /etc/iptables.save #\u52a0\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d chmod +x /etc/rc.d/rc.local echo 'iptables-restore < /etc/iptables.save' >> /etc/rc.d/rc.local","title":"\u4e3b\u673a\u6a21\u5f0f"},{"location":"linux/net_safe/#_3","text":"\u5982\u679c\u662f\u8981\u5bf9\u4f4d\u4e8e\u5bb9\u5668\u4e2d\u7684\u670d\u52a1\u8fdb\u884c\u9632\u62a4\u9700\u8981\u6307\u5b9a\u5bb9\u5668\u4e13\u5c5e\u7684\u89c4\u5219\u94fe\uff0c\u5982\u4e0b #\u5148\u7981\u6b62\u5168\u90e8\u8bbf\u95ee iptables -I DOCKER -p tcp -m tcp --dport 8080 --src 0.0.0.0/0 -j DROP #\u5141\u8bb8\u5408\u6cd5\u5730\u5740 iptables -I DOCKER -p tcp -m tcp --dport 8080 --src 192.168.123.0/24 -j ACCEPT #\u4fdd\u5b58\u89c4\u5219 iptables-save > /etc/iptables.save #\u52a0\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d chmod +x /etc/rc.d/rc.local echo 'iptables-restore < /etc/iptables.save' >> /etc/rc.d/rc.local","title":"\u5bb9\u5668\u6a21\u5f0f"},{"location":"linux/net_speed_test/","text":"\u5e26\u5bbd\u6d4b\u8bd5 \u901a\u8fc7iperf3\u8fdb\u884c\u5e26\u5bbd\u6d4b\u8bd5 #\u5728\u8981\u6d4b\u8bd5\u7684\u673a\u5668\u5b89\u88c5iperf3 yum install iperf3 -y #\u5728A\u673a\u5668\u6267\u884c\u76d1\u542c ipA:iperf3 -s #\u5728B\u673a\u5668\u6267\u884c\u53d1\u9001 ipB:iperf3 -c ipA -b 10000M -n 100G","title":"\u5e26\u5bbd\u6d4b\u8bd5"},{"location":"linux/net_speed_test/#_1","text":"","title":"\u5e26\u5bbd\u6d4b\u8bd5"},{"location":"linux/net_speed_test/#iperf3","text":"#\u5728\u8981\u6d4b\u8bd5\u7684\u673a\u5668\u5b89\u88c5iperf3 yum install iperf3 -y #\u5728A\u673a\u5668\u6267\u884c\u76d1\u542c ipA:iperf3 -s #\u5728B\u673a\u5668\u6267\u884c\u53d1\u9001 ipB:iperf3 -c ipA -b 10000M -n 100G","title":"\u901a\u8fc7iperf3\u8fdb\u884c\u5e26\u5bbd\u6d4b\u8bd5"},{"location":"linux/nfs/","text":"\u9488\u5bf9\u5927\u6570\u636e\u7ec4\u4ef6\u7684NFS\u6302\u8f7d\u53c2\u6570 nfs\u6302\u8f7d\u7684\u8fdc\u7a0b\u78c1\u76d8\u5982\u679c\u7528\u4e8ekafka\u3001zookeeper\u3001hadoop \u4e4b\u7c7b\u7684\u7ec4\u4ef6\u9700\u8981\u589e\u52a0 nolock \u5c5e\u6027","title":"\u9488\u5bf9\u5927\u6570\u636e\u7ec4\u4ef6\u7684NFS\u6302\u8f7d\u53c2\u6570"},{"location":"linux/nfs/#nfs","text":"nfs\u6302\u8f7d\u7684\u8fdc\u7a0b\u78c1\u76d8\u5982\u679c\u7528\u4e8ekafka\u3001zookeeper\u3001hadoop \u4e4b\u7c7b\u7684\u7ec4\u4ef6\u9700\u8981\u589e\u52a0 nolock \u5c5e\u6027","title":"\u9488\u5bf9\u5927\u6570\u636e\u7ec4\u4ef6\u7684NFS\u6302\u8f7d\u53c2\u6570"},{"location":"linux/nginx/","text":"nginx\u8d1f\u8f7d\u5747\u8861 \u8ba1\u7b97\u751f\u4ea7\u73af\u5883\u5927\u81f4\u7684\u7f51\u7edc\u6d41\u91cf\uff0c\u770b\u770b\u5728\u5f53\u524d\u51c6\u5907\u4f5c\u4e3a\u8d1f\u8f7d\u7684\u673a\u5668\u7684\u7269\u7406\u94fe\u8def\u80fd\u5426\u627f\u53d7\u7684\u4f4f\uff1f\u4e3b\u8981\u6709\uff1a\u4ea4\u6362\u673a\u3001\u8def\u7531\u5668\u3001\u7f51\u7ebf\u3001\u7f51\u5361\uff1b \u603b\u7684\u6d41\u91cf\u5747\u5206\u7ed9\u8d1f\u8f7d\u7684\u540e\u7aef\u8282\u70b9\u65f6\u5019\u6bcf\u4e2a\u8282\u70b9\u5230\u8d1f\u8f7d\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u94fe\u8def\u662f\u5426\u5b58\u5728\u74f6\u9888\uff1f\u95f2\u65f6\uff1f\u5fd9\u65f6\uff1f\u662f\u5426\u7559\u4e86\u8db3\u591f\u7684\u5197\u4f59\uff1b \u8fdb\u7a0b\u6570\u8bbe\u7f6e\u4e3acpu\u6838\u5fc3\u6570","title":"nginx\u8d1f\u8f7d\u5747\u8861"},{"location":"linux/nginx/#nginx","text":"\u8ba1\u7b97\u751f\u4ea7\u73af\u5883\u5927\u81f4\u7684\u7f51\u7edc\u6d41\u91cf\uff0c\u770b\u770b\u5728\u5f53\u524d\u51c6\u5907\u4f5c\u4e3a\u8d1f\u8f7d\u7684\u673a\u5668\u7684\u7269\u7406\u94fe\u8def\u80fd\u5426\u627f\u53d7\u7684\u4f4f\uff1f\u4e3b\u8981\u6709\uff1a\u4ea4\u6362\u673a\u3001\u8def\u7531\u5668\u3001\u7f51\u7ebf\u3001\u7f51\u5361\uff1b \u603b\u7684\u6d41\u91cf\u5747\u5206\u7ed9\u8d1f\u8f7d\u7684\u540e\u7aef\u8282\u70b9\u65f6\u5019\u6bcf\u4e2a\u8282\u70b9\u5230\u8d1f\u8f7d\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u94fe\u8def\u662f\u5426\u5b58\u5728\u74f6\u9888\uff1f\u95f2\u65f6\uff1f\u5fd9\u65f6\uff1f\u662f\u5426\u7559\u4e86\u8db3\u591f\u7684\u5197\u4f59\uff1b \u8fdb\u7a0b\u6570\u8bbe\u7f6e\u4e3acpu\u6838\u5fc3\u6570","title":"nginx\u8d1f\u8f7d\u5747\u8861"},{"location":"linux/update_centos7_kernel/","text":"Centos7 \u5347\u7ea7\u5185\u6838\u7248\u672c \u67e5\u770b\u5f53\u524d\u5185\u6838\u7248\u672c uname -r #3.10.0-514.el7.x86_64 uname -a #Linux k8s-master 3.10.0-514.el7.x86_64 #1 SMP Tue Nov 22 16:42:41 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux cat/etc/redhat\u2212release #CentOSLinuxrelease7.3.1611(Core) \u66f4\u65b0yum\u6e90\u4ed3\u5e93 yum -y update #\u542f\u7528 ELRepo \u4ed3\u5e93 ELRepo \u4ed3\u5e93\u662f\u57fa\u4e8e\u793e\u533a\u7684\u7528\u4e8e\u4f01\u4e1a\u7ea7 Linux \u4ed3\u5e93\uff0c\u63d0\u4f9b\u5bf9 RedHat Enterprise (RHEL) \u548c \u5176\u4ed6\u57fa\u4e8e RHEL\u7684 Linux \u53d1\u884c\u7248\uff08CentOS\u3001Scientific\u3001Fedora \u7b49\uff09\u7684\u652f\u6301\u3002 ELRepo \u805a\u7126\u4e8e\u548c\u786c\u4ef6\u76f8\u5173\u7684\u8f6f\u4ef6\u5305\uff0c\u5305\u62ec\u6587\u4ef6\u7cfb\u7edf\u9a71\u52a8\u3001\u663e\u5361\u9a71\u52a8\u3001\u7f51\u7edc\u9a71\u52a8\u3001\u58f0\u5361\u9a71\u52a8\u548c\u6444\u50cf\u5934\u9a71\u52a8\u7b49\u3002 #\u5bfc\u5165ELRepo\u4ed3\u5e93\u7684\u516c\u5171\u5bc6\u94a5 rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org #\u5b89\u88c5ELRepo\u4ed3\u5e93\u7684yum\u6e90 rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm \u67e5\u770b\u53ef\u7528\u7684\u7cfb\u7edf\u5185\u6838\u5305 \u53ef\u4ee5\u770b\u52304.4\u548c4.18\u4e24\u4e2a\u7248\u672c yum --disablerepo=\"*\" --enablerepo=\"elrepo-kernel\" list available Loaded plugins: fastestmirror Loading mirror speeds from cached hostfile elrepo-kernel: mirrors.tuna.tsinghua.edu.cn elrepo-kernel | 2.9 kB 00:00:00 elrepo-kernel/primary_db | 1.8 MB 00:00:03 Available Packages kernel-lt.x86_64 4.4.155-1.el7.elrepo elrepo-kernel kernel-lt-devel.x86_64 4.4.155-1.el7.elrepo elrepo-kernel kernel-lt-doc.noarch 4.4.155-1.el7.elrepo elrepo-kernel kernel-lt-headers.x86_64 4.4.155-1.el7.elrepo elrepo-kernel kernel-lt-tools.x86_64 4.4.155-1.el7.elrepo elrepo-kernel kernel-lt-tools-libs.x86_64 4.4.155-1.el7.elrepo elrepo-kernel kernel-lt-tools-libs-devel.x86_64 4.4.155-1.el7.elrepo elrepo-kernel kernel-ml.x86_64 4.18.7-1.el7.elrepo elrepo-kernel kernel-ml-devel.x86_64 4.18.7-1.el7.elrepo elrepo-kernel kernel-ml-doc.noarch 4.18.7-1.el7.elrepo elrepo-kernel kernel-ml-headers.x86_64 4.18.7-1.el7.elrepo elrepo-kernel kernel-ml-tools.x86_64 4.18.7-1.el7.elrepo elrepo-kernel kernel-ml-tools-libs.x86_64 4.18.7-1.el7.elrepo elrepo-kernel kernel-ml-tools-libs-devel.x86_64 4.18.7-1.el7.elrepo elrepo-kernel perf.x86_64 4.18.7-1.el7.elrepo elrepo-kernel python-perf.x86_64 4.18.7-1.el7.elrepo elrepo- \u5b89\u88c5\u6700\u65b0\u7248\u672c\u5185\u6838 yum --enablerepo=elrepo-kernel install kernel-ml --enablerepo \u9009\u9879\u5f00\u542f CentOS \u7cfb\u7edf\u4e0a\u7684\u6307\u5b9a\u4ed3\u5e93\u3002\u9ed8\u8ba4\u5f00\u542f\u7684\u662f elrepo\uff0c\u8fd9\u91cc\u7528 elrepo-kernel \u66ff\u6362\u3002 \u8bbe\u7f6e grub2 \u5185\u6838\u5b89\u88c5\u597d\u540e\uff0c\u9700\u8981\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u542f\u52a8\u9009\u9879\u5e76\u91cd\u542f\u540e\u624d\u4f1a\u751f\u6548 \u67e5\u770b\u7cfb\u7edf\u4e0a\u7684\u6240\u6709\u53ef\u7528\u5185\u6838\uff1a sudo awk\u2212F \u2032\u2032sudoawk\u2212F\u20331==\"menuentry \" {print i++ \" : \" $2}' /etc/grub2.cfg 0 : CentOS Linux (4.18.7-1.el7.elrepo.x86_64) 7 (Core) 1 : CentOS Linux (3.10.0-862.11.6.el7.x86_64) 7 (Core) 2 : CentOS Linux (3.10.0-514.el7.x86_64) 7 (Core) 3 : CentOS Linux (0-rescue-063ec330caa04d4baae54c6902c62e54) 7 (Core) \u8bbe\u7f6e\u65b0\u7684\u5185\u6838\u4e3agrub2\u7684\u9ed8\u8ba4\u7248\u672c \u670d\u52a1\u5668\u4e0a\u5b58\u57284 \u4e2a\u5185\u6838\uff0c\u6211\u4eec\u8981\u4f7f\u7528 4.18 \u8fd9\u4e2a\u7248\u672c\uff0c\u53ef\u4ee5\u901a\u8fc7 grub2-set-default 0 \u547d\u4ee4\u6216\u7f16\u8f91 /etc/default/grub \u6587\u4ef6\u6765\u8bbe\u7f6e \u901a\u8fc7 grub2-set-default 0 \u547d\u4ee4\u8bbe\u7f6e \u5176\u4e2d 0 \u662f\u4e0a\u9762\u67e5\u8be2\u51fa\u6765\u7684\u53ef\u7528\u5185\u6838 \u91cd\u542f reboot \u9a8c\u8bc1 uname -r \u663e\u793a4.18.7-1.el7.elrepo.x86_64 \u5220\u9664\u65e7\u5185\u6838\uff08\u53ef\u9009\uff09 \u67e5\u770b\u7cfb\u7edf\u4e2d\u5168\u90e8\u7684\u5185\u6838\uff1a rpm\u2212qa|grep kernel kernel\u22123.10.0\u2212514.el7.x86_64 kernel\u2212ml\u22124.18.7\u22121.el7.elrepo.x86_64 kernel\u2212tools\u2212libs\u22123.10.0\u2212862.11.6.el7.x86_64 kernel\u2212tools\u22123.10.0\u2212862.11.6.el7.x86_64 kernel\u22123.10.0\u2212862.11.6.el7.x86_64 \u65b9\u6cd51\u3001yum remove\u5220\u9664\u65e7\u5185\u6838\u7684RPM\u5305 yum remove kernel-3.10.0-514.el7.x86_64 kernel-tools-libs-3.10.0-862.11.6.el7.x86_64 kernel-tools-3.10.0-862.11.6.el7.x86_64 kernel-3.10.0-862.11.6.el7.x86_64","title":"Centos7 \u5347\u7ea7\u5185\u6838\u7248\u672c"},{"location":"linux/update_centos7_kernel/#centos7","text":"\u67e5\u770b\u5f53\u524d\u5185\u6838\u7248\u672c uname -r #3.10.0-514.el7.x86_64 uname -a #Linux k8s-master 3.10.0-514.el7.x86_64 #1 SMP Tue Nov 22 16:42:41 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux cat/etc/redhat\u2212release #CentOSLinuxrelease7.3.1611(Core) \u66f4\u65b0yum\u6e90\u4ed3\u5e93 yum -y update #\u542f\u7528 ELRepo \u4ed3\u5e93 ELRepo \u4ed3\u5e93\u662f\u57fa\u4e8e\u793e\u533a\u7684\u7528\u4e8e\u4f01\u4e1a\u7ea7 Linux \u4ed3\u5e93\uff0c\u63d0\u4f9b\u5bf9 RedHat Enterprise (RHEL) \u548c \u5176\u4ed6\u57fa\u4e8e RHEL\u7684 Linux \u53d1\u884c\u7248\uff08CentOS\u3001Scientific\u3001Fedora \u7b49\uff09\u7684\u652f\u6301\u3002 ELRepo \u805a\u7126\u4e8e\u548c\u786c\u4ef6\u76f8\u5173\u7684\u8f6f\u4ef6\u5305\uff0c\u5305\u62ec\u6587\u4ef6\u7cfb\u7edf\u9a71\u52a8\u3001\u663e\u5361\u9a71\u52a8\u3001\u7f51\u7edc\u9a71\u52a8\u3001\u58f0\u5361\u9a71\u52a8\u548c\u6444\u50cf\u5934\u9a71\u52a8\u7b49\u3002 #\u5bfc\u5165ELRepo\u4ed3\u5e93\u7684\u516c\u5171\u5bc6\u94a5 rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org #\u5b89\u88c5ELRepo\u4ed3\u5e93\u7684yum\u6e90 rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm \u67e5\u770b\u53ef\u7528\u7684\u7cfb\u7edf\u5185\u6838\u5305 \u53ef\u4ee5\u770b\u52304.4\u548c4.18\u4e24\u4e2a\u7248\u672c yum --disablerepo=\"*\" --enablerepo=\"elrepo-kernel\" list available Loaded plugins: fastestmirror Loading mirror speeds from cached hostfile elrepo-kernel: mirrors.tuna.tsinghua.edu.cn elrepo-kernel | 2.9 kB 00:00:00 elrepo-kernel/primary_db | 1.8 MB 00:00:03 Available Packages kernel-lt.x86_64 4.4.155-1.el7.elrepo elrepo-kernel kernel-lt-devel.x86_64 4.4.155-1.el7.elrepo elrepo-kernel kernel-lt-doc.noarch 4.4.155-1.el7.elrepo elrepo-kernel kernel-lt-headers.x86_64 4.4.155-1.el7.elrepo elrepo-kernel kernel-lt-tools.x86_64 4.4.155-1.el7.elrepo elrepo-kernel kernel-lt-tools-libs.x86_64 4.4.155-1.el7.elrepo elrepo-kernel kernel-lt-tools-libs-devel.x86_64 4.4.155-1.el7.elrepo elrepo-kernel kernel-ml.x86_64 4.18.7-1.el7.elrepo elrepo-kernel kernel-ml-devel.x86_64 4.18.7-1.el7.elrepo elrepo-kernel kernel-ml-doc.noarch 4.18.7-1.el7.elrepo elrepo-kernel kernel-ml-headers.x86_64 4.18.7-1.el7.elrepo elrepo-kernel kernel-ml-tools.x86_64 4.18.7-1.el7.elrepo elrepo-kernel kernel-ml-tools-libs.x86_64 4.18.7-1.el7.elrepo elrepo-kernel kernel-ml-tools-libs-devel.x86_64 4.18.7-1.el7.elrepo elrepo-kernel perf.x86_64 4.18.7-1.el7.elrepo elrepo-kernel python-perf.x86_64 4.18.7-1.el7.elrepo elrepo- \u5b89\u88c5\u6700\u65b0\u7248\u672c\u5185\u6838 yum --enablerepo=elrepo-kernel install kernel-ml --enablerepo \u9009\u9879\u5f00\u542f CentOS \u7cfb\u7edf\u4e0a\u7684\u6307\u5b9a\u4ed3\u5e93\u3002\u9ed8\u8ba4\u5f00\u542f\u7684\u662f elrepo\uff0c\u8fd9\u91cc\u7528 elrepo-kernel \u66ff\u6362\u3002 \u8bbe\u7f6e grub2 \u5185\u6838\u5b89\u88c5\u597d\u540e\uff0c\u9700\u8981\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u542f\u52a8\u9009\u9879\u5e76\u91cd\u542f\u540e\u624d\u4f1a\u751f\u6548 \u67e5\u770b\u7cfb\u7edf\u4e0a\u7684\u6240\u6709\u53ef\u7528\u5185\u6838\uff1a sudo awk\u2212F \u2032\u2032sudoawk\u2212F\u20331==\"menuentry \" {print i++ \" : \" $2}' /etc/grub2.cfg 0 : CentOS Linux (4.18.7-1.el7.elrepo.x86_64) 7 (Core) 1 : CentOS Linux (3.10.0-862.11.6.el7.x86_64) 7 (Core) 2 : CentOS Linux (3.10.0-514.el7.x86_64) 7 (Core) 3 : CentOS Linux (0-rescue-063ec330caa04d4baae54c6902c62e54) 7 (Core) \u8bbe\u7f6e\u65b0\u7684\u5185\u6838\u4e3agrub2\u7684\u9ed8\u8ba4\u7248\u672c \u670d\u52a1\u5668\u4e0a\u5b58\u57284 \u4e2a\u5185\u6838\uff0c\u6211\u4eec\u8981\u4f7f\u7528 4.18 \u8fd9\u4e2a\u7248\u672c\uff0c\u53ef\u4ee5\u901a\u8fc7 grub2-set-default 0 \u547d\u4ee4\u6216\u7f16\u8f91 /etc/default/grub \u6587\u4ef6\u6765\u8bbe\u7f6e \u901a\u8fc7 grub2-set-default 0 \u547d\u4ee4\u8bbe\u7f6e \u5176\u4e2d 0 \u662f\u4e0a\u9762\u67e5\u8be2\u51fa\u6765\u7684\u53ef\u7528\u5185\u6838 \u91cd\u542f reboot \u9a8c\u8bc1 uname -r \u663e\u793a4.18.7-1.el7.elrepo.x86_64 \u5220\u9664\u65e7\u5185\u6838\uff08\u53ef\u9009\uff09 \u67e5\u770b\u7cfb\u7edf\u4e2d\u5168\u90e8\u7684\u5185\u6838\uff1a rpm\u2212qa|grep kernel kernel\u22123.10.0\u2212514.el7.x86_64 kernel\u2212ml\u22124.18.7\u22121.el7.elrepo.x86_64 kernel\u2212tools\u2212libs\u22123.10.0\u2212862.11.6.el7.x86_64 kernel\u2212tools\u22123.10.0\u2212862.11.6.el7.x86_64 kernel\u22123.10.0\u2212862.11.6.el7.x86_64 \u65b9\u6cd51\u3001yum remove\u5220\u9664\u65e7\u5185\u6838\u7684RPM\u5305 yum remove kernel-3.10.0-514.el7.x86_64 kernel-tools-libs-3.10.0-862.11.6.el7.x86_64 kernel-tools-3.10.0-862.11.6.el7.x86_64 kernel-3.10.0-862.11.6.el7.x86_64","title":"Centos7 \u5347\u7ea7\u5185\u6838\u7248\u672c"},{"location":"store/seaweedfs/","text":"seaweedfs \u7b80\u4ecb:seaweedfs\u662f\u4e00\u5957\u57fa\u4e8ego\u8bed\u8a00\u5f00\u53d1\u7684\u5206\u5e03\u5f0f\u5b58\u50a8\u7cfb\u7edf\uff0c\u76ee\u524d\u6700\u4f73\u7684\u6d77\u91cf\u5c0f\u6587\u4ef6\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\uff08\u5927\u4e2d\u578b\u6587\u4ef6\u5b58\u50a8\u4e5f\u6ca1\u95ee\u9898\uff09\uff0c\u652f\u6301fuse\u52a0\u8f7d\u3001\u652f\u6301api\u65b9\u5f0f\u8c03\u7528\u3001\u652f\u6301\u8bbe\u7f6e\u6709\u6548\u671f\u81ea\u52a8\u6e05\u7406\u3001\u652f\u6301\u591a\u673a\u623f\u591a\u673a\u67dc\u5f02\u5730\u5bb9\u707e\u7b49,\u9879\u76ee\u5730\u5740\uff1ahttps://github.com/chrislusf/seaweedfs \u642d\u5efa #\u6700\u5c0f\u5316\u96c6\u7fa4\uff08master+volume+filer\uff09 ./weed server -dir data/vol1 -filer -ip localhost -master.dir data/mdir -volume.images.fix.orientation -volume.max 5000 - volume.port 9334 #\u5728\u53e6\u5916\u7684\u673a\u5668\u52a0\u4e00\u4e2avol\u8282\u70b9 ./weed volume -dir data/vol2 -images.fix.orientation -port 9335 -ip localhost -max 5000 #\u5728\u53e6\u5916\u7684\u673a\u5668\u52a0\u4e00\u4e2amaster\u8282\u70b9\uff08master\u8282\u70b9\u9700\u8981\u5355\u6570\u4e2a\uff09 ./weed master -ip localhost -mdir data/mdir -port 9333 -peers masterip1:9333,masterip2:9333 #\u5728\u53e6\u5916\u673a\u5668\u52a0filer\u8282\u70b9 ./weed filer -ip localhost -master masterip1:9333,masterip2:9333 -peers filerip1:8888,filerip2:8888 -port 8888 \u6ce8\u610f\u4e8b\u9879 volume\u7684max\u53c2\u6570\u4ee3\u8868\u6700\u5927\u53ef\u521b\u5efa\u7684\u5757\u6570\u91cf\uff0c\u4e00\u4e2a\u5757\u9ed8\u8ba4\u4e3a30GB\uff0c\u6839\u636e\u5b9e\u4f8b\u6240\u5728\u670d\u52a1\u5668\u7684\u78c1\u76d8\u7a7a\u95f4\u8ba1\u7b97\uff0c\u4fdd\u7559\u5fc5\u8981\u7684\u5197\u4f59\u4e4b\u540e\u53ef\u4ee5\u5c3d\u53ef\u80fd\u591a\u7684\u8bbe\u7f6e\u3002 \u4f7f\u7528seaweedfs\u7684filer\u7ec4\u4ef6\u5b58\u50a8\u56fe\u7247\u5982\u679c\u51fa\u73b0502\u3001503\u3001\u5404\u79cdtimeout\u7684\u9519\u8bef\u5728\u6392\u9664\u7f51\u7edc\u5e26\u5bbd\u3001filer.toml\u8bbe\u7f6e\u7684\u6700\u5927\u6570\u636e\u5e93\u8fde\u63a5\u6570 \u7684\u56e0\u7d20\u540e\u53ef\u4ee5\u5c1d\u8bd5\u5206\u6d41filer\u670d\u52a1\u7684\u6d41\u91cf\uff0c\u56e0\u4e3a\u6839\u636eseaweedfs\u7684wiki\u4e2d\u8bf4\u7684filer\u8981\u5904\u7406\u6587\u4ef6\u5185\u5bb9\u5e76\u5b8c\u6210\u7f51\u7edc\u8bf7\u6c42\u7684\u5206\u53d1\u6240\u4ee5\u538b\u529b\u6bd4\u8f83\u5927\uff0c\u6240\u4ee5\u9002\u65f6\u5730\u6269\u5145\u66f4\u591a\u7684filer\u8282\u70b9\u80fd\u6709\u6548\u7684\u964d\u4f4e\u6216\u907f\u514d50x\u4ee5\u53catimeout\u7684\u53d1\u751f \u4f7f\u7528 #curl\u901a\u8fc7filer\u4e0a\u4f20\u56fe\u7247 curl http://ipaddr:8888/testjpg.jpg -F \"img=@/tmp/testjpg.jpg\" #curl\u901a\u8fc7filer\u4e0a\u4f20\u56fe\u7247\u56fe\u7247\u6709\u6548\u671f1\u5e74 curl http://ipaddr:8888/testjpg.jpg?ttl=1y -F \"img=@/tmp/testjpg.jpg\" #\u4e0d\u4f7f\u7528filer\u4e0a\u4f20 curl http://ipaddr:9333/dir/assign #\u4e0d\u4f7f\u7528filer\u4e0a\u4f20\u56fe\u7247\u6709\u6548\u671f1\u4e2a\u6708 curl http://ipaddr:9333/dir/assign?ttl=1m #\u8fd4\u56de: {\"fid\":\"123,12312321312\",\"url\":\"ipaddrreturnbymaster:9334\",\"publicUrl\":\"ipaddr:9334\",\"count\":1} #\u4e0a\u4f20\u6587\u4ef6 curl http://ipaddrreturnbymaster:9334/123,12312321312 -F \"img=@/tmp/testjpg.jpg\" #\u901a\u8fc7filer\u5c06\u6587\u4ef6\u6302\u8f7d\u5230\u672c\u5730\u64cd\u4f5c weed mount -filer=localhost:8888 -dir=/some/existing/dir -filer.path=/one/remote/folder \u901a\u8fc7kotlin\u8c03\u7528\uff08java\u7c7b\u4f3c\uff09 //\u4f7f\u7528javaclient\u64cd\u4f5cseaweedfs filer\u63a5\u53e3 //kotlin+hutool+seaweedfs-javaclient @Test fun filerTest(){ //connect to filer grpc port val fc=FilerClient(\"localhost\",18888) //\u51c6\u5907\u6570\u636e val ba15mb= RandomUtils.nextBytes(1024*1024*15) val ba1mb=RandomUtils.nextBytes(1024*1024) val ba50mb=RandomUtils.nextBytes(1024*1024*50) //\u6e05\u7406\u6d4b\u8bd5\u76ee\u5f55 fc.rm(\"/ice\",true,true) fc.mkdirs(\"/ice\",666) for (i in 0 until 10){ var sos1:SeaweedOutputStream var sos15:SeaweedOutputStream var sos50:SeaweedOutputStream var ut= measureTimeMillis { sos1=SeaweedOutputStream(fc,\"/ice/idx_${i}_1mb.dat\") sos15=SeaweedOutputStream(fc,\"/ice/idx_${i}_15mb.txt\") sos50=SeaweedOutputStream(fc,\"/ice/idx_${i}_50mb.txt\") } println(\"ut1:${ut} ms\") ut= measureTimeMillis { sos1?.use { it.write(ba1mb) } sos15?.use { it.write(ba15mb) } sos50?.use { it.write(ba50mb) } } println(\"ut2:${ut} ms\") } println(\"ok\") } //\u6d4b\u8bd5\u7ed3\u679c\uff1aut1:20 ms //ut2:7104 ms //ut1:1 ms //ut2:683 ms //ut1:0 ms //ut2:691 ms //ut1:0 ms //ut2:632 ms //ut1:0 ms //ut2:738 ms //ut1:0 ms //ut2:720 ms //ut1:0 ms //ut2:655 ms //ut1:1 ms //ut2:658 ms //ut1:1 ms //ut2:667 ms //ut1:0 ms //ut2:634 ms //ok \u6027\u80fd\u4f18\u5316 \u589e\u52a0\u5e76\u53d1\u5199\u5165\u652f\u6301 #\u5e76\u53d1\u5199\u516512\u4e2avolume\u590d\u5236\u4efd\u6570\u4e3a2\u5b9e\u9645\u5199\u5165\u4e3a24\u4e2avolume\u5e76\u53d1\u5199\u5165\uff08\u540c\u65f6\u5199\u516512\u4e2a\u4e0d\u540c\u7684\uff09 curl http://localhost:9333/vol/grow?count=12&replication=001 \u589e\u52a0\u5e76\u53d1\u8bfb\u53d6\u652f\u6301 #\u8bbe\u7f6e\u590d\u5236\u4efd\u6570\u4e3a2\u5219\u540c\u4e00\u4e2a\u6587\u4ef6\u652f\u6301\u4e24\u4e2a\u5e76\u53d1\u8bfb\u53d6\uff0c\u4e0d\u540c\u7684\u8d44\u6e90\u5e76\u53d1\u8bfb\u53d6\u6570\u91cf\u4ee5volume\u5206\u5757\u6570\u4e3a\u51c6\uff08\u975evolume server\u8282\u70b9\u6570\uff09 curl http://localhost:9333/vol/grow?count=12&replication=001 \u589e\u52a0\u540c\u65f6\u6253\u5f00\u6587\u4ef6\u6570\u91cf #\u5148\u6267\u884c\u8fd9\u4e2a\u547d\u4ee4 ulimit -n 10240 #\u518d\u542f\u52a8seaweedfs ./weed ..... \u95ee\u9898\u5904\u7406 \u4fee\u590d\u4e22\u5931volume\uff08\u6709\u590d\u5236\u4efd\u6570\u7684\u60c5\u51b5\u4e0b\uff09,\u751f\u4ea7\u7cfb\u7edf\u5efa\u8bae\u5468\u671f\u6027\u7684\u5b9a\u65f6\u6267\u884c\u6b64\u4efb\u52a1 weed shell -master masterip:9333 volume.fix.replication","title":"seaweedfs"},{"location":"store/seaweedfs/#seaweedfs","text":"\u7b80\u4ecb:seaweedfs\u662f\u4e00\u5957\u57fa\u4e8ego\u8bed\u8a00\u5f00\u53d1\u7684\u5206\u5e03\u5f0f\u5b58\u50a8\u7cfb\u7edf\uff0c\u76ee\u524d\u6700\u4f73\u7684\u6d77\u91cf\u5c0f\u6587\u4ef6\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\uff08\u5927\u4e2d\u578b\u6587\u4ef6\u5b58\u50a8\u4e5f\u6ca1\u95ee\u9898\uff09\uff0c\u652f\u6301fuse\u52a0\u8f7d\u3001\u652f\u6301api\u65b9\u5f0f\u8c03\u7528\u3001\u652f\u6301\u8bbe\u7f6e\u6709\u6548\u671f\u81ea\u52a8\u6e05\u7406\u3001\u652f\u6301\u591a\u673a\u623f\u591a\u673a\u67dc\u5f02\u5730\u5bb9\u707e\u7b49,\u9879\u76ee\u5730\u5740\uff1ahttps://github.com/chrislusf/seaweedfs","title":"seaweedfs"},{"location":"store/seaweedfs/#_1","text":"#\u6700\u5c0f\u5316\u96c6\u7fa4\uff08master+volume+filer\uff09 ./weed server -dir data/vol1 -filer -ip localhost -master.dir data/mdir -volume.images.fix.orientation -volume.max 5000 - volume.port 9334 #\u5728\u53e6\u5916\u7684\u673a\u5668\u52a0\u4e00\u4e2avol\u8282\u70b9 ./weed volume -dir data/vol2 -images.fix.orientation -port 9335 -ip localhost -max 5000 #\u5728\u53e6\u5916\u7684\u673a\u5668\u52a0\u4e00\u4e2amaster\u8282\u70b9\uff08master\u8282\u70b9\u9700\u8981\u5355\u6570\u4e2a\uff09 ./weed master -ip localhost -mdir data/mdir -port 9333 -peers masterip1:9333,masterip2:9333 #\u5728\u53e6\u5916\u673a\u5668\u52a0filer\u8282\u70b9 ./weed filer -ip localhost -master masterip1:9333,masterip2:9333 -peers filerip1:8888,filerip2:8888 -port 8888","title":"\u642d\u5efa"},{"location":"store/seaweedfs/#_2","text":"volume\u7684max\u53c2\u6570\u4ee3\u8868\u6700\u5927\u53ef\u521b\u5efa\u7684\u5757\u6570\u91cf\uff0c\u4e00\u4e2a\u5757\u9ed8\u8ba4\u4e3a30GB\uff0c\u6839\u636e\u5b9e\u4f8b\u6240\u5728\u670d\u52a1\u5668\u7684\u78c1\u76d8\u7a7a\u95f4\u8ba1\u7b97\uff0c\u4fdd\u7559\u5fc5\u8981\u7684\u5197\u4f59\u4e4b\u540e\u53ef\u4ee5\u5c3d\u53ef\u80fd\u591a\u7684\u8bbe\u7f6e\u3002 \u4f7f\u7528seaweedfs\u7684filer\u7ec4\u4ef6\u5b58\u50a8\u56fe\u7247\u5982\u679c\u51fa\u73b0502\u3001503\u3001\u5404\u79cdtimeout\u7684\u9519\u8bef\u5728\u6392\u9664\u7f51\u7edc\u5e26\u5bbd\u3001filer.toml\u8bbe\u7f6e\u7684\u6700\u5927\u6570\u636e\u5e93\u8fde\u63a5\u6570 \u7684\u56e0\u7d20\u540e\u53ef\u4ee5\u5c1d\u8bd5\u5206\u6d41filer\u670d\u52a1\u7684\u6d41\u91cf\uff0c\u56e0\u4e3a\u6839\u636eseaweedfs\u7684wiki\u4e2d\u8bf4\u7684filer\u8981\u5904\u7406\u6587\u4ef6\u5185\u5bb9\u5e76\u5b8c\u6210\u7f51\u7edc\u8bf7\u6c42\u7684\u5206\u53d1\u6240\u4ee5\u538b\u529b\u6bd4\u8f83\u5927\uff0c\u6240\u4ee5\u9002\u65f6\u5730\u6269\u5145\u66f4\u591a\u7684filer\u8282\u70b9\u80fd\u6709\u6548\u7684\u964d\u4f4e\u6216\u907f\u514d50x\u4ee5\u53catimeout\u7684\u53d1\u751f","title":"\u6ce8\u610f\u4e8b\u9879"},{"location":"store/seaweedfs/#_3","text":"#curl\u901a\u8fc7filer\u4e0a\u4f20\u56fe\u7247 curl http://ipaddr:8888/testjpg.jpg -F \"img=@/tmp/testjpg.jpg\" #curl\u901a\u8fc7filer\u4e0a\u4f20\u56fe\u7247\u56fe\u7247\u6709\u6548\u671f1\u5e74 curl http://ipaddr:8888/testjpg.jpg?ttl=1y -F \"img=@/tmp/testjpg.jpg\" #\u4e0d\u4f7f\u7528filer\u4e0a\u4f20 curl http://ipaddr:9333/dir/assign #\u4e0d\u4f7f\u7528filer\u4e0a\u4f20\u56fe\u7247\u6709\u6548\u671f1\u4e2a\u6708 curl http://ipaddr:9333/dir/assign?ttl=1m #\u8fd4\u56de: {\"fid\":\"123,12312321312\",\"url\":\"ipaddrreturnbymaster:9334\",\"publicUrl\":\"ipaddr:9334\",\"count\":1} #\u4e0a\u4f20\u6587\u4ef6 curl http://ipaddrreturnbymaster:9334/123,12312321312 -F \"img=@/tmp/testjpg.jpg\" #\u901a\u8fc7filer\u5c06\u6587\u4ef6\u6302\u8f7d\u5230\u672c\u5730\u64cd\u4f5c weed mount -filer=localhost:8888 -dir=/some/existing/dir -filer.path=/one/remote/folder \u901a\u8fc7kotlin\u8c03\u7528\uff08java\u7c7b\u4f3c\uff09 //\u4f7f\u7528javaclient\u64cd\u4f5cseaweedfs filer\u63a5\u53e3 //kotlin+hutool+seaweedfs-javaclient @Test fun filerTest(){ //connect to filer grpc port val fc=FilerClient(\"localhost\",18888) //\u51c6\u5907\u6570\u636e val ba15mb= RandomUtils.nextBytes(1024*1024*15) val ba1mb=RandomUtils.nextBytes(1024*1024) val ba50mb=RandomUtils.nextBytes(1024*1024*50) //\u6e05\u7406\u6d4b\u8bd5\u76ee\u5f55 fc.rm(\"/ice\",true,true) fc.mkdirs(\"/ice\",666) for (i in 0 until 10){ var sos1:SeaweedOutputStream var sos15:SeaweedOutputStream var sos50:SeaweedOutputStream var ut= measureTimeMillis { sos1=SeaweedOutputStream(fc,\"/ice/idx_${i}_1mb.dat\") sos15=SeaweedOutputStream(fc,\"/ice/idx_${i}_15mb.txt\") sos50=SeaweedOutputStream(fc,\"/ice/idx_${i}_50mb.txt\") } println(\"ut1:${ut} ms\") ut= measureTimeMillis { sos1?.use { it.write(ba1mb) } sos15?.use { it.write(ba15mb) } sos50?.use { it.write(ba50mb) } } println(\"ut2:${ut} ms\") } println(\"ok\") } //\u6d4b\u8bd5\u7ed3\u679c\uff1aut1:20 ms //ut2:7104 ms //ut1:1 ms //ut2:683 ms //ut1:0 ms //ut2:691 ms //ut1:0 ms //ut2:632 ms //ut1:0 ms //ut2:738 ms //ut1:0 ms //ut2:720 ms //ut1:0 ms //ut2:655 ms //ut1:1 ms //ut2:658 ms //ut1:1 ms //ut2:667 ms //ut1:0 ms //ut2:634 ms //ok","title":"\u4f7f\u7528"},{"location":"store/seaweedfs/#_4","text":"\u589e\u52a0\u5e76\u53d1\u5199\u5165\u652f\u6301 #\u5e76\u53d1\u5199\u516512\u4e2avolume\u590d\u5236\u4efd\u6570\u4e3a2\u5b9e\u9645\u5199\u5165\u4e3a24\u4e2avolume\u5e76\u53d1\u5199\u5165\uff08\u540c\u65f6\u5199\u516512\u4e2a\u4e0d\u540c\u7684\uff09 curl http://localhost:9333/vol/grow?count=12&replication=001 \u589e\u52a0\u5e76\u53d1\u8bfb\u53d6\u652f\u6301 #\u8bbe\u7f6e\u590d\u5236\u4efd\u6570\u4e3a2\u5219\u540c\u4e00\u4e2a\u6587\u4ef6\u652f\u6301\u4e24\u4e2a\u5e76\u53d1\u8bfb\u53d6\uff0c\u4e0d\u540c\u7684\u8d44\u6e90\u5e76\u53d1\u8bfb\u53d6\u6570\u91cf\u4ee5volume\u5206\u5757\u6570\u4e3a\u51c6\uff08\u975evolume server\u8282\u70b9\u6570\uff09 curl http://localhost:9333/vol/grow?count=12&replication=001 \u589e\u52a0\u540c\u65f6\u6253\u5f00\u6587\u4ef6\u6570\u91cf #\u5148\u6267\u884c\u8fd9\u4e2a\u547d\u4ee4 ulimit -n 10240 #\u518d\u542f\u52a8seaweedfs ./weed .....","title":"\u6027\u80fd\u4f18\u5316"},{"location":"store/seaweedfs/#_5","text":"\u4fee\u590d\u4e22\u5931volume\uff08\u6709\u590d\u5236\u4efd\u6570\u7684\u60c5\u51b5\u4e0b\uff09,\u751f\u4ea7\u7cfb\u7edf\u5efa\u8bae\u5468\u671f\u6027\u7684\u5b9a\u65f6\u6267\u884c\u6b64\u4efb\u52a1 weed shell -master masterip:9333 volume.fix.replication","title":"\u95ee\u9898\u5904\u7406"},{"location":"%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E4%BC%98%E7%BC%BA%E7%82%B9/","text":"1.\u6734\u7d20\u8d1d\u53f6\u65af \u6734\u7d20\u8d1d\u53f6\u65af\u5c5e\u4e8e\u751f\u6210\u5f0f\u6a21\u578b\uff08\u5173\u4e8e\u751f\u6210\u6a21\u578b\u548c\u5224\u522b\u5f0f\u6a21\u578b\uff0c\u4e3b\u8981\u8fd8\u662f\u5728\u4e8e\u662f\u5426\u662f\u8981\u6c42\u8054\u5408\u5206\u5e03\uff09\uff0c\u975e\u5e38\u7b80\u5355\uff0c\u4f60\u53ea\u662f\u505a\u4e86\u4e00\u5806\u8ba1\u6570\u3002\u5982\u679c\u6ce8\u6709\u6761\u4ef6\u72ec\u7acb\u6027\u5047\u8bbe\uff08\u4e00\u4e2a\u6bd4\u8f83\u4e25\u683c\u7684\u6761\u4ef6\uff09\uff0c\u6734\u7d20\u8d1d\u53f6\u65af\u5206\u7c7b\u5668\u7684\u6536\u655b\u901f\u5ea6\u5c06\u5feb\u4e8e\u5224\u522b\u6a21\u578b\uff0c\u5982\u903b\u8f91\u56de\u5f52\uff0c\u6240\u4ee5\u4f60\u53ea\u9700\u8981\u8f83\u5c11\u7684\u8bad\u7ec3\u6570\u636e\u5373\u53ef\u3002\u5373\u4f7fNB\u6761\u4ef6\u72ec\u7acb\u5047\u8bbe\u4e0d\u6210\u7acb\uff0cNB\u5206\u7c7b\u5668\u5728\u5b9e\u8df5\u4e2d\u4ecd\u7136\u8868\u73b0\u7684\u5f88\u51fa\u8272\u3002\u5b83\u7684\u4e3b\u8981\u7f3a\u70b9\u662f\u5b83\u4e0d\u80fd\u5b66\u4e60\u7279\u5f81\u95f4\u7684\u76f8\u4e92\u4f5c\u7528\uff0c\u7528mRMR\u4e2dR\u6765\u8bb2\uff0c\u5c31\u662f\u7279\u5f81\u5197\u4f59\u3002\u5f15\u7528\u4e00\u4e2a\u6bd4\u8f83\u7ecf\u5178\u7684\u4f8b\u5b50\uff0c\u6bd4\u5982\uff0c\u867d\u7136\u4f60\u559c\u6b22Brad Pitt\u548cTom Cruise\u7684\u7535\u5f71\uff0c\u4f46\u662f\u5b83\u4e0d\u80fd\u5b66\u4e60\u51fa\u4f60\u4e0d\u559c\u6b22\u4ed6\u4eec\u5728\u4e00\u8d77\u6f14\u7684\u7535\u5f71\u3002 \u4f18\u70b9\uff1a \u6734\u7d20\u8d1d\u53f6\u65af\u6a21\u578b\u53d1\u6e90\u4e8e\u53e4\u5178\u6570\u5b66\u7406\u8bba\uff0c\u6709\u7740\u575a\u5b9e\u7684\u6570\u5b66\u57fa\u7840\uff0c\u4ee5\u53ca\u7a33\u5b9a\u7684\u5206\u7c7b\u6548\u7387\u3002 \u5bf9\u5c0f\u89c4\u6a21\u7684\u6570\u636e\u8868\u73b0\u5f88\u597d\uff0c\u80fd\u4e2a\u5904\u7406\u591a\u5206\u7c7b\u4efb\u52a1\uff0c\u9002\u5408\u589e\u91cf\u5f0f\u8bad\u7ec3\uff1b \u5bf9\u7f3a\u5931\u6570\u636e\u4e0d\u592a\u654f\u611f\uff0c\u7b97\u6cd5\u4e5f\u6bd4\u8f83\u7b80\u5355\uff0c\u5e38\u7528\u4e8e\u6587\u672c\u5206\u7c7b\u3002 \u7f3a\u70b9\uff1a \u9700\u8981\u8ba1\u7b97\u5148\u9a8c\u6982\u7387\uff1b \u5206\u7c7b\u51b3\u7b56\u5b58\u5728\u9519\u8bef\u7387\uff1b \u5bf9\u8f93\u5165\u6570\u636e\u7684\u8868\u8fbe\u5f62\u5f0f\u5f88\u654f\u611f\u3002 2.Logistic Regression\uff08\u903b\u8f91\u56de\u5f52\uff09 \u5c5e\u4e8e\u5224\u522b\u5f0f\u6a21\u578b\uff0c\u6709\u5f88\u591a\u6b63\u5219\u5316\u6a21\u578b\u7684\u65b9\u6cd5\uff08L0\uff0c L1\uff0cL2\uff0cetc\uff09\uff0c\u800c\u4e14\u4f60\u4e0d\u5fc5\u50cf\u5728\u7528\u6734\u7d20\u8d1d\u53f6\u65af\u90a3\u6837\u62c5\u5fc3\u4f60\u7684\u7279\u5f81\u662f\u5426\u76f8\u5173\u3002\u4e0e\u51b3\u7b56\u6811\u4e0eSVM\u673a\u76f8\u6bd4\uff0c\u4f60\u8fd8\u4f1a\u5f97\u5230\u4e00\u4e2a\u4e0d\u9519\u7684\u6982\u7387\u89e3\u91ca\uff0c\u4f60\u751a\u81f3\u53ef\u4ee5\u8f7b\u677e\u5730\u5229\u7528\u65b0\u6570\u636e\u6765\u66f4\u65b0\u6a21\u578b\uff08\u4f7f\u7528\u5728\u7ebf\u68af\u5ea6\u4e0b\u964d\u7b97\u6cd5\uff0conline gradient descent\uff09\u3002\u5982\u679c\u4f60\u9700\u8981\u4e00\u4e2a\u6982\u7387\u67b6\u6784\uff08\u6bd4\u5982\uff0c\u7b80\u5355\u5730\u8c03\u8282\u5206\u7c7b\u9608\u503c\uff0c\u6307\u660e\u4e0d\u786e\u5b9a\u6027\uff0c\u6216\u8005\u662f\u8981\u83b7\u5f97\u7f6e\u4fe1\u533a\u95f4\uff09\uff0c\u6216\u8005\u4f60\u5e0c\u671b\u4ee5\u540e\u5c06\u66f4\u591a\u7684\u8bad\u7ec3\u6570\u636e\u5feb\u901f\u6574\u5408\u5230\u6a21\u578b\u4e2d\u53bb\uff0c\u90a3\u4e48\u4f7f\u7528\u5b83\u5427\u3002 Sigmoid\u51fd\u6570 \uff1a \u4f18\u70b9 \uff1a \u5b9e\u73b0\u7b80\u5355\uff0c\u5e7f\u6cdb\u7684\u5e94\u7528\u4e8e\u5de5\u4e1a\u95ee\u9898\u4e0a\uff1b \u5206\u7c7b\u65f6\u8ba1\u7b97\u91cf\u975e\u5e38\u5c0f\uff0c\u901f\u5ea6\u5f88\u5feb\uff0c\u5b58\u50a8\u8d44\u6e90\u4f4e\uff1b \u4fbf\u5229\u7684\u89c2\u6d4b\u6837\u672c\u6982\u7387\u5206\u6570\uff1b \u5bf9\u903b\u8f91\u56de\u5f52\u800c\u8a00\uff0c\u591a\u91cd\u5171\u7ebf\u6027\u5e76\u4e0d\u662f\u95ee\u9898\uff0c\u5b83\u53ef\u4ee5\u7ed3\u5408L2\u6b63\u5219\u5316\u6765\u89e3\u51b3\u8be5\u95ee\u9898\uff1b \u7f3a\u70b9 \uff1a \u5f53\u7279\u5f81\u7a7a\u95f4\u5f88\u5927\u65f6\uff0c\u903b\u8f91\u56de\u5f52\u7684\u6027\u80fd\u4e0d\u662f\u5f88\u597d\uff1b \u5bb9\u6613\u6b20\u62df\u5408\uff0c\u4e00\u822c\u51c6\u786e\u5ea6\u4e0d\u592a\u9ad8 \u4e0d\u80fd\u5f88\u597d\u5730\u5904\u7406\u5927\u91cf\u591a\u7c7b\u7279\u5f81\u6216\u53d8\u91cf\uff1b \u53ea\u80fd\u5904\u7406\u4e24\u5206\u7c7b\u95ee\u9898\uff08\u5728\u6b64\u57fa\u7840\u4e0a\u884d\u751f\u51fa\u6765\u7684softmax\u53ef\u4ee5\u7528\u4e8e\u591a\u5206\u7c7b\uff09\uff0c\u4e14\u5fc5\u987b\u7ebf\u6027\u53ef\u5206\uff1b \u5bf9\u4e8e\u975e\u7ebf\u6027\u7279\u5f81\uff0c\u9700\u8981\u8fdb\u884c\u8f6c\u6362\uff1b 3.\u7ebf\u6027\u56de\u5f52 \u7ebf\u6027\u56de\u5f52\u662f\u7528\u4e8e\u56de\u5f52\u7684\uff0c\u800c\u4e0d\u50cfLogistic\u56de\u5f52\u662f\u7528\u4e8e\u5206\u7c7b\uff0c\u5176\u57fa\u672c\u601d\u60f3\u662f\u7528\u68af\u5ea6\u4e0b\u964d\u6cd5\u5bf9\u6700\u5c0f\u4e8c\u4e58\u6cd5\u5f62\u5f0f\u7684\u8bef\u5dee\u51fd\u6570\u8fdb\u884c\u4f18\u5316\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u7528normal equation\u76f4\u63a5\u6c42\u5f97\u53c2\u6570\u7684\u89e3\uff0c\u7ed3\u679c\u4e3a\uff1a \u800c\u5728LWLR\uff08\u5c40\u90e8\u52a0\u6743\u7ebf\u6027\u56de\u5f52\uff09\u4e2d\uff0c\u53c2\u6570\u7684\u8ba1\u7b97\u8868\u8fbe\u5f0f\u4e3a: \u7531\u6b64\u53ef\u89c1LWLR\u4e0eLR\u4e0d\u540c\uff0cLWLR\u662f\u4e00\u4e2a\u975e\u53c2\u6570\u6a21\u578b\uff0c\u56e0\u4e3a\u6bcf\u6b21\u8fdb\u884c\u56de\u5f52\u8ba1\u7b97\u90fd\u8981\u904d\u5386\u8bad\u7ec3\u6837\u672c\u81f3\u5c11\u4e00\u6b21\u3002 \u4f18\u70b9 \uff1a \u5b9e\u73b0\u7b80\u5355\uff0c\u8ba1\u7b97\u7b80\u5355\uff1b \u7f3a\u70b9 \uff1a \u4e0d\u80fd\u62df\u5408\u975e\u7ebf\u6027\u6570\u636e. 4.\u6700\u8fd1\u9886\u7b97\u6cd5\u2014\u2014KNN KNN\u5373\u6700\u8fd1\u90bb\u7b97\u6cd5\uff0c\u5176\u4e3b\u8981\u8fc7\u7a0b\u4e3a\uff1a \u8ba1\u7b97\u8bad\u7ec3\u6837\u672c\u548c\u6d4b\u8bd5\u6837\u672c\u4e2d\u6bcf\u4e2a\u6837\u672c\u70b9\u7684\u8ddd\u79bb\uff08\u5e38\u89c1\u7684\u8ddd\u79bb\u5ea6\u91cf\u6709\u6b27\u5f0f\u8ddd\u79bb\uff0c\u9a6c\u6c0f\u8ddd\u79bb\u7b49\uff09\uff1b2. \u5bf9\u4e0a\u9762\u6240\u6709\u7684\u8ddd\u79bb\u503c\u8fdb\u884c\u6392\u5e8f\uff1b3. \u9009\u524dk\u4e2a\u6700\u5c0f\u8ddd\u79bb\u7684\u6837\u672c\uff1b4. \u6839\u636e\u8fd9k\u4e2a\u6837\u672c\u7684\u6807\u7b7e\u8fdb\u884c\u6295\u7968\uff0c\u5f97\u5230\u6700\u540e\u7684\u5206\u7c7b\u7c7b\u522b\uff1b \u5982\u4f55\u9009\u62e9\u4e00\u4e2a\u6700\u4f73\u7684K\u503c\uff0c\u8fd9\u53d6\u51b3\u4e8e\u6570\u636e\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5728\u5206\u7c7b\u65f6\u8f83\u5927\u7684K\u503c\u80fd\u591f\u51cf\u5c0f\u566a\u58f0\u7684\u5f71\u54cd\u3002\u4f46\u4f1a\u4f7f\u7c7b\u522b\u4e4b\u95f4\u7684\u754c\u9650\u53d8\u5f97\u6a21\u7cca\u3002\u4e00\u4e2a\u8f83\u597d\u7684K\u503c\u53ef\u901a\u8fc7\u5404\u79cd\u542f\u53d1\u5f0f\u6280\u672f\u6765\u83b7\u53d6\uff0c\u6bd4\u5982\uff0c\u4ea4\u53c9\u9a8c\u8bc1\u3002\u53e6\u5916\u566a\u58f0\u548c\u975e\u76f8\u5173\u6027\u7279\u5f81\u5411\u91cf\u7684\u5b58\u5728\u4f1a\u4f7fK\u8fd1\u90bb\u7b97\u6cd5\u7684\u51c6\u786e\u6027\u51cf\u5c0f\u3002 \u8fd1\u90bb\u7b97\u6cd5\u5177\u6709\u8f83\u5f3a\u7684\u4e00\u81f4\u6027\u7ed3\u679c\u3002\u968f\u7740\u6570\u636e\u8d8b\u4e8e\u65e0\u9650\uff0c\u7b97\u6cd5\u4fdd\u8bc1\u9519\u8bef\u7387\u4e0d\u4f1a\u8d85\u8fc7\u8d1d\u53f6\u65af\u7b97\u6cd5\u9519\u8bef\u7387\u7684\u4e24\u500d\u3002\u5bf9\u4e8e\u4e00\u4e9b\u597d\u7684K\u503c\uff0cK\u8fd1\u90bb\u4fdd\u8bc1\u9519\u8bef\u7387\u4e0d\u4f1a\u8d85\u8fc7\u8d1d\u53f6\u65af\u7406\u8bba\u8bef\u5dee\u7387\u3002 KNN\u7b97\u6cd5\u7684\u4f18\u70b9 \u7406\u8bba\u6210\u719f\uff0c\u601d\u60f3\u7b80\u5355\uff0c\u65e2\u53ef\u4ee5\u7528\u6765\u505a\u5206\u7c7b\u4e5f\u53ef\u4ee5\u7528\u6765\u505a\u56de\u5f52\uff1b \u53ef\u7528\u4e8e\u975e\u7ebf\u6027\u5206\u7c7b\uff1b \u8bad\u7ec3\u65f6\u95f4\u590d\u6742\u5ea6\u4e3aO(n)\uff1b \u5bf9\u6570\u636e\u6ca1\u6709\u5047\u8bbe\uff0c\u51c6\u786e\u5ea6\u9ad8\uff0c\u5bf9outlier\u4e0d\u654f\u611f\uff1b \u7f3a\u70b9 \u8ba1\u7b97\u91cf\u5927\uff1b \u6837\u672c\u4e0d\u5e73\u8861\u95ee\u9898\uff08\u5373\u6709\u4e9b\u7c7b\u522b\u7684\u6837\u672c\u6570\u91cf\u5f88\u591a\uff0c\u800c\u5176\u5b83\u6837\u672c\u7684\u6570\u91cf\u5f88\u5c11\uff09\uff1b \u9700\u8981\u5927\u91cf\u7684\u5185\u5b58\uff1b 5.\u51b3\u7b56\u6811 \u6613\u4e8e\u89e3\u91ca\u3002\u5b83\u53ef\u4ee5\u6beb\u65e0\u538b\u529b\u5730\u5904\u7406\u7279\u5f81\u95f4\u7684\u4ea4\u4e92\u5173\u7cfb\u5e76\u4e14\u662f\u975e\u53c2\u6570\u5316\u7684\uff0c\u56e0\u6b64\u4f60\u4e0d\u5fc5\u62c5\u5fc3\u5f02\u5e38\u503c\u6216\u8005\u6570\u636e\u662f\u5426\u7ebf\u6027\u53ef\u5206\uff08\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u51b3\u7b56\u6811\u80fd\u8f7b\u677e\u5904\u7406\u597d\u7c7b\u522bA\u5728\u67d0\u4e2a\u7279\u5f81\u7ef4\u5ea6x\u7684\u672b\u7aef\uff0c\u7c7b\u522bB\u5728\u4e2d\u95f4\uff0c\u7136\u540e\u7c7b\u522bA\u53c8\u51fa\u73b0\u5728\u7279\u5f81\u7ef4\u5ea6x\u524d\u7aef\u7684\u60c5\u51b5\uff09\u3002\u5b83\u7684\u7f3a\u70b9\u4e4b\u4e00\u5c31\u662f\u4e0d\u652f\u6301\u5728\u7ebf\u5b66\u4e60\uff0c\u4e8e\u662f\u5728\u65b0\u6837\u672c\u5230\u6765\u540e\uff0c\u51b3\u7b56\u6811\u9700\u8981\u5168\u90e8\u91cd\u5efa\u3002\u53e6\u4e00\u4e2a\u7f3a\u70b9\u5c31\u662f\u5bb9\u6613\u51fa\u73b0\u8fc7\u62df\u5408\uff0c\u4f46\u8fd9\u4e5f\u5c31\u662f\u8bf8\u5982\u968f\u673a\u68ee\u6797RF\uff08\u6216\u63d0\u5347\u6811boosted tree\uff09\u4e4b\u7c7b\u7684\u96c6\u6210\u65b9\u6cd5\u7684\u5207\u5165\u70b9\u3002\u53e6\u5916\uff0c\u968f\u673a\u68ee\u6797\u7ecf\u5e38\u662f\u5f88\u591a\u5206\u7c7b\u95ee\u9898\u7684\u8d62\u5bb6\uff08\u901a\u5e38\u6bd4\u652f\u6301\u5411\u91cf\u673a\u597d\u4e0a\u90a3\u4e48\u4e00\u4e01\u70b9\uff09\uff0c\u5b83\u8bad\u7ec3\u5feb\u901f\u5e76\u4e14\u53ef\u8c03\uff0c\u540c\u65f6\u4f60\u65e0\u987b\u62c5\u5fc3\u8981\u50cf\u652f\u6301\u5411\u91cf\u673a\u90a3\u6837\u8c03\u4e00\u5927\u5806\u53c2\u6570\uff0c\u6240\u4ee5\u5728\u4ee5\u524d\u90fd\u4e00\u76f4\u5f88\u53d7\u6b22\u8fce\u3002 \u51b3\u7b56\u6811\u4e2d\u5f88\u91cd\u8981\u7684\u4e00\u70b9\u5c31\u662f\u9009\u62e9\u4e00\u4e2a\u5c5e\u6027\u8fdb\u884c\u5206\u679d\uff0c\u56e0\u6b64\u8981\u6ce8\u610f\u4e00\u4e0b\u4fe1\u606f\u589e\u76ca\u7684\u8ba1\u7b97\u516c\u5f0f\uff0c\u5e76\u6df1\u5165\u7406\u89e3\u5b83\u3002 \u4fe1\u606f\u71b5\u7684\u8ba1\u7b97\u516c\u5f0f\u5982\u4e0b: \u5176\u4e2d\u7684n\u4ee3\u8868\u6709n\u4e2a\u5206\u7c7b\u7c7b\u522b\uff08\u6bd4\u5982\u5047\u8bbe\u662f2\u7c7b\u95ee\u9898\uff0c\u90a3\u4e48n=2\uff09\u3002\u5206\u522b\u8ba1\u7b97\u8fd92\u7c7b\u6837\u672c\u5728\u603b\u6837\u672c\u4e2d\u51fa\u73b0\u7684\u6982\u7387p1\u548cp2\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa\u672a\u9009\u4e2d\u5c5e\u6027\u5206\u679d\u524d\u7684\u4fe1\u606f\u71b5\u3002 \u73b0\u5728\u9009\u4e2d\u4e00\u4e2a\u5c5e\u6027xixi\u7528\u6765\u8fdb\u884c\u5206\u679d\uff0c\u6b64\u65f6\u5206\u679d\u89c4\u5219\u662f\uff1a\u5982\u679cxi=vxi=v\u7684\u8bdd\uff0c\u5c06\u6837\u672c\u5206\u5230\u6811\u7684\u4e00\u4e2a\u5206\u652f\uff1b\u5982\u679c\u4e0d\u76f8\u7b49\u5219\u8fdb\u5165\u53e6\u4e00\u4e2a\u5206\u652f\u3002\u5f88\u663e\u7136\uff0c\u5206\u652f\u4e2d\u7684\u6837\u672c\u5f88\u6709\u53ef\u80fd\u5305\u62ec2\u4e2a\u7c7b\u522b\uff0c\u5206\u522b\u8ba1\u7b97\u8fd92\u4e2a\u5206\u652f\u7684\u71b5H1\u548cH2,\u8ba1\u7b97\u51fa\u5206\u679d\u540e\u7684\u603b\u4fe1\u606f\u71b5H\u2019 =p1H1+p2 H2,\u5219\u6b64\u65f6\u7684\u4fe1\u606f\u589e\u76ca\u0394H = H - H\u2019\u3002\u4ee5\u4fe1\u606f\u589e\u76ca\u4e3a\u539f\u5219\uff0c\u628a\u6240\u6709\u7684\u5c5e\u6027\u90fd\u6d4b\u8bd5\u4e00\u8fb9\uff0c\u9009\u62e9\u4e00\u4e2a\u4f7f\u589e\u76ca\u6700\u5927\u7684\u5c5e\u6027\u4f5c\u4e3a\u672c\u6b21\u5206\u679d\u5c5e\u6027\u3002 \u51b3\u7b56\u6811\u81ea\u8eab\u7684\u4f18\u70b9\uff1a \u8ba1\u7b97\u7b80\u5355\uff0c\u6613\u4e8e\u7406\u89e3\uff0c\u53ef\u89e3\u91ca\u6027\u5f3a\uff1b \u6bd4\u8f83\u9002\u5408\u5904\u7406\u6709\u7f3a\u5931\u5c5e\u6027\u7684\u6837\u672c\uff1b \u80fd\u591f\u5904\u7406\u4e0d\u76f8\u5173\u7684\u7279\u5f81\uff1b \u5728\u76f8\u5bf9\u77ed\u7684\u65f6\u95f4\u5185\u80fd\u591f\u5bf9\u5927\u578b\u6570\u636e\u6e90\u505a\u51fa\u53ef\u884c\u4e14\u6548\u679c\u826f\u597d\u7684\u7ed3\u679c\u3002 \u7f3a\u70b9 \u5bb9\u6613\u53d1\u751f\u8fc7\u62df\u5408\uff08\u968f\u673a\u68ee\u6797\u53ef\u4ee5\u5f88\u5927\u7a0b\u5ea6\u4e0a\u51cf\u5c11\u8fc7\u62df\u5408\uff09\uff1b \u5ffd\u7565\u4e86\u6570\u636e\u4e4b\u95f4\u7684\u76f8\u5173\u6027\uff1b \u5bf9\u4e8e\u90a3\u4e9b\u5404\u7c7b\u522b\u6837\u672c\u6570\u91cf\u4e0d\u4e00\u81f4\u7684\u6570\u636e\uff0c\u5728\u51b3\u7b56\u6811\u5f53\u4e2d,\u4fe1\u606f\u589e\u76ca\u7684\u7ed3\u679c\u504f\u5411\u4e8e\u90a3\u4e9b\u5177\u6709\u66f4\u591a\u6570\u503c\u7684\u7279\u5f81\uff08\u53ea\u8981\u662f\u4f7f\u7528\u4e86\u4fe1\u606f\u589e\u76ca\uff0c\u90fd\u6709\u8fd9\u4e2a\u7f3a\u70b9\uff0c\u5982RF\uff09\u3002 5.1 Adaboosting Adaboost\u662f\u4e00\u79cd\u52a0\u548c\u6a21\u578b\uff0c\u6bcf\u4e2a\u6a21\u578b\u90fd\u662f\u57fa\u4e8e\u4e0a\u4e00\u6b21\u6a21\u578b\u7684\u9519\u8bef\u7387\u6765\u5efa\u7acb\u7684\uff0c\u8fc7\u5206\u5173\u6ce8\u5206\u9519\u7684\u6837\u672c\uff0c\u800c\u5bf9\u6b63\u786e\u5206\u7c7b\u7684\u6837\u672c\u51cf\u5c11\u5173\u6ce8\u5ea6\uff0c\u9010\u6b21\u8fed\u4ee3\u4e4b\u540e\uff0c\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u76f8\u5bf9\u8f83\u597d\u7684\u6a21\u578b\u3002\u662f\u4e00\u79cd\u5178\u578b\u7684boosting\u7b97\u6cd5\u3002\u4e0b\u9762\u662f\u603b\u7ed3\u4e0b\u5b83\u7684\u4f18\u7f3a\u70b9\u3002 \u4f18\u70b9 adaboost\u662f\u4e00\u79cd\u6709\u5f88\u9ad8\u7cbe\u5ea6\u7684\u5206\u7c7b\u5668\u3002 \u53ef\u4ee5\u4f7f\u7528\u5404\u79cd\u65b9\u6cd5\u6784\u5efa\u5b50\u5206\u7c7b\u5668\uff0cAdaboost\u7b97\u6cd5\u63d0\u4f9b\u7684\u662f\u6846\u67b6\u3002 \u5f53\u4f7f\u7528\u7b80\u5355\u5206\u7c7b\u5668\u65f6\uff0c\u8ba1\u7b97\u51fa\u7684\u7ed3\u679c\u662f\u53ef\u4ee5\u7406\u89e3\u7684\uff0c\u5e76\u4e14\u5f31\u5206\u7c7b\u5668\u7684\u6784\u9020\u6781\u5176\u7b80\u5355\u3002 \u7b80\u5355\uff0c\u4e0d\u7528\u505a\u7279\u5f81\u7b5b\u9009\u3002 \u4e0d\u5bb9\u6613\u53d1\u751foverfitting\u3002 \u5173\u4e8e\u968f\u673a\u68ee\u6797\u548cGBDT\u7b49\u7ec4\u5408\u7b97\u6cd5\uff0c\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0\uff1a\u673a\u5668\u5b66\u4e60-\u7ec4\u5408\u7b97\u6cd5\u603b\u7ed3 \u7f3a\u70b9 \uff1a\u5bf9outlier\u6bd4\u8f83\u654f\u611f 6.SVM\u652f\u6301\u5411\u91cf\u673a \u9ad8\u51c6\u786e\u7387\uff0c\u4e3a\u907f\u514d\u8fc7\u62df\u5408\u63d0\u4f9b\u4e86\u5f88\u597d\u7684\u7406\u8bba\u4fdd\u8bc1\uff0c\u800c\u4e14\u5c31\u7b97\u6570\u636e\u5728\u539f\u7279\u5f81\u7a7a\u95f4\u7ebf\u6027\u4e0d\u53ef\u5206\uff0c\u53ea\u8981\u7ed9\u4e2a\u5408\u9002\u7684\u6838\u51fd\u6570\uff0c\u5b83\u5c31\u80fd\u8fd0\u884c\u5f97\u5f88\u597d\u3002\u5728\u52a8\u8f84\u8d85\u9ad8\u7ef4\u7684\u6587\u672c\u5206\u7c7b\u95ee\u9898\u4e2d\u7279\u522b\u53d7\u6b22\u8fce\u3002\u53ef\u60dc\u5185\u5b58\u6d88\u8017\u5927\uff0c\u96be\u4ee5\u89e3\u91ca\uff0c\u8fd0\u884c\u548c\u8c03\u53c2\u4e5f\u6709\u4e9b\u70e6\u4eba\uff0c\u800c\u968f\u673a\u68ee\u6797\u5374\u521a\u597d\u907f\u5f00\u4e86\u8fd9\u4e9b\u7f3a\u70b9\uff0c\u6bd4\u8f83\u5b9e\u7528\u3002 \u4f18\u70b9 \u53ef\u4ee5\u89e3\u51b3\u9ad8\u7ef4\u95ee\u9898\uff0c\u5373\u5927\u578b\u7279\u5f81\u7a7a\u95f4\uff1b \u80fd\u591f\u5904\u7406\u975e\u7ebf\u6027\u7279\u5f81\u7684\u76f8\u4e92\u4f5c\u7528\uff1b \u65e0\u9700\u4f9d\u8d56\u6574\u4e2a\u6570\u636e\uff1b \u53ef\u4ee5\u63d0\u9ad8\u6cdb\u5316\u80fd\u529b\uff1b \u7f3a\u70b9 \u5f53\u89c2\u6d4b\u6837\u672c\u5f88\u591a\u65f6\uff0c\u6548\u7387\u5e76\u4e0d\u662f\u5f88\u9ad8\uff1b \u5bf9\u975e\u7ebf\u6027\u95ee\u9898\u6ca1\u6709\u901a\u7528\u89e3\u51b3\u65b9\u6848\uff0c\u6709\u65f6\u5019\u5f88\u96be\u627e\u5230\u4e00\u4e2a\u5408\u9002\u7684\u6838\u51fd\u6570\uff1b \u5bf9\u7f3a\u5931\u6570\u636e\u654f\u611f\uff1b \u5bf9\u4e8e\u6838\u7684\u9009\u62e9\u4e5f\u662f\u6709\u6280\u5de7\u7684\uff08libsvm\u4e2d\u81ea\u5e26\u4e86\u56db\u79cd\u6838\u51fd\u6570\uff1a\u7ebf\u6027\u6838\u3001\u591a\u9879\u5f0f\u6838\u3001RBF\u4ee5\u53casigmoid\u6838\uff09\uff1a \u7b2c\u4e00\uff0c\u5982\u679c\u6837\u672c\u6570\u91cf\u5c0f\u4e8e\u7279\u5f81\u6570\uff0c\u90a3\u4e48\u5c31\u6ca1\u5fc5\u8981\u9009\u62e9\u975e\u7ebf\u6027\u6838\uff0c\u7b80\u5355\u7684\u4f7f\u7528\u7ebf\u6027\u6838\u5c31\u53ef\u4ee5\u4e86\uff1b \u7b2c\u4e8c\uff0c\u5982\u679c\u6837\u672c\u6570\u91cf\u5927\u4e8e\u7279\u5f81\u6570\u76ee\uff0c\u8fd9\u65f6\u53ef\u4ee5\u4f7f\u7528\u975e\u7ebf\u6027\u6838\uff0c\u5c06\u6837\u672c\u6620\u5c04\u5230\u66f4\u9ad8\u7ef4\u5ea6\uff0c\u4e00\u822c\u53ef\u4ee5\u5f97\u5230\u66f4\u597d\u7684\u7ed3\u679c\uff1b \u7b2c\u4e09\uff0c\u5982\u679c\u6837\u672c\u6570\u76ee\u548c\u7279\u5f81\u6570\u76ee\u76f8\u7b49\uff0c\u8be5\u60c5\u51b5\u53ef\u4ee5\u4f7f\u7528\u975e\u7ebf\u6027\u6838\uff0c\u539f\u7406\u548c\u7b2c\u4e8c\u79cd\u4e00\u6837\u3002 \u5bf9\u4e8e\u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u4e5f\u53ef\u4ee5\u5148\u5bf9\u6570\u636e\u8fdb\u884c\u964d\u7ef4\uff0c\u7136\u540e\u4f7f\u7528\u975e\u7ebf\u6027\u6838\uff0c\u8fd9\u4e5f\u662f\u4e00\u79cd\u65b9\u6cd5\u3002 7. \u4eba\u5de5\u795e\u7ecf\u7f51\u7edc\u7684\u4f18\u7f3a\u70b9 \u4eba\u5de5\u795e\u7ecf\u7f51\u7edc\u7684\u4f18\u70b9 \uff1a \u5206\u7c7b\u7684\u51c6\u786e\u5ea6\u9ad8\uff1b \u5e76\u884c\u5206\u5e03\u5904\u7406\u80fd\u529b\u5f3a,\u5206\u5e03\u5b58\u50a8\u53ca\u5b66\u4e60\u80fd\u529b\u5f3a\uff0c \u5bf9\u566a\u58f0\u795e\u7ecf\u6709\u8f83\u5f3a\u7684\u9c81\u68d2\u6027\u548c\u5bb9\u9519\u80fd\u529b\uff0c\u80fd\u5145\u5206\u903c\u8fd1\u590d\u6742\u7684\u975e\u7ebf\u6027\u5173\u7cfb\uff1b \u5177\u5907\u8054\u60f3\u8bb0\u5fc6\u7684\u529f\u80fd\u3002 \u4eba\u5de5\u795e\u7ecf\u7f51\u7edc\u7684\u7f3a\u70b9 \uff1a \u795e\u7ecf\u7f51\u7edc\u9700\u8981\u5927\u91cf\u7684\u53c2\u6570\uff0c\u5982\u7f51\u7edc\u62d3\u6251\u7ed3\u6784\u3001\u6743\u503c\u548c\u9608\u503c\u7684\u521d\u59cb\u503c\uff1b \u4e0d\u80fd\u89c2\u5bdf\u4e4b\u95f4\u7684\u5b66\u4e60\u8fc7\u7a0b\uff0c\u8f93\u51fa\u7ed3\u679c\u96be\u4ee5\u89e3\u91ca\uff0c\u4f1a\u5f71\u54cd\u5230\u7ed3\u679c\u7684\u53ef\u4fe1\u5ea6\u548c\u53ef\u63a5\u53d7\u7a0b\u5ea6\uff1b \u5b66\u4e60\u65f6\u95f4\u8fc7\u957f,\u751a\u81f3\u53ef\u80fd\u8fbe\u4e0d\u5230\u5b66\u4e60\u7684\u76ee\u7684\u3002 8\u3001K-Means\u805a\u7c7b \u4e4b\u524d\u5199\u8fc7\u4e00\u7bc7\u5173\u4e8eK-Means\u805a\u7c7b\u7684\u6587\u7ae0\uff0c\u535a\u6587\u94fe\u63a5\uff1a\u673a\u5668\u5b66\u4e60\u7b97\u6cd5-K-means\u805a\u7c7b\u3002\u5173\u4e8eK-Means\u7684\u63a8\u5bfc\uff0c\u91cc\u9762\u6709\u7740\u5f88\u5f3a\u5927\u7684EM\u601d\u60f3\u3002 \u4f18\u70b9 \u7b97\u6cd5\u7b80\u5355\uff0c\u5bb9\u6613\u5b9e\u73b0 \uff1b \u5bf9\u5904\u7406\u5927\u6570\u636e\u96c6\uff0c\u8be5\u7b97\u6cd5\u662f\u76f8\u5bf9\u53ef\u4f38\u7f29\u7684\u548c\u9ad8\u6548\u7387\u7684\uff0c\u56e0\u4e3a\u5b83\u7684\u590d\u6742\u5ea6\u5927\u7ea6\u662fO(nkt)\uff0c\u5176\u4e2dn\u662f\u6240\u6709\u5bf9\u8c61\u7684\u6570\u76ee\uff0ck\u662f\u7c07\u7684\u6570\u76ee,t\u662f\u8fed\u4ee3\u7684\u6b21\u6570\u3002\u901a\u5e38k<<n\u3002\u8fd9\u4e2a\u7b97\u6cd5\u901a\u5e38\u5c40\u90e8\u6536\u655b\u3002 \u7b97\u6cd5\u5c1d\u8bd5\u627e\u51fa\u4f7f\u5e73\u65b9\u8bef\u5dee\u51fd\u6570\u503c\u6700\u5c0f\u7684k\u4e2a\u5212\u5206\u3002\u5f53\u7c07\u662f\u5bc6\u96c6\u7684\u3001\u7403\u72b6\u6216\u56e2\u72b6\u7684\uff0c\u4e14\u7c07\u4e0e\u7c07\u4e4b\u95f4\u533a\u522b\u660e\u663e\u65f6\uff0c\u805a\u7c7b\u6548\u679c\u8f83\u597d\u3002 \u7f3a\u70b9 \u5bf9\u6570\u636e\u7c7b\u578b\u8981\u6c42\u8f83\u9ad8\uff0c\u9002\u5408\u6570\u503c\u578b\u6570\u636e\uff1b \u53ef\u80fd\u6536\u655b\u5230\u5c40\u90e8\u6700\u5c0f\u503c\uff0c\u5728\u5927\u89c4\u6a21\u6570\u636e\u4e0a\u6536\u655b\u8f83\u6162 K\u503c\u6bd4\u8f83\u96be\u4ee5\u9009\u53d6\uff1b \u5bf9\u521d\u503c\u7684\u7c07\u5fc3\u503c\u654f\u611f\uff0c\u5bf9\u4e8e\u4e0d\u540c\u7684\u521d\u59cb\u503c\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e0d\u540c\u7684\u805a\u7c7b\u7ed3\u679c\uff1b \u4e0d\u9002\u5408\u4e8e\u53d1\u73b0\u975e\u51f8\u9762\u5f62\u72b6\u7684\u7c07\uff0c\u6216\u8005\u5927\u5c0f\u5dee\u522b\u5f88\u5927\u7684\u7c07\u3002 \u5bf9\u4e8e\u201d\u566a\u58f0\u201d\u548c\u5b64\u7acb\u70b9\u6570\u636e\u654f\u611f\uff0c\u5c11\u91cf\u7684\u8be5\u7c7b\u6570\u636e\u80fd\u591f\u5bf9\u5e73\u5747\u503c\u4ea7\u751f\u6781\u5927\u5f71\u54cd\u3002 \u7b97\u6cd5\u9009\u62e9\u53c2\u8003 \u4e4b\u524d\u7ffb\u8bd1\u8fc7\u4e00\u4e9b\u56fd\u5916\u7684\u6587\u7ae0\uff0c\u6709\u4e00\u7bc7\u6587\u7ae0\u4e2d\u7ed9\u51fa\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u7b97\u6cd5\u9009\u62e9\u6280\u5de7\uff1a \u9996\u5f53\u5176\u51b2\u5e94\u8be5\u9009\u62e9\u7684\u5c31\u662f\u903b\u8f91\u56de\u5f52\uff0c\u5982\u679c\u5b83\u7684\u6548\u679c\u4e0d\u600e\u4e48\u6837\uff0c\u90a3\u4e48\u53ef\u4ee5\u5c06\u5b83\u7684\u7ed3\u679c\u4f5c\u4e3a\u57fa\u51c6\u6765\u53c2\u8003\uff0c\u5728\u57fa\u7840\u4e0a\u4e0e\u5176\u4ed6\u7b97\u6cd5\u8fdb\u884c\u6bd4\u8f83\uff1b \u7136\u540e\u8bd5\u8bd5\u51b3\u7b56\u6811\uff08\u968f\u673a\u68ee\u6797\uff09\u770b\u770b\u662f\u5426\u53ef\u4ee5\u5927\u5e45\u5ea6\u63d0\u5347\u4f60\u7684\u6a21\u578b\u6027\u80fd\u3002\u5373\u4fbf\u6700\u540e\u4f60\u5e76\u6ca1\u6709\u628a\u5b83\u5f53\u505a\u4e3a\u6700\u7ec8\u6a21\u578b\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u968f\u673a\u68ee\u6797\u6765\u79fb\u9664\u566a\u58f0\u53d8\u91cf\uff0c\u505a\u7279\u5f81\u9009\u62e9\uff1b \u5982\u679c\u7279\u5f81\u7684\u6570\u91cf\u548c\u89c2\u6d4b\u6837\u672c\u7279\u522b\u591a\uff0c\u90a3\u4e48\u5f53\u8d44\u6e90\u548c\u65f6\u95f4\u5145\u8db3\u65f6\uff08\u8fd9\u4e2a\u524d\u63d0\u5f88\u91cd\u8981\uff09\uff0c\u4f7f\u7528SVM\u4e0d\u5931\u4e3a\u4e00\u79cd\u9009\u62e9\u3002 \u901a\u5e38\u60c5\u51b5\u4e0b\uff1a\u3010GBDT>=SVM>=RF>=Adaboost>=Other\u2026\u3011","title":"\u5e38\u89c1\u7b97\u6cd5\u4f18\u7f3a\u70b9"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/ElasticSearch/","text":"ElasticSearch\u6280\u5de7 \u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u7684\u78c1\u76d8\u72b6\u6001 http://127.0.0.1:9200/_cat/allocation?v&pretty ES\u6eda\u52a8\u65b9\u5f0f\u83b7\u53d6\u66f4\u591a\u6570\u636e select / ! USE_SCROLL(10,600000) /id,person_img_url from person_pass where db_name='yh' and es_time between '2020-06-17 10:45:35' and '2020-06-24 00:00:00' order by es_time desc \u4f1a\u8fd4\u56de\u4e00\u4e2ascrollid,\u7136\u540e\u5c06id\u653e\u5230url\u4e2d\u83b7\u53d6\u540e\u7eed\u6570\u636e,\u4e00\u76f4\u5230\u62ff\u5230\u7684\u6570\u636e\u4e3a\u7a7a\u4ee3\u8868\u8bfb\u53d6\u5b8c\u4e86 ip:9200/_search/scroll?scroll=1m&scroll_id=DnF1ZXJ5VGhlbkZldGNoBQAAAAAAEwMtFlMxUng2Q0pwUkNxTV9yZ0plWktiLXcAAAAAABMDLhZTMVJ4NkNKcFJDcU1fcmdKZVpLYi13AAAAAAARXskWMklrckhac0ZSX3lGN0pfSnZjVWJjQQAAAAAAEV7KFjJJa3JIWnNGUl95RjdKX0p2Y1ViY0EAAAAAABJAKxZUeEMtTTU0elF4eXRTTVMteHJlWFRR","title":"ElasticSearch\u6280\u5de7"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/ElasticSearch/#elasticsearch","text":"","title":"ElasticSearch\u6280\u5de7"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/ElasticSearch/#_1","text":"http://127.0.0.1:9200/_cat/allocation?v&pretty","title":"\u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u7684\u78c1\u76d8\u72b6\u6001"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/ElasticSearch/#es","text":"select / ! USE_SCROLL(10,600000) /id,person_img_url from person_pass where db_name='yh' and es_time between '2020-06-17 10:45:35' and '2020-06-24 00:00:00' order by es_time desc \u4f1a\u8fd4\u56de\u4e00\u4e2ascrollid,\u7136\u540e\u5c06id\u653e\u5230url\u4e2d\u83b7\u53d6\u540e\u7eed\u6570\u636e,\u4e00\u76f4\u5230\u62ff\u5230\u7684\u6570\u636e\u4e3a\u7a7a\u4ee3\u8868\u8bfb\u53d6\u5b8c\u4e86 ip:9200/_search/scroll?scroll=1m&scroll_id=DnF1ZXJ5VGhlbkZldGNoBQAAAAAAEwMtFlMxUng2Q0pwUkNxTV9yZ0plWktiLXcAAAAAABMDLhZTMVJ4NkNKcFJDcU1fcmdKZVpLYi13AAAAAAARXskWMklrckhac0ZSX3lGN0pfSnZjVWJjQQAAAAAAEV7KFjJJa3JIWnNGUl95RjdKX0p2Y1ViY0EAAAAAABJAKxZUeEMtTTU0elF4eXRTTVMteHJlWFRR","title":"ES\u6eda\u52a8\u65b9\u5f0f\u83b7\u53d6\u66f4\u591a\u6570\u636e"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/Kafka%E7%9B%B8%E5%85%B3/","text":"\u60ef\u4f8b \u4e3a\u4e86\u4fdd\u8bc1\u9ad8\u53ef\u7528\u6027\u9700\u8981\u8bbe\u7f6e\u4e0d\u5c11\u4e8e2\u7684\u590d\u5236\u56e0\u5b50\uff0c\u5efa\u8bae3\uff08\u8282\u70b9\u6570\u4e0d\u80fd\u5c11\u4e8e\u590d\u5236\u56e0\u5b50\u6570\uff09\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u78c1\u76d8\u7a7a\u95f4\u7684\u53ef\u7528\u6027\uff0c\u9700\u8981\u8bbe\u7f6e\u6570\u636e\u4fdd\u7559\u65f6\u95f4\u548c\u6570\u636e\u6700\u5927\u4fdd\u7559\u4f53\u79ef\uff08\u81f3\u5c11\u5e94\u8be5\u8bbe\u7f6e\u6700\u5927\u4fdd\u7559\u4f53\u79ef\uff09\u3002 \u4e3a\u4e86\u786e\u4fdd\u53ef\u63a5\u6536\u5927\u4f53\u79ef\u6d88\u606f\uff0c\u9700\u8981\u63d0\u524d\u9884\u4f30\u5e76\u89c4\u5212\u597d\u6700\u5927\u7684\u5355\u6761\u6d88\u606f\u7684\u4f53\u79ef\u5e76\u5728\u96c6\u7fa4\u8282\u70b9\u914d\u7f6e\u4e2d\u8fdb\u884c\u7533\u660e\uff0c\u907f\u514d\u8d85\u8fc7\u9650\u5236\u5927\u5c0f\u65e0\u6cd5\u63a5\u6536\u3002 \u5e38\u7528\u547d\u4ee4 \u8bbe\u7f6e\u6d88\u8d39\u5750\u6807 #\u66f4\u65b0\u5230\u5f53\u524dgroup\u6700\u521d\u7684offset\u4f4d\u7f6e ./bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test-group --reset-offsets --all-topics --to-earliest --execute #\u66f4\u65b0\u5230\u6307\u5b9a\u7684offset\u4f4d\u7f6e ./bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test-group --reset-offsets --all-topics --to-offset 500000 --execute #\u66f4\u65b0\u5230\u5f53\u524doffset\u4f4d\u7f6e\uff08\u89e3\u51b3offset\u7684\u5f02\u5e38\uff09 ./bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test-group --reset-offsets --all-topics --to-current --execute #offset\u4f4d\u7f6e\u6309\u8bbe\u7f6e\u7684\u503c\u8fdb\u884c\u4f4d\u79fb ./bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test-group --reset-offsets --all-topics --shift-by -100000 --execute #offset\u8bbe\u7f6e\u5230\u6307\u5b9a\u65f6\u523b\u5f00\u59cb ./bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test-group --reset-offsets --all-topics --to-datetime 2017-08-04T14:30:00.000 \u5e38\u7528\u914d\u7f6e #\u8bbe\u7f6e\u590d\u5236\u56e0\u5b50\u4e3a3\u542f\u7528\u9ad8\u53ef\u7528\u673a\u5236 default.replication.factor=3 #\u6570\u636e\u4fdd\u7559\u65f6\u95f4 log.retention.hours=10 #\u6570\u636e\u4fdd\u7559\u4f53\u79ef(\u72ec\u7acb\u4e8e\u65f6\u95f4\u7b56\u7565)100G log.retention.bytes=107374182400 #\u5355\u4e2a\u6570\u636e\u6587\u4ef6\u6700\u5927\u4f53\u79ef1G log.segment.bytes=1073741824 #\u6700\u5c11\u4fdd\u8bc1\u590d\u5236\u51e0\u4e2a\u526f\u672c\uff08\u5c0f\u4e8e\u6216\u7b49\u4e8e\u590d\u5236\u56e0\u5b50\u6570\uff09 min.insync.replicas=2 #\u5355\u6761\u6d88\u606f\u6700\u5927\u4f53\u79ef10MB message.max.bytes=10485760 #\u6700\u5927\u961f\u5217\u8bf7\u6c42\u6570 queued.max.requests=1024 \u52a8\u6001\u8bbe\u7f6etopic\u7684\u590d\u5236\u56e0\u5b50 \u547d\u4ee4\u884c\u65b9\u5f0f #\u67e5\u770btopic list bin/kafka-topics.sh --zookeeper zkaddr:2181 --list #\u67e5\u770btopic detail bin/kafka-topics.sh --describe --zookeeper zkaddr:2181 --topic test #\u8f93\u51fa\u793a\u4f8b Topic:test PartitionCount:3 ReplicationFactor:1 Configs: Topic: test Partition: 0 Leader: 1 Replicas: 1 Isr: 1 Topic: test Partition: 1 Leader: 2 Replicas: 2 Isr: 2 Topic: test Partition: 2 Leader: 3 Replicas: 3 Isr: 3 #\u6269\u5bb9\u65f6\u5019\u9700\u8981\u4e00\u4e2ajson\u63cf\u8ff0\u6587\u4ef6\uff0c\u5efa\u8bae\u7528\u811a\u672c\u5199\u4e00\u4e2a\uff0c\u4e3e\u4f8b\u5982\u4e0b\uff08\u548c\u4e0a\u8ff0\u8f93\u51fa\u6709\u5173\u8054\u5173\u7cfb\uff09 #test.json { \"version\": 1, \"partitions\": [ { \"topic\": \"test\", \"partition\": 0, \"replicas\": [ 1, 2, 3 ] }, { \"topic\": \"test\", \"partition\": 1, \"replicas\": [ 1, 2, 3 ] }, { \"topic\": \"test\", \"partition\": 2, \"replicas\": [ 1, 2, 3 ] } ] } #\u6b63\u5f0f\u6267\u884c bin/kafka-reassign-partitions.sh --zookeeper zkaddr:2181 --reassignment-json-file test.json --execute #\u51fa\u73b0successfully\u4e3a\u6210\u529f\uff0c\u6b64\u65f6\u53ef\u4ee5\u518d\u901a\u8fc7`bin/kafka-topics.sh --describe --zookeeper zkaddr:2181 --topic test`\u67e5\u770b\u8be6\u60c5 \u4f7f\u7528kafkamgr\u6765\u52a8\u6001\u8c03\u6574\u5df2\u6709\u4e3b\u9898\u590d\u5236\u56e0\u5b50 \u4f9d\u6b21\u8fdb\u5165-clusters-\u4f60\u7684\u96c6\u7fa4-topics-\u4f60\u7684\u4e3b\u9898\uff0c\u70b9\u51fbGenerate Partition Assignments \u6309\u94ae\u3002 \u5728\u65b0\u9875\u9762\u4e2d\u7684Replication factor (optional)\u9879\u8f93\u5165\u4f60\u60f3\u8981\u7684\u590d\u5236\u56e0\u5b50\u8bbe\u7f6e\uff08\u5efa\u8bae\u81f3\u5c113\uff09\u3002 \u70b9\u51fbGenerate Partition Assignments \u6309\u94ae\u786e\u8ba4\u3002 \u70b9\u51fb Reassign Partitions \u6309\u94ae\uff0c\u6b64\u65f6\u4f1a\u6709\u4e2a\u8b66\u544a\uff0c\u70b9\u51fbTry force running\u8fde\u63a5\u5141\u8bb8\u540e\u4f1a\u56de\u5230\u5f53\u524d\u9875\u9762\uff0c\u70b9\u51fb\u65b0\u51fa\u73b0\u7684 Force Reassign Partitions\u5373\u53ef\u3002 \u70b9\u51fbUpdate config \u5728min.insync.replicas\u4e2d\u8bbe\u7f6e\u4e3a2\u70b9\u51fbupdate config\u786e\u8ba4 \u6574\u4e2a\u96c6\u7fa4\u540c\u65f6\u53ea\u80fd\u5b58\u5728\u4e00\u4e2areplication\u590d\u5236\u4efb\u52a1\uff0c\u5982\u679c\u8981\u8c03\u6574\u7684\u4e3b\u4f53\u8f83\u591a\u9700\u8981\u4f9d\u6b21\u8c03\u6574\u3002","title":"Kafka\u76f8\u5173"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/Kafka%E7%9B%B8%E5%85%B3/#_1","text":"\u4e3a\u4e86\u4fdd\u8bc1\u9ad8\u53ef\u7528\u6027\u9700\u8981\u8bbe\u7f6e\u4e0d\u5c11\u4e8e2\u7684\u590d\u5236\u56e0\u5b50\uff0c\u5efa\u8bae3\uff08\u8282\u70b9\u6570\u4e0d\u80fd\u5c11\u4e8e\u590d\u5236\u56e0\u5b50\u6570\uff09\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u78c1\u76d8\u7a7a\u95f4\u7684\u53ef\u7528\u6027\uff0c\u9700\u8981\u8bbe\u7f6e\u6570\u636e\u4fdd\u7559\u65f6\u95f4\u548c\u6570\u636e\u6700\u5927\u4fdd\u7559\u4f53\u79ef\uff08\u81f3\u5c11\u5e94\u8be5\u8bbe\u7f6e\u6700\u5927\u4fdd\u7559\u4f53\u79ef\uff09\u3002 \u4e3a\u4e86\u786e\u4fdd\u53ef\u63a5\u6536\u5927\u4f53\u79ef\u6d88\u606f\uff0c\u9700\u8981\u63d0\u524d\u9884\u4f30\u5e76\u89c4\u5212\u597d\u6700\u5927\u7684\u5355\u6761\u6d88\u606f\u7684\u4f53\u79ef\u5e76\u5728\u96c6\u7fa4\u8282\u70b9\u914d\u7f6e\u4e2d\u8fdb\u884c\u7533\u660e\uff0c\u907f\u514d\u8d85\u8fc7\u9650\u5236\u5927\u5c0f\u65e0\u6cd5\u63a5\u6536\u3002","title":"\u60ef\u4f8b"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/Kafka%E7%9B%B8%E5%85%B3/#_2","text":"","title":"\u5e38\u7528\u547d\u4ee4"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/Kafka%E7%9B%B8%E5%85%B3/#_3","text":"#\u66f4\u65b0\u5230\u5f53\u524dgroup\u6700\u521d\u7684offset\u4f4d\u7f6e ./bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test-group --reset-offsets --all-topics --to-earliest --execute #\u66f4\u65b0\u5230\u6307\u5b9a\u7684offset\u4f4d\u7f6e ./bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test-group --reset-offsets --all-topics --to-offset 500000 --execute #\u66f4\u65b0\u5230\u5f53\u524doffset\u4f4d\u7f6e\uff08\u89e3\u51b3offset\u7684\u5f02\u5e38\uff09 ./bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test-group --reset-offsets --all-topics --to-current --execute #offset\u4f4d\u7f6e\u6309\u8bbe\u7f6e\u7684\u503c\u8fdb\u884c\u4f4d\u79fb ./bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test-group --reset-offsets --all-topics --shift-by -100000 --execute #offset\u8bbe\u7f6e\u5230\u6307\u5b9a\u65f6\u523b\u5f00\u59cb ./bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test-group --reset-offsets --all-topics --to-datetime 2017-08-04T14:30:00.000","title":"\u8bbe\u7f6e\u6d88\u8d39\u5750\u6807"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/Kafka%E7%9B%B8%E5%85%B3/#_4","text":"#\u8bbe\u7f6e\u590d\u5236\u56e0\u5b50\u4e3a3\u542f\u7528\u9ad8\u53ef\u7528\u673a\u5236 default.replication.factor=3 #\u6570\u636e\u4fdd\u7559\u65f6\u95f4 log.retention.hours=10 #\u6570\u636e\u4fdd\u7559\u4f53\u79ef(\u72ec\u7acb\u4e8e\u65f6\u95f4\u7b56\u7565)100G log.retention.bytes=107374182400 #\u5355\u4e2a\u6570\u636e\u6587\u4ef6\u6700\u5927\u4f53\u79ef1G log.segment.bytes=1073741824 #\u6700\u5c11\u4fdd\u8bc1\u590d\u5236\u51e0\u4e2a\u526f\u672c\uff08\u5c0f\u4e8e\u6216\u7b49\u4e8e\u590d\u5236\u56e0\u5b50\u6570\uff09 min.insync.replicas=2 #\u5355\u6761\u6d88\u606f\u6700\u5927\u4f53\u79ef10MB message.max.bytes=10485760 #\u6700\u5927\u961f\u5217\u8bf7\u6c42\u6570 queued.max.requests=1024","title":"\u5e38\u7528\u914d\u7f6e"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/Kafka%E7%9B%B8%E5%85%B3/#topic","text":"","title":"\u52a8\u6001\u8bbe\u7f6etopic\u7684\u590d\u5236\u56e0\u5b50"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/Kafka%E7%9B%B8%E5%85%B3/#_5","text":"#\u67e5\u770btopic list bin/kafka-topics.sh --zookeeper zkaddr:2181 --list #\u67e5\u770btopic detail bin/kafka-topics.sh --describe --zookeeper zkaddr:2181 --topic test #\u8f93\u51fa\u793a\u4f8b Topic:test PartitionCount:3 ReplicationFactor:1 Configs: Topic: test Partition: 0 Leader: 1 Replicas: 1 Isr: 1 Topic: test Partition: 1 Leader: 2 Replicas: 2 Isr: 2 Topic: test Partition: 2 Leader: 3 Replicas: 3 Isr: 3 #\u6269\u5bb9\u65f6\u5019\u9700\u8981\u4e00\u4e2ajson\u63cf\u8ff0\u6587\u4ef6\uff0c\u5efa\u8bae\u7528\u811a\u672c\u5199\u4e00\u4e2a\uff0c\u4e3e\u4f8b\u5982\u4e0b\uff08\u548c\u4e0a\u8ff0\u8f93\u51fa\u6709\u5173\u8054\u5173\u7cfb\uff09 #test.json { \"version\": 1, \"partitions\": [ { \"topic\": \"test\", \"partition\": 0, \"replicas\": [ 1, 2, 3 ] }, { \"topic\": \"test\", \"partition\": 1, \"replicas\": [ 1, 2, 3 ] }, { \"topic\": \"test\", \"partition\": 2, \"replicas\": [ 1, 2, 3 ] } ] } #\u6b63\u5f0f\u6267\u884c bin/kafka-reassign-partitions.sh --zookeeper zkaddr:2181 --reassignment-json-file test.json --execute #\u51fa\u73b0successfully\u4e3a\u6210\u529f\uff0c\u6b64\u65f6\u53ef\u4ee5\u518d\u901a\u8fc7`bin/kafka-topics.sh --describe --zookeeper zkaddr:2181 --topic test`\u67e5\u770b\u8be6\u60c5","title":"\u547d\u4ee4\u884c\u65b9\u5f0f"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/Kafka%E7%9B%B8%E5%85%B3/#kafkamgr","text":"\u4f9d\u6b21\u8fdb\u5165-clusters-\u4f60\u7684\u96c6\u7fa4-topics-\u4f60\u7684\u4e3b\u9898\uff0c\u70b9\u51fbGenerate Partition Assignments \u6309\u94ae\u3002 \u5728\u65b0\u9875\u9762\u4e2d\u7684Replication factor (optional)\u9879\u8f93\u5165\u4f60\u60f3\u8981\u7684\u590d\u5236\u56e0\u5b50\u8bbe\u7f6e\uff08\u5efa\u8bae\u81f3\u5c113\uff09\u3002 \u70b9\u51fbGenerate Partition Assignments \u6309\u94ae\u786e\u8ba4\u3002 \u70b9\u51fb Reassign Partitions \u6309\u94ae\uff0c\u6b64\u65f6\u4f1a\u6709\u4e2a\u8b66\u544a\uff0c\u70b9\u51fbTry force running\u8fde\u63a5\u5141\u8bb8\u540e\u4f1a\u56de\u5230\u5f53\u524d\u9875\u9762\uff0c\u70b9\u51fb\u65b0\u51fa\u73b0\u7684 Force Reassign Partitions\u5373\u53ef\u3002 \u70b9\u51fbUpdate config \u5728min.insync.replicas\u4e2d\u8bbe\u7f6e\u4e3a2\u70b9\u51fbupdate config\u786e\u8ba4 \u6574\u4e2a\u96c6\u7fa4\u540c\u65f6\u53ea\u80fd\u5b58\u5728\u4e00\u4e2areplication\u590d\u5236\u4efb\u52a1\uff0c\u5982\u679c\u8981\u8c03\u6574\u7684\u4e3b\u4f53\u8f83\u591a\u9700\u8981\u4f9d\u6b21\u8c03\u6574\u3002","title":"\u4f7f\u7528kafkamgr\u6765\u52a8\u6001\u8c03\u6574\u5df2\u6709\u4e3b\u9898\u590d\u5236\u56e0\u5b50"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/cdh_spark/","text":"cdh\u7f16\u5199spark\u4f9d\u8d56\u95ee\u9898 cdh\u7684jar\u4f9d\u8d56\u4e0d\u80fd\u76f4\u63a5\u7528maven\u5b98\u65b9\u4ed3\u5e93\u7684\u7248\u672c\uff0c\u9700\u8981\u4f7f\u7528cdh\u63d0\u4f9b\u7684\u4ed3\u5e93\u4e2d\u7684\u7248\u672c\uff1a https://docs.cloudera.com/documentation/enterprise/6/release-notes/topics/rg_cdh_62_maven_artifacts.html#concept_2gp_d8n_yk \u5426\u5219\u4f1a\u51fa\u73b0jar\u5305\u4e0d\u517c\u5bb9\u7684\u60c5\u51b5\uff0c\u5e76\u4e14cdh\u4e2d\u81ea\u5e26\u7684jar\u5305\u5728pom\u4e2ddependency\u4e0b\u7684scope\u9700\u8981\u8bbe\u7f6e\u4e3aprovided\uff1aprovided","title":"cdh\u7f16\u5199spark\u4f9d\u8d56\u95ee\u9898"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/cdh_spark/#cdhspark","text":"cdh\u7684jar\u4f9d\u8d56\u4e0d\u80fd\u76f4\u63a5\u7528maven\u5b98\u65b9\u4ed3\u5e93\u7684\u7248\u672c\uff0c\u9700\u8981\u4f7f\u7528cdh\u63d0\u4f9b\u7684\u4ed3\u5e93\u4e2d\u7684\u7248\u672c\uff1a https://docs.cloudera.com/documentation/enterprise/6/release-notes/topics/rg_cdh_62_maven_artifacts.html#concept_2gp_d8n_yk \u5426\u5219\u4f1a\u51fa\u73b0jar\u5305\u4e0d\u517c\u5bb9\u7684\u60c5\u51b5\uff0c\u5e76\u4e14cdh\u4e2d\u81ea\u5e26\u7684jar\u5305\u5728pom\u4e2ddependency\u4e0b\u7684scope\u9700\u8981\u8bbe\u7f6e\u4e3aprovided\uff1aprovided","title":"cdh\u7f16\u5199spark\u4f9d\u8d56\u95ee\u9898"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/","text":"greenplum\u96c6\u7fa4\u4f7f\u7528 FDW\u63d2\u4ef6\u4f7f\u7528 mysql_fdw\u63d2\u4ef6\u4f7f\u7528 #\u5728\u4e3b\u8282\u70b9\u4ee5\u53ca\u5907\u4efd\u4e3b\u8282\u70b9\u7528root\u7528\u6237\u6267\u884c #\u521d\u6b21\u4f7f\u7528\u9700\u8981\u521b\u5efa\u6269\u5c55,\u5728mdw\u7528gpadmin\u7528\u6237source env.sh\u540e\u6267\u884c create extension mysql_fdw; #\u540e\u7eed\u4f7f\u7528\u76f4\u63a5\u521b\u5efa\u670d\u52a1\u5668\u4ee5\u53ca\u7528\u6237\u6620\u5c04\u5373\u53ef create server bz47 foreign data wrapper mysql_fdw options (host 'hereisip' ,port '3306'); #\u628a\u670d\u52a1\u5668\u8f6c\u79fb\u7ed9hjdev\u7528\u6237 ALTER SERVER \"bz47\" OWNER TO \"hjdev\"; #\u521b\u5efa\u7528\u6237\u6620\u5c04 create user mapping for hjdev server bz47 options (username 'root',password 'pass'); #\u521b\u5efa\u5916\u90e8\u8868 CREATE FOREIGN TABLE \"public\".\"out_yy_regions\" ( \"indexCode\" varchar(255), \"name\" varchar(255), \"parentIndexCode\" varchar(255), \"treeCode\" varchar(255), \"id\" int4 ) SERVER \"bz47\" OPTIONS (\"dbname\" 'db', \"table_name\" 'yy_regions'); oracle_fdw\u63d2\u4ef6\u4f7f\u7528 #\u5728\u4e3b\u8282\u70b9\u4ee5\u53ca\u5907\u4efd\u4e3b\u8282\u70b9\u7528root\u7528\u6237\u6267\u884c #\u521d\u6b21\u4f7f\u7528\u9700\u8981\u521b\u5efa\u6269\u5c55,\u5728mdw\u7528gpadmin\u7528\u6237source env.sh\u540e\u6267\u884c create extension oracle_fdw; #\u540e\u7eed\u4f7f\u7528\u76f4\u63a5\u521b\u5efa\u670d\u52a1\u5668\u4ee5\u53ca\u7528\u6237\u6620\u5c04\u5373\u53ef create server orcljcz1 foreign data wrapper oracle_fdw options (dbserver '//123.123.29.205:1521/orcl'); #\u628a\u670d\u52a1\u5668\u8f6c\u79fb\u7ed9hjdev\u7528\u6237 ALTER SERVER \"orcljcz1\" OWNER TO \"hjdev\"; #\u521b\u5efa\u7528\u6237\u6620\u5c04 create user mapping for hjdev server orcljcz1 options (user 'thieisuser',password 'thisispass'); #\u521b\u5efa\u5916\u90e8\u8868 CREATE FOREIGN TABLE \"public\".\"out_jcz1_csl_menu\" ( \"id\" varchar(255) NOT NULL, \"menu_name\" varchar(255), \"ranking\" varchar(255), \"href\" varchar(255), \"icon\" varchar(255), \"pid\" varchar(255), \"is_leaf\" varchar(255), \"is_base\" int4, \"menu_key\" varchar(255), \"tag\" varchar(255) ) SERVER \"orcljcz1\" OPTIONS (\"schema\" 'CSL', \"table\" 'CSL_MENU'); ALTER FOREIGN TABLE \"public\".\"out_jcz1_csl_menu\" OWNER TO \"hjdev\"; \u4f7f\u7528\u6280\u5de7 \u5206\u5e03\u5b57\u6bb5\u8bf4\u660e greenplum\u662f\u5206\u5e03\u5f0f\u7684\u6570\u636e\u5e93,\u6240\u4ee5\u9700\u8981\u4e00\u4e2a\u5206\u5e03\u5b57\u6bb5\u7528\u6765\u544a\u8bc9\u6570\u636e\u5e93\u6839\u636e\u54ea\u4e2a\u5b57\u6bb5\u6765\u5206\u5e03\u6570\u636e,\u6700\u597d\u4f7f\u7528\u4e00\u4e2a\u81ea\u589e\u5e8f\u5217\u4f5c\u4e3a\u5206\u5e03\u952e\u8fd9\u6837\u53ef\u4ee5\u5c06\u6570\u636e\u5747\u5300\u7684\u5206\u5e03\u5230\u6bcf\u4e2a\u6570\u636e\u8282\u70b9,\u5206\u5e03\u952e\u9ed8\u8ba4\u4e3a\u7b2c\u4e00\u4e2a\u5b57\u6bb5; \u5efa\u7acb\u7d22\u5f15\u8bf4\u660e \u5efa\u7acb\u7d22\u5f15\u65f6\u5019\u9009\u62e9\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bb5\u5728\u4f60\u7684sql\u67e5\u8be2\u4e2d\u5fc5\u987b\u4f20\u5165\u8be5\u6761\u4ef6,\u5426\u5219\u7d22\u5f15\u7528\u5904\u4e0d\u5927\u4e25\u91cd\u5f71\u54cd\u67e5\u8be2\u6548\u7387,\u7b2c\u4e00\u4e2a\u4e4b\u5916\u7684\u5176\u4ed6\u5b57\u6bb5\u4e0d\u53d7\u5f71\u54cd,\u5b9e\u6d4b\u572820\u4e2a\u5b9e\u4f8b\u7684gp\u96c6\u7fa4\u4e2d\u4ece9\u4ebf\u6761\u6570\u636e\u91cc\u6b63\u786e\u4f7f\u7528\u7d22\u5f15\u67e5\u8be2\u52a0\u6392\u5e8f\u8017\u65f61\u79d2\u5de6\u53f3(\u6570\u636e\u91cf6000w+) \u5907\u4efd\u4e0e\u6062\u590d #\u53ea\u5907\u4efd\u7ed3\u6784 pg_dump -U hjdev -f ./dbstruct.sql -s lh #\u5907\u4efd\u7ed3\u6784\u52a0\u6570\u636e pg_dump -U hjdev -f ./dbdata.sql lhlh#\u6062\u590d psql -U hjdev -f ./dbdata.sql lhlh \u6269\u5bb9\u96c6\u7fa4 \u9996\u5148\u6309\u7167\u90e8\u7f72\u6587\u6863\u5347\u7ea7\u7cfb\u7edf\u5185\u6838\u4ee5\u53casysctl\u8bbe\u7f6e\u8fd8\u6709ulimit\u7684\u8bbe\u7f6e \u5b89\u88c5docker\u5e76\u52a0\u5165\u539f\u6709\u96c6\u7fa4\u7684\u7f51\u7edc,\u5728\u539f\u6709\u96c6\u7fa4\u6267\u884cdocker swarm join-token manager\u7136\u540e\u5c06\u8f93\u51fa\u7684\u547d\u4ee4\u5728\u65b0\u673a\u5668\u6267\u884c \u6bcf\u6b21\u81f3\u5c11\u6dfb\u52a0\u4e24\u53f0\u673a\u5668 \u7f16\u5199\u6269\u5bb9\u914d\u7f6e\u6587\u4ef6addhost(\u5176\u4e2ddbid\u662f\u4ece\u6570\u636e\u5e93\u4e2d select * from gp_segment_configuration order by content \u987a\u7740\u589e\u52a0\u7684,content\u4e5f\u662f\u5728\u73b0\u6709\u57fa\u7840\u4e0a\u6328\u7740\u589e\u52a0\u7684,datadir\u4e2d\u7684pgseg\u540e\u7684\u6570\u5b57\u662f\u53d6\u503c\u4e8econtent #<hostname>|<address>|<port>|<datadir>|<dbid>|<content>|<preferred_role> sdw4|sdw4|10000|/home/gpadmin/data/gpseg6|15|6|p sdw4|sdw4|10001|/home/gpadmin/data/gpseg7|16|7|p sdw5|sdw5|10000|/home/gpadmin/data/gpseg8|19|8|p sdw5|sdw5|10001|/home/gpadmin/data/gpseg9|20|9|p sdw5|sdw5|30000|/home/gpadmin/mirror/gpseg6|17|6|m sdw5|sdw5|30001|/home/gpadmin/mirror/gpseg7|18|7|m sdw4|sdw4|30000|/home/gpadmin/mirror/gpseg8|21|8|m sdw4|sdw4|30001|/home/gpadmin/mirror/gpseg9|22|9|m \u5206\u522b\u5728\u8981\u6dfb\u52a0\u7684\u673a\u5668\u6267\u884c ipcs -ls \u53ef\u4ee5\u5728\u4e3b\u8282\u70b9\u76f4\u63a5ssh\u8fc7\u53bb\u6267\u884c,\u770b\u8f93\u51fa\u7684\u6570\u503c\u662f\u5426\u548c\u73b0\u6709\u96c6\u7fa4\u7684\u4e00\u6837 \u4fee\u6539\u4e3b\u8282\u70b9(pgseg0)\u7684\u4e3b\u8981\u5b9e\u4f8b\u548c\u955c\u50cf\u5b9e\u4f8b\u7684 gpseg0/pg_hba.conf \u6587\u4ef6,\u5728\u5176\u4e2d\u6dfb\u52a0\u4e00\u884c host all gpadmin 192.168.123.10/24 trust \u5176\u4e2d 192.168.123.10\u662f\u96c6\u7fa4\u7684\u865a\u62dfip\u6bb5\u53ef\u901a\u8fc7 ip addr \u83b7\u53d6\u5230; \u6267\u884c\u6269\u5bb9(\u6dfb\u52a0\u8282\u70b9\u6b65\u9aa4): gpexpand -i addhost -v ,\u5982\u679c\u65e0\u610f\u5916\u7684\u8bdd\u8282\u70b9\u6dfb\u52a0\u6210\u529f\u53ef\u4ee5\u901a\u8fc7 gpstate -a \u67e5\u770b\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from gp_segment_configuration order by content \u67e5\u770b \u6267\u884c\u6570\u636e\u5747\u8861(\u95f2\u65f6\u6267\u884c): gpexpand -d 2:00:00 \u4ee3\u8868\u6267\u884c\u6700\u591a2\u4e2a\u5c0f\u65f6\u7684\u6570\u636e\u5747\u8861 #\u8f93\u51fa\u65e5\u5fd7(\u5728\u5747\u8861\u8fc7\u7a0b\u4e2d\u7684\u8868\u51e0\u4e4e\u65e0\u6cd5\u8bbf\u95ee) 20210122:12:07:11:043279 gpexpand:mdw:gpadmin-[INFO]:-Querying gpexpand schema for current expansion state 20210122:12:07:12:043279 gpexpand:mdw:gpadmin-[INFO]:-Expanding lh.public.czrkjbxx 20210122:12:07:12:043279 gpexpand:mdw:gpadmin-[INFO]:-Finished expanding lhlhublic.czrkjbxx 20210122:12:07:12:043279 gpexpand:mdw:gpadmin-[INFO]:-Expanding lhlhlic.myreg 20210122:12:07:12:043279 gpexpand:mdw:gpadmin-[INFO]:-Finished expanding lh.plhc.myreg 20210122:12:07:12:043279 gpexpand:mdw:gpadmin-[INFO]:-Expanding lh.publhcar_pass \u7269\u5316\u89c6\u56fe\u529f\u80fd \u7269\u5316\u89c6\u56fe\u662fpg\u7c7b\u6570\u636e\u5e93\u7279\u6709\u4e00\u9879\u529f\u80fd\uff0c\u610f\u5373\u5c06\u89c6\u56fe\u4e2d\u7684\u6570\u636e\u7f13\u5b58\u7684gp\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u4e4b\u4e0a\u5efa\u7acb\u7d22\u5f15\u4ee5\u53ca\u589e\u91cf\u66f4\u65b0\u7b49\u7279\u6027 \u521b\u5efa\u7269\u5316\u89c6\u56fe\uff08\u53ef\u4ee5\u57fa\u4e8e\u5916\u90e8\u8868\uff09 create MATERIALIZED view mv_out_czrkupdate as select * from out_czrkupdate with no data; -- \u5237\u65b0\u6570\u636e refresh MATERIALIZED view mv_out_czrkupdate; -- \u521b\u5efa\u7d22\u5f15 create index idx_mv_outczk_pt on mv_out_czrkupdate(gmsfhm); --\u6307\u5b9a\u5206\u5e03\u952e\u7684\u7269\u5316\u89c6\u56fe create MATERIALIZED view mv_out_lhhj_yhcar as select * from out_lhhj_yhcar with no data Distributed by (pid); -- \u521b\u5efa\u552f\u4e00\u7d22\u5f15\uff08\u589e\u91cf\u5237\u65b0\u5fc5\u5907\uff09 create index idx_mv_out_lhlh_yhcar on mv_out_lhhj_yhcar(pid); -- \u5168\u91cf\u5237\u65b0 -- \u589e\u91cf\u5237\u65b0\uff08\u589e\u91cf\u5237\u65b0\u524d\u5fc5\u987b\u5168\u91cf\u5237\u65b0\u4e00\u6b21\uff09 refresh MATERIALIZED view concurrently mv_out_lhhj_yhcar; \u6545\u969c\u6062\u590d \u6062\u590d\u6240\u6709\u6709\u95ee\u9898\u7684\u8282\u70b9(\u8282\u70b9\u7684\u5bb9\u5668\u542f\u52a8\u72b6\u6001\u4e0b) #gpmaster gpadmin\u767b\u5f55 source env.sh gprecoverseg --hba-hostnames -a #\u6267\u884c\u6210\u529f\u4e0a\u9762\u547d\u4ee4\u540e\u901a\u8fc7\u4e0b\u9762\u547d\u4ee4\u67e5\u770b(\u4e0a\u9762\u547d\u4ee4\u6267\u884c\u6210\u529f\u540e\u9700\u8981\u7b49\u7b49\u4e09\u4e94\u5206\u949f\u6216\u8005\u901a\u8fc7`gpstate -s`\u67e5\u770b\u540c\u6b65\u72b6\u6001) gpstate -e #\u5982\u679c\u59cb\u7ec8\u6709\u8282\u70b9\u9519\u8bef\u5c31\u7ee7\u7eed\u4f7f\u7528\u4e0b\u9762\u5168\u91cf\u540c\u6b65\u6a21\u5f0f\u6062\u590d\u8282\u70b9 gprecoverseg --hba-hostnames -F -a #\u6210\u529f\u5b8c\u6210\u540e\u6267\u884c gprecoverseg ---hba-hostnames -r -a #\u6700\u540e\u901a\u8fc7\u4e0b\u9762\u547d\u4ee4\u67e5\u770b(\u4e0a\u9762\u547d\u4ee4\u6267\u884c\u6210\u529f\u540e\u9700\u8981\u7b49\u7b49\u4e09\u4e94\u5206\u949f\u6216\u8005\u901a\u8fc7`gpstate -s`\u67e5\u770b\u540c\u6b65\u72b6\u6001) gpstate -e \u81ea\u52a8\u6e05\u7406\u8fc7\u671f\u65e5\u5fd7 \u4ece\u5bb9\u5668\u5916\u9762\u901a\u8fc7docker exec xxx\u6765\u8c03\u7528 #!/bin/bash cd /home/gpadmin/master logf=\"perday.log\" echo \"begin check gpstate `date` \" > $logf source /home/gpadmin/env.sh gprecoverseg --hba-hostnames -a >> $logf gprecoverseg --hba-hostnames -F -a >> $logf gprecoverseg --hba-hostnames -r -a >> $logf gpstate -a >> $logf #clean old log find /home/gpadmin -name \"gpdb-*.csv\" -atime +3 |xargs rm -f echo mdw >> $logf df -h >> $logf gpssh -f /home/gpadmin/hostfile -e 'df -h' >> $logf gpssh -f /home/gpadmin/hostfile -e 'find /home/gpadmin -name \"gpdb-*.csv\" -atime +3 |xargs rm -f' >> $logf echo \"check over\" >> $logf \u7ef4\u62a4\u6a21\u5f0f \u7ef4\u62a4\u6a21\u5f0f\u542f\u52a8: gpstart -m \u7ef4\u62a4\u6a21\u5f0f\u8fde\u63a5: PGOPTIONS='-c gp_session_role=utility' psql dbname \u7ef4\u62a4\u5b8c\u6bd5\u6b63\u5e38\u542f\u52a8: gpstop -mr sql\u6280\u5de7 \u5bf9\u67d0\u4e2a\u8868\u8fdb\u884c\u7edf\u8ba1\u5e76\u67e5\u770b \u6b64\u65b9\u6cd5\u53ef\u4ee5\u6839\u636e\u6570\u636e\u8868\u7ed3\u6784\u548c\u5b58\u50a8\u7684\u6570\u636e\u5206\u6790\u51fa\u5177\u4f53\u6bcf\u5217\u7684\u6700\u5e38\u89c1\u503c\u3001\u51fa\u73b0\u9891\u7387\u3001null\u7387\u7b49\u5e38\u7528\u7edf\u8ba1\u4fe1\u606f\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5236\u4f5c\u70ed\u529b\u56fe\u4e00\u7c7b \u6ce8\u610f\uff1a\u5bf9\u4e8e\u6570\u636e\u91cf\u8f83\u591a\u7684\u8868\uff0c\u6b64\u65b9\u6cd5\u7edf\u8ba1\u51fa\u7684\u4fe1\u606f\u53ea\u662f\u62bd\u6837\u7edf\u8ba1\u4e0d\u662f\u5168\u91cf\u7edf\u8ba1\uff01 analyze car_pass; select * from pg_stats where tablename='car_pass'; \u67e5\u8be2\u5f53\u524d\u8fde\u63a5\u6570 select count(1) from pg_stat_activity; \u6ce8\u610f\u4e8b\u9879 \u4e25\u7981\u4f7f\u7528kill\u547d\u4ee4\u6740postgres\u8fdb\u7a0b\uff0c\u6709\u7c7b\u4f3c\u9700\u8981\u8bf7\u4f7f\u7528\u6570\u636e\u5e93\u547d\u4ee4 pg_terminate_backend() \u6765\u5b8c\u6210 \u6bcf\u5929\u5b9a\u65f6analyze\u4ee5\u53cavacuum\u5927\u8868\u6216\u8005\u6570\u636e\u91cf\u6bcf\u5929\u53d8\u5316\u8f83\u5927\u7684\u8868 greenplum\u5173\u95ed\u73b0\u6709\u8fde\u63a5 \u5f53\u666e\u901a\u7528\u6237\u65e0\u6cd5\u8fde\u63a5\u6570\u636e\u5e93\uff0c\u63d0\u793a\u8fde\u63a5\u8fc7\u591a\u65f6\u5019\u6211\u4eec\u901a\u8fc7\u7ba1\u7406\u5458\u6a21\u5f0f\u8fdb\u53bb\u67e5\u51fa\u6240\u6709\u8fde\u63a5\uff0c\u7136\u540e\u8fdb\u884c\u5173\u95ed\u5373\u53ef #\u4f7f\u7528\u8d85\u7ba1\u6a21\u5f0f\u8fdb\u5165 PGOPTIONS='-c gp_session_role=utility' psql test #\u5982\u679c\u8981\u5173\u95ed\u6240\u6709\u8fde\u63a5 select pg_terminate_backend(pid) from pg_stat_activity; #\u5982\u679c\u5173\u95ed\u8fde\u63a5\u5230\u67d0\u4e2a\u6570\u636e\u5e93\u7684\u8fde\u63a5 select pg_terminate_backend(pid) from pg_stat_activity where datname='test'; \u5217\u5f0f\u5b58\u50a8\u7279\u70b9 \u4f18\u52bf \u6570\u636e\u6309\u5217\u5b58\u50a8\u53ef\u4ee5\u83b7\u5f97\u8f83\u9ad8\u7684\u538b\u7f29\u6bd4 \u5f53\u67e5\u8be2\u5c11\u91cf\u5b57\u6bb5\u65f6\u5019\uff0c\u626b\u63cf\u7684\u5757\u66f4\u5c11\uff0c\u8282\u7ea6iO\u4e14\u63d0\u5347\u6548\u7387 \u52a3\u52bf \u67e5\u8be2\u5927\u91cf\u5b57\u6bb5\u6216\u67e5\u8be2\u8bb0\u5f55\u6570\u504f\u5c11\u65f6\u4f1a\u9020\u6210\u8f83\u591a\u79bb\u6563IO \u7531\u4e8eIO\u653e\u5927\uff0c\u5217\u5b58\u50a8\u4e0d\u9002\u5408OLTP\u573a\u666f\uff0c\u5982\u6709\u5927\u91cf\u66f4\u65b0\u67e5\u8be2\u64cd\u4f5c\u7684\u8868 \u9002\u7528\u573a\u666f \u5178\u578b\u7684OLAP\u573a\u666f\u3001\u6309\u5217\u505a\u8f83\u5927\u8303\u56f4\u7684\u805a\u5408\u5206\u6790\u6216\u8005JOIN\u5206\u6790 \u5982\u679c\u7528\u6237\u9891\u7e41\u7684\u88c5\u8f7d\u548c\u66f4\u65b0\u8868\u6570\u636e\u9002\u7528\u4e8e\u9762\u5411\u884c\u7684heap\u8868\uff0c\u9762\u5411\u5217\u9002\u7528\u4e8e\u8ffd\u52a0\u4f18\u5316\u7684\u8868\uff08\u5199\u5165\u591a\uff09 \u9891\u7e41insert\u6574\u884c\u7684\u8bf7\u9009\u62e9\u9762\u5411\u8ffd\u52a0\u4f18\u5316\u7684\u884c\u5b58\u50a8\u8868 \u67e5\u8be2\u4e2d\u7ecf\u5e38\u9700\u8981\u8fd4\u56de\u5168\u90e8\u6216\u8005\u5927\u90e8\u5206\u5217\u7684\u60c5\u51b5\u4e0b\u8bf7\u4f7f\u7528\u9762\u5411\u884c\u5b58\u50a8\u7684\u65b9\u5f0f where\u6761\u4ef6\u5355\u4e00\u4e14\u8fd4\u56de\u8f83\u5c11\u884c\uff0c\u9002\u7528\u4e8e\u5217\u5b58 \u5217\u5b58\u652f\u6301\u538b\u7f29\uff0c\u884c\u5b58\u4e0d\u652f\u6301 \u8ffd\u52a0\u4f18\u5316\u8868\u4f7f\u7528 \u5217\u5f0f\u8ffd\u52a0\u8868 create table tac (id serial4,t1 varchar(255) with(appendonly=true,orientation=column) distributed by (id) ; \u884c\u5f0f\u8ffd\u52a0\u8868 create table tarc (id serial4,t1 varchar(255) with(appendonly=true,orientation=row) distributed by (id) ; \u666e\u901a\u884c\u5f0fheap\u8868 create table tarc (id serial4,t1 varchar(255) distributed by (id) ; \u6b7b\u9501\u6392\u67e5 select * from gp_toolkit.gp_locks_on_relation limit 10 --select pg_terminate_backend(xxx)","title":"greenplum\u96c6\u7fa4\u4f7f\u7528"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#greenplum","text":"","title":"greenplum\u96c6\u7fa4\u4f7f\u7528"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#fdw","text":"","title":"FDW\u63d2\u4ef6\u4f7f\u7528"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#mysql_fdw","text":"#\u5728\u4e3b\u8282\u70b9\u4ee5\u53ca\u5907\u4efd\u4e3b\u8282\u70b9\u7528root\u7528\u6237\u6267\u884c #\u521d\u6b21\u4f7f\u7528\u9700\u8981\u521b\u5efa\u6269\u5c55,\u5728mdw\u7528gpadmin\u7528\u6237source env.sh\u540e\u6267\u884c create extension mysql_fdw; #\u540e\u7eed\u4f7f\u7528\u76f4\u63a5\u521b\u5efa\u670d\u52a1\u5668\u4ee5\u53ca\u7528\u6237\u6620\u5c04\u5373\u53ef create server bz47 foreign data wrapper mysql_fdw options (host 'hereisip' ,port '3306'); #\u628a\u670d\u52a1\u5668\u8f6c\u79fb\u7ed9hjdev\u7528\u6237 ALTER SERVER \"bz47\" OWNER TO \"hjdev\"; #\u521b\u5efa\u7528\u6237\u6620\u5c04 create user mapping for hjdev server bz47 options (username 'root',password 'pass'); #\u521b\u5efa\u5916\u90e8\u8868 CREATE FOREIGN TABLE \"public\".\"out_yy_regions\" ( \"indexCode\" varchar(255), \"name\" varchar(255), \"parentIndexCode\" varchar(255), \"treeCode\" varchar(255), \"id\" int4 ) SERVER \"bz47\" OPTIONS (\"dbname\" 'db', \"table_name\" 'yy_regions');","title":"mysql_fdw\u63d2\u4ef6\u4f7f\u7528"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#oracle_fdw","text":"#\u5728\u4e3b\u8282\u70b9\u4ee5\u53ca\u5907\u4efd\u4e3b\u8282\u70b9\u7528root\u7528\u6237\u6267\u884c #\u521d\u6b21\u4f7f\u7528\u9700\u8981\u521b\u5efa\u6269\u5c55,\u5728mdw\u7528gpadmin\u7528\u6237source env.sh\u540e\u6267\u884c create extension oracle_fdw; #\u540e\u7eed\u4f7f\u7528\u76f4\u63a5\u521b\u5efa\u670d\u52a1\u5668\u4ee5\u53ca\u7528\u6237\u6620\u5c04\u5373\u53ef create server orcljcz1 foreign data wrapper oracle_fdw options (dbserver '//123.123.29.205:1521/orcl'); #\u628a\u670d\u52a1\u5668\u8f6c\u79fb\u7ed9hjdev\u7528\u6237 ALTER SERVER \"orcljcz1\" OWNER TO \"hjdev\"; #\u521b\u5efa\u7528\u6237\u6620\u5c04 create user mapping for hjdev server orcljcz1 options (user 'thieisuser',password 'thisispass'); #\u521b\u5efa\u5916\u90e8\u8868 CREATE FOREIGN TABLE \"public\".\"out_jcz1_csl_menu\" ( \"id\" varchar(255) NOT NULL, \"menu_name\" varchar(255), \"ranking\" varchar(255), \"href\" varchar(255), \"icon\" varchar(255), \"pid\" varchar(255), \"is_leaf\" varchar(255), \"is_base\" int4, \"menu_key\" varchar(255), \"tag\" varchar(255) ) SERVER \"orcljcz1\" OPTIONS (\"schema\" 'CSL', \"table\" 'CSL_MENU'); ALTER FOREIGN TABLE \"public\".\"out_jcz1_csl_menu\" OWNER TO \"hjdev\";","title":"oracle_fdw\u63d2\u4ef6\u4f7f\u7528"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_1","text":"","title":"\u4f7f\u7528\u6280\u5de7"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_2","text":"greenplum\u662f\u5206\u5e03\u5f0f\u7684\u6570\u636e\u5e93,\u6240\u4ee5\u9700\u8981\u4e00\u4e2a\u5206\u5e03\u5b57\u6bb5\u7528\u6765\u544a\u8bc9\u6570\u636e\u5e93\u6839\u636e\u54ea\u4e2a\u5b57\u6bb5\u6765\u5206\u5e03\u6570\u636e,\u6700\u597d\u4f7f\u7528\u4e00\u4e2a\u81ea\u589e\u5e8f\u5217\u4f5c\u4e3a\u5206\u5e03\u952e\u8fd9\u6837\u53ef\u4ee5\u5c06\u6570\u636e\u5747\u5300\u7684\u5206\u5e03\u5230\u6bcf\u4e2a\u6570\u636e\u8282\u70b9,\u5206\u5e03\u952e\u9ed8\u8ba4\u4e3a\u7b2c\u4e00\u4e2a\u5b57\u6bb5;","title":"\u5206\u5e03\u5b57\u6bb5\u8bf4\u660e"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_3","text":"\u5efa\u7acb\u7d22\u5f15\u65f6\u5019\u9009\u62e9\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bb5\u5728\u4f60\u7684sql\u67e5\u8be2\u4e2d\u5fc5\u987b\u4f20\u5165\u8be5\u6761\u4ef6,\u5426\u5219\u7d22\u5f15\u7528\u5904\u4e0d\u5927\u4e25\u91cd\u5f71\u54cd\u67e5\u8be2\u6548\u7387,\u7b2c\u4e00\u4e2a\u4e4b\u5916\u7684\u5176\u4ed6\u5b57\u6bb5\u4e0d\u53d7\u5f71\u54cd,\u5b9e\u6d4b\u572820\u4e2a\u5b9e\u4f8b\u7684gp\u96c6\u7fa4\u4e2d\u4ece9\u4ebf\u6761\u6570\u636e\u91cc\u6b63\u786e\u4f7f\u7528\u7d22\u5f15\u67e5\u8be2\u52a0\u6392\u5e8f\u8017\u65f61\u79d2\u5de6\u53f3(\u6570\u636e\u91cf6000w+)","title":"\u5efa\u7acb\u7d22\u5f15\u8bf4\u660e"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_4","text":"#\u53ea\u5907\u4efd\u7ed3\u6784 pg_dump -U hjdev -f ./dbstruct.sql -s lh #\u5907\u4efd\u7ed3\u6784\u52a0\u6570\u636e pg_dump -U hjdev -f ./dbdata.sql lhlh#\u6062\u590d psql -U hjdev -f ./dbdata.sql lhlh","title":"\u5907\u4efd\u4e0e\u6062\u590d"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_5","text":"\u9996\u5148\u6309\u7167\u90e8\u7f72\u6587\u6863\u5347\u7ea7\u7cfb\u7edf\u5185\u6838\u4ee5\u53casysctl\u8bbe\u7f6e\u8fd8\u6709ulimit\u7684\u8bbe\u7f6e \u5b89\u88c5docker\u5e76\u52a0\u5165\u539f\u6709\u96c6\u7fa4\u7684\u7f51\u7edc,\u5728\u539f\u6709\u96c6\u7fa4\u6267\u884cdocker swarm join-token manager\u7136\u540e\u5c06\u8f93\u51fa\u7684\u547d\u4ee4\u5728\u65b0\u673a\u5668\u6267\u884c \u6bcf\u6b21\u81f3\u5c11\u6dfb\u52a0\u4e24\u53f0\u673a\u5668 \u7f16\u5199\u6269\u5bb9\u914d\u7f6e\u6587\u4ef6addhost(\u5176\u4e2ddbid\u662f\u4ece\u6570\u636e\u5e93\u4e2d select * from gp_segment_configuration order by content \u987a\u7740\u589e\u52a0\u7684,content\u4e5f\u662f\u5728\u73b0\u6709\u57fa\u7840\u4e0a\u6328\u7740\u589e\u52a0\u7684,datadir\u4e2d\u7684pgseg\u540e\u7684\u6570\u5b57\u662f\u53d6\u503c\u4e8econtent #<hostname>|<address>|<port>|<datadir>|<dbid>|<content>|<preferred_role> sdw4|sdw4|10000|/home/gpadmin/data/gpseg6|15|6|p sdw4|sdw4|10001|/home/gpadmin/data/gpseg7|16|7|p sdw5|sdw5|10000|/home/gpadmin/data/gpseg8|19|8|p sdw5|sdw5|10001|/home/gpadmin/data/gpseg9|20|9|p sdw5|sdw5|30000|/home/gpadmin/mirror/gpseg6|17|6|m sdw5|sdw5|30001|/home/gpadmin/mirror/gpseg7|18|7|m sdw4|sdw4|30000|/home/gpadmin/mirror/gpseg8|21|8|m sdw4|sdw4|30001|/home/gpadmin/mirror/gpseg9|22|9|m \u5206\u522b\u5728\u8981\u6dfb\u52a0\u7684\u673a\u5668\u6267\u884c ipcs -ls \u53ef\u4ee5\u5728\u4e3b\u8282\u70b9\u76f4\u63a5ssh\u8fc7\u53bb\u6267\u884c,\u770b\u8f93\u51fa\u7684\u6570\u503c\u662f\u5426\u548c\u73b0\u6709\u96c6\u7fa4\u7684\u4e00\u6837 \u4fee\u6539\u4e3b\u8282\u70b9(pgseg0)\u7684\u4e3b\u8981\u5b9e\u4f8b\u548c\u955c\u50cf\u5b9e\u4f8b\u7684 gpseg0/pg_hba.conf \u6587\u4ef6,\u5728\u5176\u4e2d\u6dfb\u52a0\u4e00\u884c host all gpadmin 192.168.123.10/24 trust \u5176\u4e2d 192.168.123.10\u662f\u96c6\u7fa4\u7684\u865a\u62dfip\u6bb5\u53ef\u901a\u8fc7 ip addr \u83b7\u53d6\u5230; \u6267\u884c\u6269\u5bb9(\u6dfb\u52a0\u8282\u70b9\u6b65\u9aa4): gpexpand -i addhost -v ,\u5982\u679c\u65e0\u610f\u5916\u7684\u8bdd\u8282\u70b9\u6dfb\u52a0\u6210\u529f\u53ef\u4ee5\u901a\u8fc7 gpstate -a \u67e5\u770b\u4e5f\u53ef\u4ee5\u901a\u8fc7 select * from gp_segment_configuration order by content \u67e5\u770b \u6267\u884c\u6570\u636e\u5747\u8861(\u95f2\u65f6\u6267\u884c): gpexpand -d 2:00:00 \u4ee3\u8868\u6267\u884c\u6700\u591a2\u4e2a\u5c0f\u65f6\u7684\u6570\u636e\u5747\u8861 #\u8f93\u51fa\u65e5\u5fd7(\u5728\u5747\u8861\u8fc7\u7a0b\u4e2d\u7684\u8868\u51e0\u4e4e\u65e0\u6cd5\u8bbf\u95ee) 20210122:12:07:11:043279 gpexpand:mdw:gpadmin-[INFO]:-Querying gpexpand schema for current expansion state 20210122:12:07:12:043279 gpexpand:mdw:gpadmin-[INFO]:-Expanding lh.public.czrkjbxx 20210122:12:07:12:043279 gpexpand:mdw:gpadmin-[INFO]:-Finished expanding lhlhublic.czrkjbxx 20210122:12:07:12:043279 gpexpand:mdw:gpadmin-[INFO]:-Expanding lhlhlic.myreg 20210122:12:07:12:043279 gpexpand:mdw:gpadmin-[INFO]:-Finished expanding lh.plhc.myreg 20210122:12:07:12:043279 gpexpand:mdw:gpadmin-[INFO]:-Expanding lh.publhcar_pass","title":"\u6269\u5bb9\u96c6\u7fa4"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_6","text":"\u7269\u5316\u89c6\u56fe\u662fpg\u7c7b\u6570\u636e\u5e93\u7279\u6709\u4e00\u9879\u529f\u80fd\uff0c\u610f\u5373\u5c06\u89c6\u56fe\u4e2d\u7684\u6570\u636e\u7f13\u5b58\u7684gp\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u4e4b\u4e0a\u5efa\u7acb\u7d22\u5f15\u4ee5\u53ca\u589e\u91cf\u66f4\u65b0\u7b49\u7279\u6027 \u521b\u5efa\u7269\u5316\u89c6\u56fe\uff08\u53ef\u4ee5\u57fa\u4e8e\u5916\u90e8\u8868\uff09 create MATERIALIZED view mv_out_czrkupdate as select * from out_czrkupdate with no data; -- \u5237\u65b0\u6570\u636e refresh MATERIALIZED view mv_out_czrkupdate; -- \u521b\u5efa\u7d22\u5f15 create index idx_mv_outczk_pt on mv_out_czrkupdate(gmsfhm); --\u6307\u5b9a\u5206\u5e03\u952e\u7684\u7269\u5316\u89c6\u56fe create MATERIALIZED view mv_out_lhhj_yhcar as select * from out_lhhj_yhcar with no data Distributed by (pid); -- \u521b\u5efa\u552f\u4e00\u7d22\u5f15\uff08\u589e\u91cf\u5237\u65b0\u5fc5\u5907\uff09 create index idx_mv_out_lhlh_yhcar on mv_out_lhhj_yhcar(pid); -- \u5168\u91cf\u5237\u65b0 -- \u589e\u91cf\u5237\u65b0\uff08\u589e\u91cf\u5237\u65b0\u524d\u5fc5\u987b\u5168\u91cf\u5237\u65b0\u4e00\u6b21\uff09 refresh MATERIALIZED view concurrently mv_out_lhhj_yhcar;","title":"\u7269\u5316\u89c6\u56fe\u529f\u80fd"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_7","text":"","title":"\u6545\u969c\u6062\u590d"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_8","text":"#gpmaster gpadmin\u767b\u5f55 source env.sh gprecoverseg --hba-hostnames -a #\u6267\u884c\u6210\u529f\u4e0a\u9762\u547d\u4ee4\u540e\u901a\u8fc7\u4e0b\u9762\u547d\u4ee4\u67e5\u770b(\u4e0a\u9762\u547d\u4ee4\u6267\u884c\u6210\u529f\u540e\u9700\u8981\u7b49\u7b49\u4e09\u4e94\u5206\u949f\u6216\u8005\u901a\u8fc7`gpstate -s`\u67e5\u770b\u540c\u6b65\u72b6\u6001) gpstate -e #\u5982\u679c\u59cb\u7ec8\u6709\u8282\u70b9\u9519\u8bef\u5c31\u7ee7\u7eed\u4f7f\u7528\u4e0b\u9762\u5168\u91cf\u540c\u6b65\u6a21\u5f0f\u6062\u590d\u8282\u70b9 gprecoverseg --hba-hostnames -F -a #\u6210\u529f\u5b8c\u6210\u540e\u6267\u884c gprecoverseg ---hba-hostnames -r -a #\u6700\u540e\u901a\u8fc7\u4e0b\u9762\u547d\u4ee4\u67e5\u770b(\u4e0a\u9762\u547d\u4ee4\u6267\u884c\u6210\u529f\u540e\u9700\u8981\u7b49\u7b49\u4e09\u4e94\u5206\u949f\u6216\u8005\u901a\u8fc7`gpstate -s`\u67e5\u770b\u540c\u6b65\u72b6\u6001) gpstate -e","title":"\u6062\u590d\u6240\u6709\u6709\u95ee\u9898\u7684\u8282\u70b9(\u8282\u70b9\u7684\u5bb9\u5668\u542f\u52a8\u72b6\u6001\u4e0b)"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_9","text":"\u4ece\u5bb9\u5668\u5916\u9762\u901a\u8fc7docker exec xxx\u6765\u8c03\u7528 #!/bin/bash cd /home/gpadmin/master logf=\"perday.log\" echo \"begin check gpstate `date` \" > $logf source /home/gpadmin/env.sh gprecoverseg --hba-hostnames -a >> $logf gprecoverseg --hba-hostnames -F -a >> $logf gprecoverseg --hba-hostnames -r -a >> $logf gpstate -a >> $logf #clean old log find /home/gpadmin -name \"gpdb-*.csv\" -atime +3 |xargs rm -f echo mdw >> $logf df -h >> $logf gpssh -f /home/gpadmin/hostfile -e 'df -h' >> $logf gpssh -f /home/gpadmin/hostfile -e 'find /home/gpadmin -name \"gpdb-*.csv\" -atime +3 |xargs rm -f' >> $logf echo \"check over\" >> $logf","title":"\u81ea\u52a8\u6e05\u7406\u8fc7\u671f\u65e5\u5fd7"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_10","text":"\u7ef4\u62a4\u6a21\u5f0f\u542f\u52a8: gpstart -m \u7ef4\u62a4\u6a21\u5f0f\u8fde\u63a5: PGOPTIONS='-c gp_session_role=utility' psql dbname \u7ef4\u62a4\u5b8c\u6bd5\u6b63\u5e38\u542f\u52a8: gpstop -mr","title":"\u7ef4\u62a4\u6a21\u5f0f"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#sql","text":"","title":"sql\u6280\u5de7"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_11","text":"\u6b64\u65b9\u6cd5\u53ef\u4ee5\u6839\u636e\u6570\u636e\u8868\u7ed3\u6784\u548c\u5b58\u50a8\u7684\u6570\u636e\u5206\u6790\u51fa\u5177\u4f53\u6bcf\u5217\u7684\u6700\u5e38\u89c1\u503c\u3001\u51fa\u73b0\u9891\u7387\u3001null\u7387\u7b49\u5e38\u7528\u7edf\u8ba1\u4fe1\u606f\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5236\u4f5c\u70ed\u529b\u56fe\u4e00\u7c7b \u6ce8\u610f\uff1a\u5bf9\u4e8e\u6570\u636e\u91cf\u8f83\u591a\u7684\u8868\uff0c\u6b64\u65b9\u6cd5\u7edf\u8ba1\u51fa\u7684\u4fe1\u606f\u53ea\u662f\u62bd\u6837\u7edf\u8ba1\u4e0d\u662f\u5168\u91cf\u7edf\u8ba1\uff01 analyze car_pass; select * from pg_stats where tablename='car_pass';","title":"\u5bf9\u67d0\u4e2a\u8868\u8fdb\u884c\u7edf\u8ba1\u5e76\u67e5\u770b"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_12","text":"select count(1) from pg_stat_activity;","title":"\u67e5\u8be2\u5f53\u524d\u8fde\u63a5\u6570"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_13","text":"\u4e25\u7981\u4f7f\u7528kill\u547d\u4ee4\u6740postgres\u8fdb\u7a0b\uff0c\u6709\u7c7b\u4f3c\u9700\u8981\u8bf7\u4f7f\u7528\u6570\u636e\u5e93\u547d\u4ee4 pg_terminate_backend() \u6765\u5b8c\u6210 \u6bcf\u5929\u5b9a\u65f6analyze\u4ee5\u53cavacuum\u5927\u8868\u6216\u8005\u6570\u636e\u91cf\u6bcf\u5929\u53d8\u5316\u8f83\u5927\u7684\u8868","title":"\u6ce8\u610f\u4e8b\u9879"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#greenplum_1","text":"\u5f53\u666e\u901a\u7528\u6237\u65e0\u6cd5\u8fde\u63a5\u6570\u636e\u5e93\uff0c\u63d0\u793a\u8fde\u63a5\u8fc7\u591a\u65f6\u5019\u6211\u4eec\u901a\u8fc7\u7ba1\u7406\u5458\u6a21\u5f0f\u8fdb\u53bb\u67e5\u51fa\u6240\u6709\u8fde\u63a5\uff0c\u7136\u540e\u8fdb\u884c\u5173\u95ed\u5373\u53ef #\u4f7f\u7528\u8d85\u7ba1\u6a21\u5f0f\u8fdb\u5165 PGOPTIONS='-c gp_session_role=utility' psql test #\u5982\u679c\u8981\u5173\u95ed\u6240\u6709\u8fde\u63a5 select pg_terminate_backend(pid) from pg_stat_activity; #\u5982\u679c\u5173\u95ed\u8fde\u63a5\u5230\u67d0\u4e2a\u6570\u636e\u5e93\u7684\u8fde\u63a5 select pg_terminate_backend(pid) from pg_stat_activity where datname='test';","title":"greenplum\u5173\u95ed\u73b0\u6709\u8fde\u63a5"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_14","text":"","title":"\u5217\u5f0f\u5b58\u50a8\u7279\u70b9"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_15","text":"\u6570\u636e\u6309\u5217\u5b58\u50a8\u53ef\u4ee5\u83b7\u5f97\u8f83\u9ad8\u7684\u538b\u7f29\u6bd4 \u5f53\u67e5\u8be2\u5c11\u91cf\u5b57\u6bb5\u65f6\u5019\uff0c\u626b\u63cf\u7684\u5757\u66f4\u5c11\uff0c\u8282\u7ea6iO\u4e14\u63d0\u5347\u6548\u7387","title":"\u4f18\u52bf"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_16","text":"\u67e5\u8be2\u5927\u91cf\u5b57\u6bb5\u6216\u67e5\u8be2\u8bb0\u5f55\u6570\u504f\u5c11\u65f6\u4f1a\u9020\u6210\u8f83\u591a\u79bb\u6563IO \u7531\u4e8eIO\u653e\u5927\uff0c\u5217\u5b58\u50a8\u4e0d\u9002\u5408OLTP\u573a\u666f\uff0c\u5982\u6709\u5927\u91cf\u66f4\u65b0\u67e5\u8be2\u64cd\u4f5c\u7684\u8868","title":"\u52a3\u52bf"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_17","text":"\u5178\u578b\u7684OLAP\u573a\u666f\u3001\u6309\u5217\u505a\u8f83\u5927\u8303\u56f4\u7684\u805a\u5408\u5206\u6790\u6216\u8005JOIN\u5206\u6790 \u5982\u679c\u7528\u6237\u9891\u7e41\u7684\u88c5\u8f7d\u548c\u66f4\u65b0\u8868\u6570\u636e\u9002\u7528\u4e8e\u9762\u5411\u884c\u7684heap\u8868\uff0c\u9762\u5411\u5217\u9002\u7528\u4e8e\u8ffd\u52a0\u4f18\u5316\u7684\u8868\uff08\u5199\u5165\u591a\uff09 \u9891\u7e41insert\u6574\u884c\u7684\u8bf7\u9009\u62e9\u9762\u5411\u8ffd\u52a0\u4f18\u5316\u7684\u884c\u5b58\u50a8\u8868 \u67e5\u8be2\u4e2d\u7ecf\u5e38\u9700\u8981\u8fd4\u56de\u5168\u90e8\u6216\u8005\u5927\u90e8\u5206\u5217\u7684\u60c5\u51b5\u4e0b\u8bf7\u4f7f\u7528\u9762\u5411\u884c\u5b58\u50a8\u7684\u65b9\u5f0f where\u6761\u4ef6\u5355\u4e00\u4e14\u8fd4\u56de\u8f83\u5c11\u884c\uff0c\u9002\u7528\u4e8e\u5217\u5b58 \u5217\u5b58\u652f\u6301\u538b\u7f29\uff0c\u884c\u5b58\u4e0d\u652f\u6301","title":"\u9002\u7528\u573a\u666f"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_18","text":"","title":"\u8ffd\u52a0\u4f18\u5316\u8868\u4f7f\u7528"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_19","text":"create table tac (id serial4,t1 varchar(255) with(appendonly=true,orientation=column) distributed by (id) ;","title":"\u5217\u5f0f\u8ffd\u52a0\u8868"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_20","text":"create table tarc (id serial4,t1 varchar(255) with(appendonly=true,orientation=row) distributed by (id) ;","title":"\u884c\u5f0f\u8ffd\u52a0\u8868"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#heap","text":"create table tarc (id serial4,t1 varchar(255) distributed by (id) ;","title":"\u666e\u901a\u884c\u5f0fheap\u8868"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8/#_21","text":"select * from gp_toolkit.gp_locks_on_relation limit 10 --select pg_terminate_backend(xxx)","title":"\u6b7b\u9501\u6392\u67e5"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/","text":"greenplum\u96c6\u7fa4\u642d\u5efa \u8fd9\u662f\u4f7f\u7528docker\u65b9\u5f0f\u642d\u5efa\u7684\uff0c\u4ec5\u4f9b\u53c2\u8003\uff0c\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u76f4\u63a5\u5728\u5bbf\u4e3b\u673a\u5b89\u88c5 \u673a\u5668\u5217\u8868 123.123.4.96 123.123.4.100 123.123.4.101 123.123.4.102 123.123.4.103 \u4e3b\u8282\u70b9\u72ec\u5360 123.123.4.104 123.123.4.105 docker swarm\u65b9\u5f0f(\u5f53\u524d\u91c7\u7528) docker \u7248\u672c19.03 \u540c\u6b65\u6240\u6709\u673a\u5668\u65f6\u949f ntpdate 21.0.2.8 \u66f4\u65b0\u5185\u6838\u5230\u81f3\u5c114.4 rpm -ivh http://ip:9999/kernel-ml-5.1.16-1.el7.elrepo.x86_64.rpm && sed -i \"s/saved/0/g\" /etc/default/grub && grub2-mkconfig -o /boot/grub2/grub.cfg grub2-set-default 'CentOS Linux (5.1.16-1.el7.elrepo.x86_64) 7 (Core)' grub2-editenv list reboot \u4fee\u6539\u5bb9\u5668\u5bbf\u4e3b\u673a /etc/security/limit.conf\u4e2d\u7684\u6700\u5927\u6253\u5f00\u6587\u4ef6\u6570\u91cf\u9650\u5236 \u7cfb\u7edf\u8d44\u6e90\u9650\u5236\u8bbe\u7f6e #/etc/security/limits.conf * soft nofile 524288 * hard nofile 524288 * soft nproc 131072 * hard nproc 131072 root soft nofile 524288 root hard nofile 524288 root soft nproc 131072 root hard nproc 131072 ulimit -u \u5bb9\u5668\u5bbf\u4e3b\u673a\u7cfb\u7edf\u5185\u6838\u8bbe\u7f6e /etc/sysctl.conf #\u4e0b\u9762\u8fd9\u4e2a\u503c\u6765\u81ea# echo $(expr $(getconf _PHYS_PAGES) / 2) kernel.shmall=25769461 #\u4e0b\u9762\u8fd9\u4e2a\u503c\u6765\u81ea# echo $(expr $(getconf _PHYS_PAGES) / 2 \\* $(getconf PAGE_SIZE)) kernel.shmmax=105551712256 kernel.shmmni = 4096 vm.overcommit_memory = 2 vm.overcommit_ratio = 95 net.ipv4.ip_local_port_range = 10000 65535 #\u4e0b\u9762\u8fd9\u4e2a\u503c\u5f71\u54cd\u6700\u5927\u8fde\u63a5\u6570 kernel.sem = 50100 128256000 50100 2560 kernel.sysrq = 1 kernel.core_uses_pid = 1 kernel.msgmnb = 65536 kernel.msgmax = 65536 kernel.msgmni = 2048 net.ipv4.tcp_syncookies = 1 net.ipv4.conf.default.accept_source_route = 0 net.ipv4.tcp_max_syn_backlog = 4096 net.ipv4.conf.all.arp_filter = 1 net.core.netdev_max_backlog = 10000 net.core.rmem_max = 2097152 net.core.wmem_max = 2097152 vm.swappiness = 10 vm.zone_reclaim_mode = 0 vm.dirty_expire_centisecs = 500 vm.dirty_writeback_centisecs = 100 vm.dirty_background_ratio = 0 vm.dirty_ratio = 0 vm.dirty_background_bytes = 1610612736 vm.dirty_bytes = 4294967296 \u5bb9\u5668\u5bbf\u4e3b\u673a\u4fee\u6539\u6570\u636e\u76d8\u7684\u6302\u8f7d\u9009\u9879\u4e3a: rw,nodev,noatime,nobarrier,inode64 nano /etc/fstab #\u5982\u679c\u7c7b\u578b\u5df2\u7ecf\u662fxfs\u5c31\u5149\u4fee\u6539\u9009\u9879\u5373\u53ef\uff0cgp\u5b98\u65b9\u63a8\u8350xfs\u7c7b\u578b\uff0c\u5982\u679c\u6ca1\u5565\u6570\u636e\u4e14\u4e0d\u662fxfs\u7684\u8bdd\u53ef\u4ee5\u683c\u5f0f\u5316\u4e00\u4e0b #\u91cd\u65b0\u52a0\u8f7d\u5206\u533a mount -o,remount /data #\u5176\u4e2d105\u4e3a\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u673a\u5668\u4e0d\u4fbf\u683c\u5f0f\u5316\u6570\u636e\u5206\u533a\uff0c\u8003\u8651\u6682\u65f6\u4e0d\u5c06\u5176\u52a0\u5165\u96c6\u7fa4\u4e2d \u521b\u5efadocker swarm\u96c6\u7fa4 docker swarm init #worker docker swarm join --token SWMTKN-1-3t4l2pk38x0v08f81u5kamsd6izx8llun3wy34oq3emvwy2p9x-1j0uk1hytunbpwt5lvzztauu3 123.123.4.104:2377 #manager docker swarm join --token SWMTKN-1-3t4l2pk38x0v08f81u5kamsd6izx8llun3wy34oq3emvwy2p9x-3y9hzhemm08k70dh4s0f3uw5x 123.123.4.104:2377 \u521b\u5efa\u7f51\u7edc docker network create --attachable -d overlay --subnet 192.168.123.0/24 gpnet \u521b\u5efa\u4e3b\u8282\u70b9\u548c\u6570\u636e\u8282\u70b9 #\u4e3b\u8282\u70b9103 mkdir /data/gpmaster && chmod 777 -R /data/gpmaster docker run -itd --name mdw --hostname mdw --net gpnet -p 6222:22 -p 5432:5432 -v /data/gpmaster:/home/gpadmin/master --restart=always hdfs4:5000/mygreenplum6:fdwmo #\u6570\u636e\u8282\u70b9101 mkdir /data/{gpdata,gpmirror} && chmod 777 -R /data/gpdata && chmod 777 -R /data/gpmirror docker run -itd --name sdw4 --hostname sdw4 --net gpnet -v /data/gpmirror:/home/gpadmin/mirror -v /data/gpdata:/home/gpadmin/data --restart=always hdfs4:5000/mygreenplum6:fdwmo #\u6570\u636e\u8282\u70b9102 mkdir /data/{gpdata,gpmirror} && chmod 777 -R /data/gpdata && chmod 777 -R /data/gpmirror docker run -itd --name sdw2 --hostname sdw2 --net gpnet -v /data/gpmirror:/home/gpadmin/mirror -v /data/gpdata:/home/gpadmin/data --restart=always hdfs4:5000/mygreenplum6:fdwmo #\u6570\u636e\u8282\u70b9104 mkdir /data/{gpdata,gpmirror} && chmod 777 -R /data/gpdata && chmod 777 -R /data/gpmirror docker run -itd --name sdw3 --hostname sdw3 --net gpnet -v /data/gpmirror:/home/gpadmin/mirror -v /data/gpdata:/home/gpadmin/data --restart=always hdfs4:5000/mygreenplum6:fdwmo #\u6570\u636e\u8282\u70b9100 mkdir /data/{gpdata,gpmirror} && chmod 777 -R /data/gpdata && chmod 777 -R /data/gpmirror docker run -itd --name sdw1 --hostname sdw1 --net gpnet -v /data/gpmirror:/home/gpadmin/mirror -v /data/gpdata:/home/gpadmin/data --restart=always hdfs4:5000/mygreenplum6:fdwmo #\u5907\u4efd\u4e3b\u8282\u70b9103 mkdir /data/gpdata && chmod 777 -R /data/gpdata docker run -itd --name mdw1 --hostname mdw1 --net gpnet -v /data/gpstandby:/home/gpadmin/master --restart=always hdfs4:5000/mygreenplum6:fdwmo #\u5907\u4efd\u4e3b\u8282\u70b996 mkdir /data/{gpdata,gpmirror} && chmod 777 -R /data/gpdata && chmod 777 -R /data/gpmirror docker run -itd --name sdw5 --hostname sdw5 --net gpnet -v /data/gpmirror:/home/gpadmin/mirror -v /data/gpdata:/home/gpadmin/data --restart=always hdfs4:5000/mygreenplum6:fdwmo \u521d\u59cb\u5316\u96c6\u7fa4 #103\u4e3b\u8282\u70b9\u6267\u884c docker exec -it -u gpadmin mdw bash cd ~ source /usr/local/greenplum-db/greenplum_path.sh ./artifact/prepare.sh -s 4 -n 1 #\u4fee\u6539gpinitsystem_config\u653e\u5f00\u5176\u4e2d\u88ab\u6ce8\u91ca\u6389\u7684mirror\u76f8\u5173\u8bbe\u7f6e,\u5e76\u4fee\u6539\u5176\u4e2d MIRROR_DATA_DIRECTORY=(/home/gpadmin/mirror)\u4e3a MIRROR_DATA_DIRECTORY=(/home/gpadmin/mirror /home/gpadmin/mirror) \u5177\u4f53\u8bbe\u7f6e\u51e0\u4e2a\u7531\u4e0a\u9762\u4e00\u6761\u547d\u4ee4\u4e2d\u7684-n \u53c2\u6570\u6765\u51b3\u5b9a(\u5982\u679c\u662f1\u5c31\u4e0d\u7528\u6539\u8fd9\u4e2a\uff09 gpinitsystem -c gpinitsystem_config -s mdw1 -a source env.sh echo 'source /usr/local/greenplum-db/greenplum_path.sh' >> ~/.bashrc echo 'source env.sh' >> ~/.bashrc #\u4e0d\u5efa\u8bae \u5f00\u542fgpadmin\u7528\u6237\u7684\u8fdc\u7a0b\u8bbf\u95ee\uff08\u5f00\u542f\u540e\u662f\u65e0\u5bc6\u7801\u7684\uff0c\u5c3d\u5feb\u8bbe\u7f6e\u5bc6\u7801\uff09 #bash artifact/postinstall.sh #\u67e5\u770b\u5b89\u88c5\u7ed3\u679c ps -ef|grep postgres #\u67e5\u770b\u96c6\u7fa4\u72b6\u6001\uff0c\u5e94\u8be5\u80fd\u770b\u5230\u4e24\u4e2amaster\uff0c4\u4e2aPrimary Segment \u4ee5\u53ca4\u4e2aMirror Segment gpstate -a #\u7528\u4e0b\u9762\u547d\u4ee4\u67e5\u8be2\u5404\u4e2a\u8282\u70b9\u7684\u53c2\u6570\u662f\u5426\u76f8\u540c gpssh -f hostfile -e 'ipcs -ls' \u4f18\u5316\u8c03\u6574 gpconfig -c gp_enable_global_deadlock_detector -v on gpconfig -c log_statement -v none gpconfig -c wal_writer_delay -v '10ms' gpconfig -c checkpoint_completion_target -v 0.9 gpconfig -c shared_buffers -v '16GB' -m '512MB' gpconfig -c work_mem -v '16MB' -m '16MB' gpconfig -c wal_buffers -v '10MB' -m '10MB' gpconfig -c statement_mem -v '2GB' -m '2GB' gpconfig -c max_statement_mem -v '4GB' -m '4GB' gpconfig -c statement_timeout -m 10min -v 10min #\u8bbe\u7f6e\u65f6\u533a gpconfig -c TimeZone -m 'Asia/Shanghai' -v 'Asia/Shanghai' #\u81ea\u52a8\u5206\u6790 gpconfig -c gp_autostats_mode -m on_change -v on_change gpconfig -c gp_autostats_on_change_threshold -m 100000000 -v 100000000 #\u8bbe\u7f6e\u5185\u5b58\u5927\u5c0f\uff0c\u6700\u5c0f\u5185\u5b58\u8282\u70b9\u5185\u5b58=x\uff0c\u6b64\u503c\u8ba1\u7b97\u65b9\u6cd5\u4e3a=x*0.75/(\u4e3b\u8282\u70b9\u6570+\u4ece\u8282\u70b9\u6570) gpconfig -c gp_vmem_protect_limit -m 6144 -v 6144 #\u4fee\u6539\u6700\u5927\u8fde\u63a5\u6570(-v\u4e3asegment\u7684\u5b98\u65b9\u5efa\u8bae\u4e3a\u4e3b\u8282\u70b9\u76845~10\u500d) gpconfig -c max_connections -v 4000 -m 2000 && gpconfig -c max_prepared_transactions -v 4000 #\u91cd\u542f\u96c6\u7fa4\u751f\u6548\uff08\u90e8\u5206\u914d\u7f6e\u9700\u8981\u5f7b\u5e95\u91cd\u542f\uff09 gpstop -M fast -a && gpstart #\u68c0\u67e5\u4fee\u6539\u662f\u5426\u751f\u6548 gpconfig -s gp_enable_global_deadlock_detector && gpconfig -s log_statement gpconfig -s max_connections && gpconfig -s max_prepared_transactions \u521d\u59cb\u5316\u6570\u636e\u5e93\u4ee5\u53ca\u521b\u5efa\u7528\u6237 #\u521b\u5efa\u6570\u636e\u5e93 createdb lhcz -E utf-8 #\u521b\u5efa\u7528\u6237 psql -d lhcz create role hjdev password 'thisispass' createdb login; \\q #\u5728master\u8282\u70b9\u4fee\u6539pg_hba.conf\u6587\u4ef6\u6765\u8d4b\u4e88\u7528\u6237\u8fdc\u7a0b\u767b\u5f55\u7684\u6743\u9650 vi /home/gpadmin/master/gpseg-1/pg_hba.conf #\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9 host all hjdev 0.0.0.0/0 md5 :wq \u4fdd\u5b58\u9000\u51fa #\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e gpstop -u nginx\u8bbf\u95ee\u5165\u53e3 #nginx.cfg user nginx; worker_processes 32; error_log /var/log/nginx/error.log warn; pid /var/run/nginx.pid; events { worker_connections 8192; # muti_accept on; use epoll; } worker_rlimit_nofile 40000; #fastcgi_connect_timeout 100; #fastcgi_send_timeout 100; #fastcgi_read_timeout 100; #depends on nginx 1.11.2 and later stream { upstream gps { server mdw:5432 max_fails=3; server mdw1:5432 max_fails=3 backup; } server { listen 5432; proxy_pass gps; } } #createnginx.sh docker rm nginx -f docker run -itd -v /data/nginx/nginx.cfg:/etc/nginx/nginx.conf --name nginx -p 15432:5432 --restart=always cloud.lhcz.com:5000/nginx \u5b89\u88c5\u914d\u7f6e\u670d\u52a1\u7aef\u8fde\u63a5\u6c60 cd /tmp #\u4e0b\u8f7dwget ftp://read:read@spwftp/linux/greenplum/pgbouncer_1.15_x86_64.tgz tar zxvf pgbouncer_1.15_x86_64.tgz ./install.sh mkdir bin mv pgbouncer bin/ cd bin \u521b\u5efa\u914d\u7f6e\u6587\u4ef6 [databases] lhcz = host=localhost port=5432 dbname=lhcz bzyq = host=localhost port=5432 dbname=bzyq test = host=localhost port=5432 dbname=test postgres = host=localhost port=5432 dbname=postgres [pgbouncer] listen_port=6543 listen_addr=0.0.0.0 auth_type=md5 auth_file=userlist.txt logfile=pgbouncer.log pidfile=pgbouncer.pid max_db_connections=500 admin_users=hjdev ;next for datax ignore_startup_parameters = extra_float_digits ;; When server connection is released back to pool: ;; session - after client disconnects (default) ;; transaction - after transaction finishes ;datax throw error ;; statement - after statement finishes ;cannot use transaction ;pool_mode = transaction transaction\u6a21\u5f0f\u4f1a\u9020\u6210datax\u62a5\u9519\uff0c\u9700\u8981\u5728datax\u7684\u6570\u636e\u5e93\u8fde\u63a5\u5b57\u4e32\u4e2d\u589e\u52a0 prepareThreshold=0 \u521b\u5efa\u7528\u6237\u914d\u7f6e\u6587\u4ef6userlist.txt \"\u7528\u6237\u540d\" \"\u5bc6\u7801\u660e\u6587\" \"\u7528\u6237\u540d\" \"md5+md5\u503c\" \u7f16\u5199\u542f\u52a8\u811a\u672c\uff08\u5bb9\u5668\u5185\uff09 #path:/home/gpadmin/master/startpool.sh cd /home/gpadmin/master/bin ./pgbouncer -d pgbouncer.ini #\u8fdb\u5165\u63a7\u5236\u53f0 psql -p 6543 -U hjdev pgbouncer #\u8f93\u5165\u5bc6\u7801 show help;\u663e\u793a\u5e2e\u52a9 \u7f16\u5199\u201c\u81ea\u542f\u52a8\u201d #\u901a\u8fc7\u5728/home/gpadmin/env.sh\u4e2d\u8ffd\u52a0\u8bed\u53e5\u5b9e\u73b0\u53d8\u76f8\u81ea\u542f\u52a8 bash /home/gpadmin/master/startpool.sh \u4f7f\u7528 #\u8fdb\u5165\u8fde\u63a5\u6c60\u7ba1\u7406\u5e93 psql -p 6543 -h 127.0.0.1 -U hjdev pgbouncer #\u8f93\u5165\u5bc6\u7801 show help;#\u67e5\u770b\u5e2e\u52a9 show clients;#\u67e5\u770b\u8fde\u63a5\u7684\u5ba2\u6237\u7aef","title":"greenplum\u96c6\u7fa4\u642d\u5efa"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/#greenplum","text":"\u8fd9\u662f\u4f7f\u7528docker\u65b9\u5f0f\u642d\u5efa\u7684\uff0c\u4ec5\u4f9b\u53c2\u8003\uff0c\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u76f4\u63a5\u5728\u5bbf\u4e3b\u673a\u5b89\u88c5","title":"greenplum\u96c6\u7fa4\u642d\u5efa"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/#_1","text":"123.123.4.96 123.123.4.100 123.123.4.101 123.123.4.102 123.123.4.103 \u4e3b\u8282\u70b9\u72ec\u5360 123.123.4.104 123.123.4.105","title":"\u673a\u5668\u5217\u8868"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/#docker-swarm","text":"docker \u7248\u672c19.03 \u540c\u6b65\u6240\u6709\u673a\u5668\u65f6\u949f ntpdate 21.0.2.8 \u66f4\u65b0\u5185\u6838\u5230\u81f3\u5c114.4 rpm -ivh http://ip:9999/kernel-ml-5.1.16-1.el7.elrepo.x86_64.rpm && sed -i \"s/saved/0/g\" /etc/default/grub && grub2-mkconfig -o /boot/grub2/grub.cfg grub2-set-default 'CentOS Linux (5.1.16-1.el7.elrepo.x86_64) 7 (Core)' grub2-editenv list reboot \u4fee\u6539\u5bb9\u5668\u5bbf\u4e3b\u673a /etc/security/limit.conf\u4e2d\u7684\u6700\u5927\u6253\u5f00\u6587\u4ef6\u6570\u91cf\u9650\u5236 \u7cfb\u7edf\u8d44\u6e90\u9650\u5236\u8bbe\u7f6e #/etc/security/limits.conf * soft nofile 524288 * hard nofile 524288 * soft nproc 131072 * hard nproc 131072 root soft nofile 524288 root hard nofile 524288 root soft nproc 131072 root hard nproc 131072 ulimit -u \u5bb9\u5668\u5bbf\u4e3b\u673a\u7cfb\u7edf\u5185\u6838\u8bbe\u7f6e /etc/sysctl.conf #\u4e0b\u9762\u8fd9\u4e2a\u503c\u6765\u81ea# echo $(expr $(getconf _PHYS_PAGES) / 2) kernel.shmall=25769461 #\u4e0b\u9762\u8fd9\u4e2a\u503c\u6765\u81ea# echo $(expr $(getconf _PHYS_PAGES) / 2 \\* $(getconf PAGE_SIZE)) kernel.shmmax=105551712256 kernel.shmmni = 4096 vm.overcommit_memory = 2 vm.overcommit_ratio = 95 net.ipv4.ip_local_port_range = 10000 65535 #\u4e0b\u9762\u8fd9\u4e2a\u503c\u5f71\u54cd\u6700\u5927\u8fde\u63a5\u6570 kernel.sem = 50100 128256000 50100 2560 kernel.sysrq = 1 kernel.core_uses_pid = 1 kernel.msgmnb = 65536 kernel.msgmax = 65536 kernel.msgmni = 2048 net.ipv4.tcp_syncookies = 1 net.ipv4.conf.default.accept_source_route = 0 net.ipv4.tcp_max_syn_backlog = 4096 net.ipv4.conf.all.arp_filter = 1 net.core.netdev_max_backlog = 10000 net.core.rmem_max = 2097152 net.core.wmem_max = 2097152 vm.swappiness = 10 vm.zone_reclaim_mode = 0 vm.dirty_expire_centisecs = 500 vm.dirty_writeback_centisecs = 100 vm.dirty_background_ratio = 0 vm.dirty_ratio = 0 vm.dirty_background_bytes = 1610612736 vm.dirty_bytes = 4294967296 \u5bb9\u5668\u5bbf\u4e3b\u673a\u4fee\u6539\u6570\u636e\u76d8\u7684\u6302\u8f7d\u9009\u9879\u4e3a: rw,nodev,noatime,nobarrier,inode64 nano /etc/fstab #\u5982\u679c\u7c7b\u578b\u5df2\u7ecf\u662fxfs\u5c31\u5149\u4fee\u6539\u9009\u9879\u5373\u53ef\uff0cgp\u5b98\u65b9\u63a8\u8350xfs\u7c7b\u578b\uff0c\u5982\u679c\u6ca1\u5565\u6570\u636e\u4e14\u4e0d\u662fxfs\u7684\u8bdd\u53ef\u4ee5\u683c\u5f0f\u5316\u4e00\u4e0b #\u91cd\u65b0\u52a0\u8f7d\u5206\u533a mount -o,remount /data #\u5176\u4e2d105\u4e3a\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u673a\u5668\u4e0d\u4fbf\u683c\u5f0f\u5316\u6570\u636e\u5206\u533a\uff0c\u8003\u8651\u6682\u65f6\u4e0d\u5c06\u5176\u52a0\u5165\u96c6\u7fa4\u4e2d \u521b\u5efadocker swarm\u96c6\u7fa4 docker swarm init #worker docker swarm join --token SWMTKN-1-3t4l2pk38x0v08f81u5kamsd6izx8llun3wy34oq3emvwy2p9x-1j0uk1hytunbpwt5lvzztauu3 123.123.4.104:2377 #manager docker swarm join --token SWMTKN-1-3t4l2pk38x0v08f81u5kamsd6izx8llun3wy34oq3emvwy2p9x-3y9hzhemm08k70dh4s0f3uw5x 123.123.4.104:2377 \u521b\u5efa\u7f51\u7edc docker network create --attachable -d overlay --subnet 192.168.123.0/24 gpnet \u521b\u5efa\u4e3b\u8282\u70b9\u548c\u6570\u636e\u8282\u70b9 #\u4e3b\u8282\u70b9103 mkdir /data/gpmaster && chmod 777 -R /data/gpmaster docker run -itd --name mdw --hostname mdw --net gpnet -p 6222:22 -p 5432:5432 -v /data/gpmaster:/home/gpadmin/master --restart=always hdfs4:5000/mygreenplum6:fdwmo #\u6570\u636e\u8282\u70b9101 mkdir /data/{gpdata,gpmirror} && chmod 777 -R /data/gpdata && chmod 777 -R /data/gpmirror docker run -itd --name sdw4 --hostname sdw4 --net gpnet -v /data/gpmirror:/home/gpadmin/mirror -v /data/gpdata:/home/gpadmin/data --restart=always hdfs4:5000/mygreenplum6:fdwmo #\u6570\u636e\u8282\u70b9102 mkdir /data/{gpdata,gpmirror} && chmod 777 -R /data/gpdata && chmod 777 -R /data/gpmirror docker run -itd --name sdw2 --hostname sdw2 --net gpnet -v /data/gpmirror:/home/gpadmin/mirror -v /data/gpdata:/home/gpadmin/data --restart=always hdfs4:5000/mygreenplum6:fdwmo #\u6570\u636e\u8282\u70b9104 mkdir /data/{gpdata,gpmirror} && chmod 777 -R /data/gpdata && chmod 777 -R /data/gpmirror docker run -itd --name sdw3 --hostname sdw3 --net gpnet -v /data/gpmirror:/home/gpadmin/mirror -v /data/gpdata:/home/gpadmin/data --restart=always hdfs4:5000/mygreenplum6:fdwmo #\u6570\u636e\u8282\u70b9100 mkdir /data/{gpdata,gpmirror} && chmod 777 -R /data/gpdata && chmod 777 -R /data/gpmirror docker run -itd --name sdw1 --hostname sdw1 --net gpnet -v /data/gpmirror:/home/gpadmin/mirror -v /data/gpdata:/home/gpadmin/data --restart=always hdfs4:5000/mygreenplum6:fdwmo #\u5907\u4efd\u4e3b\u8282\u70b9103 mkdir /data/gpdata && chmod 777 -R /data/gpdata docker run -itd --name mdw1 --hostname mdw1 --net gpnet -v /data/gpstandby:/home/gpadmin/master --restart=always hdfs4:5000/mygreenplum6:fdwmo #\u5907\u4efd\u4e3b\u8282\u70b996 mkdir /data/{gpdata,gpmirror} && chmod 777 -R /data/gpdata && chmod 777 -R /data/gpmirror docker run -itd --name sdw5 --hostname sdw5 --net gpnet -v /data/gpmirror:/home/gpadmin/mirror -v /data/gpdata:/home/gpadmin/data --restart=always hdfs4:5000/mygreenplum6:fdwmo \u521d\u59cb\u5316\u96c6\u7fa4 #103\u4e3b\u8282\u70b9\u6267\u884c docker exec -it -u gpadmin mdw bash cd ~ source /usr/local/greenplum-db/greenplum_path.sh ./artifact/prepare.sh -s 4 -n 1 #\u4fee\u6539gpinitsystem_config\u653e\u5f00\u5176\u4e2d\u88ab\u6ce8\u91ca\u6389\u7684mirror\u76f8\u5173\u8bbe\u7f6e,\u5e76\u4fee\u6539\u5176\u4e2d MIRROR_DATA_DIRECTORY=(/home/gpadmin/mirror)\u4e3a MIRROR_DATA_DIRECTORY=(/home/gpadmin/mirror /home/gpadmin/mirror) \u5177\u4f53\u8bbe\u7f6e\u51e0\u4e2a\u7531\u4e0a\u9762\u4e00\u6761\u547d\u4ee4\u4e2d\u7684-n \u53c2\u6570\u6765\u51b3\u5b9a(\u5982\u679c\u662f1\u5c31\u4e0d\u7528\u6539\u8fd9\u4e2a\uff09 gpinitsystem -c gpinitsystem_config -s mdw1 -a source env.sh echo 'source /usr/local/greenplum-db/greenplum_path.sh' >> ~/.bashrc echo 'source env.sh' >> ~/.bashrc #\u4e0d\u5efa\u8bae \u5f00\u542fgpadmin\u7528\u6237\u7684\u8fdc\u7a0b\u8bbf\u95ee\uff08\u5f00\u542f\u540e\u662f\u65e0\u5bc6\u7801\u7684\uff0c\u5c3d\u5feb\u8bbe\u7f6e\u5bc6\u7801\uff09 #bash artifact/postinstall.sh #\u67e5\u770b\u5b89\u88c5\u7ed3\u679c ps -ef|grep postgres #\u67e5\u770b\u96c6\u7fa4\u72b6\u6001\uff0c\u5e94\u8be5\u80fd\u770b\u5230\u4e24\u4e2amaster\uff0c4\u4e2aPrimary Segment \u4ee5\u53ca4\u4e2aMirror Segment gpstate -a #\u7528\u4e0b\u9762\u547d\u4ee4\u67e5\u8be2\u5404\u4e2a\u8282\u70b9\u7684\u53c2\u6570\u662f\u5426\u76f8\u540c gpssh -f hostfile -e 'ipcs -ls' \u4f18\u5316\u8c03\u6574 gpconfig -c gp_enable_global_deadlock_detector -v on gpconfig -c log_statement -v none gpconfig -c wal_writer_delay -v '10ms' gpconfig -c checkpoint_completion_target -v 0.9 gpconfig -c shared_buffers -v '16GB' -m '512MB' gpconfig -c work_mem -v '16MB' -m '16MB' gpconfig -c wal_buffers -v '10MB' -m '10MB' gpconfig -c statement_mem -v '2GB' -m '2GB' gpconfig -c max_statement_mem -v '4GB' -m '4GB' gpconfig -c statement_timeout -m 10min -v 10min #\u8bbe\u7f6e\u65f6\u533a gpconfig -c TimeZone -m 'Asia/Shanghai' -v 'Asia/Shanghai' #\u81ea\u52a8\u5206\u6790 gpconfig -c gp_autostats_mode -m on_change -v on_change gpconfig -c gp_autostats_on_change_threshold -m 100000000 -v 100000000 #\u8bbe\u7f6e\u5185\u5b58\u5927\u5c0f\uff0c\u6700\u5c0f\u5185\u5b58\u8282\u70b9\u5185\u5b58=x\uff0c\u6b64\u503c\u8ba1\u7b97\u65b9\u6cd5\u4e3a=x*0.75/(\u4e3b\u8282\u70b9\u6570+\u4ece\u8282\u70b9\u6570) gpconfig -c gp_vmem_protect_limit -m 6144 -v 6144 #\u4fee\u6539\u6700\u5927\u8fde\u63a5\u6570(-v\u4e3asegment\u7684\u5b98\u65b9\u5efa\u8bae\u4e3a\u4e3b\u8282\u70b9\u76845~10\u500d) gpconfig -c max_connections -v 4000 -m 2000 && gpconfig -c max_prepared_transactions -v 4000 #\u91cd\u542f\u96c6\u7fa4\u751f\u6548\uff08\u90e8\u5206\u914d\u7f6e\u9700\u8981\u5f7b\u5e95\u91cd\u542f\uff09 gpstop -M fast -a && gpstart #\u68c0\u67e5\u4fee\u6539\u662f\u5426\u751f\u6548 gpconfig -s gp_enable_global_deadlock_detector && gpconfig -s log_statement gpconfig -s max_connections && gpconfig -s max_prepared_transactions \u521d\u59cb\u5316\u6570\u636e\u5e93\u4ee5\u53ca\u521b\u5efa\u7528\u6237 #\u521b\u5efa\u6570\u636e\u5e93 createdb lhcz -E utf-8 #\u521b\u5efa\u7528\u6237 psql -d lhcz create role hjdev password 'thisispass' createdb login; \\q #\u5728master\u8282\u70b9\u4fee\u6539pg_hba.conf\u6587\u4ef6\u6765\u8d4b\u4e88\u7528\u6237\u8fdc\u7a0b\u767b\u5f55\u7684\u6743\u9650 vi /home/gpadmin/master/gpseg-1/pg_hba.conf #\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9 host all hjdev 0.0.0.0/0 md5 :wq \u4fdd\u5b58\u9000\u51fa #\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e gpstop -u nginx\u8bbf\u95ee\u5165\u53e3 #nginx.cfg user nginx; worker_processes 32; error_log /var/log/nginx/error.log warn; pid /var/run/nginx.pid; events { worker_connections 8192; # muti_accept on; use epoll; } worker_rlimit_nofile 40000; #fastcgi_connect_timeout 100; #fastcgi_send_timeout 100; #fastcgi_read_timeout 100; #depends on nginx 1.11.2 and later stream { upstream gps { server mdw:5432 max_fails=3; server mdw1:5432 max_fails=3 backup; } server { listen 5432; proxy_pass gps; } } #createnginx.sh docker rm nginx -f docker run -itd -v /data/nginx/nginx.cfg:/etc/nginx/nginx.conf --name nginx -p 15432:5432 --restart=always cloud.lhcz.com:5000/nginx","title":"docker swarm\u65b9\u5f0f(\u5f53\u524d\u91c7\u7528)"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/greenplum%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/#_2","text":"cd /tmp #\u4e0b\u8f7dwget ftp://read:read@spwftp/linux/greenplum/pgbouncer_1.15_x86_64.tgz tar zxvf pgbouncer_1.15_x86_64.tgz ./install.sh mkdir bin mv pgbouncer bin/ cd bin \u521b\u5efa\u914d\u7f6e\u6587\u4ef6 [databases] lhcz = host=localhost port=5432 dbname=lhcz bzyq = host=localhost port=5432 dbname=bzyq test = host=localhost port=5432 dbname=test postgres = host=localhost port=5432 dbname=postgres [pgbouncer] listen_port=6543 listen_addr=0.0.0.0 auth_type=md5 auth_file=userlist.txt logfile=pgbouncer.log pidfile=pgbouncer.pid max_db_connections=500 admin_users=hjdev ;next for datax ignore_startup_parameters = extra_float_digits ;; When server connection is released back to pool: ;; session - after client disconnects (default) ;; transaction - after transaction finishes ;datax throw error ;; statement - after statement finishes ;cannot use transaction ;pool_mode = transaction transaction\u6a21\u5f0f\u4f1a\u9020\u6210datax\u62a5\u9519\uff0c\u9700\u8981\u5728datax\u7684\u6570\u636e\u5e93\u8fde\u63a5\u5b57\u4e32\u4e2d\u589e\u52a0 prepareThreshold=0 \u521b\u5efa\u7528\u6237\u914d\u7f6e\u6587\u4ef6userlist.txt \"\u7528\u6237\u540d\" \"\u5bc6\u7801\u660e\u6587\" \"\u7528\u6237\u540d\" \"md5+md5\u503c\" \u7f16\u5199\u542f\u52a8\u811a\u672c\uff08\u5bb9\u5668\u5185\uff09 #path:/home/gpadmin/master/startpool.sh cd /home/gpadmin/master/bin ./pgbouncer -d pgbouncer.ini #\u8fdb\u5165\u63a7\u5236\u53f0 psql -p 6543 -U hjdev pgbouncer #\u8f93\u5165\u5bc6\u7801 show help;\u663e\u793a\u5e2e\u52a9 \u7f16\u5199\u201c\u81ea\u542f\u52a8\u201d #\u901a\u8fc7\u5728/home/gpadmin/env.sh\u4e2d\u8ffd\u52a0\u8bed\u53e5\u5b9e\u73b0\u53d8\u76f8\u81ea\u542f\u52a8 bash /home/gpadmin/master/startpool.sh \u4f7f\u7528 #\u8fdb\u5165\u8fde\u63a5\u6c60\u7ba1\u7406\u5e93 psql -p 6543 -h 127.0.0.1 -U hjdev pgbouncer #\u8f93\u5165\u5bc6\u7801 show help;#\u67e5\u770b\u5e2e\u52a9 show clients;#\u67e5\u770b\u8fde\u63a5\u7684\u5ba2\u6237\u7aef","title":"\u5b89\u88c5\u914d\u7f6e\u670d\u52a1\u7aef\u8fde\u63a5\u6c60"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE/mysql/","text":"","title":"Mysql"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Mariadb%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/","text":"\u521b\u5efa\u5bb9\u5668 docker network create mdb rootpwd=`openssl rand -base64 16` echo $rootpwd #K0XwkqGwPH+2g4A8x/OueQ== #\u5982\u679c\u662f\u8de8\u4e3b\u673a\u90e8\u7f72\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a--net host\u5373\u53ef\u4f7f\u7528\u4e3b\u673a\u7f51\u7edc\u65e0\u9700\u6620\u5c04\u7aef\u53e3 docker run -itd --name pridb -e MARIADB_ROOT_PASSWORD=\"K0XwkqGwPH+2g4A8x/OueQ==\" --net mdb --hostname pridb -p 3306:3306 mariadb:10.5 docker run -itd --name secdb -e MARIADB_ROOT_PASSWORD=\"K0XwkqGwPH+2g4A8x/OueQ==\" --net mdb --hostname secdb -p 3307:3306 mariadb:10.5 \u8bbe\u7f6e\u4e3b\u8282\u70b9 docker exec -it pridb bash cd /etc/mysql/mariadb.conf.d #\u53ef\u4ee5\u5728\u4e0b\u9762\u914d\u7f6e\u6587\u4ef6\u4e2d\u81ea\u5b9a\u4e49\u4fdd\u7559logbin\u7684\u65e5\u671f\uff0c\u4fdd\u7559\u7684\u957f\u4e86\u4f1a\u5360\u7528\u66f4\u591a\u78c1\u76d8\u7a7a\u95f4\uff0c\u77ed\u4e86\u4f1a\u5b58\u5728\u4ece\u8282\u70b9\u6389\u7ebf\u8d85\u8fc7N\u5929\u5c31\u65e0\u6cd5\u518d\u540c\u6b65\u7684\u60c5\u51b5\uff0c\u9700\u8981\u81ea\u884c\u9009\u62e9 cat > pri.cnf [mysqld] server-id = 1 log-bin = mysql-bin expire_logs_days=3 Ctrl+D exit docker restart pridb docker exec -it pridb bash mysql -uroot -p #\u67e5\u770b\u4e3b\u8282\u70b9\u72b6\u6001 show master status; #\u521b\u5efa\u4ece\u8282\u70b9\u590d\u5236\u8d26\u6237 CREATE USER 'sec'@'%' IDENTIFIED BY 'K0XwkqGwPH'; GRANT REPLICATION SLAVE ON *.* TO 'sec'@'%'; \u914d\u7f6e\u4ece\u8282\u70b9 docker exec -it secdb bash cd /etc/mysql/mariadb.conf.d cat > sec.cnf [mysqld] server-id=2 log-bin = mysql-bin expire_logs_days=3 #\u53ef\u9009\u53c2\u6570 read-only Ctrl+D exit docker restart secdb docker exec -it pridb bash mysql -uroot -p #\u521b\u5efa\u8d26\u6237 CREATE USER 'sec'@'%' IDENTIFIED BY 'K0XwkqGwPH'; GRANT REPLICATION SLAVE ON *.* TO 'sec'@'%'; #\u4e0b\u9762\u7684\u503c\u901a\u8fc7\u5728\u4e3b\u8282\u70b9\u4e2d\u7684show master status\u83b7\u5f97 CHANGE MASTER TO MASTER_HOST='pridb', MASTER_USER='sec', MASTER_PASSWORD='K0XwkqGwPH', MASTER_LOG_FILE='mysqld-bin.000001', MASTER_LOG_POS=646; start slave; show slave status; \u6d4b\u8bd5 --\u5728\u4e3b\u8282\u70b9\u6267\u884c create database testdb; use testdb; create table mytest(id int,txt varchar(255)); insert into mytest values(1,'111'); --\u5728\u4ece\u8282\u70b9\u6267\u884c show databases; use testdb; select * from mytest; --\u5373\u53ef\u770b\u5230testdb\u4e2d\u7684mytest\u8868\u4e2d\u7684\u6570\u636e \u4e3b\u8282\u70b9\u6545\u969c\u63d0\u5347\u4ece\u8282\u70b9\u4e3a\u4e3b\u8282\u70b9 docker stop pridb docker exec -it secdb bash mysql -uroot -p stop slave; reset slave all; show slave status; #\u6ca1\u6709\u4ece\u8282\u70b9\u7684\u72b6\u6001\u6570\u636e\u4e86 #\u5982\u679c\u4e4b\u524d\u6709\u914d\u7f6e\u4ece\u8282\u70b9\u4e3a\u53ea\u8bfb\u7684\u8bdd\u9700\u8981\u53bb\u9664\u53ea\u8bfb\u9009\u9879 exit #\u5b8c\u6210\uff0c\u6b64\u65f6\u53ef\u4ee5\u5bf9\u4ece\u8282\u70b9\u8fdb\u884c\u6b63\u5e38\u4f7f\u7528\u4e86\uff08\u6b63\u5e38\u60c5\u51b5\u4e0d\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528\u4ece\u8282\u70b9\uff0c\u56e0\u4e3a\u4ece\u8282\u70b9\u505a\u7684\u53d8\u66f4\u4e0d\u4f1a\u88ab\u540c\u6b65\u5230\u4e3b\u8282\u70b9\uff0c\u9020\u6210\u6570\u636e\u5dee\u5f02\uff09","title":"Mariadb\u4e3b\u4ece\u590d\u5236"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Mariadb%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/#_1","text":"docker network create mdb rootpwd=`openssl rand -base64 16` echo $rootpwd #K0XwkqGwPH+2g4A8x/OueQ== #\u5982\u679c\u662f\u8de8\u4e3b\u673a\u90e8\u7f72\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a--net host\u5373\u53ef\u4f7f\u7528\u4e3b\u673a\u7f51\u7edc\u65e0\u9700\u6620\u5c04\u7aef\u53e3 docker run -itd --name pridb -e MARIADB_ROOT_PASSWORD=\"K0XwkqGwPH+2g4A8x/OueQ==\" --net mdb --hostname pridb -p 3306:3306 mariadb:10.5 docker run -itd --name secdb -e MARIADB_ROOT_PASSWORD=\"K0XwkqGwPH+2g4A8x/OueQ==\" --net mdb --hostname secdb -p 3307:3306 mariadb:10.5","title":"\u521b\u5efa\u5bb9\u5668"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Mariadb%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/#_2","text":"docker exec -it pridb bash cd /etc/mysql/mariadb.conf.d #\u53ef\u4ee5\u5728\u4e0b\u9762\u914d\u7f6e\u6587\u4ef6\u4e2d\u81ea\u5b9a\u4e49\u4fdd\u7559logbin\u7684\u65e5\u671f\uff0c\u4fdd\u7559\u7684\u957f\u4e86\u4f1a\u5360\u7528\u66f4\u591a\u78c1\u76d8\u7a7a\u95f4\uff0c\u77ed\u4e86\u4f1a\u5b58\u5728\u4ece\u8282\u70b9\u6389\u7ebf\u8d85\u8fc7N\u5929\u5c31\u65e0\u6cd5\u518d\u540c\u6b65\u7684\u60c5\u51b5\uff0c\u9700\u8981\u81ea\u884c\u9009\u62e9 cat > pri.cnf [mysqld] server-id = 1 log-bin = mysql-bin expire_logs_days=3 Ctrl+D exit docker restart pridb docker exec -it pridb bash mysql -uroot -p #\u67e5\u770b\u4e3b\u8282\u70b9\u72b6\u6001 show master status; #\u521b\u5efa\u4ece\u8282\u70b9\u590d\u5236\u8d26\u6237 CREATE USER 'sec'@'%' IDENTIFIED BY 'K0XwkqGwPH'; GRANT REPLICATION SLAVE ON *.* TO 'sec'@'%';","title":"\u8bbe\u7f6e\u4e3b\u8282\u70b9"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Mariadb%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/#_3","text":"docker exec -it secdb bash cd /etc/mysql/mariadb.conf.d cat > sec.cnf [mysqld] server-id=2 log-bin = mysql-bin expire_logs_days=3 #\u53ef\u9009\u53c2\u6570 read-only Ctrl+D exit docker restart secdb docker exec -it pridb bash mysql -uroot -p #\u521b\u5efa\u8d26\u6237 CREATE USER 'sec'@'%' IDENTIFIED BY 'K0XwkqGwPH'; GRANT REPLICATION SLAVE ON *.* TO 'sec'@'%'; #\u4e0b\u9762\u7684\u503c\u901a\u8fc7\u5728\u4e3b\u8282\u70b9\u4e2d\u7684show master status\u83b7\u5f97 CHANGE MASTER TO MASTER_HOST='pridb', MASTER_USER='sec', MASTER_PASSWORD='K0XwkqGwPH', MASTER_LOG_FILE='mysqld-bin.000001', MASTER_LOG_POS=646; start slave; show slave status;","title":"\u914d\u7f6e\u4ece\u8282\u70b9"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Mariadb%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/#_4","text":"--\u5728\u4e3b\u8282\u70b9\u6267\u884c create database testdb; use testdb; create table mytest(id int,txt varchar(255)); insert into mytest values(1,'111'); --\u5728\u4ece\u8282\u70b9\u6267\u884c show databases; use testdb; select * from mytest; --\u5373\u53ef\u770b\u5230testdb\u4e2d\u7684mytest\u8868\u4e2d\u7684\u6570\u636e","title":"\u6d4b\u8bd5"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Mariadb%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/#_5","text":"docker stop pridb docker exec -it secdb bash mysql -uroot -p stop slave; reset slave all; show slave status; #\u6ca1\u6709\u4ece\u8282\u70b9\u7684\u72b6\u6001\u6570\u636e\u4e86 #\u5982\u679c\u4e4b\u524d\u6709\u914d\u7f6e\u4ece\u8282\u70b9\u4e3a\u53ea\u8bfb\u7684\u8bdd\u9700\u8981\u53bb\u9664\u53ea\u8bfb\u9009\u9879 exit #\u5b8c\u6210\uff0c\u6b64\u65f6\u53ef\u4ee5\u5bf9\u4ece\u8282\u70b9\u8fdb\u884c\u6b63\u5e38\u4f7f\u7528\u4e86\uff08\u6b63\u5e38\u60c5\u51b5\u4e0d\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528\u4ece\u8282\u70b9\uff0c\u56e0\u4e3a\u4ece\u8282\u70b9\u505a\u7684\u53d8\u66f4\u4e0d\u4f1a\u88ab\u540c\u6b65\u5230\u4e3b\u8282\u70b9\uff0c\u9020\u6210\u6570\u636e\u5dee\u5f02\uff09","title":"\u4e3b\u8282\u70b9\u6545\u969c\u63d0\u5347\u4ece\u8282\u70b9\u4e3a\u4e3b\u8282\u70b9"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/","text":"Postgresql\u76f8\u5173 \u5e38\u7528\u914d\u7f6e max_connections \u5141\u8bb8\u7684\u6700\u5927\u5ba2\u6237\u7aef\u8fde\u63a5\u6570\u3002\u8fd9\u4e2a\u53c2\u6570\u8bbe\u7f6e\u5927\u5c0f\u548cwork_mem\u6709\u4e00\u4e9b\u5173\u7cfb\u3002\u914d\u7f6e\u7684\u8d8a\u9ad8\uff0c\u53ef\u80fd\u4f1a\u5360\u7528\u7cfb\u7edf\u66f4\u591a\u7684\u5185\u5b58\u3002\u901a\u5e38\u53ef\u4ee5\u8bbe\u7f6e\u6570\u767e\u4e2a\u8fde\u63a5\uff0c\u5982\u679c\u8981\u4f7f\u7528\u4e0a\u5343\u4e2a\u8fde\u63a5\uff0c\u5efa\u8bae\u914d\u7f6e\u8fde\u63a5\u6c60\u6765\u51cf\u5c11\u5f00\u9500\u3002 shared_buffers PostgreSQL\u4f7f\u7528\u81ea\u5df1\u7684\u7f13\u51b2\u533a\uff0c\u4e5f\u4f7f\u7528Linux\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2OS Cache\u3002\u8fd9\u5c31\u8bf4\u660e\u6570\u636e\u4e24\u6b21\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u9996\u5148\u662fPostgreSQL\u7f13\u51b2\u533a\uff0c\u7136\u540e\u662f\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2\u533a\u3002\u4e0e\u5176\u4ed6\u6570\u636e\u5e93\u4e0d\u540c\uff0cPostgreSQL\u4e0d\u63d0\u4f9b\u76f4\u63a5IO\uff0c\u6240\u4ee5\u8fd9\u53c8\u88ab\u79f0\u4e3a\u53cc\u7f13\u51b2\u3002PostgreSQL\u7f13\u51b2\u533a\u79f0\u4e3ashared_buffer\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a\u7269\u7406\u5185\u5b58\u76841/4\u3002\u800c\u5b9e\u9645\u914d\u7f6e\u53d6\u51b3\u4e8e\u786c\u4ef6\u914d\u7f6e\u548c\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5982\u679c\u4f60\u7684\u5185\u5b58\u5f88\u5927\uff0c\u800c\u4f60\u53c8\u60f3\u591a\u7f13\u51b2\u4e00\u4e9b\u6570\u636e\u5230\u5185\u5b58\u4e2d\uff0c\u53ef\u4ee5\u7ee7\u7eed\u8c03\u5927shared_buffer\u3002 Effective_cache_size \u8fd9\u4e2a\u53c2\u6570\u4e3b\u8981\u7528\u4e8ePostgre\u67e5\u8be2\u4f18\u5316\u5668\u3002\u662f\u5355\u4e2a\u67e5\u8be2\u53ef\u7528\u7684\u78c1\u76d8\u9ad8\u901f\u7f13\u5b58\u7684\u6709\u6548\u5927\u5c0f\u7684\u4e00\u4e2a\u5047\u8bbe\uff0c\u662f\u4e00\u4e2a\u4f30\u7b97\u503c\uff0c\u5b83\u5e76\u4e0d\u5360\u636e\u7cfb\u7edf\u5185\u5b58\u3002\u7531\u4e8e\u4f18\u5316\u5668\u9700\u8981\u8fdb\u884c\u4f30\u7b97\u6210\u672c\uff0c\u8f83\u9ad8\u7684\u503c\u66f4\u6709\u53ef\u80fd\u4f7f\u7528\u7d22\u5f15\u626b\u63cf\uff0c\u8f83\u4f4e\u7684\u503c\u5219\u6709\u53ef\u80fd\u4f7f\u7528\u987a\u5e8f\u626b\u63cf\u3002\u4e00\u822c\u8fd9\u4e2a\u503c\u8bbe\u7f6e\u4e3a\u5185\u5b58\u76841/2\u662f\u6b63\u5e38\u4fdd\u5b88\u7684\u8bbe\u7f6e\uff0c\u8bbe\u7f6e\u4e3a\u5185\u5b58\u76843/4\u662f\u6bd4\u8f83\u63a8\u8350\u7684\u503c\u3002\u901a\u8fc7free\u547d\u4ee4\u67e5\u770b\u64cd\u4f5c\u7cfb\u7edf\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u60a8\u53ef\u80fd\u4f1a\u66f4\u597d\u7684\u4f30\u7b97\u8be5\u503c\u3002 [pg@e22 ~]$ free -g total used free shared buff/cache available Mem: 62 2 5 16 55 40 Swap: 7 0 7 work_mem \u8fd9\u4e2a\u53c2\u6570\u4e3b\u8981\u7528\u4e8e\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u4e4b\u524d\u5185\u90e8\u6392\u5e8f\u64cd\u4f5c\u548c\u6563\u5217\u8868\u4f7f\u7528\u7684\u5185\u5b58\u91cf\uff0c\u589e\u52a0work_mem\u53c2\u6570\u5c06\u4f7fPostgreSQL\u53ef\u4ee5\u8fdb\u884c\u66f4\u5927\u7684\u5185\u5b58\u6392\u5e8f\u3002\u8fd9\u4e2a\u53c2\u6570\u548cmax_connections\u6709\u4e00\u4e9b\u5173\u7cfb\uff0c\u5047\u8bbe\u4f60\u8bbe\u7f6e\u4e3a30MB\uff0c\u521940\u4e2a\u7528\u6237\u540c\u65f6\u6267\u884c\u67e5\u8be2\u6392\u5e8f\uff0c\u5f88\u5feb\u5c31\u4f1a\u4f7f\u75281.2GB\u7684\u5b9e\u9645\u5185\u5b58\u3002\u540c\u65f6\u5bf9\u4e8e\u590d\u6742\u67e5\u8be2\uff0c\u53ef\u80fd\u4f1a\u8fd0\u884c\u591a\u4e2a\u6392\u5e8f\u548c\u6563\u5217\u64cd\u4f5c\uff0c\u4f8b\u5982\u6d89\u53ca\u52308\u5f20\u8868\u8fdb\u884c\u5408\u5e76\u6392\u5e8f\uff0c\u6b64\u65f6\u5c31\u9700\u89818\u500d\u7684work_mem\u3002 \u5982\u4e0b\u9762\u6848\u4f8b\u6240\u793a\uff0c\u8be5\u73af\u5883\u4f7f\u75284MB\u7684work_mem\uff0c\u5728\u6267\u884c\u6392\u5e8f\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u7684Sort Method\u662fexternal merge Disk\u3002 external merge Disk\u3002 kms=> explain (analyze,buffers) select * from KMS_BUSINESS_HALL_TOTAL order by buss_query_info; QUERY PLAN --------------------------------------------------------------------------------------------------------------------------------------------------------- Gather Merge (cost=262167.99..567195.15 rows=2614336 width=52) (actual time=2782.203..5184.442 rows=3137204 loops=1) Workers Planned: 2 Workers Launched: 2 Buffers: shared hit=68 read=25939, temp read=28863 written=28947 -> Sort (cost=261167.97..264435.89 rows=1307168 width=52) (actual time=2760.566..3453.783 rows=1045735 loops=3) Sort Key: buss_query_info Sort Method: external merge Disk: 50568kB Worker 0: Sort Method: external merge Disk: 50840kB Worker 1: Sort Method: external merge Disk: 49944kB Buffers: shared hit=68 read=25939, temp read=28863 written=28947 -> Parallel Seq Scan on kms_business_hall_total (cost=0.00..39010.68 rows=1307168 width=52) (actual time=0.547..259.524 rows=1045735 loops=3) Buffers: shared read=25939 Planning Time: 0.540 ms Execution Time: 5461.516 ms (14 rows) \u5f53\u6211\u4eec\u628a\u53c2\u6570\u4fee\u6539\u6210512MB\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u770b\u5230Sort Method\u53d8\u6210\u4e86quicksort Memory\uff0c\u53d8\u6210\u4e86\u5185\u5b58\u6392\u5e8f\u3002 kms=> set work_mem to \"512MB\"; SET kms=> explain (analyze,buffers) select * from KMS_BUSINESS_HALL_TOTAL order by buss_query_info; QUERY PLAN ------------------------------------------------------------------------------------------------------------------------------------------ Sort (cost=395831.79..403674.80 rows=3137204 width=52) (actual time=7870.826..8204.794 rows=3137204 loops=1) Sort Key: buss_query_info Sort Method: quicksort Memory: 359833kB Buffers: shared hit=25939 -> Seq Scan on kms_business_hall_total (cost=0.00..57311.04 rows=3137204 width=52) (actual time=0.019..373.067 rows=3137204 loops=1) Buffers: shared hit=25939 Planning Time: 0.081 ms Execution Time: 8419.994 ms (8 rows) maintenance_work_mem \u6307\u5b9a\u7ef4\u62a4\u64cd\u4f5c\u4f7f\u7528\u7684\u6700\u5927\u5185\u5b58\u91cf\uff0c\u4f8b\u5982\uff08Vacuum\u3001Create Index\u548cAlter Table Add Foreign Key\uff09\uff0c\u9ed8\u8ba4\u503c\u662f64MB\u3002\u7531\u4e8e\u901a\u5e38\u6b63\u5e38\u8fd0\u884c\u7684\u6570\u636e\u5e93\u4e2d\u4e0d\u4f1a\u6709\u5927\u91cf\u5e76\u53d1\u7684\u6b64\u7c7b\u64cd\u4f5c\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u7684\u8f83\u5927\u4e00\u4e9b\uff0c\u63d0\u9ad8\u6e05\u7406\u548c\u521b\u5efa\u7d22\u5f15\u5916\u952e\u7684\u901f\u5ea6\u3002 postgres=# set maintenance_work_mem to \"64MB\"; SET Time: 1.971 ms postgres=# create index idx1_test on test(id); CREATE INDEX Time: 7483.621 ms (00:07.484) postgres=# set maintenance_work_mem to \"2GB\"; SET Time: 0.543 ms postgres=# drop index idx1_test; DROP INDEX Time: 133.984 ms postgres=# create index idx1_test on test(id); CREATE INDEX Time: 5661.018 ms (00:05.661) \u53ef\u4ee5\u770b\u5230\u5728\u4f7f\u7528\u9ed8\u8ba4\u768464MB\u521b\u5efa\u7d22\u5f15\uff0c\u901f\u5ea6\u4e3a7.4\u79d2\uff0c\u800c\u8bbe\u7f6e\u4e3a2GB\u540e\uff0c\u521b\u5efa\u901f\u5ea6\u662f5.6\u79d2 wal_sync_method \u6bcf\u6b21\u53d1\u751f\u4e8b\u52a1\u540e\uff0cPostgreSQL\u4f1a\u5f3a\u5236\u5c06\u63d0\u4ea4\u5199\u5230WAL\u65e5\u5fd7\u7684\u65b9\u5f0f\u3002\u53ef\u4ee5\u4f7f\u7528pg_test_fsync\u547d\u4ee4\u5728\u4f60\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u8fdb\u884c\u6d4b\u8bd5\uff0cfdatasync\u662fLinux\u4e0a\u7684\u9ed8\u8ba4\u65b9\u6cd5\u3002\u5982\u4e0b\u6240\u793a\uff0c\u6211\u7684\u73af\u5883\u6d4b\u8bd5\u4e0b\u6765fdatasync\u8fd8\u662f\u901f\u5ea6\u53ef\u4ee5\u7684\u3002\u4e0d\u652f\u6301\u7684\u65b9\u6cd5\u50cffsync_writethrough\u76f4\u63a5\u663e\u793an/a\u3002 postgres=# show wal_sync_method ; wal_sync_method ----------------- fdatasync (1 row) [pg@e22 ~]$ pg_test_fsync -s 3 3 seconds per test O_DIRECT supported on this platform for open_datasync and open_sync. Compare file sync methods using one 8kB write: (in wal_sync_method preference order, except fdatasync is Linux's default) open_datasync 4782.871 ops/sec 209 usecs/op fdatasync 4935.556 ops/sec 203 usecs/op fsync 3781.254 ops/sec 264 usecs/op fsync_writethrough n/a open_sync 3850.219 ops/sec 260 usecs/op Compare file sync methods using two 8kB writes: (in wal_sync_method preference order, except fdatasync is Linux's default) open_datasync 2469.646 ops/sec 405 usecs/op fdatasync 4412.266 ops/sec 227 usecs/op fsync 3432.794 ops/sec 291 usecs/op fsync_writethrough n/a open_sync 1929.221 ops/sec 518 usecs/op Compare open_sync with different write sizes: (This is designed to compare the cost of writing 16kB in different write open_sync sizes.) 1 * 16kB open_sync write 3159.780 ops/sec 316 usecs/op 2 * 8kB open_sync writes 1944.723 ops/sec 514 usecs/op 4 * 4kB open_sync writes 993.173 ops/sec 1007 usecs/op 8 * 2kB open_sync writes 493.396 ops/sec 2027 usecs/op 16 * 1kB open_sync writes 249.762 ops/sec 4004 usecs/op Test if fsync on non-write file descriptor is honored: (If the times are similar, fsync() can sync data written on a different descriptor.) write, fsync, close 3719.973 ops/sec 269 usecs/op write, close, fsync 3651.820 ops/sec 274 usecs/op Non-sync'ed 8kB writes: write 400577.329 ops/sec 2 usecs/op wal_buffers \u4e8b\u52a1\u65e5\u5fd7\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0cPostgreSQL\u5c06WAL\u8bb0\u5f55\u5199\u5165\u7f13\u51b2\u533a\uff0c\u7136\u540e\u518d\u5c06\u7f13\u51b2\u533a\u5237\u65b0\u5230\u78c1\u76d8\u3002\u5728PostgreSQL 12\u7248\u4e2d\uff0c\u9ed8\u8ba4\u503c\u4e3a-1\uff0c\u4e5f\u5c31\u662f\u9009\u62e9\u7b49\u4e8eshared_buffers\u76841/32 \u3002\u5982\u679c\u81ea\u52a8\u7684\u9009\u62e9\u592a\u5927\u6216\u592a\u5c0f\u53ef\u4ee5\u624b\u5de5\u8bbe\u7f6e\u8be5\u503c\u3002\u4e00\u822c\u8003\u8651\u8bbe\u7f6e\u4e3a16MB\u3002 synchronous_commit \u5ba2\u6237\u7aef\u6267\u884c\u63d0\u4ea4\uff0c\u5e76\u4e14\u7b49\u5f85WAL\u5199\u5165\u78c1\u76d8\u4e4b\u540e\uff0c\u7136\u540e\u518d\u5c06\u6210\u529f\u72b6\u6001\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u53ef\u4ee5\u8bbe\u7f6e\u4e3aon\uff0cremote_apply\uff0cremote_write\uff0clocal\uff0coff\u7b49\u503c\u3002\u9ed8\u8ba4\u8bbe\u7f6e\u4e3aon\u3002\u5982\u679c\u8bbe\u7f6e\u4e3aoff\uff0c\u4f1a\u5173\u95edsync_commit\uff0c\u5ba2\u6237\u7aef\u63d0\u4ea4\u4e4b\u540e\u5c31\u7acb\u9a6c\u8fd4\u56de\uff0c\u4e0d\u7528\u7b49\u8bb0\u5f55\u5237\u65b0\u5230\u78c1\u76d8\u3002\u6b64\u65f6\u5982\u679cPostgreSQL\u5b9e\u4f8b\u5d29\u6e83\uff0c\u5219\u6700\u540e\u51e0\u4e2a\u5f02\u6b65\u63d0\u4ea4\u5c06\u4f1a\u4e22\u5931\u3002 default_statistics_target PostgreSQL\u4f7f\u7528\u7edf\u8ba1\u4fe1\u606f\u6765\u751f\u6210\u6267\u884c\u8ba1\u5212\u3002\u7edf\u8ba1\u4fe1\u606f\u53ef\u4ee5\u901a\u8fc7\u624b\u52a8Analyze\u547d\u4ee4\u6216\u8005\u662fautovacuum\u8fdb\u7a0b\u542f\u52a8\u7684\u81ea\u52a8\u5206\u6790\u6765\u6536\u96c6\uff0cdefault_statistics_target\u53c2\u6570\u6307\u5b9a\u5728\u6536\u96c6\u548c\u8bb0\u5f55\u8fd9\u4e9b\u7edf\u8ba1\u4fe1\u606f\u65f6\u7684\u8be6\u7ec6\u7a0b\u5ea6\u3002\u9ed8\u8ba4\u503c\u4e3a100\u5bf9\u4e8e\u5927\u591a\u6570\u5de5\u4f5c\u8d1f\u8f7d\u662f\u6bd4\u8f83\u5408\u7406\u7684\uff0c\u5bf9\u4e8e\u975e\u5e38\u7b80\u5355\u7684\u67e5\u8be2\uff0c\u8f83\u5c0f\u7684\u503c\u53ef\u80fd\u4f1a\u6709\u7528\uff0c\u800c\u5bf9\u4e8e\u590d\u6742\u7684\u67e5\u8be2\uff08\u5c24\u5176\u662f\u9488\u5bf9\u5927\u578b\u8868\u7684\u67e5\u8be2\uff09\uff0c\u8f83\u5927\u7684\u503c\u53ef\u80fd\u4f1a\u66f4\u597d\u3002\u4e3a\u4e86\u4e0d\u8981\u4e00\u5200\u5207\uff0c\u53ef\u4ee5\u4f7f\u7528ALTER TABLE .. ALTER COLUMN .. SET STATISTICS\u8986\u76d6\u7279\u5b9a\u8868\u5217\u7684\u9ed8\u8ba4\u6536\u96c6\u7edf\u8ba1\u4fe1\u606f\u7684\u8be6\u7ec6\u7a0b\u5ea6\u3002 checkpoint_timeout\u3001max_wal_size\uff0cmin_wal_size\u3001checkpoint_completion_target \u4e86\u89e3\u8fd9\u4e24\u4e2a\u53c2\u6570\u4ee5\u524d\uff0c\u9996\u5148\u6211\u4eec\u6765\u770b\u4e00\u4e0b\uff0c\u89e6\u53d1\u68c0\u67e5\u70b9\u7684\u51e0\u4e2a\u64cd\u4f5c\u3002 \u76f4\u63a5\u6267\u884ccheckpoint\u547d\u4ee4 \u6267\u884c\u9700\u8981\u68c0\u67e5\u70b9\u7684\u547d\u4ee4\uff08\u4f8b\u5982pg_start_backup,Create database,pg_ctl stop/start\u7b49\u7b49\uff09 \u81ea\u4e0a\u4e00\u4e2a\u68c0\u67e5\u70b9\u4ee5\u6765\uff0c\u8fbe\u5230\u4e86\u5df2\u7ecf\u914d\u7f6e\u7684\u65f6\u95f4\u91cf\uff08checkpoint_timeout \uff09 \u81ea\u4e0a\u4e00\u4e2a\u68c0\u67e5\u70b9\u4ee5\u6765\u751f\u6210\u7684WAL\u6570\u91cf\uff08max_wal_size\uff09 \u4f7f\u7528\u9ed8\u8ba4\u503c\uff0c\u68c0\u67e5\u70b9\u5c06\u5728checkpoint_timeout=5min\u3002\u4e5f\u5c31\u662f\u6bcf5\u5206\u949f\u89e6\u53d1\u4e00\u6b21\u3002\u800cmax_wal_size\u8bbe\u7f6e\u662f\u81ea\u52a8\u68c0\u67e5\u70b9\u4e4b\u95f4\u589e\u957f\u7684\u6700\u5927\u9884\u5199\u65e5\u5fd7\u8bb0\u5f55\uff08WAL\uff09\u91cf\u3002\u9ed8\u8ba4\u662f1GB\uff0c\u5982\u679c\u8d85\u8fc7\u4e861GB\uff0c\u5219\u4f1a\u53d1\u751f\u68c0\u67e5\u70b9\u3002\u8fd9\u662f\u4e00\u4e2a\u8f6f\u9650\u5236\u3002\u5728\u4e00\u4e2a\u7279\u6b8a\u7684\u60c5\u51b5\u4e0b\uff0c\u6bd4\u5982\u7cfb\u7edf\u906d\u9047\u5230\u77ed\u65f6\u95f4\u7684\u9ad8\u8d1f\u8f7d\uff0c\u65e5\u5fd7\u4ea7\u751f\u51e0\u79d2\u79cd\u5c31\u53ef\u4ee5\u8fbe\u52301GB\uff0c\u8fd9\u4e2a\u901f\u5ea6\u5df2\u7ecf\u660e\u663e\u8d85\u8fc7\u4e86checkpoint_timeout \uff0cpg_wal\u76ee\u5f55\u7684\u5927\u5c0f\u4f1a\u6025\u5267\u589e\u52a0\u3002\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u4ece\u65e5\u5fd7\u4e2d\u770b\u5230\u76f8\u5173\u7c7b\u4f3c\u7684\u8b66\u544a\u3002 LOG: checkpoints are occurring too frequently (9 seconds apart) HINT: Consider increasing the configuration parameter \"max_wal_size\". LOG: checkpoints are occurring too frequently (2 seconds apart) HINT: Consider increasing the configuration parameter \"max_wal_size\". \u6240\u4ee5\u8981\u5408\u7406\u914d\u7f6emax_wal_size\uff0c\u4ee5\u907f\u514d\u9891\u7e41\u7684\u8fdb\u884c\u68c0\u67e5\u70b9\u3002\u4e00\u822c\u63a8\u8350\u8bbe\u7f6e\u4e3a16GB\u4ee5\u4e0a\uff0c\u4e0d\u8fc7\u5177\u4f53\u8bbe\u7f6e\u591a\u5927\u8fd8\u9700\u8981\u548c\u5de5\u4f5c\u8d1f\u8377\u76f8\u5339\u914d\u3002 min_wal_size\u53c2\u6570\u662f\u53ea\u8981 WAL \u78c1\u76d8\u4f7f\u7528\u91cf\u4fdd\u6301\u5728\u8fd9\u4e2a\u8bbe\u7f6e\u4e4b\u4e0b\uff0c\u5728\u505a\u68c0\u67e5\u70b9\u65f6\uff0c\u65e7\u7684 WAL \u6587\u4ef6\u603b\u662f\u88ab\u56de\u6536\u4ee5\u4fbf\u672a\u6765\u4f7f\u7528\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u88ab\u5220\u9664\u3002 \u800c\u68c0\u67e5\u70b9\u7684\u5199\u5165\u4e0d\u662f\u5168\u90e8\u7acb\u9a6c\u5b8c\u6210\u7684\uff0cPostgreSQL\u4f1a\u5c06\u4e00\u6b21\u68c0\u67e5\u70b9\u7684\u6240\u6709\u64cd\u4f5c\u5206\u6563\u5230\u4e00\u6bb5\u65f6\u95f4\u5185\u3002\u8fd9\u6bb5\u65f6\u95f4\u7531\u53c2\u6570checkpoint_completion_target\u63a7\u5236\uff0c\u5b83\u662f\u4e00\u4e2a\u5206\u6570\uff0c\u9ed8\u8ba4\u4e3a0.5\u3002\u4e5f\u5c31\u662f\u5728\u4e24\u6b21\u68c0\u67e5\u70b9\u4e4b\u95f4\u76840.5\u6bd4\u4f8b\u5b8c\u6210\u5199\u76d8\u64cd\u4f5c\u3002\u5982\u679c\u8bbe\u7f6e\u7684\u5f88\u5c0f\uff0c\u5219\u68c0\u67e5\u70b9\u8fdb\u7a0b\u5c31\u4f1a\u66f4\u52a0\u8fc5\u901f\u7684\u5199\u76d8\uff0c\u8bbe\u7f6e\u7684\u5f88\u5927\uff0c\u5219\u5c31\u4f1a\u6bd4\u8f83\u6162\u3002\u4e00\u822c\u63a8\u8350\u8bbe\u7f6e\u4e3a0.9\uff0c\u8ba9\u68c0\u67e5\u70b9\u7684\u5199\u5165\u5206\u6563\u4e00\u70b9\u3002\u4f46\u662f\u7f3a\u70b9\u5c31\u662f\u51fa\u73b0\u6545\u969c\u7684\u65f6\u5019\uff0c\u5f71\u54cd\u6062\u590d\u7684\u65f6\u95f4\u3002 \u53ef\u4ee5\u8f93\u5165\u53c2\u6570\u4f7f\u7528pgtune\u81ea\u52a8\u751f\u6210\u914d\u7f6e\u5efa\u8bae\uff1ahttps://pgtune.leopard.in.ua/#/ \u5916\u90e8\u8868 mysql/mariadb/tidb\u5916\u90e8\u8868 --\u4e3e\u4f8b\u4e2d\u672c\u5730\u6570\u636e\u5e93\u7528\u6237\u4e3auser --\u521b\u5efafdw\u63d2\u4ef6\uff08\u5982\u5bb9\u5668\u955c\u50cfpg13\u547d\u4ee4\u4e3aapt-get update && apt-get install -y postgresql-13-mysql-fdw) create extension mysql_fdw; --\u6ce8\u518c\u5916\u90e8\u670d\u52a1\u5668 create server outdb foreign data wrapper mysql_fdw options (host '123.123.123.123' ,port '3306'); --\u5728greenplum\u4e2d\uff0c\u5982\u679c\u4e0a\u9762\u547d\u4ee4\u7528pgadmin\u7528\u6237\u6267\u884c\u7684\u8bdd\uff0c\u9700\u8981\u5c06\u6240\u6709\u6743\u7ed9\u5230\u666e\u901a\u7528\u6237 ALTER SERVER \"outdb\" OWNER TO \"user\"; --\u521b\u5efa\u7528\u6237\u6620\u5c04 create user mapping for user server outdb options (username 'root',password 'password'); --\u521b\u5efa\u5916\u90e8\u8868 CREATE FOREIGN TABLE \"public\".\"out_yy_regions\" ( \"indexCode\" varchar(255), \"name\" varchar(255), \"parentIndexCode\" varchar(255), \"treeCode\" varchar(255), \"id\" int4 ) SERVER \"outdb\" OPTIONS (\"dbname\" 'mydb', \"table_name\" 'mytable'); oracle\u5916\u90e8\u8868 todo \u7269\u5316\u89c6\u56fe postgres\u4e2d\u7269\u5316\u89c6\u56fe\u53ef\u4ee5\u5c06\u9700\u8981\u4e00\u5b9a\u8ba1\u7b97\u91cf\u6216\u8005\u6570\u636e\u4f20\u8f93\uff08\u4f8b\u5982\u5916\u90e8\u8868\uff09\u8017\u65f6\u7684\u89c6\u56fe\u4eff\u771f\u6210\u4e3a\u4e00\u4e2a\u6570\u636e\u8868\uff0c\u518d\u8f85\u4ee5\u5b9a\u65f6\u5237\u65b0\u6216\u8005\u6309\u9700\u5237\u65b0\u7684\u673a\u5236\u6765\u4fbf\u6377\u7684\u4f7f\u7528\u8be5\u6570\u636e\uff1b \u521b\u5efa\u7269\u5316\u89c6\u56fe --\u5047\u8bbe\u5b58\u5728\u4e00\u4e2a\u5916\u90e8\u8868 out_tab1\u5176\u4e2d\u6709100\u4e07\u6570\u636e\uff0c\u5982\u679c\u4e0d\u505a\u7269\u5316\u89c6\u56fe\u7684\u8bdd\u6bcf\u6b21\u67e5\u8be2\u90fd\u4f1a\u53bb\u539f\u59cb\u6570\u636e\u5e93\u4e2d\u62ff\u8fd9100\u4e07\u7684\u6570\u636e\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u5bf9\u8017\u65f6\u654f\u611f\u7684\u64cd\u4f5c\u5341\u5206\u4e0d\u53cb\u597d\uff0c\u6b64\u65f6\u901a\u8fc7\u7269\u5316\u89c6\u56fe\u6765\u8fdb\u884c\u4f18\u5316\uff1b --\u521b\u5efa\u7a7a\u7684\u7269\u5316\u89c6\u56fe create MATERIALIZED view mv_out_tab1 as select * from out_tab1 with no data; --\u5982\u679c\u662fgreenplum\u8fd8\u9700\u8981\u589e\u52a0\u5206\u5e03\u952e\u7684\u58f0\u660e\uff0c\u4f8b\u5982\uff1acreate MATERIALIZED view mv_out_tab1 as select * from out_tab1 with no data Distributed by (id) --\u5237\u65b0\u6570\u636e refresh MATERIALIZED view mv_out_tab1; \u5e38\u7528\u6280\u5de7 domain \u521b\u5efa\u7c7b\u578b\u522b\u540d create domain amount as decimal(33, 18); create domain price as decimal(33, 18); \u81ea\u5b9a\u4e49\u679a\u4e3e\u7c7b\u578b \u4f7f\u7528\u7684\u65f6\u5019\u53ef\u4ee5\u4f20\u5b57\u7b26\u4e32\uff0c\u5b9e\u9645\u5b58\u50a8\u662f\u6574\u6570\u3002 create type \u8fd8\u53ef\u4ee5\u521b\u5efa\u5176\u4ed6\u66f4\u590d\u6742\u7684\u7c7b\u578b\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u3002create type side as enum ('buy', 'sell'); Heap-Only-Tuple \u548c fillfactor \u8fd9\u4e2a\u548cPG\u7684MVCC\u5b9e\u73b0\u6709\u5173\u7cfb\uff0c\u7b80\u5355\u7684\u8bf4\uff0cPG\u7684\u8868\u6570\u636e\u662f\u5b58\u5728\u65e0\u5e8f\u7684\u5806\u4e0a\u7684\uff0c\u5305\u62ec\u4e3b\u952e\u7684\u6240\u6709\u7d22\u5f15\u90fd\u662f\u5355\u72ec\u7684\uff0c\u7d22\u5f15\u5f15\u7528\u6570\u636e\u884c\u5728\u5806\u4e0a\u7684\u4f4d\u7f6e\u3002 \u52a0\u4e0aMVCC\u7684\u5b9e\u73b0\uff0cUpdate\u5176\u5b9e\u662fInsert+Delete\uff0c\u65b0\u7684\u884c\u6570\u636e\u5728\u5806\u4e0a\u7684\u4f4d\u7f6e\u53d1\u751f\u6539\u53d8\uff0c\u4f7f\u5f97\u9700\u8981\u66f4\u65b0\u7d22\u5f15\u6570\u636e\u3002\u4e3a\u4e86\u4f18\u5316\u8fd9\u79cd\u60c5\u51b5\uff0c \u5982\u679c\u5728\u8be5\u6761\u6570\u636e\u76f8\u540c\u7684Page\u4e0a\u9762\u6709\u7a7a\u95f2\u4f4d\u7f6e\uff0c\u65b0\u63d2\u5165\u6570\u636e\u4f18\u5148\u653e\u5728\u76f8\u540c\u9875\u4e0a\uff0c\u5e76\u548c\u65e7\u7248\u672c\u6570\u636e\u5efa\u7acb\u94fe\u8868\u3002\u5728\u67e5\u8be2\u6570\u636e\u7684\u65f6\u5019\uff0c\u6839\u636e\u8fd9\u4e2a\u94fe\u8868\u518d\u53bb\u5904\u7406\u4e8b\u52a1\u53ef\u89c1\u6027\u7b49\u5224\u65ad\u3002 \u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u53bb\u66f4\u65b0\u7d22\u5f15\u6570\u636e\u4e86\u3002\u5982\u679cPage\u4e0a\u6ca1\u6709\u7a7a\u95f2\u4f4d\u7f6e\u5c31\u6ca1\u529e\u6cd5\u4e86\u3002\u6240\u4ee5 create table \u7684\u65f6\u5019\u53ef\u4ee5\u6307\u5b9a fillfactor \u9009\u9879\uff0c\u9884\u5148\u7559\u51fa\u4e00\u4e9b\u4f4d\u7f6e\u3002 \u9002\u5408\u6570\u636e\u91cf\u4e0d\u5927\u4e14\u66f4\u65b0\u9891\u7e41\u7684\u573a\u666f\u3002 \u7528snowflake\u7b97\u6cd5\u751f\u6210\u552f\u4e00ID\u5f88\u5b9e\u7528\uff0c\u4f46\u662f\u5728PG\u4e0a\u6709\u4e2a\u95ee\u9898\uff0cPG\u9075\u5faaSQL\u6807\u51c6\uff0c\u4e0d\u652f\u6301\u65e0\u7b26\u53f764\u4f4d\u6574\u6570\u3002snowflake\u7559\u4e8641bit\u7ed9\u6beb\u79d2\u7ea7\u65f6\u95f4\u6233\uff0c\u53bb\u4e00\u4f4d\u7ed9\u7b26\u53f7\u4f4d\uff0c\u5269\u4e0b40\u4f4d\u3002 \u7b97\u4e00\u4e0b\u53d1\u73b02004\u5e74\u5c31\u6ea2\u51fa\u4e86\uff0c\u5176\u5b9e\u5c31\u7b97\u65e0\u7b26\u53f764\u4f4d\u6574\u6570\uff0c2039\u5e74\u4e5f\u5c31\u6ea2\u51fa\u4e86\u3002\u89e3\u51b3\u65b9\u6848\uff0c\u65f6\u95f4\u6233\u7edf\u4e00\u51cf\u53bb\u4e00\u4e2a\u6700\u8fd1\u7684\u65f6\u95f4\u70b9\uff0c\u77ac\u95f4\u591a\u51fa50\u5e74\u3002 \u5728PG\u91cc\u9762\u7528\u8fd9\u79cdID\uff0c\u7ed3\u5408\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u8fde\u65f6\u95f4\u6233\u5b57\u6bb5\u90fd\u7701\u4e86(PG12\u8c8c\u4f3c\u8981\u652f\u6301\u865a\u62df\u5b57\u6bb5\u4e86)\u3002\u81ea\u52a8\u5206\u8868\u4e5f\u53ef\u4ee5\u6309\u7167ID\u8fdb\u884c\uff0c\u8fbe\u5230\u6309\u65f6\u95f4\u6233\u5206\u8868\u4e00\u6837\u7684\u6548\u679c\uff0c\u8fd8\u80fd\u4fdd\u7559\u4e3b\u952e\u529f\u80fd\uff0c\u4e00\u4e3e\u591a\u5f97\u3002 \u6279\u91cfinsert/update/upsert/delete/move #\u6570\u636e\u5e93\u91cc\u9762\uff0c\u6279\u91cf\u64cd\u4f5c\u7684\u541e\u5410\u91cf\u548c\u5355\u6761\u6267\u884c\u4e0d\u5728\u4e00\u4e2a\u6570\u91cf\u7ea7\u3002insert\u6279\u91cf\u5927\u5bb6\u90fd\u77e5\u9053\uff1a insert into table values (1,3,3), (2,3,3), (3,3,3)... #\u7528psycopg2\u7684\u670b\u53cb\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c cur.executemany \u51fd\u6570\u5e76\u4e0d\u662f\u771f\u6279\u91cf\u64cd\u4f5c\uff0c\u4ed6\u8fd8\u662f\u751f\u6210\u4e00\u5806\u72ec\u7acb\u7684insert\u6267\u884c\uff0c\u771f\u6b63\u7684\u6279\u91cf\u64cd\u4f5c\u8981\u8fd9\u4e48\u5199\uff1a #postgresql\u6279\u91cf\u64cd\u4f5c import time import psycopg2 import psycopg2.extras db=psycopg2.connect(\"dbname=postgres user=postgres password=pwd host=127.0.0.1\") cur=db.cursor() #insert_values lst=[] for i in range(100_0000): lst.append(['name%s' % i,'text%s' % i]) cur.execute('truncate table ctest') ta=time.time() psycopg2.extras.execute_values(cur,\"\"\" insert into ctest(uname,text) values %s\"\"\",lst) cur.execute(\"commit\") print('use time:%s' % (time.time()-ta)) # use time:15.339413166046143 cur.execute(\"select count(1) cnt from ctest\") data=cur.fetchone() print(data) db.close() #update \u5982\u4f55\u6279\u91cf\u5462\uff1a with tmp(id, name) as (values (1, 'a'), (2, 'b'), (3, 'c')) update table set name=tmp.name from tmp where table.id=tmp.id; upsert: insert into table values (1,3,3), (2,3,3), (3,3,3)... on conflict (a) do update set a=table.a+excluded.a delete: delete from table where id = ANY[%s] #move, \u6709\u65f6\u5019\u6211\u4eec\u60f3\u628a\u6570\u636e\u6279\u91cf\u4ece\u4e00\u4e2a\u8868\u79fb\u52a8\u5230\u53e6\u4e00\u4e2a\u8868\uff1a with moved_rows as ( with tmp(id, a, b) as (values %s) delete from t_old_table a using tmp where tmp.id=a.id returning a.* ) insert into t_new_table select * from moved_rows mvcc snapshot\u3002\u95ee\u9898\uff1a\u5982\u4f55\u628a\u4e00\u4e2a\u5e76\u53d1\u8bbf\u95ee\u7684\u8868\u4e00\u81f4\u7684\u5206\u5272\u6210\u591a\u6bb5\uff0c\u6bd4\u5982\u6211\u4eec\u60f3\u8981\u5206\u6279\u6b21\u5bf9\u91cc\u9762\u7684\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u4f46\u4e0d\u5e0c\u671b\u6f0f\u6570\u636e\uff0c\u4e5f\u4e0d\u5e0c\u671b\u91cd\u590d\u5904\u7406\u3002 \u6ce8\u89e3 \u81ea\u589eID\uff1f\u5728\u5e76\u53d1\u8bbf\u95ee\u4e0b\uff0c\u81ea\u589eID\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u8fde\u7eed\u6ca1\u6709\u95f4\u65ad\u7684\uff0c\u6bd4\u5982\u4e2d\u95f4\u53ef\u80fd\u8fd8\u6709\u4e8b\u52a1\u6ca1\u6709\u63d0\u4ea4\u3002 \u89e3\u51b3\u65b9\u6848\u662f\uff0c\u5728\u8868\u91cc\u4fdd\u5b58 txid_current() \uff0c\u8981\u5206\u6bb5\u7684\u65f6\u5019\uff0c\u8bb0\u5f55\u4e0b txid_current_snapshot() \uff0csnapshot\u7531\u4e09\u4e2a\u4fe1\u606f\u7ec4\u6210\uff1axmin, xmax, xip\u3002 xmin\u662f\u5f53\u524d\u8fdb\u884c\u4e2d\u7684\u4e8b\u52a1ID\u4e2d\u6700\u5c0f\u7684\uff0c\u4e5f\u5c31\u662f\u6bd4xmin\u66f4\u5c0f\u7684\u4e8b\u52a1\u90fd\u5df2\u63d0\u4ea4\u6216\u8005\u64a4\u9500\uff0cxmax\u662f\u4e0b\u4e00\u4e2a\u5c06\u8981\u5206\u914d\u7684\u4e8b\u52a1ID\uff0c\u6bd4xmax\u66f4\u5927\u7684\u4e8b\u52a1\u8fd8\u6ca1\u51fa\u73b0\uff0cxip\u662f\u5f53\u524d\u8fdb\u884c\u4e2d\u7684\u4e8b\u52a1ID\u5217\u8868\u3002 \u90a3\u4e48\u4e00\u6761\u8bb0\u5f55\u662f\u5426\u53d1\u751f\u5728\u8fd9\u4e2asnapshot\u4e4b\u524d\u5c31\u5f88\u660e\u786e\u4e86\uff0c txid < xmin or (txid < xmax and txid not in xip) \uff0c\u5bf9\u5e94\u7684\u51fd\u6570\u662f txid_visible_in_snapshot(txid, snapshot) \u3002 pipelinedb\uff0c\u6d41\u5f0f\u805a\u5408 create foreign table trade (time timestamp with time zone, price decimal, amount decimal) server pipelinedb; create view kline_1m as select date_trunc('minute', time) as time, keyed_min(time, price) as open, max(price) as high, min(price) as low, keyed_max(time, price) as close, sum(amount) as volume, sum(amount * price) as value, count(*) as count from trade group by 1; create unique index kline_1m_time_idx on kline_1m(time); \u7136\u540e\u53ea\u7ba1\u75af\u72c2\u5bf9 trade \u8868insert\uff0c kline_1m \u4f1a\u81ea\u52a8\u66f4\u65b0\u805a\u5408\u6570\u636e\uff0c\u800c\u4e14 trade \u4e0d\u4f1a\u4fdd\u7559\u6570\u636e\u3002 timescaledb\uff0c\u65f6\u5e8f\u6570\u636e\u5e93\uff0c\u6309\u7167\u65f6\u95f4\u6233\u5b57\u6bb5\u5168\u81ea\u52a8\u5206\u8868\u3002\u867d\u7136pg\u6709\u4e86\u58f0\u660e\u5f0f\u5206\u8868\uff0c\u4f46\u8fd8\u662f\u4e0d\u5982\u5168\u81ea\u52a8\u6765\u7684\u723d\u3002\u518d\u4e5f\u4e0d\u7528\u62c5\u5fc3\u8868\u6570\u636e\u91cf\u8fc7\u592a\u591a\u5f71\u54cd\u6027\u80fd\u4e86\u3002 large in\u4f18\u5316 Large In:\u67e5\u8be2\u6761\u4ef6\u4e2d\u6709\u4f8b\u5982 id in (1,2,3\u2026\u2026) \u5f88\u591a\u5f88\u591a\u503c\u7684list\u7684\u60c5\u51b5\uff0c\u5f53\u4f20\u5165\u503c\u8fbe\u5230\u4e0a\u4e07\u540e\u6548\u7387\u5f88\u4f4e\u3002 \u5e38\u7528\u65b9\u5f0f\uff1a in-list\uff1a where id in (1,2,3\u2026\u2026) \u5e38\u91cf\u5b50\u67e5\u8be2: location in (values ('\u6668\u5e02'),('\u78ca\u5e02'),('\u9759\u5e02')) limit 100 \u4e34\u65f6\u8868\u67e5\u8be2\uff08cte\uff09\uff1a with tmp_ids as ( select unnest('{2100698,2100699,2100700,2100701,2100702,2100703,2100704,2100705,2100706,2100707,2100708,2100709,2100710,2100711,2100712,2100713,2100714,2100715,2100716}'::bigint[]) id ) select * from czrkjbxx ck,tmp_ids tids where ck.pid =tids.id \u5b9e\u6d4b \uff1a1000\u4e2a\u503c\u5dee\u8ddd\u4e0d\u660e\u663e\uff0c\u5728\u8fbe\u523010000\u4e2a\u503c\u4e4b\u540e\uff0cIN-list\u9700\u898118\u79d2\u5de6\u53f3\uff0c\u5e38\u91cf\u5b50\u67e5\u8be2\u9700\u89814\u79d2\uff0c\u4e34\u65f6\u8868\u53ea\u9700\u8981347 ms\u3002\u4e34\u65f6\u8868\u7684\u6548\u7387\u662f\u6700\u9ad8\u7684\u3002","title":"Postgresql\u76f8\u5173"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#postgresql","text":"","title":"Postgresql\u76f8\u5173"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#_1","text":"","title":"\u5e38\u7528\u914d\u7f6e"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#max_connections","text":"\u5141\u8bb8\u7684\u6700\u5927\u5ba2\u6237\u7aef\u8fde\u63a5\u6570\u3002\u8fd9\u4e2a\u53c2\u6570\u8bbe\u7f6e\u5927\u5c0f\u548cwork_mem\u6709\u4e00\u4e9b\u5173\u7cfb\u3002\u914d\u7f6e\u7684\u8d8a\u9ad8\uff0c\u53ef\u80fd\u4f1a\u5360\u7528\u7cfb\u7edf\u66f4\u591a\u7684\u5185\u5b58\u3002\u901a\u5e38\u53ef\u4ee5\u8bbe\u7f6e\u6570\u767e\u4e2a\u8fde\u63a5\uff0c\u5982\u679c\u8981\u4f7f\u7528\u4e0a\u5343\u4e2a\u8fde\u63a5\uff0c\u5efa\u8bae\u914d\u7f6e\u8fde\u63a5\u6c60\u6765\u51cf\u5c11\u5f00\u9500\u3002","title":"max_connections"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#shared_buffers","text":"PostgreSQL\u4f7f\u7528\u81ea\u5df1\u7684\u7f13\u51b2\u533a\uff0c\u4e5f\u4f7f\u7528Linux\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2OS Cache\u3002\u8fd9\u5c31\u8bf4\u660e\u6570\u636e\u4e24\u6b21\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u9996\u5148\u662fPostgreSQL\u7f13\u51b2\u533a\uff0c\u7136\u540e\u662f\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2\u533a\u3002\u4e0e\u5176\u4ed6\u6570\u636e\u5e93\u4e0d\u540c\uff0cPostgreSQL\u4e0d\u63d0\u4f9b\u76f4\u63a5IO\uff0c\u6240\u4ee5\u8fd9\u53c8\u88ab\u79f0\u4e3a\u53cc\u7f13\u51b2\u3002PostgreSQL\u7f13\u51b2\u533a\u79f0\u4e3ashared_buffer\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a\u7269\u7406\u5185\u5b58\u76841/4\u3002\u800c\u5b9e\u9645\u914d\u7f6e\u53d6\u51b3\u4e8e\u786c\u4ef6\u914d\u7f6e\u548c\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5982\u679c\u4f60\u7684\u5185\u5b58\u5f88\u5927\uff0c\u800c\u4f60\u53c8\u60f3\u591a\u7f13\u51b2\u4e00\u4e9b\u6570\u636e\u5230\u5185\u5b58\u4e2d\uff0c\u53ef\u4ee5\u7ee7\u7eed\u8c03\u5927shared_buffer\u3002","title":"shared_buffers"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#effective_cache_size","text":"\u8fd9\u4e2a\u53c2\u6570\u4e3b\u8981\u7528\u4e8ePostgre\u67e5\u8be2\u4f18\u5316\u5668\u3002\u662f\u5355\u4e2a\u67e5\u8be2\u53ef\u7528\u7684\u78c1\u76d8\u9ad8\u901f\u7f13\u5b58\u7684\u6709\u6548\u5927\u5c0f\u7684\u4e00\u4e2a\u5047\u8bbe\uff0c\u662f\u4e00\u4e2a\u4f30\u7b97\u503c\uff0c\u5b83\u5e76\u4e0d\u5360\u636e\u7cfb\u7edf\u5185\u5b58\u3002\u7531\u4e8e\u4f18\u5316\u5668\u9700\u8981\u8fdb\u884c\u4f30\u7b97\u6210\u672c\uff0c\u8f83\u9ad8\u7684\u503c\u66f4\u6709\u53ef\u80fd\u4f7f\u7528\u7d22\u5f15\u626b\u63cf\uff0c\u8f83\u4f4e\u7684\u503c\u5219\u6709\u53ef\u80fd\u4f7f\u7528\u987a\u5e8f\u626b\u63cf\u3002\u4e00\u822c\u8fd9\u4e2a\u503c\u8bbe\u7f6e\u4e3a\u5185\u5b58\u76841/2\u662f\u6b63\u5e38\u4fdd\u5b88\u7684\u8bbe\u7f6e\uff0c\u8bbe\u7f6e\u4e3a\u5185\u5b58\u76843/4\u662f\u6bd4\u8f83\u63a8\u8350\u7684\u503c\u3002\u901a\u8fc7free\u547d\u4ee4\u67e5\u770b\u64cd\u4f5c\u7cfb\u7edf\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u60a8\u53ef\u80fd\u4f1a\u66f4\u597d\u7684\u4f30\u7b97\u8be5\u503c\u3002 [pg@e22 ~]$ free -g total used free shared buff/cache available Mem: 62 2 5 16 55 40 Swap: 7 0 7","title":"Effective_cache_size"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#work_mem","text":"\u8fd9\u4e2a\u53c2\u6570\u4e3b\u8981\u7528\u4e8e\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u4e4b\u524d\u5185\u90e8\u6392\u5e8f\u64cd\u4f5c\u548c\u6563\u5217\u8868\u4f7f\u7528\u7684\u5185\u5b58\u91cf\uff0c\u589e\u52a0work_mem\u53c2\u6570\u5c06\u4f7fPostgreSQL\u53ef\u4ee5\u8fdb\u884c\u66f4\u5927\u7684\u5185\u5b58\u6392\u5e8f\u3002\u8fd9\u4e2a\u53c2\u6570\u548cmax_connections\u6709\u4e00\u4e9b\u5173\u7cfb\uff0c\u5047\u8bbe\u4f60\u8bbe\u7f6e\u4e3a30MB\uff0c\u521940\u4e2a\u7528\u6237\u540c\u65f6\u6267\u884c\u67e5\u8be2\u6392\u5e8f\uff0c\u5f88\u5feb\u5c31\u4f1a\u4f7f\u75281.2GB\u7684\u5b9e\u9645\u5185\u5b58\u3002\u540c\u65f6\u5bf9\u4e8e\u590d\u6742\u67e5\u8be2\uff0c\u53ef\u80fd\u4f1a\u8fd0\u884c\u591a\u4e2a\u6392\u5e8f\u548c\u6563\u5217\u64cd\u4f5c\uff0c\u4f8b\u5982\u6d89\u53ca\u52308\u5f20\u8868\u8fdb\u884c\u5408\u5e76\u6392\u5e8f\uff0c\u6b64\u65f6\u5c31\u9700\u89818\u500d\u7684work_mem\u3002 \u5982\u4e0b\u9762\u6848\u4f8b\u6240\u793a\uff0c\u8be5\u73af\u5883\u4f7f\u75284MB\u7684work_mem\uff0c\u5728\u6267\u884c\u6392\u5e8f\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u7684Sort Method\u662fexternal merge Disk\u3002 external merge Disk\u3002 kms=> explain (analyze,buffers) select * from KMS_BUSINESS_HALL_TOTAL order by buss_query_info; QUERY PLAN --------------------------------------------------------------------------------------------------------------------------------------------------------- Gather Merge (cost=262167.99..567195.15 rows=2614336 width=52) (actual time=2782.203..5184.442 rows=3137204 loops=1) Workers Planned: 2 Workers Launched: 2 Buffers: shared hit=68 read=25939, temp read=28863 written=28947 -> Sort (cost=261167.97..264435.89 rows=1307168 width=52) (actual time=2760.566..3453.783 rows=1045735 loops=3) Sort Key: buss_query_info Sort Method: external merge Disk: 50568kB Worker 0: Sort Method: external merge Disk: 50840kB Worker 1: Sort Method: external merge Disk: 49944kB Buffers: shared hit=68 read=25939, temp read=28863 written=28947 -> Parallel Seq Scan on kms_business_hall_total (cost=0.00..39010.68 rows=1307168 width=52) (actual time=0.547..259.524 rows=1045735 loops=3) Buffers: shared read=25939 Planning Time: 0.540 ms Execution Time: 5461.516 ms (14 rows) \u5f53\u6211\u4eec\u628a\u53c2\u6570\u4fee\u6539\u6210512MB\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u770b\u5230Sort Method\u53d8\u6210\u4e86quicksort Memory\uff0c\u53d8\u6210\u4e86\u5185\u5b58\u6392\u5e8f\u3002 kms=> set work_mem to \"512MB\"; SET kms=> explain (analyze,buffers) select * from KMS_BUSINESS_HALL_TOTAL order by buss_query_info; QUERY PLAN ------------------------------------------------------------------------------------------------------------------------------------------ Sort (cost=395831.79..403674.80 rows=3137204 width=52) (actual time=7870.826..8204.794 rows=3137204 loops=1) Sort Key: buss_query_info Sort Method: quicksort Memory: 359833kB Buffers: shared hit=25939 -> Seq Scan on kms_business_hall_total (cost=0.00..57311.04 rows=3137204 width=52) (actual time=0.019..373.067 rows=3137204 loops=1) Buffers: shared hit=25939 Planning Time: 0.081 ms Execution Time: 8419.994 ms (8 rows)","title":"work_mem"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#maintenance_work_mem","text":"\u6307\u5b9a\u7ef4\u62a4\u64cd\u4f5c\u4f7f\u7528\u7684\u6700\u5927\u5185\u5b58\u91cf\uff0c\u4f8b\u5982\uff08Vacuum\u3001Create Index\u548cAlter Table Add Foreign Key\uff09\uff0c\u9ed8\u8ba4\u503c\u662f64MB\u3002\u7531\u4e8e\u901a\u5e38\u6b63\u5e38\u8fd0\u884c\u7684\u6570\u636e\u5e93\u4e2d\u4e0d\u4f1a\u6709\u5927\u91cf\u5e76\u53d1\u7684\u6b64\u7c7b\u64cd\u4f5c\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u7684\u8f83\u5927\u4e00\u4e9b\uff0c\u63d0\u9ad8\u6e05\u7406\u548c\u521b\u5efa\u7d22\u5f15\u5916\u952e\u7684\u901f\u5ea6\u3002 postgres=# set maintenance_work_mem to \"64MB\"; SET Time: 1.971 ms postgres=# create index idx1_test on test(id); CREATE INDEX Time: 7483.621 ms (00:07.484) postgres=# set maintenance_work_mem to \"2GB\"; SET Time: 0.543 ms postgres=# drop index idx1_test; DROP INDEX Time: 133.984 ms postgres=# create index idx1_test on test(id); CREATE INDEX Time: 5661.018 ms (00:05.661) \u53ef\u4ee5\u770b\u5230\u5728\u4f7f\u7528\u9ed8\u8ba4\u768464MB\u521b\u5efa\u7d22\u5f15\uff0c\u901f\u5ea6\u4e3a7.4\u79d2\uff0c\u800c\u8bbe\u7f6e\u4e3a2GB\u540e\uff0c\u521b\u5efa\u901f\u5ea6\u662f5.6\u79d2","title":"maintenance_work_mem"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#wal_sync_method","text":"\u6bcf\u6b21\u53d1\u751f\u4e8b\u52a1\u540e\uff0cPostgreSQL\u4f1a\u5f3a\u5236\u5c06\u63d0\u4ea4\u5199\u5230WAL\u65e5\u5fd7\u7684\u65b9\u5f0f\u3002\u53ef\u4ee5\u4f7f\u7528pg_test_fsync\u547d\u4ee4\u5728\u4f60\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u8fdb\u884c\u6d4b\u8bd5\uff0cfdatasync\u662fLinux\u4e0a\u7684\u9ed8\u8ba4\u65b9\u6cd5\u3002\u5982\u4e0b\u6240\u793a\uff0c\u6211\u7684\u73af\u5883\u6d4b\u8bd5\u4e0b\u6765fdatasync\u8fd8\u662f\u901f\u5ea6\u53ef\u4ee5\u7684\u3002\u4e0d\u652f\u6301\u7684\u65b9\u6cd5\u50cffsync_writethrough\u76f4\u63a5\u663e\u793an/a\u3002 postgres=# show wal_sync_method ; wal_sync_method ----------------- fdatasync (1 row) [pg@e22 ~]$ pg_test_fsync -s 3 3 seconds per test O_DIRECT supported on this platform for open_datasync and open_sync. Compare file sync methods using one 8kB write: (in wal_sync_method preference order, except fdatasync is Linux's default) open_datasync 4782.871 ops/sec 209 usecs/op fdatasync 4935.556 ops/sec 203 usecs/op fsync 3781.254 ops/sec 264 usecs/op fsync_writethrough n/a open_sync 3850.219 ops/sec 260 usecs/op Compare file sync methods using two 8kB writes: (in wal_sync_method preference order, except fdatasync is Linux's default) open_datasync 2469.646 ops/sec 405 usecs/op fdatasync 4412.266 ops/sec 227 usecs/op fsync 3432.794 ops/sec 291 usecs/op fsync_writethrough n/a open_sync 1929.221 ops/sec 518 usecs/op Compare open_sync with different write sizes: (This is designed to compare the cost of writing 16kB in different write open_sync sizes.) 1 * 16kB open_sync write 3159.780 ops/sec 316 usecs/op 2 * 8kB open_sync writes 1944.723 ops/sec 514 usecs/op 4 * 4kB open_sync writes 993.173 ops/sec 1007 usecs/op 8 * 2kB open_sync writes 493.396 ops/sec 2027 usecs/op 16 * 1kB open_sync writes 249.762 ops/sec 4004 usecs/op Test if fsync on non-write file descriptor is honored: (If the times are similar, fsync() can sync data written on a different descriptor.) write, fsync, close 3719.973 ops/sec 269 usecs/op write, close, fsync 3651.820 ops/sec 274 usecs/op Non-sync'ed 8kB writes: write 400577.329 ops/sec 2 usecs/op","title":"wal_sync_method"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#wal_buffers","text":"\u4e8b\u52a1\u65e5\u5fd7\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0cPostgreSQL\u5c06WAL\u8bb0\u5f55\u5199\u5165\u7f13\u51b2\u533a\uff0c\u7136\u540e\u518d\u5c06\u7f13\u51b2\u533a\u5237\u65b0\u5230\u78c1\u76d8\u3002\u5728PostgreSQL 12\u7248\u4e2d\uff0c\u9ed8\u8ba4\u503c\u4e3a-1\uff0c\u4e5f\u5c31\u662f\u9009\u62e9\u7b49\u4e8eshared_buffers\u76841/32 \u3002\u5982\u679c\u81ea\u52a8\u7684\u9009\u62e9\u592a\u5927\u6216\u592a\u5c0f\u53ef\u4ee5\u624b\u5de5\u8bbe\u7f6e\u8be5\u503c\u3002\u4e00\u822c\u8003\u8651\u8bbe\u7f6e\u4e3a16MB\u3002","title":"wal_buffers"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#synchronous_commit","text":"\u5ba2\u6237\u7aef\u6267\u884c\u63d0\u4ea4\uff0c\u5e76\u4e14\u7b49\u5f85WAL\u5199\u5165\u78c1\u76d8\u4e4b\u540e\uff0c\u7136\u540e\u518d\u5c06\u6210\u529f\u72b6\u6001\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u53ef\u4ee5\u8bbe\u7f6e\u4e3aon\uff0cremote_apply\uff0cremote_write\uff0clocal\uff0coff\u7b49\u503c\u3002\u9ed8\u8ba4\u8bbe\u7f6e\u4e3aon\u3002\u5982\u679c\u8bbe\u7f6e\u4e3aoff\uff0c\u4f1a\u5173\u95edsync_commit\uff0c\u5ba2\u6237\u7aef\u63d0\u4ea4\u4e4b\u540e\u5c31\u7acb\u9a6c\u8fd4\u56de\uff0c\u4e0d\u7528\u7b49\u8bb0\u5f55\u5237\u65b0\u5230\u78c1\u76d8\u3002\u6b64\u65f6\u5982\u679cPostgreSQL\u5b9e\u4f8b\u5d29\u6e83\uff0c\u5219\u6700\u540e\u51e0\u4e2a\u5f02\u6b65\u63d0\u4ea4\u5c06\u4f1a\u4e22\u5931\u3002","title":"synchronous_commit"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#default_statistics_target","text":"PostgreSQL\u4f7f\u7528\u7edf\u8ba1\u4fe1\u606f\u6765\u751f\u6210\u6267\u884c\u8ba1\u5212\u3002\u7edf\u8ba1\u4fe1\u606f\u53ef\u4ee5\u901a\u8fc7\u624b\u52a8Analyze\u547d\u4ee4\u6216\u8005\u662fautovacuum\u8fdb\u7a0b\u542f\u52a8\u7684\u81ea\u52a8\u5206\u6790\u6765\u6536\u96c6\uff0cdefault_statistics_target\u53c2\u6570\u6307\u5b9a\u5728\u6536\u96c6\u548c\u8bb0\u5f55\u8fd9\u4e9b\u7edf\u8ba1\u4fe1\u606f\u65f6\u7684\u8be6\u7ec6\u7a0b\u5ea6\u3002\u9ed8\u8ba4\u503c\u4e3a100\u5bf9\u4e8e\u5927\u591a\u6570\u5de5\u4f5c\u8d1f\u8f7d\u662f\u6bd4\u8f83\u5408\u7406\u7684\uff0c\u5bf9\u4e8e\u975e\u5e38\u7b80\u5355\u7684\u67e5\u8be2\uff0c\u8f83\u5c0f\u7684\u503c\u53ef\u80fd\u4f1a\u6709\u7528\uff0c\u800c\u5bf9\u4e8e\u590d\u6742\u7684\u67e5\u8be2\uff08\u5c24\u5176\u662f\u9488\u5bf9\u5927\u578b\u8868\u7684\u67e5\u8be2\uff09\uff0c\u8f83\u5927\u7684\u503c\u53ef\u80fd\u4f1a\u66f4\u597d\u3002\u4e3a\u4e86\u4e0d\u8981\u4e00\u5200\u5207\uff0c\u53ef\u4ee5\u4f7f\u7528ALTER TABLE .. ALTER COLUMN .. SET STATISTICS\u8986\u76d6\u7279\u5b9a\u8868\u5217\u7684\u9ed8\u8ba4\u6536\u96c6\u7edf\u8ba1\u4fe1\u606f\u7684\u8be6\u7ec6\u7a0b\u5ea6\u3002","title":"default_statistics_target"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#checkpoint_timeoutmax_wal_sizemin_wal_sizecheckpoint_completion_target","text":"\u4e86\u89e3\u8fd9\u4e24\u4e2a\u53c2\u6570\u4ee5\u524d\uff0c\u9996\u5148\u6211\u4eec\u6765\u770b\u4e00\u4e0b\uff0c\u89e6\u53d1\u68c0\u67e5\u70b9\u7684\u51e0\u4e2a\u64cd\u4f5c\u3002 \u76f4\u63a5\u6267\u884ccheckpoint\u547d\u4ee4 \u6267\u884c\u9700\u8981\u68c0\u67e5\u70b9\u7684\u547d\u4ee4\uff08\u4f8b\u5982pg_start_backup,Create database,pg_ctl stop/start\u7b49\u7b49\uff09 \u81ea\u4e0a\u4e00\u4e2a\u68c0\u67e5\u70b9\u4ee5\u6765\uff0c\u8fbe\u5230\u4e86\u5df2\u7ecf\u914d\u7f6e\u7684\u65f6\u95f4\u91cf\uff08checkpoint_timeout \uff09 \u81ea\u4e0a\u4e00\u4e2a\u68c0\u67e5\u70b9\u4ee5\u6765\u751f\u6210\u7684WAL\u6570\u91cf\uff08max_wal_size\uff09 \u4f7f\u7528\u9ed8\u8ba4\u503c\uff0c\u68c0\u67e5\u70b9\u5c06\u5728checkpoint_timeout=5min\u3002\u4e5f\u5c31\u662f\u6bcf5\u5206\u949f\u89e6\u53d1\u4e00\u6b21\u3002\u800cmax_wal_size\u8bbe\u7f6e\u662f\u81ea\u52a8\u68c0\u67e5\u70b9\u4e4b\u95f4\u589e\u957f\u7684\u6700\u5927\u9884\u5199\u65e5\u5fd7\u8bb0\u5f55\uff08WAL\uff09\u91cf\u3002\u9ed8\u8ba4\u662f1GB\uff0c\u5982\u679c\u8d85\u8fc7\u4e861GB\uff0c\u5219\u4f1a\u53d1\u751f\u68c0\u67e5\u70b9\u3002\u8fd9\u662f\u4e00\u4e2a\u8f6f\u9650\u5236\u3002\u5728\u4e00\u4e2a\u7279\u6b8a\u7684\u60c5\u51b5\u4e0b\uff0c\u6bd4\u5982\u7cfb\u7edf\u906d\u9047\u5230\u77ed\u65f6\u95f4\u7684\u9ad8\u8d1f\u8f7d\uff0c\u65e5\u5fd7\u4ea7\u751f\u51e0\u79d2\u79cd\u5c31\u53ef\u4ee5\u8fbe\u52301GB\uff0c\u8fd9\u4e2a\u901f\u5ea6\u5df2\u7ecf\u660e\u663e\u8d85\u8fc7\u4e86checkpoint_timeout \uff0cpg_wal\u76ee\u5f55\u7684\u5927\u5c0f\u4f1a\u6025\u5267\u589e\u52a0\u3002\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u4ece\u65e5\u5fd7\u4e2d\u770b\u5230\u76f8\u5173\u7c7b\u4f3c\u7684\u8b66\u544a\u3002 LOG: checkpoints are occurring too frequently (9 seconds apart) HINT: Consider increasing the configuration parameter \"max_wal_size\". LOG: checkpoints are occurring too frequently (2 seconds apart) HINT: Consider increasing the configuration parameter \"max_wal_size\". \u6240\u4ee5\u8981\u5408\u7406\u914d\u7f6emax_wal_size\uff0c\u4ee5\u907f\u514d\u9891\u7e41\u7684\u8fdb\u884c\u68c0\u67e5\u70b9\u3002\u4e00\u822c\u63a8\u8350\u8bbe\u7f6e\u4e3a16GB\u4ee5\u4e0a\uff0c\u4e0d\u8fc7\u5177\u4f53\u8bbe\u7f6e\u591a\u5927\u8fd8\u9700\u8981\u548c\u5de5\u4f5c\u8d1f\u8377\u76f8\u5339\u914d\u3002 min_wal_size\u53c2\u6570\u662f\u53ea\u8981 WAL \u78c1\u76d8\u4f7f\u7528\u91cf\u4fdd\u6301\u5728\u8fd9\u4e2a\u8bbe\u7f6e\u4e4b\u4e0b\uff0c\u5728\u505a\u68c0\u67e5\u70b9\u65f6\uff0c\u65e7\u7684 WAL \u6587\u4ef6\u603b\u662f\u88ab\u56de\u6536\u4ee5\u4fbf\u672a\u6765\u4f7f\u7528\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u88ab\u5220\u9664\u3002 \u800c\u68c0\u67e5\u70b9\u7684\u5199\u5165\u4e0d\u662f\u5168\u90e8\u7acb\u9a6c\u5b8c\u6210\u7684\uff0cPostgreSQL\u4f1a\u5c06\u4e00\u6b21\u68c0\u67e5\u70b9\u7684\u6240\u6709\u64cd\u4f5c\u5206\u6563\u5230\u4e00\u6bb5\u65f6\u95f4\u5185\u3002\u8fd9\u6bb5\u65f6\u95f4\u7531\u53c2\u6570checkpoint_completion_target\u63a7\u5236\uff0c\u5b83\u662f\u4e00\u4e2a\u5206\u6570\uff0c\u9ed8\u8ba4\u4e3a0.5\u3002\u4e5f\u5c31\u662f\u5728\u4e24\u6b21\u68c0\u67e5\u70b9\u4e4b\u95f4\u76840.5\u6bd4\u4f8b\u5b8c\u6210\u5199\u76d8\u64cd\u4f5c\u3002\u5982\u679c\u8bbe\u7f6e\u7684\u5f88\u5c0f\uff0c\u5219\u68c0\u67e5\u70b9\u8fdb\u7a0b\u5c31\u4f1a\u66f4\u52a0\u8fc5\u901f\u7684\u5199\u76d8\uff0c\u8bbe\u7f6e\u7684\u5f88\u5927\uff0c\u5219\u5c31\u4f1a\u6bd4\u8f83\u6162\u3002\u4e00\u822c\u63a8\u8350\u8bbe\u7f6e\u4e3a0.9\uff0c\u8ba9\u68c0\u67e5\u70b9\u7684\u5199\u5165\u5206\u6563\u4e00\u70b9\u3002\u4f46\u662f\u7f3a\u70b9\u5c31\u662f\u51fa\u73b0\u6545\u969c\u7684\u65f6\u5019\uff0c\u5f71\u54cd\u6062\u590d\u7684\u65f6\u95f4\u3002 \u53ef\u4ee5\u8f93\u5165\u53c2\u6570\u4f7f\u7528pgtune\u81ea\u52a8\u751f\u6210\u914d\u7f6e\u5efa\u8bae\uff1ahttps://pgtune.leopard.in.ua/#/","title":"checkpoint_timeout\u3001max_wal_size\uff0cmin_wal_size\u3001checkpoint_completion_target"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#_2","text":"","title":"\u5916\u90e8\u8868"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#mysqlmariadbtidb","text":"--\u4e3e\u4f8b\u4e2d\u672c\u5730\u6570\u636e\u5e93\u7528\u6237\u4e3auser --\u521b\u5efafdw\u63d2\u4ef6\uff08\u5982\u5bb9\u5668\u955c\u50cfpg13\u547d\u4ee4\u4e3aapt-get update && apt-get install -y postgresql-13-mysql-fdw) create extension mysql_fdw; --\u6ce8\u518c\u5916\u90e8\u670d\u52a1\u5668 create server outdb foreign data wrapper mysql_fdw options (host '123.123.123.123' ,port '3306'); --\u5728greenplum\u4e2d\uff0c\u5982\u679c\u4e0a\u9762\u547d\u4ee4\u7528pgadmin\u7528\u6237\u6267\u884c\u7684\u8bdd\uff0c\u9700\u8981\u5c06\u6240\u6709\u6743\u7ed9\u5230\u666e\u901a\u7528\u6237 ALTER SERVER \"outdb\" OWNER TO \"user\"; --\u521b\u5efa\u7528\u6237\u6620\u5c04 create user mapping for user server outdb options (username 'root',password 'password'); --\u521b\u5efa\u5916\u90e8\u8868 CREATE FOREIGN TABLE \"public\".\"out_yy_regions\" ( \"indexCode\" varchar(255), \"name\" varchar(255), \"parentIndexCode\" varchar(255), \"treeCode\" varchar(255), \"id\" int4 ) SERVER \"outdb\" OPTIONS (\"dbname\" 'mydb', \"table_name\" 'mytable');","title":"mysql/mariadb/tidb\u5916\u90e8\u8868"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#oracle","text":"todo","title":"oracle\u5916\u90e8\u8868"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#_3","text":"postgres\u4e2d\u7269\u5316\u89c6\u56fe\u53ef\u4ee5\u5c06\u9700\u8981\u4e00\u5b9a\u8ba1\u7b97\u91cf\u6216\u8005\u6570\u636e\u4f20\u8f93\uff08\u4f8b\u5982\u5916\u90e8\u8868\uff09\u8017\u65f6\u7684\u89c6\u56fe\u4eff\u771f\u6210\u4e3a\u4e00\u4e2a\u6570\u636e\u8868\uff0c\u518d\u8f85\u4ee5\u5b9a\u65f6\u5237\u65b0\u6216\u8005\u6309\u9700\u5237\u65b0\u7684\u673a\u5236\u6765\u4fbf\u6377\u7684\u4f7f\u7528\u8be5\u6570\u636e\uff1b","title":"\u7269\u5316\u89c6\u56fe"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#_4","text":"--\u5047\u8bbe\u5b58\u5728\u4e00\u4e2a\u5916\u90e8\u8868 out_tab1\u5176\u4e2d\u6709100\u4e07\u6570\u636e\uff0c\u5982\u679c\u4e0d\u505a\u7269\u5316\u89c6\u56fe\u7684\u8bdd\u6bcf\u6b21\u67e5\u8be2\u90fd\u4f1a\u53bb\u539f\u59cb\u6570\u636e\u5e93\u4e2d\u62ff\u8fd9100\u4e07\u7684\u6570\u636e\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u5bf9\u8017\u65f6\u654f\u611f\u7684\u64cd\u4f5c\u5341\u5206\u4e0d\u53cb\u597d\uff0c\u6b64\u65f6\u901a\u8fc7\u7269\u5316\u89c6\u56fe\u6765\u8fdb\u884c\u4f18\u5316\uff1b --\u521b\u5efa\u7a7a\u7684\u7269\u5316\u89c6\u56fe create MATERIALIZED view mv_out_tab1 as select * from out_tab1 with no data; --\u5982\u679c\u662fgreenplum\u8fd8\u9700\u8981\u589e\u52a0\u5206\u5e03\u952e\u7684\u58f0\u660e\uff0c\u4f8b\u5982\uff1acreate MATERIALIZED view mv_out_tab1 as select * from out_tab1 with no data Distributed by (id) --\u5237\u65b0\u6570\u636e refresh MATERIALIZED view mv_out_tab1;","title":"\u521b\u5efa\u7269\u5316\u89c6\u56fe"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#_5","text":"domain \u521b\u5efa\u7c7b\u578b\u522b\u540d create domain amount as decimal(33, 18); create domain price as decimal(33, 18); \u81ea\u5b9a\u4e49\u679a\u4e3e\u7c7b\u578b \u4f7f\u7528\u7684\u65f6\u5019\u53ef\u4ee5\u4f20\u5b57\u7b26\u4e32\uff0c\u5b9e\u9645\u5b58\u50a8\u662f\u6574\u6570\u3002 create type \u8fd8\u53ef\u4ee5\u521b\u5efa\u5176\u4ed6\u66f4\u590d\u6742\u7684\u7c7b\u578b\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u3002create type side as enum ('buy', 'sell'); Heap-Only-Tuple \u548c fillfactor \u8fd9\u4e2a\u548cPG\u7684MVCC\u5b9e\u73b0\u6709\u5173\u7cfb\uff0c\u7b80\u5355\u7684\u8bf4\uff0cPG\u7684\u8868\u6570\u636e\u662f\u5b58\u5728\u65e0\u5e8f\u7684\u5806\u4e0a\u7684\uff0c\u5305\u62ec\u4e3b\u952e\u7684\u6240\u6709\u7d22\u5f15\u90fd\u662f\u5355\u72ec\u7684\uff0c\u7d22\u5f15\u5f15\u7528\u6570\u636e\u884c\u5728\u5806\u4e0a\u7684\u4f4d\u7f6e\u3002 \u52a0\u4e0aMVCC\u7684\u5b9e\u73b0\uff0cUpdate\u5176\u5b9e\u662fInsert+Delete\uff0c\u65b0\u7684\u884c\u6570\u636e\u5728\u5806\u4e0a\u7684\u4f4d\u7f6e\u53d1\u751f\u6539\u53d8\uff0c\u4f7f\u5f97\u9700\u8981\u66f4\u65b0\u7d22\u5f15\u6570\u636e\u3002\u4e3a\u4e86\u4f18\u5316\u8fd9\u79cd\u60c5\u51b5\uff0c \u5982\u679c\u5728\u8be5\u6761\u6570\u636e\u76f8\u540c\u7684Page\u4e0a\u9762\u6709\u7a7a\u95f2\u4f4d\u7f6e\uff0c\u65b0\u63d2\u5165\u6570\u636e\u4f18\u5148\u653e\u5728\u76f8\u540c\u9875\u4e0a\uff0c\u5e76\u548c\u65e7\u7248\u672c\u6570\u636e\u5efa\u7acb\u94fe\u8868\u3002\u5728\u67e5\u8be2\u6570\u636e\u7684\u65f6\u5019\uff0c\u6839\u636e\u8fd9\u4e2a\u94fe\u8868\u518d\u53bb\u5904\u7406\u4e8b\u52a1\u53ef\u89c1\u6027\u7b49\u5224\u65ad\u3002 \u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u53bb\u66f4\u65b0\u7d22\u5f15\u6570\u636e\u4e86\u3002\u5982\u679cPage\u4e0a\u6ca1\u6709\u7a7a\u95f2\u4f4d\u7f6e\u5c31\u6ca1\u529e\u6cd5\u4e86\u3002\u6240\u4ee5 create table \u7684\u65f6\u5019\u53ef\u4ee5\u6307\u5b9a fillfactor \u9009\u9879\uff0c\u9884\u5148\u7559\u51fa\u4e00\u4e9b\u4f4d\u7f6e\u3002 \u9002\u5408\u6570\u636e\u91cf\u4e0d\u5927\u4e14\u66f4\u65b0\u9891\u7e41\u7684\u573a\u666f\u3002 \u7528snowflake\u7b97\u6cd5\u751f\u6210\u552f\u4e00ID\u5f88\u5b9e\u7528\uff0c\u4f46\u662f\u5728PG\u4e0a\u6709\u4e2a\u95ee\u9898\uff0cPG\u9075\u5faaSQL\u6807\u51c6\uff0c\u4e0d\u652f\u6301\u65e0\u7b26\u53f764\u4f4d\u6574\u6570\u3002snowflake\u7559\u4e8641bit\u7ed9\u6beb\u79d2\u7ea7\u65f6\u95f4\u6233\uff0c\u53bb\u4e00\u4f4d\u7ed9\u7b26\u53f7\u4f4d\uff0c\u5269\u4e0b40\u4f4d\u3002 \u7b97\u4e00\u4e0b\u53d1\u73b02004\u5e74\u5c31\u6ea2\u51fa\u4e86\uff0c\u5176\u5b9e\u5c31\u7b97\u65e0\u7b26\u53f764\u4f4d\u6574\u6570\uff0c2039\u5e74\u4e5f\u5c31\u6ea2\u51fa\u4e86\u3002\u89e3\u51b3\u65b9\u6848\uff0c\u65f6\u95f4\u6233\u7edf\u4e00\u51cf\u53bb\u4e00\u4e2a\u6700\u8fd1\u7684\u65f6\u95f4\u70b9\uff0c\u77ac\u95f4\u591a\u51fa50\u5e74\u3002 \u5728PG\u91cc\u9762\u7528\u8fd9\u79cdID\uff0c\u7ed3\u5408\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u8fde\u65f6\u95f4\u6233\u5b57\u6bb5\u90fd\u7701\u4e86(PG12\u8c8c\u4f3c\u8981\u652f\u6301\u865a\u62df\u5b57\u6bb5\u4e86)\u3002\u81ea\u52a8\u5206\u8868\u4e5f\u53ef\u4ee5\u6309\u7167ID\u8fdb\u884c\uff0c\u8fbe\u5230\u6309\u65f6\u95f4\u6233\u5206\u8868\u4e00\u6837\u7684\u6548\u679c\uff0c\u8fd8\u80fd\u4fdd\u7559\u4e3b\u952e\u529f\u80fd\uff0c\u4e00\u4e3e\u591a\u5f97\u3002 \u6279\u91cfinsert/update/upsert/delete/move #\u6570\u636e\u5e93\u91cc\u9762\uff0c\u6279\u91cf\u64cd\u4f5c\u7684\u541e\u5410\u91cf\u548c\u5355\u6761\u6267\u884c\u4e0d\u5728\u4e00\u4e2a\u6570\u91cf\u7ea7\u3002insert\u6279\u91cf\u5927\u5bb6\u90fd\u77e5\u9053\uff1a insert into table values (1,3,3), (2,3,3), (3,3,3)... #\u7528psycopg2\u7684\u670b\u53cb\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c cur.executemany \u51fd\u6570\u5e76\u4e0d\u662f\u771f\u6279\u91cf\u64cd\u4f5c\uff0c\u4ed6\u8fd8\u662f\u751f\u6210\u4e00\u5806\u72ec\u7acb\u7684insert\u6267\u884c\uff0c\u771f\u6b63\u7684\u6279\u91cf\u64cd\u4f5c\u8981\u8fd9\u4e48\u5199\uff1a #postgresql\u6279\u91cf\u64cd\u4f5c import time import psycopg2 import psycopg2.extras db=psycopg2.connect(\"dbname=postgres user=postgres password=pwd host=127.0.0.1\") cur=db.cursor() #insert_values lst=[] for i in range(100_0000): lst.append(['name%s' % i,'text%s' % i]) cur.execute('truncate table ctest') ta=time.time() psycopg2.extras.execute_values(cur,\"\"\" insert into ctest(uname,text) values %s\"\"\",lst) cur.execute(\"commit\") print('use time:%s' % (time.time()-ta)) # use time:15.339413166046143 cur.execute(\"select count(1) cnt from ctest\") data=cur.fetchone() print(data) db.close() #update \u5982\u4f55\u6279\u91cf\u5462\uff1a with tmp(id, name) as (values (1, 'a'), (2, 'b'), (3, 'c')) update table set name=tmp.name from tmp where table.id=tmp.id; upsert: insert into table values (1,3,3), (2,3,3), (3,3,3)... on conflict (a) do update set a=table.a+excluded.a delete: delete from table where id = ANY[%s] #move, \u6709\u65f6\u5019\u6211\u4eec\u60f3\u628a\u6570\u636e\u6279\u91cf\u4ece\u4e00\u4e2a\u8868\u79fb\u52a8\u5230\u53e6\u4e00\u4e2a\u8868\uff1a with moved_rows as ( with tmp(id, a, b) as (values %s) delete from t_old_table a using tmp where tmp.id=a.id returning a.* ) insert into t_new_table select * from moved_rows mvcc snapshot\u3002\u95ee\u9898\uff1a\u5982\u4f55\u628a\u4e00\u4e2a\u5e76\u53d1\u8bbf\u95ee\u7684\u8868\u4e00\u81f4\u7684\u5206\u5272\u6210\u591a\u6bb5\uff0c\u6bd4\u5982\u6211\u4eec\u60f3\u8981\u5206\u6279\u6b21\u5bf9\u91cc\u9762\u7684\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u4f46\u4e0d\u5e0c\u671b\u6f0f\u6570\u636e\uff0c\u4e5f\u4e0d\u5e0c\u671b\u91cd\u590d\u5904\u7406\u3002 \u6ce8\u89e3 \u81ea\u589eID\uff1f\u5728\u5e76\u53d1\u8bbf\u95ee\u4e0b\uff0c\u81ea\u589eID\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u8fde\u7eed\u6ca1\u6709\u95f4\u65ad\u7684\uff0c\u6bd4\u5982\u4e2d\u95f4\u53ef\u80fd\u8fd8\u6709\u4e8b\u52a1\u6ca1\u6709\u63d0\u4ea4\u3002 \u89e3\u51b3\u65b9\u6848\u662f\uff0c\u5728\u8868\u91cc\u4fdd\u5b58 txid_current() \uff0c\u8981\u5206\u6bb5\u7684\u65f6\u5019\uff0c\u8bb0\u5f55\u4e0b txid_current_snapshot() \uff0csnapshot\u7531\u4e09\u4e2a\u4fe1\u606f\u7ec4\u6210\uff1axmin, xmax, xip\u3002 xmin\u662f\u5f53\u524d\u8fdb\u884c\u4e2d\u7684\u4e8b\u52a1ID\u4e2d\u6700\u5c0f\u7684\uff0c\u4e5f\u5c31\u662f\u6bd4xmin\u66f4\u5c0f\u7684\u4e8b\u52a1\u90fd\u5df2\u63d0\u4ea4\u6216\u8005\u64a4\u9500\uff0cxmax\u662f\u4e0b\u4e00\u4e2a\u5c06\u8981\u5206\u914d\u7684\u4e8b\u52a1ID\uff0c\u6bd4xmax\u66f4\u5927\u7684\u4e8b\u52a1\u8fd8\u6ca1\u51fa\u73b0\uff0cxip\u662f\u5f53\u524d\u8fdb\u884c\u4e2d\u7684\u4e8b\u52a1ID\u5217\u8868\u3002 \u90a3\u4e48\u4e00\u6761\u8bb0\u5f55\u662f\u5426\u53d1\u751f\u5728\u8fd9\u4e2asnapshot\u4e4b\u524d\u5c31\u5f88\u660e\u786e\u4e86\uff0c txid < xmin or (txid < xmax and txid not in xip) \uff0c\u5bf9\u5e94\u7684\u51fd\u6570\u662f txid_visible_in_snapshot(txid, snapshot) \u3002 pipelinedb\uff0c\u6d41\u5f0f\u805a\u5408 create foreign table trade (time timestamp with time zone, price decimal, amount decimal) server pipelinedb; create view kline_1m as select date_trunc('minute', time) as time, keyed_min(time, price) as open, max(price) as high, min(price) as low, keyed_max(time, price) as close, sum(amount) as volume, sum(amount * price) as value, count(*) as count from trade group by 1; create unique index kline_1m_time_idx on kline_1m(time); \u7136\u540e\u53ea\u7ba1\u75af\u72c2\u5bf9 trade \u8868insert\uff0c kline_1m \u4f1a\u81ea\u52a8\u66f4\u65b0\u805a\u5408\u6570\u636e\uff0c\u800c\u4e14 trade \u4e0d\u4f1a\u4fdd\u7559\u6570\u636e\u3002 timescaledb\uff0c\u65f6\u5e8f\u6570\u636e\u5e93\uff0c\u6309\u7167\u65f6\u95f4\u6233\u5b57\u6bb5\u5168\u81ea\u52a8\u5206\u8868\u3002\u867d\u7136pg\u6709\u4e86\u58f0\u660e\u5f0f\u5206\u8868\uff0c\u4f46\u8fd8\u662f\u4e0d\u5982\u5168\u81ea\u52a8\u6765\u7684\u723d\u3002\u518d\u4e5f\u4e0d\u7528\u62c5\u5fc3\u8868\u6570\u636e\u91cf\u8fc7\u592a\u591a\u5f71\u54cd\u6027\u80fd\u4e86\u3002","title":"\u5e38\u7528\u6280\u5de7"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql/#large-in","text":"Large In:\u67e5\u8be2\u6761\u4ef6\u4e2d\u6709\u4f8b\u5982 id in (1,2,3\u2026\u2026) \u5f88\u591a\u5f88\u591a\u503c\u7684list\u7684\u60c5\u51b5\uff0c\u5f53\u4f20\u5165\u503c\u8fbe\u5230\u4e0a\u4e07\u540e\u6548\u7387\u5f88\u4f4e\u3002 \u5e38\u7528\u65b9\u5f0f\uff1a in-list\uff1a where id in (1,2,3\u2026\u2026) \u5e38\u91cf\u5b50\u67e5\u8be2: location in (values ('\u6668\u5e02'),('\u78ca\u5e02'),('\u9759\u5e02')) limit 100 \u4e34\u65f6\u8868\u67e5\u8be2\uff08cte\uff09\uff1a with tmp_ids as ( select unnest('{2100698,2100699,2100700,2100701,2100702,2100703,2100704,2100705,2100706,2100707,2100708,2100709,2100710,2100711,2100712,2100713,2100714,2100715,2100716}'::bigint[]) id ) select * from czrkjbxx ck,tmp_ids tids where ck.pid =tids.id \u5b9e\u6d4b \uff1a1000\u4e2a\u503c\u5dee\u8ddd\u4e0d\u660e\u663e\uff0c\u5728\u8fbe\u523010000\u4e2a\u503c\u4e4b\u540e\uff0cIN-list\u9700\u898118\u79d2\u5de6\u53f3\uff0c\u5e38\u91cf\u5b50\u67e5\u8be2\u9700\u89814\u79d2\uff0c\u4e34\u65f6\u8868\u53ea\u9700\u8981347 ms\u3002\u4e34\u65f6\u8868\u7684\u6548\u7387\u662f\u6700\u9ad8\u7684\u3002","title":"large in\u4f18\u5316"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql%E9%9B%86%E7%BE%A4/","text":"pg\u96c6\u7fa4\u642d\u5efa \u521b\u5efa\u5bb9\u5668 docker run -d -p 5433:5432 --name pg1 --hostname pg1 --net local livingdocs/postgres:12.4 docker run -d -p 5434:5432 --name pg2 --hostname pg2 --net local livingdocs/postgres:12.4 standby -d \"host=pg1 port=5432 user=postgres target_session_attrs=read-write\" \u6d4b\u8bd5\u590d\u5236 docker exec pg1 psql -c \"CREATE TABLE hello (value text); INSERT INTO hello(value) VALUES('world');\" docker exec pg2 psql -c \"SELECT * FROM hello;\" \u89d2\u8272\u5347\u7ea7\uff08\u6545\u969c\u6062\u590d\uff09 docker rm pg1 -f docker exec pg2 psql -c \"CREATE TABLE hello1 (value text); INSERT INTO hello1(value) VALUES('world');\" \u62a5\u9519ERROR: cannot execute CREATE TABLE in a read-only transaction \u5347\u7ea7 docker exec pg2 touch /var/lib/postgresql/data/promote.signal \u6267\u884c\u540e\u7b49\u4e09\u79d2\u518d\u6267\u884cddl\u7b49\u8bed\u53e5\u5c31\u53ef\u4ee5\u6210\u529f\uff0c\u6b64\u65f6\u4ee5\u5347\u7ea7\u4e3a\u4e3b\u8282\u70b9 docker exec pg2 psql -c \"CREATE TABLE hello1 (value text); INSERT INTO hello1(value) VALUES('world');\" \u589e\u52a0\u4ece\u8282\u70b9 docker run -d -p 5433:5432 --name pg1 --hostname pg1 --net local livingdocs/postgres:12.4 standby -d \"host=pg2 port=5432 user=postgres target_session_attrs=read-write\" \u6d4b\u8bd5\u4ece\u8282\u70b9 docker exec pg1 psql -c \"SELECT * FROM hello;\"","title":"pg\u96c6\u7fa4\u642d\u5efa"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql%E9%9B%86%E7%BE%A4/#pg","text":"","title":"pg\u96c6\u7fa4\u642d\u5efa"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql%E9%9B%86%E7%BE%A4/#_1","text":"docker run -d -p 5433:5432 --name pg1 --hostname pg1 --net local livingdocs/postgres:12.4 docker run -d -p 5434:5432 --name pg2 --hostname pg2 --net local livingdocs/postgres:12.4 standby -d \"host=pg1 port=5432 user=postgres target_session_attrs=read-write\"","title":"\u521b\u5efa\u5bb9\u5668"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql%E9%9B%86%E7%BE%A4/#_2","text":"docker exec pg1 psql -c \"CREATE TABLE hello (value text); INSERT INTO hello(value) VALUES('world');\" docker exec pg2 psql -c \"SELECT * FROM hello;\"","title":"\u6d4b\u8bd5\u590d\u5236"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql%E9%9B%86%E7%BE%A4/#_3","text":"docker rm pg1 -f docker exec pg2 psql -c \"CREATE TABLE hello1 (value text); INSERT INTO hello1(value) VALUES('world');\"","title":"\u89d2\u8272\u5347\u7ea7\uff08\u6545\u969c\u6062\u590d\uff09"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql%E9%9B%86%E7%BE%A4/#error-cannot-execute-create-table-in-a-read-only-transaction","text":"","title":"\u62a5\u9519ERROR:  cannot execute CREATE TABLE in a read-only transaction"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql%E9%9B%86%E7%BE%A4/#_4","text":"docker exec pg2 touch /var/lib/postgresql/data/promote.signal","title":"\u5347\u7ea7"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql%E9%9B%86%E7%BE%A4/#ddl","text":"docker exec pg2 psql -c \"CREATE TABLE hello1 (value text); INSERT INTO hello1(value) VALUES('world');\"","title":"\u6267\u884c\u540e\u7b49\u4e09\u79d2\u518d\u6267\u884cddl\u7b49\u8bed\u53e5\u5c31\u53ef\u4ee5\u6210\u529f\uff0c\u6b64\u65f6\u4ee5\u5347\u7ea7\u4e3a\u4e3b\u8282\u70b9"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql%E9%9B%86%E7%BE%A4/#_5","text":"docker run -d -p 5433:5432 --name pg1 --hostname pg1 --net local livingdocs/postgres:12.4 standby -d \"host=pg2 port=5432 user=postgres target_session_attrs=read-write\"","title":"\u589e\u52a0\u4ece\u8282\u70b9"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Postgresql%E9%9B%86%E7%BE%A4/#_6","text":"docker exec pg1 psql -c \"SELECT * FROM hello;\"","title":"\u6d4b\u8bd5\u4ece\u8282\u70b9"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/","text":"Redis\u76f8\u5173 \u60ef\u4f8b \u5728String\u3001Hashes\u3001Lists\u3001Sets\u3001Sorted Sets\u51e0\u4e2a\u5e38\u7528\u6570\u636e\u7c7b\u578b\u4e2d\u7ed3\u5408\u4e1a\u52a1\u9009\u62e9\u5408\u9002\u7684\u7c7b\u578b\u6765\u5b58\u50a8\u3002 \u5e38\u7528\u547d\u4ee4 #\u8fde\u63a5\u96c6\u7fa4\uff08\u589e\u52a0-c\u53c2\u6570\uff09 redis-cli -a password -c -h 127.0.0.1 \u7279\u6027 \u8fc7\u671f\u7b56\u7565 \u5b9a\u65f6\u5220\u9664 \u9ed8\u8ba4Redis\u6bcf100MS\u968f\u673a\u62bd\u53d6\u4e00\u90e8\u5206key\u5bf9\u5176\u8fdb\u884c\u68c0\u6d4b\u662f\u5426\u8fc7\u671f\u9700\u8981\u5220\u9664\u3002 \u4e0d\u5168\u90e8\u6267\u884c\u7684\u539f\u56e0\u5728\u4e8e\u6570\u636e\u8f83\u591a\u65f6\u5019\u5168\u90e8\u68c0\u6d4b\u4f1a\u8017\u8d39\u592a\u591aCPU\uff0c\u65e0\u6cd5\u4fdd\u8bc1\u6027\u80fd\u3002 \u60f0\u6027(LRU)\u5220\u9664 \u5728\u7528\u6237\u83b7\u53d6\u67d0\u4e2akey\u7684\u65f6\u5019\u4f1a\u68c0\u6d4b\u662f\u5426\u8fc7\u671f\uff0c\u5982\u679c\u8fc7\u671f\u4e86\u5220\u9664\u5e76\u8fd4\u56de\u7a7a\u3002 \u6570\u636e\u6b8b\u7559\u95ee\u9898 \u4e0a\u8ff0\u4e24\u79cd\u7b56\u7565\u65e0\u6cd5\u5bf9\u5168\u90e8\u6570\u636e\u8fdb\u884c\u8fc7\u671f\u5220\u9664\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u5b9e\u9645\u7684\u53ef\u7528\u5185\u5b58\u7a7a\u95f4\u6d6a\u8d39\uff0c\u6b64\u65f6\u5e94\u914d\u5408\u5185\u5b58\u6dd8\u6c70\u673a\u5236\u914d\u7f6e\u3002 \u5185\u5b58\u6dd8\u6c70\u673a\u5236 noeviction: \u5f53\u5185\u5b58\u4e0d\u8db3\u4ee5\u5bb9\u7eb3\u65b0\u5199\u5165\u6570\u636e\u65f6\uff0c\u65b0\u5199\u5165\u64cd\u4f5c\u4f1a\u62a5\u9519\uff0c\u8fd9\u4e2a\u4e00\u822c\u6ca1\u4eba\u7528\u5427\uff0c\u5b9e\u5728\u662f\u592a\u6076\u5fc3\u4e86\u3002 allkeys-lru\uff1a\u5f53\u5185\u5b58\u4e0d\u8db3\u4ee5\u5bb9\u7eb3\u65b0\u5199\u5165\u6570\u636e\u65f6\uff0c\u5728\u952e\u7a7a\u95f4\u4e2d\uff0c\u79fb\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684 key\uff08\u8fd9\u4e2a\u662f\u6700\u5e38\u7528\u7684\uff09\u3002 allkeys-random\uff1a\u5f53\u5185\u5b58\u4e0d\u8db3\u4ee5\u5bb9\u7eb3\u65b0\u5199\u5165\u6570\u636e\u65f6\uff0c\u5728\u952e\u7a7a\u95f4\u4e2d\uff0c\u968f\u673a\u79fb\u9664\u67d0\u4e2a key\uff0c\u8fd9\u4e2a\u4e00\u822c\u6ca1\u4eba\u7528\u5427\uff0c\u4e3a\u5565\u8981\u968f\u673a\uff0c\u80af\u5b9a\u662f\u628a\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684 key \u7ed9\u5e72\u6389\u554a\u3002 volatile-lru\uff1a\u5f53\u5185\u5b58\u4e0d\u8db3\u4ee5\u5bb9\u7eb3\u65b0\u5199\u5165\u6570\u636e\u65f6\uff0c\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u7a7a\u95f4\u4e2d\uff0c\u79fb\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684 key\uff08\u8fd9\u4e2a\u4e00\u822c\u4e0d\u592a\u5408\u9002\uff09\u3002 volatile-random\uff1a\u5f53\u5185\u5b58\u4e0d\u8db3\u4ee5\u5bb9\u7eb3\u65b0\u5199\u5165\u6570\u636e\u65f6\uff0c\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u7a7a\u95f4\u4e2d\uff0c\u968f\u673a\u79fb\u9664\u67d0\u4e2a key\u3002 volatile-ttl\uff1a\u5f53\u5185\u5b58\u4e0d\u8db3\u4ee5\u5bb9\u7eb3\u65b0\u5199\u5165\u6570\u636e\u65f6\uff0c\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u7a7a\u95f4\u4e2d\uff0c\u6709\u66f4\u65e9\u8fc7\u671f\u65f6\u95f4\u7684 key \u4f18\u5148\u79fb\u9664\u3002 \u6570\u636e\u7c7b\u578b\u53ca\u7279\u70b9 String string \u662f redis \u6700\u57fa\u672c\u7684\u7c7b\u578b\uff0c\u4f60\u53ef\u4ee5\u7406\u89e3\u6210\u4e0e Memcached \u4e00\u6a21\u4e00\u6837\u7684\u7c7b\u578b\uff0c\u4e00\u4e2a key \u5bf9\u5e94\u4e00\u4e2a value\u3002 string \u7c7b\u578b\u662f\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\u3002\u610f\u601d\u662f redis \u7684 string \u53ef\u4ee5\u5305\u542b\u4efb\u4f55\u6570\u636e\u3002\u6bd4\u5982jpg\u56fe\u7247\u6216\u8005\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\u3002 string \u7c7b\u578b\u662f Redis \u6700\u57fa\u672c\u7684\u6570\u636e\u7c7b\u578b\uff0cstring \u7c7b\u578b\u7684\u503c\u6700\u5927\u80fd\u5b58\u50a8 512MB\u3002 \u5e38\u7528\u547d\u4ee4\uff1aset\u3001get\u3001decr\u3001incr\u3001mget\u7b49\u3002 \u6ce8\u610f\uff1a\u4e00\u4e2a\u952e\u6700\u5927\u80fd\u5b58\u50a8512MB\u3002 Hashes Redis hash \u662f\u4e00\u4e2a\u952e\u503c(key=>value)\u5bf9\u96c6\u5408\uff1b\u662f\u4e00\u4e2a string \u7c7b\u578b\u7684 field \u548c value \u7684\u6620\u5c04\u8868\uff0chash \u7279\u522b\u9002\u5408\u7528\u4e8e\u5b58\u50a8\u5bf9\u8c61\uff08\u5bf9\u8c61\u4e0d\u80fd\u5d4c\u5957\u5176\u4ed6\u5bf9\u8c61\uff09\u3002 \u6bcf\u4e2a hash \u53ef\u4ee5\u5b58\u50a8 232 -1 \u952e\u503c\u5bf9\uff0840\u591a\u4ebf\uff09\u3002 \u5e38\u7528\u547d\u4ee4\uff1ahget\u3001hset\u3001hgetall\u7b49\u3002 \u5e94\u7528\u573a\u666f\uff1a\u5b58\u50a8\u4e00\u4e9b\u7ed3\u6784\u5316\u7684\u6570\u636e\uff0c\u6bd4\u5982\u7528\u6237\u7684\u6635\u79f0\u3001\u5e74\u9f84\u3001\u6027\u522b\u3001\u79ef\u5206\u7b49\uff0c\u5b58\u50a8\u4e00\u4e2a\u7528\u6237\u4fe1\u606f\u5bf9\u8c61\u6570\u636e\u3002 hset person name bingo hset person age 20 hset person id 1 hget person name (person = { \"name\": \"bingo\", \"age\": 20, \"id\": 1 }) Lists Redis \u5217\u8868\u662f\u7b80\u5355\u7684\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u6309\u7167\u63d2\u5165\u987a\u5e8f\u6392\u5e8f\u3002\u4f60\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\u5230\u5217\u8868\u7684\u5934\u90e8\uff08\u5de6\u8fb9\uff09\u6216\u8005\u5c3e\u90e8\uff08\u53f3\u8fb9\uff09\u3002 list\u7c7b\u578b\u7ecf\u5e38\u4f1a\u88ab\u7528\u4e8e\u6d88\u606f\u961f\u5217\u7684\u670d\u52a1\uff0c\u4ee5\u5b8c\u6210\u591a\u7a0b\u5e8f\u4e4b\u95f4\u7684\u6d88\u606f\u4ea4\u6362\u3002 \u5e38\u7528\u547d\u4ee4\uff1alpush\u3001rpush\u3001lpop\u3001rpop\u3001lrange\u7b49\u3002 \u5217\u8868\u6700\u591a\u53ef\u5b58\u50a8 232 - 1 \u5143\u7d20 (4294967295, \u6bcf\u4e2a\u5217\u8868\u53ef\u5b58\u50a840\u591a\u4ebf)\u3002 \u5e94\u7528\u573a\u666f\uff1a \u6bd4\u5982\u53ef\u4ee5\u901a\u8fc7 list \u5b58\u50a8\u4e00\u4e9b\u5217\u8868\u578b\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7c7b\u4f3c\u7c89\u4e1d\u5217\u8868\u3001\u6587\u7ae0\u7684\u8bc4\u8bba\u5217\u8868\u4e4b\u7c7b\u7684\u4e1c\u897f\u3002 \u6bd4\u5982\u53ef\u4ee5\u901a\u8fc7 lrange \u547d\u4ee4\uff0c\u8bfb\u53d6\u67d0\u4e2a\u95ed\u533a\u95f4\u5185\u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u57fa\u4e8e list \u5b9e\u73b0\u5206\u9875\u67e5\u8be2\uff0c\u8fd9\u4e2a\u662f\u5f88\u68d2\u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u57fa\u4e8e Redis \u5b9e\u73b0\u7b80\u5355\u7684\u9ad8\u6027\u80fd\u5206\u9875\uff0c\u53ef\u4ee5\u505a\u7c7b\u4f3c\u5fae\u535a\u90a3\u79cd\u4e0b\u62c9\u4e0d\u65ad\u5206\u9875\u7684\u4e1c\u897f\uff0c\u6027\u80fd\u9ad8\uff0c\u5c31\u4e00\u9875\u4e00\u9875\u8d70\u3002 # 0\u5f00\u59cb\u4f4d\u7f6e\uff0c-1\u7ed3\u675f\u4f4d\u7f6e\uff0c\u7ed3\u675f\u4f4d\u7f6e\u4e3a-1\u65f6\uff0c\u8868\u793a\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u5373\u67e5\u770b\u6240\u6709\u3002 lrange mylist 0 -1 \u6bd4\u5982\u53ef\u4ee5\u641e\u4e2a\u7b80\u5355\u7684\u6d88\u606f\u961f\u5217\uff0c\u4ece list \u5934\u603c\u8fdb\u53bb\uff0c\u4ece list \u5c3e\u5df4\u90a3\u91cc\u5f04\u51fa\u6765\u3002 ``` lpush mylist 1 lpush mylist 2 lpush mylist 3 4 5 # 1 rpop mylist ``` Sets Redis\u7684Set\u662fstring\u7c7b\u578b\u7684\u65e0\u5e8f\u96c6\u5408(\u4f1a\u81ea\u52a8\u53bb\u91cd\u3002)\u3002\u548c\u5217\u8868\u4e00\u6837\uff0c\u5728\u6267\u884c\u63d2\u5165\u548c\u5220\u9664\u548c\u5224\u65ad\u662f\u5426\u5b58\u5728\u67d0\u5143\u7d20\u65f6\uff0c\u6548\u7387\u662f\u5f88\u9ad8\u7684\u3002\u96c6\u5408\u6700\u5927\u7684\u4f18\u52bf\u5728\u4e8e\u53ef\u4ee5\u8fdb\u884c\u4ea4\u96c6\u5e76\u96c6\u5dee\u96c6\u64cd\u4f5c\u3002Set\u53ef\u5305\u542b\u7684\u6700\u5927\u5143\u7d20\u6570\u91cf\u662f4294967295\u3002 \u96c6\u5408\u662f\u901a\u8fc7\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u6dfb\u52a0\uff0c\u5220\u9664\uff0c\u67e5\u627e\u7684\u590d\u6742\u5ea6\u90fd\u662fO(1)\u3002 \u5e94\u7528\u573a\u666f\uff1a \u53ef\u4ee5\u73a9\u513f\u4ea4\u96c6\u3001\u5e76\u96c6\u3001\u5dee\u96c6\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u4ea4\u96c6\u5427\uff0c\u53ef\u4ee5\u628a\u4e24\u4e2a\u4eba\u7684\u7c89\u4e1d\u5217\u8868\u6574\u4e00\u4e2a\u4ea4\u96c6\uff0c\u770b\u770b\u4fe9\u4eba\u7684\u5171\u540c\u597d\u53cb\u662f\u8c01\uff0c\u628a\u4e24\u4e2a\u5927 V \u7684\u7c89\u4e1d\u90fd\u653e\u5728\u4e24\u4e2a set \u4e2d\uff0c\u5bf9\u4e24\u4e2a set \u505a\u4ea4\u96c6\uff1a #-------\u64cd\u4f5c\u4e00\u4e2aset------- # \u6dfb\u52a0\u5143\u7d20 sadd mySet 1 # \u67e5\u770b\u5168\u90e8\u5143\u7d20 smembers mySet # \u5224\u65ad\u662f\u5426\u5305\u542b\u67d0\u4e2a\u503c sismember mySet 3 # \u5220\u9664\u67d0\u4e2a/\u4e9b\u5143\u7d20 srem mySet 1 srem mySet 2 4 # \u67e5\u770b\u5143\u7d20\u4e2a\u6570 scard mySet # \u968f\u673a\u5220\u9664\u4e00\u4e2a\u5143\u7d20 spop mySet #-------\u64cd\u4f5c\u591a\u4e2aset------- # \u5c06\u4e00\u4e2aset\u7684\u5143\u7d20\u79fb\u52a8\u5230\u53e6\u5916\u4e00\u4e2aset smove yourSet mySet 2 # \u6c42\u4e24set\u7684\u4ea4\u96c6 sinter yourSet mySet # \u6c42\u4e24set\u7684\u5e76\u96c6 sunion yourSet mySet # \u6c42\u5728yourSet\u4e2d\u800c\u4e0d\u5728mySet\u4e2d\u7684\u5143\u7d20 sdiff yourSet mySet \u5229\u7528\u552f\u4e00\u6027\uff0c\u53ef\u4ee5\u7edf\u8ba1\u8bbf\u95ee\u7f51\u7ad9\u7684\u6240\u6709\u72ec\u7acbIP\u3002 \u597d\u53cb\u63a8\u8350\u7684\u65f6\u5019\u6839\u636etag\u6c42\u4ea4\u96c6\uff0c\u5927\u4e8e\u67d0\u4e2athreshold\uff08\u4e34\u754c\u503c\u7684\uff09\u5c31\u53ef\u4ee5\u63a8\u8350\u3002 \u5e38\u7528\u547d\u4ee4\uff1asadd\u3001spop\u3001smembers\u3001sunion\u7b49\u3002 \u96c6\u5408\u4e2d\u6700\u5927\u7684\u6210\u5458\u6570\u4e3a 232 - 1(4294967295, \u6bcf\u4e2a\u96c6\u5408\u53ef\u5b58\u50a840\u591a\u4ebf\u4e2a\u6210\u5458)\u3002 zsets\uff08Sorted Sets\uff09 Redis zset \u548c set \u4e00\u6837\u4e5f\u662fstring\u7c7b\u578b\u5143\u7d20\u7684\u96c6\u5408,\u4e14\u4e0d\u5141\u8bb8\u91cd\u590d\u7684\u6210\u5458\u3002 \u4e0d\u540c\u7684\u662f\u6bcf\u4e2a\u5143\u7d20\u90fd\u4f1a\u5173\u8054\u4e00\u4e2adouble\u7c7b\u578b\u7684\u5206\u6570\u3002redis\u6b63\u662f\u901a\u8fc7\u5206\u6570\u6765\u4e3a\u96c6\u5408\u4e2d\u7684\u6210\u5458\u8fdb\u884c\u4ece\u5c0f\u5230\u5927\u7684\u6392\u5e8f\u3002 zset\u7684\u6210\u5458\u662f\u552f\u4e00\u7684,\u4f46\u5206\u6570(score)\u5374\u53ef\u4ee5\u91cd\u590d\u3002 sorted set\u662f\u63d2\u5165\u6709\u5e8f\u7684\uff0c\u5373\u81ea\u52a8\u6392\u5e8f\u3002 \u5e38\u7528\u547d\u4ee4\uff1azadd\u3001zrange\u3001zrem\u3001zcard\u7b49\u3002 \u5f53\u4f60\u9700\u8981\u4e00\u4e2a\u6709\u5e8f\u7684\u5e76\u4e14\u4e0d\u91cd\u590d\u7684\u96c6\u5408\u5217\u8868\u65f6\uff0c\u90a3\u4e48\u53ef\u4ee5\u9009\u62e9sorted set\u6570\u636e\u7ed3\u6784\u3002 \u5199\u5165\u6570\u636e\u65f6\u5019\u5e26\u4e00\u4e2a\u5206\u6570\u503c\uff0c\u5c06\u81ea\u52a8\u6309\u7167\u5206\u6570\u8fdb\u884c\u6392\u5e8f\u3002 zadd board 85 zhangsan zadd board 72 lisi zadd board 96 wangwu zadd board 63 zhaoliu # \u83b7\u53d6\u6392\u540d\u524d\u4e09\u7684\u7528\u6237\uff08\u9ed8\u8ba4\u662f\u5347\u5e8f\uff0c\u6240\u4ee5\u9700\u8981 rev \u6539\u4e3a\u964d\u5e8f\uff09 zrevrange board 0 3 # \u83b7\u53d6\u67d0\u7528\u6237\u7684\u6392\u540d zrank board zhaoliu \u5e94\u7528\u4e3e\u4f8b\uff1a \u4f8b\u5982\u5b58\u50a8\u5168\u73ed\u540c\u5b66\u7684\u6210\u7ee9\uff0c\u5176\u96c6\u5408value\u53ef\u4ee5\u662f\u540c\u5b66\u7684\u5b66\u53f7\uff0c\u800cscore\u5c31\u53ef\u4ee5\u662f\u6210\u7ee9\u3002 \u6392\u884c\u699c\u5e94\u7528\uff0c\u6839\u636e\u5f97\u5206\u5217\u51fatopN\u7684\u7528\u6237\u7b49\u3002 \u5206\u5e03\u5f0f\u9501\u5b9e\u73b0 <dependency> <groupId>org.redisson</groupId> <artifactId>redisson</artifactId> <version>3.16.3</version> </dependency> // 1. Create config object Config config = new Config(); config.useClusterServers() // use \"rediss://\" for SSL connection .addNodeAddress(\"redis://127.0.0.1:7181\"); // or read config from file config = Config.fromYAML(new File(\"config-file.yaml\")); // 2. Create Redisson instance // Sync and Async API RedissonClient redisson = Redisson.create(config); // Reactive API RedissonReactiveClient redissonReactive = redisson.reactive(); // RxJava3 API RedissonRxClient redissonRx = redisson.rxJava(); // 3. Get Redis based implementation of java.util.concurrent.ConcurrentMap RMap<MyKey, MyValue> map = redisson.getMap(\"myMap\"); RMapReactive<MyKey, MyValue> mapReactive = redissonReactive.getMap(\"myMap\"); RMapRx<MyKey, MyValue> mapRx = redissonRx.getMap(\"myMap\"); // 4. Get Redis based implementation of java.util.concurrent.locks.Lock RLock lock = redisson.getLock(\"myLock\"); RLockReactive lockReactive = redissonReactive.getLock(\"myLock\"); RLockRx lockRx = redissonRx.getLock(\"myLock\"); // 4. Get Redis based implementation of java.util.concurrent.ExecutorService RExecutorService executor = redisson.getExecutorService(\"myExecutorService\"); // over 50 Redis based Java objects and services ...","title":"Redis\u76f8\u5173"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/#redis","text":"","title":"Redis\u76f8\u5173"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/#_1","text":"\u5728String\u3001Hashes\u3001Lists\u3001Sets\u3001Sorted Sets\u51e0\u4e2a\u5e38\u7528\u6570\u636e\u7c7b\u578b\u4e2d\u7ed3\u5408\u4e1a\u52a1\u9009\u62e9\u5408\u9002\u7684\u7c7b\u578b\u6765\u5b58\u50a8\u3002","title":"\u60ef\u4f8b"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/#_2","text":"#\u8fde\u63a5\u96c6\u7fa4\uff08\u589e\u52a0-c\u53c2\u6570\uff09 redis-cli -a password -c -h 127.0.0.1","title":"\u5e38\u7528\u547d\u4ee4"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/#_3","text":"","title":"\u7279\u6027"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/#_4","text":"\u5b9a\u65f6\u5220\u9664 \u9ed8\u8ba4Redis\u6bcf100MS\u968f\u673a\u62bd\u53d6\u4e00\u90e8\u5206key\u5bf9\u5176\u8fdb\u884c\u68c0\u6d4b\u662f\u5426\u8fc7\u671f\u9700\u8981\u5220\u9664\u3002 \u4e0d\u5168\u90e8\u6267\u884c\u7684\u539f\u56e0\u5728\u4e8e\u6570\u636e\u8f83\u591a\u65f6\u5019\u5168\u90e8\u68c0\u6d4b\u4f1a\u8017\u8d39\u592a\u591aCPU\uff0c\u65e0\u6cd5\u4fdd\u8bc1\u6027\u80fd\u3002 \u60f0\u6027(LRU)\u5220\u9664 \u5728\u7528\u6237\u83b7\u53d6\u67d0\u4e2akey\u7684\u65f6\u5019\u4f1a\u68c0\u6d4b\u662f\u5426\u8fc7\u671f\uff0c\u5982\u679c\u8fc7\u671f\u4e86\u5220\u9664\u5e76\u8fd4\u56de\u7a7a\u3002 \u6570\u636e\u6b8b\u7559\u95ee\u9898 \u4e0a\u8ff0\u4e24\u79cd\u7b56\u7565\u65e0\u6cd5\u5bf9\u5168\u90e8\u6570\u636e\u8fdb\u884c\u8fc7\u671f\u5220\u9664\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u5b9e\u9645\u7684\u53ef\u7528\u5185\u5b58\u7a7a\u95f4\u6d6a\u8d39\uff0c\u6b64\u65f6\u5e94\u914d\u5408\u5185\u5b58\u6dd8\u6c70\u673a\u5236\u914d\u7f6e\u3002","title":"\u8fc7\u671f\u7b56\u7565"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/#_5","text":"noeviction: \u5f53\u5185\u5b58\u4e0d\u8db3\u4ee5\u5bb9\u7eb3\u65b0\u5199\u5165\u6570\u636e\u65f6\uff0c\u65b0\u5199\u5165\u64cd\u4f5c\u4f1a\u62a5\u9519\uff0c\u8fd9\u4e2a\u4e00\u822c\u6ca1\u4eba\u7528\u5427\uff0c\u5b9e\u5728\u662f\u592a\u6076\u5fc3\u4e86\u3002 allkeys-lru\uff1a\u5f53\u5185\u5b58\u4e0d\u8db3\u4ee5\u5bb9\u7eb3\u65b0\u5199\u5165\u6570\u636e\u65f6\uff0c\u5728\u952e\u7a7a\u95f4\u4e2d\uff0c\u79fb\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684 key\uff08\u8fd9\u4e2a\u662f\u6700\u5e38\u7528\u7684\uff09\u3002 allkeys-random\uff1a\u5f53\u5185\u5b58\u4e0d\u8db3\u4ee5\u5bb9\u7eb3\u65b0\u5199\u5165\u6570\u636e\u65f6\uff0c\u5728\u952e\u7a7a\u95f4\u4e2d\uff0c\u968f\u673a\u79fb\u9664\u67d0\u4e2a key\uff0c\u8fd9\u4e2a\u4e00\u822c\u6ca1\u4eba\u7528\u5427\uff0c\u4e3a\u5565\u8981\u968f\u673a\uff0c\u80af\u5b9a\u662f\u628a\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684 key \u7ed9\u5e72\u6389\u554a\u3002 volatile-lru\uff1a\u5f53\u5185\u5b58\u4e0d\u8db3\u4ee5\u5bb9\u7eb3\u65b0\u5199\u5165\u6570\u636e\u65f6\uff0c\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u7a7a\u95f4\u4e2d\uff0c\u79fb\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684 key\uff08\u8fd9\u4e2a\u4e00\u822c\u4e0d\u592a\u5408\u9002\uff09\u3002 volatile-random\uff1a\u5f53\u5185\u5b58\u4e0d\u8db3\u4ee5\u5bb9\u7eb3\u65b0\u5199\u5165\u6570\u636e\u65f6\uff0c\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u7a7a\u95f4\u4e2d\uff0c\u968f\u673a\u79fb\u9664\u67d0\u4e2a key\u3002 volatile-ttl\uff1a\u5f53\u5185\u5b58\u4e0d\u8db3\u4ee5\u5bb9\u7eb3\u65b0\u5199\u5165\u6570\u636e\u65f6\uff0c\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u7a7a\u95f4\u4e2d\uff0c\u6709\u66f4\u65e9\u8fc7\u671f\u65f6\u95f4\u7684 key \u4f18\u5148\u79fb\u9664\u3002","title":"\u5185\u5b58\u6dd8\u6c70\u673a\u5236"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/#_6","text":"","title":"\u6570\u636e\u7c7b\u578b\u53ca\u7279\u70b9"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/#string","text":"string \u662f redis \u6700\u57fa\u672c\u7684\u7c7b\u578b\uff0c\u4f60\u53ef\u4ee5\u7406\u89e3\u6210\u4e0e Memcached \u4e00\u6a21\u4e00\u6837\u7684\u7c7b\u578b\uff0c\u4e00\u4e2a key \u5bf9\u5e94\u4e00\u4e2a value\u3002 string \u7c7b\u578b\u662f\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\u3002\u610f\u601d\u662f redis \u7684 string \u53ef\u4ee5\u5305\u542b\u4efb\u4f55\u6570\u636e\u3002\u6bd4\u5982jpg\u56fe\u7247\u6216\u8005\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\u3002 string \u7c7b\u578b\u662f Redis \u6700\u57fa\u672c\u7684\u6570\u636e\u7c7b\u578b\uff0cstring \u7c7b\u578b\u7684\u503c\u6700\u5927\u80fd\u5b58\u50a8 512MB\u3002 \u5e38\u7528\u547d\u4ee4\uff1aset\u3001get\u3001decr\u3001incr\u3001mget\u7b49\u3002 \u6ce8\u610f\uff1a\u4e00\u4e2a\u952e\u6700\u5927\u80fd\u5b58\u50a8512MB\u3002","title":"String"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/#hashes","text":"Redis hash \u662f\u4e00\u4e2a\u952e\u503c(key=>value)\u5bf9\u96c6\u5408\uff1b\u662f\u4e00\u4e2a string \u7c7b\u578b\u7684 field \u548c value \u7684\u6620\u5c04\u8868\uff0chash \u7279\u522b\u9002\u5408\u7528\u4e8e\u5b58\u50a8\u5bf9\u8c61\uff08\u5bf9\u8c61\u4e0d\u80fd\u5d4c\u5957\u5176\u4ed6\u5bf9\u8c61\uff09\u3002 \u6bcf\u4e2a hash \u53ef\u4ee5\u5b58\u50a8 232 -1 \u952e\u503c\u5bf9\uff0840\u591a\u4ebf\uff09\u3002 \u5e38\u7528\u547d\u4ee4\uff1ahget\u3001hset\u3001hgetall\u7b49\u3002 \u5e94\u7528\u573a\u666f\uff1a\u5b58\u50a8\u4e00\u4e9b\u7ed3\u6784\u5316\u7684\u6570\u636e\uff0c\u6bd4\u5982\u7528\u6237\u7684\u6635\u79f0\u3001\u5e74\u9f84\u3001\u6027\u522b\u3001\u79ef\u5206\u7b49\uff0c\u5b58\u50a8\u4e00\u4e2a\u7528\u6237\u4fe1\u606f\u5bf9\u8c61\u6570\u636e\u3002 hset person name bingo hset person age 20 hset person id 1 hget person name (person = { \"name\": \"bingo\", \"age\": 20, \"id\": 1 })","title":"Hashes"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/#lists","text":"Redis \u5217\u8868\u662f\u7b80\u5355\u7684\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u6309\u7167\u63d2\u5165\u987a\u5e8f\u6392\u5e8f\u3002\u4f60\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\u5230\u5217\u8868\u7684\u5934\u90e8\uff08\u5de6\u8fb9\uff09\u6216\u8005\u5c3e\u90e8\uff08\u53f3\u8fb9\uff09\u3002 list\u7c7b\u578b\u7ecf\u5e38\u4f1a\u88ab\u7528\u4e8e\u6d88\u606f\u961f\u5217\u7684\u670d\u52a1\uff0c\u4ee5\u5b8c\u6210\u591a\u7a0b\u5e8f\u4e4b\u95f4\u7684\u6d88\u606f\u4ea4\u6362\u3002 \u5e38\u7528\u547d\u4ee4\uff1alpush\u3001rpush\u3001lpop\u3001rpop\u3001lrange\u7b49\u3002 \u5217\u8868\u6700\u591a\u53ef\u5b58\u50a8 232 - 1 \u5143\u7d20 (4294967295, \u6bcf\u4e2a\u5217\u8868\u53ef\u5b58\u50a840\u591a\u4ebf)\u3002 \u5e94\u7528\u573a\u666f\uff1a \u6bd4\u5982\u53ef\u4ee5\u901a\u8fc7 list \u5b58\u50a8\u4e00\u4e9b\u5217\u8868\u578b\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7c7b\u4f3c\u7c89\u4e1d\u5217\u8868\u3001\u6587\u7ae0\u7684\u8bc4\u8bba\u5217\u8868\u4e4b\u7c7b\u7684\u4e1c\u897f\u3002 \u6bd4\u5982\u53ef\u4ee5\u901a\u8fc7 lrange \u547d\u4ee4\uff0c\u8bfb\u53d6\u67d0\u4e2a\u95ed\u533a\u95f4\u5185\u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u57fa\u4e8e list \u5b9e\u73b0\u5206\u9875\u67e5\u8be2\uff0c\u8fd9\u4e2a\u662f\u5f88\u68d2\u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u57fa\u4e8e Redis \u5b9e\u73b0\u7b80\u5355\u7684\u9ad8\u6027\u80fd\u5206\u9875\uff0c\u53ef\u4ee5\u505a\u7c7b\u4f3c\u5fae\u535a\u90a3\u79cd\u4e0b\u62c9\u4e0d\u65ad\u5206\u9875\u7684\u4e1c\u897f\uff0c\u6027\u80fd\u9ad8\uff0c\u5c31\u4e00\u9875\u4e00\u9875\u8d70\u3002 # 0\u5f00\u59cb\u4f4d\u7f6e\uff0c-1\u7ed3\u675f\u4f4d\u7f6e\uff0c\u7ed3\u675f\u4f4d\u7f6e\u4e3a-1\u65f6\uff0c\u8868\u793a\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u5373\u67e5\u770b\u6240\u6709\u3002 lrange mylist 0 -1 \u6bd4\u5982\u53ef\u4ee5\u641e\u4e2a\u7b80\u5355\u7684\u6d88\u606f\u961f\u5217\uff0c\u4ece list \u5934\u603c\u8fdb\u53bb\uff0c\u4ece list \u5c3e\u5df4\u90a3\u91cc\u5f04\u51fa\u6765\u3002 ``` lpush mylist 1 lpush mylist 2 lpush mylist 3 4 5 # 1 rpop mylist ```","title":"Lists"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/#sets","text":"Redis\u7684Set\u662fstring\u7c7b\u578b\u7684\u65e0\u5e8f\u96c6\u5408(\u4f1a\u81ea\u52a8\u53bb\u91cd\u3002)\u3002\u548c\u5217\u8868\u4e00\u6837\uff0c\u5728\u6267\u884c\u63d2\u5165\u548c\u5220\u9664\u548c\u5224\u65ad\u662f\u5426\u5b58\u5728\u67d0\u5143\u7d20\u65f6\uff0c\u6548\u7387\u662f\u5f88\u9ad8\u7684\u3002\u96c6\u5408\u6700\u5927\u7684\u4f18\u52bf\u5728\u4e8e\u53ef\u4ee5\u8fdb\u884c\u4ea4\u96c6\u5e76\u96c6\u5dee\u96c6\u64cd\u4f5c\u3002Set\u53ef\u5305\u542b\u7684\u6700\u5927\u5143\u7d20\u6570\u91cf\u662f4294967295\u3002 \u96c6\u5408\u662f\u901a\u8fc7\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u6dfb\u52a0\uff0c\u5220\u9664\uff0c\u67e5\u627e\u7684\u590d\u6742\u5ea6\u90fd\u662fO(1)\u3002 \u5e94\u7528\u573a\u666f\uff1a \u53ef\u4ee5\u73a9\u513f\u4ea4\u96c6\u3001\u5e76\u96c6\u3001\u5dee\u96c6\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u4ea4\u96c6\u5427\uff0c\u53ef\u4ee5\u628a\u4e24\u4e2a\u4eba\u7684\u7c89\u4e1d\u5217\u8868\u6574\u4e00\u4e2a\u4ea4\u96c6\uff0c\u770b\u770b\u4fe9\u4eba\u7684\u5171\u540c\u597d\u53cb\u662f\u8c01\uff0c\u628a\u4e24\u4e2a\u5927 V \u7684\u7c89\u4e1d\u90fd\u653e\u5728\u4e24\u4e2a set \u4e2d\uff0c\u5bf9\u4e24\u4e2a set \u505a\u4ea4\u96c6\uff1a #-------\u64cd\u4f5c\u4e00\u4e2aset------- # \u6dfb\u52a0\u5143\u7d20 sadd mySet 1 # \u67e5\u770b\u5168\u90e8\u5143\u7d20 smembers mySet # \u5224\u65ad\u662f\u5426\u5305\u542b\u67d0\u4e2a\u503c sismember mySet 3 # \u5220\u9664\u67d0\u4e2a/\u4e9b\u5143\u7d20 srem mySet 1 srem mySet 2 4 # \u67e5\u770b\u5143\u7d20\u4e2a\u6570 scard mySet # \u968f\u673a\u5220\u9664\u4e00\u4e2a\u5143\u7d20 spop mySet #-------\u64cd\u4f5c\u591a\u4e2aset------- # \u5c06\u4e00\u4e2aset\u7684\u5143\u7d20\u79fb\u52a8\u5230\u53e6\u5916\u4e00\u4e2aset smove yourSet mySet 2 # \u6c42\u4e24set\u7684\u4ea4\u96c6 sinter yourSet mySet # \u6c42\u4e24set\u7684\u5e76\u96c6 sunion yourSet mySet # \u6c42\u5728yourSet\u4e2d\u800c\u4e0d\u5728mySet\u4e2d\u7684\u5143\u7d20 sdiff yourSet mySet \u5229\u7528\u552f\u4e00\u6027\uff0c\u53ef\u4ee5\u7edf\u8ba1\u8bbf\u95ee\u7f51\u7ad9\u7684\u6240\u6709\u72ec\u7acbIP\u3002 \u597d\u53cb\u63a8\u8350\u7684\u65f6\u5019\u6839\u636etag\u6c42\u4ea4\u96c6\uff0c\u5927\u4e8e\u67d0\u4e2athreshold\uff08\u4e34\u754c\u503c\u7684\uff09\u5c31\u53ef\u4ee5\u63a8\u8350\u3002 \u5e38\u7528\u547d\u4ee4\uff1asadd\u3001spop\u3001smembers\u3001sunion\u7b49\u3002 \u96c6\u5408\u4e2d\u6700\u5927\u7684\u6210\u5458\u6570\u4e3a 232 - 1(4294967295, \u6bcf\u4e2a\u96c6\u5408\u53ef\u5b58\u50a840\u591a\u4ebf\u4e2a\u6210\u5458)\u3002","title":"Sets"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/#zsetssorted-sets","text":"Redis zset \u548c set \u4e00\u6837\u4e5f\u662fstring\u7c7b\u578b\u5143\u7d20\u7684\u96c6\u5408,\u4e14\u4e0d\u5141\u8bb8\u91cd\u590d\u7684\u6210\u5458\u3002 \u4e0d\u540c\u7684\u662f\u6bcf\u4e2a\u5143\u7d20\u90fd\u4f1a\u5173\u8054\u4e00\u4e2adouble\u7c7b\u578b\u7684\u5206\u6570\u3002redis\u6b63\u662f\u901a\u8fc7\u5206\u6570\u6765\u4e3a\u96c6\u5408\u4e2d\u7684\u6210\u5458\u8fdb\u884c\u4ece\u5c0f\u5230\u5927\u7684\u6392\u5e8f\u3002 zset\u7684\u6210\u5458\u662f\u552f\u4e00\u7684,\u4f46\u5206\u6570(score)\u5374\u53ef\u4ee5\u91cd\u590d\u3002 sorted set\u662f\u63d2\u5165\u6709\u5e8f\u7684\uff0c\u5373\u81ea\u52a8\u6392\u5e8f\u3002 \u5e38\u7528\u547d\u4ee4\uff1azadd\u3001zrange\u3001zrem\u3001zcard\u7b49\u3002 \u5f53\u4f60\u9700\u8981\u4e00\u4e2a\u6709\u5e8f\u7684\u5e76\u4e14\u4e0d\u91cd\u590d\u7684\u96c6\u5408\u5217\u8868\u65f6\uff0c\u90a3\u4e48\u53ef\u4ee5\u9009\u62e9sorted set\u6570\u636e\u7ed3\u6784\u3002 \u5199\u5165\u6570\u636e\u65f6\u5019\u5e26\u4e00\u4e2a\u5206\u6570\u503c\uff0c\u5c06\u81ea\u52a8\u6309\u7167\u5206\u6570\u8fdb\u884c\u6392\u5e8f\u3002 zadd board 85 zhangsan zadd board 72 lisi zadd board 96 wangwu zadd board 63 zhaoliu # \u83b7\u53d6\u6392\u540d\u524d\u4e09\u7684\u7528\u6237\uff08\u9ed8\u8ba4\u662f\u5347\u5e8f\uff0c\u6240\u4ee5\u9700\u8981 rev \u6539\u4e3a\u964d\u5e8f\uff09 zrevrange board 0 3 # \u83b7\u53d6\u67d0\u7528\u6237\u7684\u6392\u540d zrank board zhaoliu \u5e94\u7528\u4e3e\u4f8b\uff1a \u4f8b\u5982\u5b58\u50a8\u5168\u73ed\u540c\u5b66\u7684\u6210\u7ee9\uff0c\u5176\u96c6\u5408value\u53ef\u4ee5\u662f\u540c\u5b66\u7684\u5b66\u53f7\uff0c\u800cscore\u5c31\u53ef\u4ee5\u662f\u6210\u7ee9\u3002 \u6392\u884c\u699c\u5e94\u7528\uff0c\u6839\u636e\u5f97\u5206\u5217\u51fatopN\u7684\u7528\u6237\u7b49\u3002","title":"zsets\uff08Sorted Sets\uff09"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3/#_7","text":"<dependency> <groupId>org.redisson</groupId> <artifactId>redisson</artifactId> <version>3.16.3</version> </dependency> // 1. Create config object Config config = new Config(); config.useClusterServers() // use \"rediss://\" for SSL connection .addNodeAddress(\"redis://127.0.0.1:7181\"); // or read config from file config = Config.fromYAML(new File(\"config-file.yaml\")); // 2. Create Redisson instance // Sync and Async API RedissonClient redisson = Redisson.create(config); // Reactive API RedissonReactiveClient redissonReactive = redisson.reactive(); // RxJava3 API RedissonRxClient redissonRx = redisson.rxJava(); // 3. Get Redis based implementation of java.util.concurrent.ConcurrentMap RMap<MyKey, MyValue> map = redisson.getMap(\"myMap\"); RMapReactive<MyKey, MyValue> mapReactive = redissonReactive.getMap(\"myMap\"); RMapRx<MyKey, MyValue> mapRx = redissonRx.getMap(\"myMap\"); // 4. Get Redis based implementation of java.util.concurrent.locks.Lock RLock lock = redisson.getLock(\"myLock\"); RLockReactive lockReactive = redissonReactive.getLock(\"myLock\"); RLockRx lockRx = redissonRx.getLock(\"myLock\"); // 4. Get Redis based implementation of java.util.concurrent.ExecutorService RExecutorService executor = redisson.getExecutorService(\"myExecutorService\"); // over 50 Redis based Java objects and services ...","title":"\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/","text":"Redis\u96c6\u7fa4\u76f8\u5173 Redis\u5e38\u89c1\u95ee\u9898 \u7f13\u5b58\u96ea\u5d29 \u5bf9\u4e8e\u7cfb\u7edf A\uff0c\u5047\u8bbe\u6bcf\u5929\u9ad8\u5cf0\u671f\u6bcf\u79d2 5000 \u4e2a\u8bf7\u6c42\uff0c\u672c\u6765\u7f13\u5b58\u5728\u9ad8\u5cf0\u671f\u53ef\u4ee5\u625b\u4f4f\u6bcf\u79d2 4000 \u4e2a\u8bf7\u6c42\uff0c\u4f46\u662f\u7f13\u5b58\u673a\u5668\u610f\u5916\u53d1\u751f\u4e86\u5168\u76d8\u5b95\u673a\u3002\u7f13\u5b58\u6302\u4e86\uff0c\u6b64\u65f6 1 \u79d2 5000 \u4e2a\u8bf7\u6c42\u5168\u90e8\u843d\u6570\u636e\u5e93\uff0c\u6570\u636e\u5e93\u5fc5\u7136\u625b\u4e0d\u4f4f\uff0c\u5b83\u4f1a\u62a5\u4e00\u4e0b\u8b66\uff0c\u7136\u540e\u5c31\u6302\u4e86\u3002\u6b64\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u91c7\u7528\u4ec0\u4e48\u7279\u522b\u7684\u65b9\u6848\u6765\u5904\u7406\u8fd9\u4e2a\u6545\u969c\uff0cDBA \u5f88\u7740\u6025\uff0c\u91cd\u542f\u6570\u636e\u5e93\uff0c\u4f46\u662f\u6570\u636e\u5e93\u7acb\u9a6c\u53c8\u88ab\u65b0\u7684\u6d41\u91cf\u7ed9\u6253\u6b7b\u4e86\u3002\u8fd9\u5c31\u662f\u7f13\u5b58\u96ea\u5d29\u3002 \u89e3\u51b3\u529e\u6cd5 \u4e8b\u524d\uff1aRedis \u9ad8\u53ef\u7528\uff0c\u4e3b\u4ece+\u54e8\u5175\uff0cRedis cluster\uff0c\u907f\u514d\u5168\u76d8\u5d29\u6e83\u3002 \u4e8b\u4e2d\uff1a\u672c\u5730 ehcache \u7f13\u5b58 + hystrix \u9650\u6d41&\u964d\u7ea7\uff0c\u907f\u514d MySQL \u88ab\u6253\u6b7b\u3002 \u4e8b\u540e\uff1aRedis \u6301\u4e45\u5316\uff0c\u4e00\u65e6\u91cd\u542f\uff0c\u81ea\u52a8\u4ece\u78c1\u76d8\u4e0a\u52a0\u8f7d\u6570\u636e\uff0c\u5feb\u901f\u6062\u590d\u7f13\u5b58\u6570\u636e\u3002 \u7f13\u5b58\u7a7f\u900f \u5bf9\u4e8e\u7cfb\u7edf A\uff0c\u5047\u8bbe\u4e00\u79d2 5000 \u4e2a\u8bf7\u6c42\uff0c\u7ed3\u679c\u5176\u4e2d 4000 \u4e2a\u8bf7\u6c42\u662f\u9ed1\u5ba2\u53d1\u51fa\u7684\u6076\u610f\u653b\u51fb\u3002\u9ed1\u5ba2\u53d1\u51fa\u7684\u90a3 4000 \u4e2a\u653b\u51fb\uff0c\u7f13\u5b58\u4e2d\u67e5\u4e0d\u5230\uff0c\u6bcf\u6b21\u4f60\u53bb\u6570\u636e\u5e93\u91cc\u67e5\uff0c\u4e5f\u67e5\u4e0d\u5230\u3002\u4e3e\u4e2a\u6817\u5b50\u3002\u6570\u636e\u5e93 id \u662f\u4ece 1 \u5f00\u59cb\u7684\uff0c\u7ed3\u679c\u9ed1\u5ba2\u53d1\u8fc7\u6765\u7684\u8bf7\u6c42 id \u5168\u90e8\u90fd\u662f\u8d1f\u6570\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u7f13\u5b58\u4e2d\u4e0d\u4f1a\u6709\uff0c\u8bf7\u6c42\u6bcf\u6b21\u90fd\u201c \u89c6\u7f13\u5b58\u4e8e\u65e0\u7269 \u201d\uff0c\u76f4\u63a5\u67e5\u8be2\u6570\u636e\u5e93\u3002\u8fd9\u79cd\u6076\u610f\u653b\u51fb\u573a\u666f\u7684\u7f13\u5b58\u7a7f\u900f\u5c31\u4f1a\u76f4\u63a5\u628a\u6570\u636e\u5e93\u7ed9\u6253\u6b7b\u3002 \u89e3\u51b3\u529e\u6cd5 \u8bf7\u6c42\u6570\u636e\u7684 key \u4e0d\u5b58\u5728\u4e8e\u5e03\u9686\u8fc7\u6ee4\u5668\u4e2d\uff0c\u53ef\u4ee5\u786e\u5b9a\u6570\u636e\u5c31\u4e00\u5b9a\u4e0d\u4f1a\u5b58\u5728\u4e8e\u6570\u636e\u5e93\u4e2d\uff0c\u7cfb\u7edf\u53ef\u4ee5\u7acb\u5373\u8fd4\u56de\u4e0d\u5b58\u5728\u3002 \u8bf7\u6c42\u6570\u636e\u7684 key \u5b58\u5728\u4e8e\u5e03\u9686\u8fc7\u6ee4\u5668\u4e2d\uff0c\u5219\u7ee7\u7eed\u518d\u5411\u7f13\u5b58\u4e2d\u67e5\u8be2\u3002 \u7f13\u5b58\u51fb\u7a7f \u7f13\u5b58\u51fb\u7a7f\uff0c\u5c31\u662f\u8bf4\u67d0\u4e2a key \u975e\u5e38\u70ed\u70b9\uff0c\u8bbf\u95ee\u975e\u5e38\u9891\u7e41\uff0c\u5904\u4e8e\u96c6\u4e2d\u5f0f\u9ad8\u5e76\u53d1\u8bbf\u95ee\u7684\u60c5\u51b5\uff0c\u5f53\u8fd9\u4e2a key \u5728\u5931\u6548\u7684\u77ac\u95f4\uff0c\u5927\u91cf\u7684\u8bf7\u6c42\u5c31\u51fb\u7a7f\u4e86\u7f13\u5b58\uff0c\u76f4\u63a5\u8bf7\u6c42\u6570\u636e\u5e93\uff0c\u5c31\u50cf\u662f\u5728\u4e00\u9053\u5c4f\u969c\u4e0a\u51ff\u5f00\u4e86\u4e00\u4e2a\u6d1e\u3002 \u89e3\u51b3\u529e\u6cd5 \u82e5\u7f13\u5b58\u7684\u6570\u636e\u662f\u57fa\u672c\u4e0d\u4f1a\u53d1\u751f\u66f4\u65b0\u7684\uff0c\u5219\u53ef\u5c1d\u8bd5\u5c06\u8be5\u70ed\u70b9\u6570\u636e\u8bbe\u7f6e\u4e3a\u6c38\u4e0d\u8fc7\u671f\u3002 \u82e5\u7f13\u5b58\u7684\u6570\u636e\u66f4\u65b0\u4e0d\u9891\u7e41\uff0c\u4e14\u7f13\u5b58\u5237\u65b0\u7684\u6574\u4e2a\u6d41\u7a0b\u8017\u65f6\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\uff0c\u5219\u53ef\u4ee5\u91c7\u7528\u57fa\u4e8e Redis\u3001zookeeper \u7b49\u5206\u5e03\u5f0f\u4e2d\u95f4\u4ef6\u7684\u5206\u5e03\u5f0f\u4e92\u65a5\u9501\uff0c\u6216\u8005\u672c\u5730\u4e92\u65a5\u9501\u4ee5\u4fdd\u8bc1\u4ec5\u5c11\u91cf\u7684\u8bf7\u6c42\u80fd\u8bf7\u6c42\u6570\u636e\u5e93\u5e76\u91cd\u65b0\u6784\u5efa\u7f13\u5b58\uff0c\u5176\u4f59\u7ebf\u7a0b\u5219\u5728\u9501\u91ca\u653e\u540e\u80fd\u8bbf\u95ee\u5230\u65b0\u7f13\u5b58\u3002 \u82e5\u7f13\u5b58\u7684\u6570\u636e\u66f4\u65b0\u9891\u7e41\u6216\u8005\u5728\u7f13\u5b58\u5237\u65b0\u7684\u6d41\u7a0b\u8017\u65f6\u8f83\u957f\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5229\u7528\u5b9a\u65f6\u7ebf\u7a0b\u5728\u7f13\u5b58\u8fc7\u671f\u524d\u4e3b\u52a8\u5730\u91cd\u65b0\u6784\u5efa\u7f13\u5b58\u6216\u8005\u5ef6\u540e\u7f13\u5b58\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u4fdd\u8bc1\u6240\u6709\u7684\u8bf7\u6c42\u80fd\u4e00\u76f4\u8bbf\u95ee\u5230\u5bf9\u5e94\u7684\u7f13\u5b58\u3002 \u6ce8\u610f\u4e8b\u9879 \u751f\u4ea7\u73af\u5883\u4e2d\u7981\u6b62\u4f7f\u7528save\u547d\u4ee4\u624b\u5de5\u4fdd\u5b58\u6570\u636e\uff0c\u5982\u679c\u9700\u8981\u624b\u5de5\u4fdd\u5b58\u6570\u636e\u8bf7\u4f7f\u7528bgsave\u3002 \u751f\u4ea7\u73af\u5883\u4e2d\u5fc5\u987b\u8bbe\u7f6e\u8bbf\u95ee\u5bc6\u7801\u3002 \u5355\u8282\u70b9\u6027\u80fd\u8bf4\u660e \u5355\u673a\u7684 Redis\uff0c\u80fd\u591f\u627f\u8f7d\u7684 QPS \u5927\u6982\u5c31\u5728\u4e0a\u4e07\u5230\u51e0\u4e07\u4e0d\u7b49\u3002\u5bf9\u4e8e\u7f13\u5b58\u6765\u8bf4\uff0c\u4e00\u822c\u90fd\u662f\u7528\u6765\u652f\u6491\u8bfb\u9ad8\u5e76\u53d1\u7684\u3002\u56e0\u6b64\u67b6\u6784\u505a\u6210\u4e3b\u4ece(master-slave)\u67b6\u6784\uff0c\u4e00\u4e3b\u591a\u4ece\uff0c\u4e3b\u8d1f\u8d23\u5199\uff0c\u5e76\u4e14\u5c06\u6570\u636e\u590d\u5236\u5230\u5176\u5b83\u7684 slave \u8282\u70b9\uff0c\u4ece\u8282\u70b9\u8d1f\u8d23\u8bfb\u3002\u6240\u6709\u7684\u8bfb\u8bf7\u6c42\u5168\u90e8\u8d70\u4ece\u8282\u70b9\u3002\u8fd9\u6837\u4e5f\u53ef\u4ee5\u5f88\u8f7b\u677e\u5b9e\u73b0\u6c34\u5e73\u6269\u5bb9\uff0c\u652f\u6491\u8bfb\u9ad8\u5e76\u53d1\u3002 Redis replication -> \u4e3b\u4ece\u67b6\u6784 -> \u8bfb\u5199\u5206\u79bb -> \u6c34\u5e73\u6269\u5bb9\u652f\u6491\u8bfb\u9ad8\u5e76\u53d1\u3002 Redis\u4e3b\u4ece\u96c6\u7fa4\u4e3b\u8981\u673a\u5236 Redis \u91c7\u7528 \u5f02\u6b65\u65b9\u5f0f \u590d\u5236\u6570\u636e\u5230 slave \u8282\u70b9\uff0c\u4e0d\u8fc7 Redis2.8 \u5f00\u59cb\uff0cslave node \u4f1a\u5468\u671f\u6027\u5730\u786e\u8ba4\u81ea\u5df1\u6bcf\u6b21\u590d\u5236\u7684\u6570\u636e\u91cf\uff1b \u4e00\u4e2a master node \u662f\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a slave node \u7684\uff1b slave node \u4e5f\u53ef\u4ee5\u8fde\u63a5\u5176\u4ed6\u7684 slave node\uff1b slave node \u505a\u590d\u5236\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a block master node \u7684\u6b63\u5e38\u5de5\u4f5c\uff1b slave node \u5728\u505a\u590d\u5236\u7684\u65f6\u5019\uff0c\u4e5f\u4e0d\u4f1a block \u5bf9\u81ea\u5df1\u7684\u67e5\u8be2\u64cd\u4f5c\uff0c\u5b83\u4f1a\u7528\u65e7\u7684\u6570\u636e\u96c6\u6765\u63d0\u4f9b\u670d\u52a1\uff1b\u4f46\u662f\u590d\u5236\u5b8c\u6210\u7684\u65f6\u5019\uff0c\u9700\u8981\u5220\u9664\u65e7\u6570\u636e\u96c6\uff0c\u52a0\u8f7d\u65b0\u6570\u636e\u96c6\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a\u6682\u505c\u5bf9\u5916\u670d\u52a1\u4e86\uff1b slave node \u4e3b\u8981\u7528\u6765\u8fdb\u884c\u6a2a\u5411\u6269\u5bb9\uff0c\u505a\u8bfb\u5199\u5206\u79bb\uff0c\u6269\u5bb9\u7684 slave node \u53ef\u4ee5\u63d0\u9ad8\u8bfb\u7684\u541e\u5410\u91cf\u3002 \u6ce8\u610f\uff0c\u5982\u679c\u91c7\u7528\u4e86\u4e3b\u4ece\u67b6\u6784\uff0c\u90a3\u4e48\u5efa\u8bae\u5fc5\u987b\u5f00\u542f master node \u7684 \u6301\u4e45\u5316 \uff0c\u4e0d\u5efa\u8bae\u7528 slave node \u4f5c\u4e3a master node \u7684\u6570\u636e\u70ed\u5907\uff0c\u56e0\u4e3a\u90a3\u6837\u7684\u8bdd\uff0c\u5982\u679c\u4f60\u5173\u6389 master \u7684\u6301\u4e45\u5316\uff0c\u53ef\u80fd\u5728 master \u5b95\u673a\u91cd\u542f\u7684\u65f6\u5019\u6570\u636e\u662f\u7a7a\u7684\uff0c\u7136\u540e\u53ef\u80fd\u4e00\u7ecf\u8fc7\u590d\u5236\uff0c slave node \u7684\u6570\u636e\u4e5f\u4e22\u4e86\u3002 \u53e6\u5916\uff0cmaster \u7684\u5404\u79cd\u5907\u4efd\u65b9\u6848\uff0c\u4e5f\u9700\u8981\u505a\u3002\u4e07\u4e00\u672c\u5730\u7684\u6240\u6709\u6587\u4ef6\u4e22\u5931\u4e86\uff0c\u4ece\u5907\u4efd\u4e2d\u6311\u9009\u4e00\u4efd rdb \u53bb\u6062\u590d master\uff0c\u8fd9\u6837\u624d\u80fd \u786e\u4fdd\u542f\u52a8\u7684\u65f6\u5019\uff0c\u662f\u6709\u6570\u636e\u7684 \uff0c\u5373\u4f7f\u91c7\u7528\u4e86\u540e\u7eed\u8bb2\u89e3\u7684\u9ad8\u53ef\u7528\u673a\u5236\uff0cslave node \u53ef\u4ee5\u81ea\u52a8\u63a5\u7ba1 master node\uff0c\u4f46\u4e5f\u53ef\u80fd sentinel \u8fd8\u6ca1\u68c0\u6d4b\u5230 master failure\uff0cmaster node \u5c31\u81ea\u52a8\u91cd\u542f\u4e86\uff0c\u8fd8\u662f\u53ef\u80fd\u5bfc\u81f4\u4e0a\u9762\u6240\u6709\u7684 slave node \u6570\u636e\u88ab\u6e05\u7a7a\u3002 \u54e8\u5175\u96c6\u7fa4\u4e3b\u8981\u673a\u5236\uff08\u57fa\u672c\u5e9f\u5f03\uff0c\u76ee\u524d\u76f4\u63a5\u4f7f\u7528redis\u539f\u751f\u96c6\u7fa4\uff09 \u54e8\u5175\u8d1f\u8d23\uff1a\u96c6\u7fa4\u76d1\u63a7\u3001\u6d88\u606f\u901a\u77e5\u3001\u6545\u969c\u8f6c\u79fb\u3001\u914d\u7f6e\u4e2d\u5fc3\u529f\u80fd \u54e8\u5175\u81f3\u5c11\u9700\u8981 3 \u4e2a\u5b9e\u4f8b\uff0c\u6765\u4fdd\u8bc1\u81ea\u5df1\u7684\u5065\u58ee\u6027\u3002 \u54e8\u5175 + Redis \u4e3b\u4ece\u7684\u90e8\u7f72\u67b6\u6784\uff0c\u662f \u4e0d\u4fdd\u8bc1\u6570\u636e\u96f6\u4e22\u5931 \u7684\uff0c\u53ea\u80fd\u4fdd\u8bc1 Redis \u96c6\u7fa4\u7684\u9ad8\u53ef\u7528\u6027\u3002 \u4e3b\u5907\u5207\u6362\u7684\u8fc7\u7a0b\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931 \u56e0\u4e3a master->slave \u7684\u590d\u5236\u662f\u5f02\u6b65\u7684\uff0c\u6240\u4ee5\u53ef\u80fd\u6709\u90e8\u5206\u6570\u636e\u8fd8\u6ca1\u590d\u5236\u5230 slave\uff0cmaster \u5c31\u5b95\u673a\u4e86\uff0c\u6b64\u65f6\u8fd9\u90e8\u5206\u6570\u636e\u5c31\u4e22\u5931\u4e86\u3002 \u8111\u88c2\u5bfc\u81f4\u7684\u6570\u636e\u4e22\u5931\uff0c\u67d0\u4e2a master \u6240\u5728\u673a\u5668\u7a81\u7136\u8131\u79bb\u4e86\u6b63\u5e38\u7684\u7f51\u7edc\uff0c\u8ddf\u5176\u4ed6 slave \u673a\u5668\u4e0d\u80fd\u8fde\u63a5\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a master \u8fd8\u8fd0\u884c\u7740\u3002\u6b64\u65f6\u54e8\u5175\u53ef\u80fd\u5c31\u4f1a\u8ba4\u4e3a master \u5b95\u673a\u4e86\uff0c\u7136\u540e\u5f00\u542f\u9009\u4e3e\uff0c\u5c06\u5176\u4ed6 slave \u5207\u6362\u6210\u4e86 master\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u96c6\u7fa4\u91cc\u5c31\u4f1a\u6709\u4e24\u4e2a master \uff0c\u4e5f\u5c31\u662f\u6240\u8c13\u7684\u8111\u88c2\u3002\u6b64\u65f6\u867d\u7136\u67d0\u4e2a slave \u88ab\u5207\u6362\u6210\u4e86 master\uff0c\u4f46\u662f\u53ef\u80fd client \u8fd8\u6ca1\u6765\u5f97\u53ca\u5207\u6362\u5230\u65b0\u7684 master\uff0c\u8fd8\u7ee7\u7eed\u5411\u65e7 master \u5199\u6570\u636e\u3002\u56e0\u6b64\u65e7 master \u518d\u6b21\u6062\u590d\u7684\u65f6\u5019\uff0c\u4f1a\u88ab\u4f5c\u4e3a\u4e00\u4e2a slave \u6302\u5230\u65b0\u7684 master \u4e0a\u53bb\uff0c\u81ea\u5df1\u7684\u6570\u636e\u4f1a\u6e05\u7a7a\uff0c\u91cd\u65b0\u4ece\u65b0\u7684 master \u590d\u5236\u6570\u636e\u3002\u800c\u65b0\u7684 master \u5e76\u6ca1\u6709\u540e\u6765 client \u5199\u5165\u7684\u6570\u636e\uff0c\u56e0\u6b64\uff0c\u8fd9\u90e8\u5206\u6570\u636e\u4e5f\u5c31\u4e22\u5931\u4e86\u3002 \u5bf9\u4e8e\u54e8\u5175 + Redis \u4e3b\u4ece\u8fd9\u79cd\u590d\u6742\u7684\u90e8\u7f72\u67b6\u6784\uff0c\u5c3d\u91cf\u5728\u6d4b\u8bd5\u73af\u5883\u548c\u751f\u4ea7\u73af\u5883\uff0c\u90fd\u8fdb\u884c\u5145\u8db3\u7684\u6d4b\u8bd5\u548c\u6f14\u7ec3\u3002 sdown \u548c odown \u8f6c\u6362\u673a\u5236 sdown \u662f\u4e3b\u89c2\u5b95\u673a\uff0c\u5c31\u4e00\u4e2a\u54e8\u5175\u5982\u679c\u81ea\u5df1\u89c9\u5f97\u4e00\u4e2a master \u5b95\u673a\u4e86\uff0c\u90a3\u4e48\u5c31\u662f\u4e3b\u89c2\u5b95\u673a odown \u662f\u5ba2\u89c2\u5b95\u673a\uff0c\u5982\u679c quorum \u6570\u91cf\u7684\u54e8\u5175\u90fd\u89c9\u5f97\u4e00\u4e2a master \u5b95\u673a\u4e86\uff0c\u90a3\u4e48\u5c31\u662f\u5ba2\u89c2\u5b95\u673a sdown \u8fbe\u6210\u7684\u6761\u4ef6\u5f88\u7b80\u5355\uff0c\u5982\u679c\u4e00\u4e2a\u54e8\u5175 ping \u4e00\u4e2a master\uff0c\u8d85\u8fc7\u4e86 is-master-down-after-milliseconds \u6307\u5b9a\u7684\u6beb\u79d2\u6570\u4e4b\u540e\uff0c\u5c31\u4e3b\u89c2\u8ba4\u4e3a master \u5b95\u673a\u4e86\uff1b\u5982\u679c\u4e00\u4e2a\u54e8\u5175\u5728\u6307\u5b9a\u65f6\u95f4\u5185\uff0c\u6536\u5230\u4e86 quorum \u6570\u91cf\u7684\u5176\u5b83\u54e8\u5175\u4e5f\u8ba4\u4e3a\u90a3\u4e2a master \u662f sdown \u7684\uff0c\u90a3\u4e48\u5c31\u8ba4\u4e3a\u662f odown \u4e86\u3002 \u54e8\u5175\u96c6\u7fa4\u7684\u81ea\u52a8\u53d1\u73b0\u673a\u5236 \u54e8\u5175\u4e92\u76f8\u4e4b\u95f4\u7684\u53d1\u73b0\uff0c\u662f\u901a\u8fc7 Redis \u7684 pub/sub \u7cfb\u7edf\u5b9e\u73b0\u7684\uff0c\u6bcf\u4e2a\u54e8\u5175\u90fd\u4f1a\u5f80 __sentinel__:hello \u8fd9\u4e2a channel \u91cc\u53d1\u9001\u4e00\u4e2a\u6d88\u606f\uff0c\u8fd9\u65f6\u5019\u6240\u6709\u5176\u4ed6\u54e8\u5175\u90fd\u53ef\u4ee5\u6d88\u8d39\u5230\u8fd9\u4e2a\u6d88\u606f\uff0c\u5e76\u611f\u77e5\u5230\u5176\u4ed6\u7684\u54e8\u5175\u7684\u5b58\u5728\u3002 \u6bcf\u9694\u4e24\u79d2\u949f\uff0c\u6bcf\u4e2a\u54e8\u5175\u90fd\u4f1a\u5f80\u81ea\u5df1\u76d1\u63a7\u7684\u67d0\u4e2a master+slaves \u5bf9\u5e94\u7684 __sentinel__:hello channel \u91cc \u53d1\u9001\u4e00\u4e2a\u6d88\u606f \uff0c\u5185\u5bb9\u662f\u81ea\u5df1\u7684 host\u3001ip \u548c runid \u8fd8\u6709\u5bf9\u8fd9\u4e2a master \u7684\u76d1\u63a7\u914d\u7f6e\u3002 \u6bcf\u4e2a\u54e8\u5175\u4e5f\u4f1a\u53bb \u76d1\u542c \u81ea\u5df1\u76d1\u63a7\u7684\u6bcf\u4e2a master+slaves \u5bf9\u5e94\u7684 __sentinel__:hello channel\uff0c\u7136\u540e\u53bb\u611f\u77e5\u5230\u540c\u6837\u5728\u76d1\u542c\u8fd9\u4e2a master+slaves \u7684\u5176\u4ed6\u54e8\u5175\u7684\u5b58\u5728\u3002 \u6bcf\u4e2a\u54e8\u5175\u8fd8\u4f1a\u8ddf\u5176\u4ed6\u54e8\u5175\u4ea4\u6362\u5bf9 master \u7684\u76d1\u63a7\u914d\u7f6e\uff0c\u4e92\u76f8\u8fdb\u884c\u76d1\u63a7\u914d\u7f6e\u7684\u540c\u6b65\u3002 quorum \u548c majority \u6bcf\u6b21\u4e00\u4e2a\u54e8\u5175\u8981\u505a\u4e3b\u5907\u5207\u6362\uff0c\u9996\u5148\u9700\u8981 quorum \u6570\u91cf\u7684\u54e8\u5175\u8ba4\u4e3a odown\uff0c\u7136\u540e\u9009\u4e3e\u51fa\u4e00\u4e2a\u54e8\u5175\u6765\u505a\u5207\u6362\uff0c\u8fd9\u4e2a\u54e8\u5175\u8fd8\u9700\u8981\u5f97\u5230 majority \u54e8\u5175\u7684\u6388\u6743\uff0c\u624d\u80fd\u6b63\u5f0f\u6267\u884c\u5207\u6362\u3002 \u5982\u679c quorum < majority\uff0c\u6bd4\u5982 5 \u4e2a\u54e8\u5175\uff0cmajority \u5c31\u662f 3\uff0cquorum \u8bbe\u7f6e\u4e3a 2\uff0c\u90a3\u4e48\u5c31 3 \u4e2a\u54e8\u5175\u6388\u6743\u5c31\u53ef\u4ee5\u6267\u884c\u5207\u6362\u3002 \u4f46\u662f\u5982\u679c quorum >= majority\uff0c\u90a3\u4e48\u5fc5\u987b quorum \u6570\u91cf\u7684\u54e8\u5175\u90fd\u6388\u6743\uff0c\u6bd4\u5982 5 \u4e2a\u54e8\u5175\uff0cquorum \u662f 5\uff0c\u90a3\u4e48\u5fc5\u987b 5 \u4e2a\u54e8\u5175\u90fd\u540c\u610f\u6388\u6743\uff0c\u624d\u80fd\u6267\u884c\u5207\u6362\u3002 Redis \u6301\u4e45\u5316\u7684\u4e24\u79cd\u65b9\u5f0f RDB \u6301\u4e45\u5316\u673a\u5236\uff0c\u662f\u5bf9 Redis \u4e2d\u7684\u6570\u636e\u6267\u884c\u5468\u671f\u6027\u7684\u6301\u4e45\u5316\u3002 RDB \u4f1a\u751f\u6210\u591a\u4e2a\u6570\u636e\u6587\u4ef6\uff0c\u6bcf\u4e2a\u6570\u636e\u6587\u4ef6\u90fd\u4ee3\u8868\u4e86\u67d0\u4e00\u4e2a\u65f6\u523b\u4e2d Redis \u7684\u6570\u636e\uff0c\u8fd9\u79cd\u591a\u4e2a\u6570\u636e\u6587\u4ef6\u7684\u65b9\u5f0f\uff0c\u975e\u5e38\u9002\u5408\u505a\u51b7\u5907\uff0c\u53ef\u4ee5\u5c06\u8fd9\u79cd\u5b8c\u6574\u7684\u6570\u636e\u6587\u4ef6\u53d1\u9001\u5230\u4e00\u4e9b\u8fdc\u7a0b\u7684\u5b89\u5168\u5b58\u50a8\u4e0a\u53bb\uff0c\u6bd4\u5982\u8bf4 Amazon \u7684 S3 \u4e91\u670d\u52a1\u4e0a\u53bb\uff0c\u5728\u56fd\u5185\u53ef\u4ee5\u662f\u963f\u91cc\u4e91\u7684 ODPS \u5206\u5e03\u5f0f\u5b58\u50a8\u4e0a\uff0c\u4ee5\u9884\u5b9a\u597d\u7684\u5907\u4efd\u7b56\u7565\u6765\u5b9a\u671f\u5907\u4efd Redis \u4e2d\u7684\u6570\u636e\u3002 RDB \u5bf9 Redis \u5bf9\u5916\u63d0\u4f9b\u7684\u8bfb\u5199\u670d\u52a1\uff0c\u5f71\u54cd\u975e\u5e38\u5c0f\uff0c\u53ef\u4ee5\u8ba9 Redis \u4fdd\u6301\u9ad8\u6027\u80fd\uff0c\u56e0\u4e3a Redis \u4e3b\u8fdb\u7a0b\u53ea\u9700\u8981 fork \u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u8ba9\u5b50\u8fdb\u7a0b\u6267\u884c\u78c1\u76d8 IO \u64cd\u4f5c\u6765\u8fdb\u884c RDB \u6301\u4e45\u5316\u5373\u53ef\u3002 \u76f8\u5bf9\u4e8e AOF \u6301\u4e45\u5316\u673a\u5236\u6765\u8bf4\uff0c\u76f4\u63a5\u57fa\u4e8e RDB \u6570\u636e\u6587\u4ef6\u6765\u91cd\u542f\u548c\u6062\u590d Redis \u8fdb\u7a0b\uff0c\u66f4\u52a0\u5feb\u901f\u3002 \u5982\u679c\u60f3\u8981\u5728 Redis \u6545\u969c\u65f6\uff0c\u5c3d\u53ef\u80fd\u5c11\u7684\u4e22\u5931\u6570\u636e\uff0c\u90a3\u4e48 RDB \u6ca1\u6709 AOF \u597d\u3002\u4e00\u822c\u6765\u8bf4\uff0cRDB \u6570\u636e\u5feb\u7167\u6587\u4ef6\uff0c\u90fd\u662f\u6bcf\u9694 5 \u5206\u949f\uff0c\u6216\u8005\u66f4\u957f\u65f6\u95f4\u751f\u6210\u4e00\u6b21\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u5f97\u63a5\u53d7\u4e00\u65e6 Redis \u8fdb\u7a0b\u5b95\u673a\uff0c\u90a3\u4e48\u4f1a\u4e22\u5931\u6700\u8fd1 5 \u5206\u949f\uff08\u751a\u81f3\u66f4\u957f\u65f6\u95f4\uff09\u7684\u6570\u636e\u3002 RDB \u6bcf\u6b21\u5728 fork \u5b50\u8fdb\u7a0b\u6765\u6267\u884c RDB \u5feb\u7167\u6570\u636e\u6587\u4ef6\u751f\u6210\u7684\u65f6\u5019\uff0c\u5982\u679c\u6570\u636e\u6587\u4ef6\u7279\u522b\u5927\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5bf9\u5ba2\u6237\u7aef\u63d0\u4f9b\u7684\u670d\u52a1\u6682\u505c\u6570\u6beb\u79d2\uff0c\u6216\u8005\u751a\u81f3\u6570\u79d2\u3002 AOF \u673a\u5236\u5bf9\u6bcf\u6761\u5199\u5165\u547d\u4ee4\u4f5c\u4e3a\u65e5\u5fd7\uff0c\u4ee5 append-only \u7684\u6a21\u5f0f\u5199\u5165\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u5728 Redis \u91cd\u542f\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u901a\u8fc7\u56de\u653e AOF \u65e5\u5fd7\u4e2d\u7684\u5199\u5165\u6307\u4ee4\u6765\u91cd\u65b0\u6784\u5efa\u6574\u4e2a\u6570\u636e\u96c6\u3002 AOF \u53ef\u4ee5\u66f4\u597d\u7684\u4fdd\u62a4\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u4e00\u822c AOF \u4f1a\u6bcf\u9694 1 \u79d2\uff0c\u901a\u8fc7\u4e00\u4e2a\u540e\u53f0\u7ebf\u7a0b\u6267\u884c\u4e00\u6b21 fsync \u64cd\u4f5c\uff0c\u6700\u591a\u4e22\u5931 1 \u79d2\u949f\u7684\u6570\u636e\u3002 AOF \u65e5\u5fd7\u6587\u4ef6\u4ee5 append-only \u6a21\u5f0f\u5199\u5165\uff0c\u6240\u4ee5\u6ca1\u6709\u4efb\u4f55\u78c1\u76d8\u5bfb\u5740\u7684\u5f00\u9500\uff0c\u5199\u5165\u6027\u80fd\u975e\u5e38\u9ad8\uff0c\u800c\u4e14\u6587\u4ef6\u4e0d\u5bb9\u6613\u7834\u635f\uff0c\u5373\u4f7f\u6587\u4ef6\u5c3e\u90e8\u7834\u635f\uff0c\u4e5f\u5f88\u5bb9\u6613\u4fee\u590d\u3002 AOF \u65e5\u5fd7\u6587\u4ef6\u5373\u4f7f\u8fc7\u5927\u7684\u65f6\u5019\uff0c\u51fa\u73b0\u540e\u53f0\u91cd\u5199\u64cd\u4f5c\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u5ba2\u6237\u7aef\u7684\u8bfb\u5199\u3002\u56e0\u4e3a\u5728 rewrite log \u7684\u65f6\u5019\uff0c\u4f1a\u5bf9\u5176\u4e2d\u7684\u6307\u4ee4\u8fdb\u884c\u538b\u7f29\uff0c\u521b\u5efa\u51fa\u4e00\u4efd\u9700\u8981\u6062\u590d\u6570\u636e\u7684\u6700\u5c0f\u65e5\u5fd7\u51fa\u6765\u3002\u5728\u521b\u5efa\u65b0\u65e5\u5fd7\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u8001\u7684\u65e5\u5fd7\u6587\u4ef6\u8fd8\u662f\u7167\u5e38\u5199\u5165\u3002\u5f53\u65b0\u7684 merge \u540e\u7684\u65e5\u5fd7\u6587\u4ef6 ready \u7684\u65f6\u5019\uff0c\u518d\u4ea4\u6362\u65b0\u8001\u65e5\u5fd7\u6587\u4ef6\u5373\u53ef\u3002 AOF \u65e5\u5fd7\u6587\u4ef6\u7684\u547d\u4ee4\u901a\u8fc7\u53ef\u8bfb\u8f83\u5f3a\u7684\u65b9\u5f0f\u8fdb\u884c\u8bb0\u5f55\uff0c\u8fd9\u4e2a\u7279\u6027\u975e\u5e38\u9002\u5408\u505a\u707e\u96be\u6027\u7684\u8bef\u5220\u9664\u7684\u7d27\u6025\u6062\u590d\u3002\u6bd4\u5982\u67d0\u4eba\u4e0d\u5c0f\u5fc3\u7528 flushall \u547d\u4ee4\u6e05\u7a7a\u4e86\u6240\u6709\u6570\u636e\uff0c\u53ea\u8981\u8fd9\u4e2a\u65f6\u5019\u540e\u53f0 rewrite \u8fd8\u6ca1\u6709\u53d1\u751f\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u7acb\u5373\u62f7\u8d1d AOF \u6587\u4ef6\uff0c\u5c06\u6700\u540e\u4e00\u6761 flushall \u547d\u4ee4\u7ed9\u5220\u4e86\uff0c\u7136\u540e\u518d\u5c06\u8be5 AOF \u6587\u4ef6\u653e\u56de\u53bb\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u6062\u590d\u673a\u5236\uff0c\u81ea\u52a8\u6062\u590d\u6240\u6709\u6570\u636e\u3002 \u5bf9\u4e8e\u540c\u4e00\u4efd\u6570\u636e\u6765\u8bf4\uff0cAOF \u65e5\u5fd7\u6587\u4ef6\u901a\u5e38\u6bd4 RDB \u6570\u636e\u5feb\u7167\u6587\u4ef6\u66f4\u5927\u3002 AOF \u5f00\u542f\u540e\uff0c\u652f\u6301\u7684\u5199 QPS \u4f1a\u6bd4 RDB \u652f\u6301\u7684\u5199 QPS \u4f4e\uff0c\u56e0\u4e3a AOF \u4e00\u822c\u4f1a\u914d\u7f6e\u6210\u6bcf\u79d2 fsync \u4e00\u6b21\u65e5\u5fd7\u6587\u4ef6\uff0c\u5f53\u7136\uff0c\u6bcf\u79d2\u4e00\u6b21 fsync \uff0c\u6027\u80fd\u4e5f\u8fd8\u662f\u5f88\u9ad8\u7684\u3002\uff08\u5982\u679c\u5b9e\u65f6\u5199\u5165\uff0c\u90a3\u4e48 QPS \u4f1a\u5927\u964d\uff0cRedis \u6027\u80fd\u4f1a\u5927\u5927\u964d\u4f4e\uff09\u3002 \u4ee5\u524d AOF \u53d1\u751f\u8fc7 bug\uff0c\u5c31\u662f\u901a\u8fc7 AOF \u8bb0\u5f55\u7684\u65e5\u5fd7\uff0c\u8fdb\u884c\u6570\u636e\u6062\u590d\u7684\u65f6\u5019\uff0c\u6ca1\u6709\u6062\u590d\u4e00\u6a21\u4e00\u6837\u7684\u6570\u636e\u51fa\u6765\u3002\u6240\u4ee5\u8bf4\uff0c\u7c7b\u4f3c AOF \u8fd9\u79cd\u8f83\u4e3a\u590d\u6742\u7684\u57fa\u4e8e\u547d\u4ee4\u65e5\u5fd7 merge \u56de\u653e\u7684\u65b9\u5f0f\uff0c\u6bd4\u57fa\u4e8e RDB \u6bcf\u6b21\u6301\u4e45\u5316\u4e00\u4efd\u5b8c\u6574\u7684\u6570\u636e\u5feb\u7167\u6587\u4ef6\u7684\u65b9\u5f0f\uff0c\u66f4\u52a0\u8106\u5f31\u4e00\u4e9b\uff0c\u5bb9\u6613\u6709 bug\u3002\u4e0d\u8fc7 AOF \u5c31\u662f\u4e3a\u4e86\u907f\u514d rewrite \u8fc7\u7a0b\u5bfc\u81f4\u7684 bug\uff0c\u56e0\u6b64\u6bcf\u6b21 rewrite \u5e76\u4e0d\u662f\u57fa\u4e8e\u65e7\u7684\u6307\u4ee4\u65e5\u5fd7\u8fdb\u884c merge \u7684\uff0c\u800c\u662f\u57fa\u4e8e\u5f53\u65f6\u5185\u5b58\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u6307\u4ee4\u7684\u91cd\u65b0\u6784\u5efa\uff0c\u8fd9\u6837\u5065\u58ee\u6027\u4f1a\u597d\u5f88\u591a\u3002 RDB \u548c AOF \u5230\u5e95\u8be5\u5982\u4f55\u9009\u62e9 \u4e0d\u8981\u4ec5\u4ec5\u4f7f\u7528 RDB\uff0c\u56e0\u4e3a\u90a3\u6837\u4f1a\u5bfc\u81f4\u4f60\u4e22\u5931\u5f88\u591a\u6570\u636e\uff1b \u4e5f\u4e0d\u8981\u4ec5\u4ec5\u4f7f\u7528 AOF\uff0c\u56e0\u4e3a\u90a3\u6837\u6709\u4e24\u4e2a\u95ee\u9898\uff1a\u7b2c\u4e00\uff0c\u4f60\u901a\u8fc7 AOF \u505a\u51b7\u5907\uff0c\u6ca1\u6709 RDB \u505a\u51b7\u5907\u6765\u7684\u6062\u590d\u901f\u5ea6\u66f4\u5feb\uff1b\u7b2c\u4e8c\uff0cRDB \u6bcf\u6b21\u7b80\u5355\u7c97\u66b4\u751f\u6210\u6570\u636e\u5feb\u7167\uff0c\u66f4\u52a0\u5065\u58ee\uff0c\u53ef\u4ee5\u907f\u514d AOF \u8fd9\u79cd\u590d\u6742\u7684\u5907\u4efd\u548c\u6062\u590d\u673a\u5236\u7684 bug\uff1b Redis \u652f\u6301\u540c\u65f6\u5f00\u542f\u5f00\u542f\u4e24\u79cd\u6301\u4e45\u5316\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u7efc\u5408\u4f7f\u7528 AOF \u548c RDB \u4e24\u79cd\u6301\u4e45\u5316\u673a\u5236\uff0c\u7528 AOF \u6765\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u4f5c\u4e3a\u6570\u636e\u6062\u590d\u7684\u7b2c\u4e00\u9009\u62e9\uff1b\u7528 RDB \u6765\u505a\u4e0d\u540c\u7a0b\u5ea6\u7684\u51b7\u5907\uff0c\u5728 AOF \u6587\u4ef6\u90fd\u4e22\u5931\u6216\u635f\u574f\u4e0d\u53ef\u7528\u7684\u65f6\u5019\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528 RDB \u6765\u8fdb\u884c\u5feb\u901f\u7684\u6570\u636e\u6062\u590d\u3002 \u5404\u79cd\u642d\u5efa \u5355\u8282\u70b9 \u914d\u7f6e\u6587\u4ef6single.conf #RDB\u6301\u4e45\u5316\u914d\u7f6e #\u5728300\u79d2(5\u5206\u949f)\u4e4b\u540e\uff0c\u5982\u679c\u81f3\u5c11\u670910\u4e2akey\u53d1\u751f\u53d8\u5316\uff0c\u5219dump\u5185\u5b58\u5feb\u7167\u3002 save 300 10 #\u538b\u7f29 rdbcompression yes #AOF\u6301\u4e45\u5316\u914d\u7f6e ## \u53ea\u6709\u5728\u201cyes\u201d\u4e0b\uff0caof\u91cd\u5199/\u6587\u4ef6\u540c\u6b65\u7b49\u7279\u6027\u624d\u4f1a\u751f\u6548 appendonly yes #\u6bcf\u79d2\u949f\u540c\u6b65\u4e00\u6b21\uff0c\u8be5\u7b56\u7565\u4e3aAOF\u7684\u7f3a\u7701\u7b56\u7565\u3002 appendfsync everysec ## \u6307\u5b9aaof\u6587\u4ef6\u540d\u79f0 appendfilename appendonly.aof #\u6570\u636e\u6587\u4ef6\u5939 dir /data #\u8bbe\u7f6e\u8bbf\u95ee\u5bc6\u7801 requirepass yourpassword #\u5141\u8bb8\u5916\u7f51\u8bbf\u95ee\uff08\u76d1\u542c0.0.0.0\uff09\uff0c\uff08\u5728\u6ca1\u6709\u8bbe\u7f6e\u5bc6\u7801\u4e14\u6ca1\u6709\u8bbe\u7f6ebind ip\u65f6\u5019\u9ed8\u8ba4\u5f00\u542f\u53ea\u76d1\u542c127.0.0.1\uff09 protected-mode no \u5bb9\u5668\u65b9\u5f0f\u542f\u52a8 mkdir data docker run -it --restart=always -p 6379:6379 --name redis -v `pwd`/data:/data -v `pwd`/single.conf:/etc/redis.conf redis redis-server /etc/redis.conf \u96c6\u7fa4\u65b9\u5f0f Redis\u7684\u96c6\u7fa4\u4e0d\u652f\u6301nat\u7c7b\u578b\u7684\u7f51\u7edc\uff0c\u6240\u4ee5\u4f7f\u7528\u5bb9\u5668\u642d\u5efa\u7684\u8bdd\u9700\u8981\u7528\u4e3b\u673a\u7f51\u7edc\u7684\u65b9\u5f0f\u63a5\u5165 --net host Redis\u955c\u50cf\u7248\u672c>5\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528\u6700\u65b0\u7248\u672c\u955c\u50cf \u96c6\u7fa4\u4f9d\u8d56\u4e24\u4e2atcp\u7aef\u53e3\u9ed8\u8ba4\u4e3ax=6379 y=x+10000=16379 \u5982\u679c\u4f7f\u7528\u9632\u706b\u5899\u9700\u8981\u6ce8\u610f\u5f00\u542f\u8fd9\u4e24\u4e2a\u7aef\u53e3\u7684\u51fa\u5165\u6808\u89c4\u5219\u3002 \u914d\u7f6e\u6587\u4ef6cluster.conf #\u542f\u7528\u96c6\u7fa4\u6a21\u5f0f cluster-enabled yes #\u96c6\u7fa4\u81ea\u52a8\u914d\u7f6e\u6587\u4ef6\uff08\u975e\u7528\u6237\u81ea\u5b9a\u4e49\u800c\u662f\u96c6\u7fa4\u81ea\u5df1\u4f7f\u7528\u7684\uff09 cluster-config-file cluster.conf #\u96c6\u7fa4\u8282\u70b9\u6700\u5927\u8d85\u65f6\u65f6\u95f4\u5355\u4f4d\u4e3a\u6beb\u79d2\uff0c\u5982\u67d0\u4e2a\u8282\u70b910\u79d2\u6ca1\u54cd\u5e94\u5c06\u89c6\u4e3a\u6389\u7ebf cluster-node-timeout 10000 #\u526f\u672c\u8282\u70b9\u6709\u6548\u6027\u6821\u9a8c\u56e0\u5b50\uff08\u7ed3\u5408\u8282\u70b9\u8d85\u65f6\u65f6\u95f4\u4f7f\u7528\uff0c\u5f53\u8282\u70b9\u4e0e\u4e3b\u8282\u70b9\u4e0a\u6b21\u540c\u6b65\u65f6\u95f4>(\u8282\u70b9\u8d85\u65f6\u65f6\u95f4*\u6821\u9a8c\u56e0\u5b50)\u540e\u8ba4\u4e3a\u6b64\u5907\u4efd\u65e0\u6548\uff0c\u4e0d\u53c2\u4e0e\u4e3b\u8282\u70b9\u6545\u969c\u8f6c\u79fb cluster-slave-validity-factor 10 #\u4e3b\u8282\u70b9\u5c06\u4fdd\u6301\u8fde\u63a5\u7684\u6700\u5c0f\u526f\u672c\u6570 cluster-migration-barrier 3 #\u5982\u679c\u5c06\u5176\u8bbe\u7f6e\u4e3a yes\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4efb\u4f55\u8282\u70b9\u672a\u8986\u76d6\u4e00\u5b9a\u767e\u5206\u6bd4\u7684\u5bc6\u94a5\u7a7a\u95f4\uff0c\u5219\u96c6\u7fa4\u5c06\u505c\u6b62\u63a5\u53d7\u5199\u5165\u3002 #\u5982\u679c\u8be5\u9009\u9879\u8bbe\u7f6e\u4e3a no\uff0c\u5373\u4f7f\u53ea\u80fd\u5904\u7406\u6709\u5173\u5bc6\u94a5\u5b50\u96c6\u7684\u8bf7\u6c42\uff0c\u96c6\u7fa4\u4ecd\u5c06\u63d0\u4f9b\u67e5\u8be2\u670d\u52a1\u3002 cluster-require-full-coverage no #\u5982\u679c\u8bbe\u7f6e\u4e3a no\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u96c6\u7fa4\u88ab\u6807\u8bb0\u4e3a\u5931\u8d25\u65f6\uff0cRedis \u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u5c06\u505c\u6b62\u670d\u52a1\u6240\u6709\u6d41\u91cf\uff0c\u6216\u8005\u5f53\u8282\u70b9\u65e0\u6cd5\u8bbf\u95ee\u65f6\u8fbe\u5230\u6cd5\u5b9a\u4eba\u6570\u6216\u672a\u8fbe\u5230\u5b8c\u5168\u8986\u76d6\u65f6\u3002\u8fd9\u53ef\u4ee5\u9632\u6b62\u4ece\u4e0d\u77e5\u9053\u96c6\u7fa4\u4e2d\u7684\u53d8\u5316\u7684\u8282\u70b9\u8bfb\u53d6\u53ef\u80fd\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u3002\u53ef\u4ee5\u5c06\u6b64\u9009\u9879\u8bbe\u7f6e\u4e3a yes \u4ee5\u5141\u8bb8\u5728\u5931\u8d25\u72b6\u6001\u671f\u95f4\u4ece\u8282\u70b9\u8bfb\u53d6\uff0c\u8fd9\u5bf9\u4e8e\u5e0c\u671b\u4f18\u5148\u8003\u8651\u8bfb\u53d6\u53ef\u7528\u6027\u4f46\u4ecd\u5e0c\u671b\u9632\u6b62\u4e0d\u4e00\u81f4\u5199\u5165\u7684\u5e94\u7528\u7a0b\u5e8f\u975e\u5e38\u6709\u7528\u3002\u5b83\u4e5f\u53ef\u4ee5\u7528\u4e8e\u4f7f\u7528\u53ea\u6709\u4e00\u4e2a\u6216\u4e24\u4e2a\u5206\u7247\u7684 Redis Cluster \u65f6\uff0c\u56e0\u4e3a\u5b83\u5141\u8bb8\u8282\u70b9\u5728\u4e3b\u8282\u70b9\u53d1\u751f\u6545\u969c\u4f46\u65e0\u6cd5\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u65f6\u7ee7\u7eed\u63d0\u4f9b\u5199\u5165\u670d\u52a1\u3002 cluster-allow-reads-when-down yes requirepass yourpassword save 600 10 #\u6328\u4e2a\u542f\u52a8\u6bcf\u4e2a\u8282\u70b9\uff08\u9700\u8981\u63d0\u524d\u5c06\u914d\u7f6e\u6587\u4ef6\u4ee5\u53ca\u5b58\u50a8\u8def\u5f84\u521b\u5efa\u597d\uff09\uff0c\u6211\u4eec\u5efa\u7acb6\u4e2a\u8282\u70b9\uff0c\u5176\u4e2d3\u4e2a\u505a\u4e3a\u4e3b\u8282\u70b9\uff08\u5b58\u6570\u636e\uff09\uff0c\u4e09\u4e2a\u4f5c\u4e3a\u4ece\u8282\u70b9\uff0c\u6570\u636e\u57283\u4e2a\u4e3b\u8282\u70b9\u4e4b\u95f4\u5747\u5206\uff08\u4fbf\u4e8e\uff09 docker run -itd --name redis1 --restart=always --net host -v `pwd`/data:/data -v `pwd`/cluster.conf:/etc/redis.conf -p 6379:6379 redis redis-server /etc/redis.conf #\u521b\u5efa\u5176\u4ed6\u8282\u70b9\u2026\u2026 #\u8fdb\u5165\u8282\u70b9\u51c6\u5907\u5efa\u7acb\u96c6\u7fa4\u8fde\u63a5 docker exec -it redis1 bash #\u96c6\u7fa4\u8fde\u63a5\u4e0d\u652f\u6301\u4e3b\u673a\u540d\uff0c\u53ea\u80fd\u4f7f\u7528ip\uff0c\u6240\u4ee5\u6bcf\u4e2a\u8282\u70b9\u7684ip\u5730\u5740\u9700\u8981\u56fa\u5b9a redis-cli -a yourpassword --cluster create 172.21.0.2:6379 172.21.0.3:6379 172.21.0.4:6379 172.21.0.5:6379 172.21.0.6:6379 172.21.0.7:6379 --cluster-replicas 1 #\u8f93\u5165yes\u8fdb\u884c\u786e\u8ba4 #\u8f93\u51fa [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. #\u5176\u4ed6\u5e38\u7528\u96c6\u7fa4\u547d\u4ee4 #fix\u547d\u4ee4\u6765\u4fee\u590d\u96c6\u7fa4\uff0c\u4ee5\u4fbf\u6839\u636e\u6bcf\u4e2a\u8282\u70b9\u662f\u5426\u5177\u6709\u6743\u5a01\u6027\u7684\u54c8\u5e0c\u69fd\u6765\u8fc1\u79fb\u5bc6\u94a5\u3002 redis-cli --cluster fix #check\u68c0\u67e5\u96c6\u7fa4\u72b6\u6001 redis-cli --cluster check #\u6dfb\u52a0\u4e3b\u8282\u70b9add-node\u540e\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u65b0\u8282\u70b9\u7684ip\u548c\u7aef\u53e3\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u73b0\u6709\u96c6\u7fa4\u4e2d\u7684\u4efb\u610f\u4e00\u4e2aip\u548c\u7aef\u53e3 redis-cli -a yourpassword --cluster add-node 172.21.0.8:6379 172.21.0.2:6379 #\u6dfb\u52a0\u4ece\u8282\u70b9\uff08\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0--cluster-master-id \u5bf9\u5e94\u7684\u4e3b\u8282\u70b9id\uff09\u6765\u6307\u5b9a\u5176\u6210\u4e3a\u7279\u5b9a\u8282\u70b9\u7684\u526f\u672c\uff0c\u5177\u4f53\u8282\u70b9id\u53ef\u4ee5\u5728\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\uff08\u81ea\u52a8\uff09\u4e2d\u83b7\u53d6\u5230 redis-cli -a yourpassword --cluster add-node 172.21.0.9:6379 172.21.0.2:6379 --cluster-slave #\u5220\u9664\u8282\u70b9del-node\u540e\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u96c6\u7fa4\u4e2d\u4efb\u610f\u4e00\u4e2a\u8282\u70b9ip\u548c\u7aef\u53e3\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u8981\u5220\u9664\u7684\u8282\u70b9id redis-cli --cluster del-node 127.0.0.1:7000 `<node-id>` \u5e38\u7528\u914d\u7f6e #\u96c6\u7fa4\u4f7f\u7528 \u5f00\u59cb #\u65e0\u78c1\u76d8\u5316\u590d\u5236master \u5728\u5185\u5b58\u4e2d\u76f4\u63a5\u521b\u5efa RDB \uff0c\u7136\u540e\u53d1\u9001\u7ed9 slave\uff0c\u4e0d\u4f1a\u5728\u81ea\u5df1\u672c\u5730\u843d\u5730\u78c1\u76d8 repl-diskless-sync yes # \u7b49\u5f85 5s \u540e\u518d\u5f00\u59cb\u590d\u5236\uff0c\u56e0\u4e3a\u8981\u7b49\u66f4\u591a slave \u91cd\u65b0\u8fde\u63a5\u8fc7\u6765 repl-diskless-sync-delay 5 #\u8981\u6c42\u81f3\u5c11\u6709 1 \u4e2a slave\u5b8c\u6210\u5199\u5165 min-slaves-to-write 1 #\u6570\u636e\u590d\u5236\u548c\u540c\u6b65\u7684\u5ef6\u8fdf\u4e0d\u80fd\u8d85\u8fc7 10 \u79d2\uff0c\u5982\u679c\u8bf4\u4e00\u65e6\u6240\u6709\u7684 slave\uff0c\u6570\u636e\u590d\u5236\u548c\u540c\u6b65\u7684\u5ef6\u8fdf\u90fd\u8d85\u8fc7\u4e86 10 \u79d2\u949f\uff0c\u90a3\u4e48\u8fd9\u4e2a\u65f6\u5019\uff0cmaster \u5c31\u4e0d\u4f1a\u518d\u63a5\u6536\u4efb\u4f55\u8bf7\u6c42\u4e86\u3002 min-slaves-max-lag 10 #\u96c6\u7fa4\u4f7f\u7528 \u7ed3\u675f","title":"Redis\u96c6\u7fa4\u76f8\u5173"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#redis","text":"","title":"Redis\u96c6\u7fa4\u76f8\u5173"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#redis_1","text":"","title":"Redis\u5e38\u89c1\u95ee\u9898"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#_1","text":"\u5bf9\u4e8e\u7cfb\u7edf A\uff0c\u5047\u8bbe\u6bcf\u5929\u9ad8\u5cf0\u671f\u6bcf\u79d2 5000 \u4e2a\u8bf7\u6c42\uff0c\u672c\u6765\u7f13\u5b58\u5728\u9ad8\u5cf0\u671f\u53ef\u4ee5\u625b\u4f4f\u6bcf\u79d2 4000 \u4e2a\u8bf7\u6c42\uff0c\u4f46\u662f\u7f13\u5b58\u673a\u5668\u610f\u5916\u53d1\u751f\u4e86\u5168\u76d8\u5b95\u673a\u3002\u7f13\u5b58\u6302\u4e86\uff0c\u6b64\u65f6 1 \u79d2 5000 \u4e2a\u8bf7\u6c42\u5168\u90e8\u843d\u6570\u636e\u5e93\uff0c\u6570\u636e\u5e93\u5fc5\u7136\u625b\u4e0d\u4f4f\uff0c\u5b83\u4f1a\u62a5\u4e00\u4e0b\u8b66\uff0c\u7136\u540e\u5c31\u6302\u4e86\u3002\u6b64\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u91c7\u7528\u4ec0\u4e48\u7279\u522b\u7684\u65b9\u6848\u6765\u5904\u7406\u8fd9\u4e2a\u6545\u969c\uff0cDBA \u5f88\u7740\u6025\uff0c\u91cd\u542f\u6570\u636e\u5e93\uff0c\u4f46\u662f\u6570\u636e\u5e93\u7acb\u9a6c\u53c8\u88ab\u65b0\u7684\u6d41\u91cf\u7ed9\u6253\u6b7b\u4e86\u3002\u8fd9\u5c31\u662f\u7f13\u5b58\u96ea\u5d29\u3002","title":"\u7f13\u5b58\u96ea\u5d29"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#_2","text":"\u4e8b\u524d\uff1aRedis \u9ad8\u53ef\u7528\uff0c\u4e3b\u4ece+\u54e8\u5175\uff0cRedis cluster\uff0c\u907f\u514d\u5168\u76d8\u5d29\u6e83\u3002 \u4e8b\u4e2d\uff1a\u672c\u5730 ehcache \u7f13\u5b58 + hystrix \u9650\u6d41&\u964d\u7ea7\uff0c\u907f\u514d MySQL \u88ab\u6253\u6b7b\u3002 \u4e8b\u540e\uff1aRedis \u6301\u4e45\u5316\uff0c\u4e00\u65e6\u91cd\u542f\uff0c\u81ea\u52a8\u4ece\u78c1\u76d8\u4e0a\u52a0\u8f7d\u6570\u636e\uff0c\u5feb\u901f\u6062\u590d\u7f13\u5b58\u6570\u636e\u3002","title":"\u89e3\u51b3\u529e\u6cd5"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#_3","text":"\u5bf9\u4e8e\u7cfb\u7edf A\uff0c\u5047\u8bbe\u4e00\u79d2 5000 \u4e2a\u8bf7\u6c42\uff0c\u7ed3\u679c\u5176\u4e2d 4000 \u4e2a\u8bf7\u6c42\u662f\u9ed1\u5ba2\u53d1\u51fa\u7684\u6076\u610f\u653b\u51fb\u3002\u9ed1\u5ba2\u53d1\u51fa\u7684\u90a3 4000 \u4e2a\u653b\u51fb\uff0c\u7f13\u5b58\u4e2d\u67e5\u4e0d\u5230\uff0c\u6bcf\u6b21\u4f60\u53bb\u6570\u636e\u5e93\u91cc\u67e5\uff0c\u4e5f\u67e5\u4e0d\u5230\u3002\u4e3e\u4e2a\u6817\u5b50\u3002\u6570\u636e\u5e93 id \u662f\u4ece 1 \u5f00\u59cb\u7684\uff0c\u7ed3\u679c\u9ed1\u5ba2\u53d1\u8fc7\u6765\u7684\u8bf7\u6c42 id \u5168\u90e8\u90fd\u662f\u8d1f\u6570\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u7f13\u5b58\u4e2d\u4e0d\u4f1a\u6709\uff0c\u8bf7\u6c42\u6bcf\u6b21\u90fd\u201c \u89c6\u7f13\u5b58\u4e8e\u65e0\u7269 \u201d\uff0c\u76f4\u63a5\u67e5\u8be2\u6570\u636e\u5e93\u3002\u8fd9\u79cd\u6076\u610f\u653b\u51fb\u573a\u666f\u7684\u7f13\u5b58\u7a7f\u900f\u5c31\u4f1a\u76f4\u63a5\u628a\u6570\u636e\u5e93\u7ed9\u6253\u6b7b\u3002","title":"\u7f13\u5b58\u7a7f\u900f"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#_4","text":"\u8bf7\u6c42\u6570\u636e\u7684 key \u4e0d\u5b58\u5728\u4e8e\u5e03\u9686\u8fc7\u6ee4\u5668\u4e2d\uff0c\u53ef\u4ee5\u786e\u5b9a\u6570\u636e\u5c31\u4e00\u5b9a\u4e0d\u4f1a\u5b58\u5728\u4e8e\u6570\u636e\u5e93\u4e2d\uff0c\u7cfb\u7edf\u53ef\u4ee5\u7acb\u5373\u8fd4\u56de\u4e0d\u5b58\u5728\u3002 \u8bf7\u6c42\u6570\u636e\u7684 key \u5b58\u5728\u4e8e\u5e03\u9686\u8fc7\u6ee4\u5668\u4e2d\uff0c\u5219\u7ee7\u7eed\u518d\u5411\u7f13\u5b58\u4e2d\u67e5\u8be2\u3002","title":"\u89e3\u51b3\u529e\u6cd5"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#_5","text":"\u7f13\u5b58\u51fb\u7a7f\uff0c\u5c31\u662f\u8bf4\u67d0\u4e2a key \u975e\u5e38\u70ed\u70b9\uff0c\u8bbf\u95ee\u975e\u5e38\u9891\u7e41\uff0c\u5904\u4e8e\u96c6\u4e2d\u5f0f\u9ad8\u5e76\u53d1\u8bbf\u95ee\u7684\u60c5\u51b5\uff0c\u5f53\u8fd9\u4e2a key \u5728\u5931\u6548\u7684\u77ac\u95f4\uff0c\u5927\u91cf\u7684\u8bf7\u6c42\u5c31\u51fb\u7a7f\u4e86\u7f13\u5b58\uff0c\u76f4\u63a5\u8bf7\u6c42\u6570\u636e\u5e93\uff0c\u5c31\u50cf\u662f\u5728\u4e00\u9053\u5c4f\u969c\u4e0a\u51ff\u5f00\u4e86\u4e00\u4e2a\u6d1e\u3002","title":"\u7f13\u5b58\u51fb\u7a7f"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#_6","text":"\u82e5\u7f13\u5b58\u7684\u6570\u636e\u662f\u57fa\u672c\u4e0d\u4f1a\u53d1\u751f\u66f4\u65b0\u7684\uff0c\u5219\u53ef\u5c1d\u8bd5\u5c06\u8be5\u70ed\u70b9\u6570\u636e\u8bbe\u7f6e\u4e3a\u6c38\u4e0d\u8fc7\u671f\u3002 \u82e5\u7f13\u5b58\u7684\u6570\u636e\u66f4\u65b0\u4e0d\u9891\u7e41\uff0c\u4e14\u7f13\u5b58\u5237\u65b0\u7684\u6574\u4e2a\u6d41\u7a0b\u8017\u65f6\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\uff0c\u5219\u53ef\u4ee5\u91c7\u7528\u57fa\u4e8e Redis\u3001zookeeper \u7b49\u5206\u5e03\u5f0f\u4e2d\u95f4\u4ef6\u7684\u5206\u5e03\u5f0f\u4e92\u65a5\u9501\uff0c\u6216\u8005\u672c\u5730\u4e92\u65a5\u9501\u4ee5\u4fdd\u8bc1\u4ec5\u5c11\u91cf\u7684\u8bf7\u6c42\u80fd\u8bf7\u6c42\u6570\u636e\u5e93\u5e76\u91cd\u65b0\u6784\u5efa\u7f13\u5b58\uff0c\u5176\u4f59\u7ebf\u7a0b\u5219\u5728\u9501\u91ca\u653e\u540e\u80fd\u8bbf\u95ee\u5230\u65b0\u7f13\u5b58\u3002 \u82e5\u7f13\u5b58\u7684\u6570\u636e\u66f4\u65b0\u9891\u7e41\u6216\u8005\u5728\u7f13\u5b58\u5237\u65b0\u7684\u6d41\u7a0b\u8017\u65f6\u8f83\u957f\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5229\u7528\u5b9a\u65f6\u7ebf\u7a0b\u5728\u7f13\u5b58\u8fc7\u671f\u524d\u4e3b\u52a8\u5730\u91cd\u65b0\u6784\u5efa\u7f13\u5b58\u6216\u8005\u5ef6\u540e\u7f13\u5b58\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u4fdd\u8bc1\u6240\u6709\u7684\u8bf7\u6c42\u80fd\u4e00\u76f4\u8bbf\u95ee\u5230\u5bf9\u5e94\u7684\u7f13\u5b58\u3002","title":"\u89e3\u51b3\u529e\u6cd5"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#_7","text":"\u751f\u4ea7\u73af\u5883\u4e2d\u7981\u6b62\u4f7f\u7528save\u547d\u4ee4\u624b\u5de5\u4fdd\u5b58\u6570\u636e\uff0c\u5982\u679c\u9700\u8981\u624b\u5de5\u4fdd\u5b58\u6570\u636e\u8bf7\u4f7f\u7528bgsave\u3002 \u751f\u4ea7\u73af\u5883\u4e2d\u5fc5\u987b\u8bbe\u7f6e\u8bbf\u95ee\u5bc6\u7801\u3002","title":"\u6ce8\u610f\u4e8b\u9879"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#_8","text":"\u5355\u673a\u7684 Redis\uff0c\u80fd\u591f\u627f\u8f7d\u7684 QPS \u5927\u6982\u5c31\u5728\u4e0a\u4e07\u5230\u51e0\u4e07\u4e0d\u7b49\u3002\u5bf9\u4e8e\u7f13\u5b58\u6765\u8bf4\uff0c\u4e00\u822c\u90fd\u662f\u7528\u6765\u652f\u6491\u8bfb\u9ad8\u5e76\u53d1\u7684\u3002\u56e0\u6b64\u67b6\u6784\u505a\u6210\u4e3b\u4ece(master-slave)\u67b6\u6784\uff0c\u4e00\u4e3b\u591a\u4ece\uff0c\u4e3b\u8d1f\u8d23\u5199\uff0c\u5e76\u4e14\u5c06\u6570\u636e\u590d\u5236\u5230\u5176\u5b83\u7684 slave \u8282\u70b9\uff0c\u4ece\u8282\u70b9\u8d1f\u8d23\u8bfb\u3002\u6240\u6709\u7684\u8bfb\u8bf7\u6c42\u5168\u90e8\u8d70\u4ece\u8282\u70b9\u3002\u8fd9\u6837\u4e5f\u53ef\u4ee5\u5f88\u8f7b\u677e\u5b9e\u73b0\u6c34\u5e73\u6269\u5bb9\uff0c\u652f\u6491\u8bfb\u9ad8\u5e76\u53d1\u3002 Redis replication -> \u4e3b\u4ece\u67b6\u6784 -> \u8bfb\u5199\u5206\u79bb -> \u6c34\u5e73\u6269\u5bb9\u652f\u6491\u8bfb\u9ad8\u5e76\u53d1\u3002","title":"\u5355\u8282\u70b9\u6027\u80fd\u8bf4\u660e"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#redis_2","text":"Redis \u91c7\u7528 \u5f02\u6b65\u65b9\u5f0f \u590d\u5236\u6570\u636e\u5230 slave \u8282\u70b9\uff0c\u4e0d\u8fc7 Redis2.8 \u5f00\u59cb\uff0cslave node \u4f1a\u5468\u671f\u6027\u5730\u786e\u8ba4\u81ea\u5df1\u6bcf\u6b21\u590d\u5236\u7684\u6570\u636e\u91cf\uff1b \u4e00\u4e2a master node \u662f\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a slave node \u7684\uff1b slave node \u4e5f\u53ef\u4ee5\u8fde\u63a5\u5176\u4ed6\u7684 slave node\uff1b slave node \u505a\u590d\u5236\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a block master node \u7684\u6b63\u5e38\u5de5\u4f5c\uff1b slave node \u5728\u505a\u590d\u5236\u7684\u65f6\u5019\uff0c\u4e5f\u4e0d\u4f1a block \u5bf9\u81ea\u5df1\u7684\u67e5\u8be2\u64cd\u4f5c\uff0c\u5b83\u4f1a\u7528\u65e7\u7684\u6570\u636e\u96c6\u6765\u63d0\u4f9b\u670d\u52a1\uff1b\u4f46\u662f\u590d\u5236\u5b8c\u6210\u7684\u65f6\u5019\uff0c\u9700\u8981\u5220\u9664\u65e7\u6570\u636e\u96c6\uff0c\u52a0\u8f7d\u65b0\u6570\u636e\u96c6\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a\u6682\u505c\u5bf9\u5916\u670d\u52a1\u4e86\uff1b slave node \u4e3b\u8981\u7528\u6765\u8fdb\u884c\u6a2a\u5411\u6269\u5bb9\uff0c\u505a\u8bfb\u5199\u5206\u79bb\uff0c\u6269\u5bb9\u7684 slave node \u53ef\u4ee5\u63d0\u9ad8\u8bfb\u7684\u541e\u5410\u91cf\u3002 \u6ce8\u610f\uff0c\u5982\u679c\u91c7\u7528\u4e86\u4e3b\u4ece\u67b6\u6784\uff0c\u90a3\u4e48\u5efa\u8bae\u5fc5\u987b\u5f00\u542f master node \u7684 \u6301\u4e45\u5316 \uff0c\u4e0d\u5efa\u8bae\u7528 slave node \u4f5c\u4e3a master node \u7684\u6570\u636e\u70ed\u5907\uff0c\u56e0\u4e3a\u90a3\u6837\u7684\u8bdd\uff0c\u5982\u679c\u4f60\u5173\u6389 master \u7684\u6301\u4e45\u5316\uff0c\u53ef\u80fd\u5728 master \u5b95\u673a\u91cd\u542f\u7684\u65f6\u5019\u6570\u636e\u662f\u7a7a\u7684\uff0c\u7136\u540e\u53ef\u80fd\u4e00\u7ecf\u8fc7\u590d\u5236\uff0c slave node \u7684\u6570\u636e\u4e5f\u4e22\u4e86\u3002 \u53e6\u5916\uff0cmaster \u7684\u5404\u79cd\u5907\u4efd\u65b9\u6848\uff0c\u4e5f\u9700\u8981\u505a\u3002\u4e07\u4e00\u672c\u5730\u7684\u6240\u6709\u6587\u4ef6\u4e22\u5931\u4e86\uff0c\u4ece\u5907\u4efd\u4e2d\u6311\u9009\u4e00\u4efd rdb \u53bb\u6062\u590d master\uff0c\u8fd9\u6837\u624d\u80fd \u786e\u4fdd\u542f\u52a8\u7684\u65f6\u5019\uff0c\u662f\u6709\u6570\u636e\u7684 \uff0c\u5373\u4f7f\u91c7\u7528\u4e86\u540e\u7eed\u8bb2\u89e3\u7684\u9ad8\u53ef\u7528\u673a\u5236\uff0cslave node \u53ef\u4ee5\u81ea\u52a8\u63a5\u7ba1 master node\uff0c\u4f46\u4e5f\u53ef\u80fd sentinel \u8fd8\u6ca1\u68c0\u6d4b\u5230 master failure\uff0cmaster node \u5c31\u81ea\u52a8\u91cd\u542f\u4e86\uff0c\u8fd8\u662f\u53ef\u80fd\u5bfc\u81f4\u4e0a\u9762\u6240\u6709\u7684 slave node \u6570\u636e\u88ab\u6e05\u7a7a\u3002","title":"Redis\u4e3b\u4ece\u96c6\u7fa4\u4e3b\u8981\u673a\u5236"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#redis_3","text":"\u54e8\u5175\u8d1f\u8d23\uff1a\u96c6\u7fa4\u76d1\u63a7\u3001\u6d88\u606f\u901a\u77e5\u3001\u6545\u969c\u8f6c\u79fb\u3001\u914d\u7f6e\u4e2d\u5fc3\u529f\u80fd \u54e8\u5175\u81f3\u5c11\u9700\u8981 3 \u4e2a\u5b9e\u4f8b\uff0c\u6765\u4fdd\u8bc1\u81ea\u5df1\u7684\u5065\u58ee\u6027\u3002 \u54e8\u5175 + Redis \u4e3b\u4ece\u7684\u90e8\u7f72\u67b6\u6784\uff0c\u662f \u4e0d\u4fdd\u8bc1\u6570\u636e\u96f6\u4e22\u5931 \u7684\uff0c\u53ea\u80fd\u4fdd\u8bc1 Redis \u96c6\u7fa4\u7684\u9ad8\u53ef\u7528\u6027\u3002 \u4e3b\u5907\u5207\u6362\u7684\u8fc7\u7a0b\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931 \u56e0\u4e3a master->slave \u7684\u590d\u5236\u662f\u5f02\u6b65\u7684\uff0c\u6240\u4ee5\u53ef\u80fd\u6709\u90e8\u5206\u6570\u636e\u8fd8\u6ca1\u590d\u5236\u5230 slave\uff0cmaster \u5c31\u5b95\u673a\u4e86\uff0c\u6b64\u65f6\u8fd9\u90e8\u5206\u6570\u636e\u5c31\u4e22\u5931\u4e86\u3002 \u8111\u88c2\u5bfc\u81f4\u7684\u6570\u636e\u4e22\u5931\uff0c\u67d0\u4e2a master \u6240\u5728\u673a\u5668\u7a81\u7136\u8131\u79bb\u4e86\u6b63\u5e38\u7684\u7f51\u7edc\uff0c\u8ddf\u5176\u4ed6 slave \u673a\u5668\u4e0d\u80fd\u8fde\u63a5\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a master \u8fd8\u8fd0\u884c\u7740\u3002\u6b64\u65f6\u54e8\u5175\u53ef\u80fd\u5c31\u4f1a\u8ba4\u4e3a master \u5b95\u673a\u4e86\uff0c\u7136\u540e\u5f00\u542f\u9009\u4e3e\uff0c\u5c06\u5176\u4ed6 slave \u5207\u6362\u6210\u4e86 master\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u96c6\u7fa4\u91cc\u5c31\u4f1a\u6709\u4e24\u4e2a master \uff0c\u4e5f\u5c31\u662f\u6240\u8c13\u7684\u8111\u88c2\u3002\u6b64\u65f6\u867d\u7136\u67d0\u4e2a slave \u88ab\u5207\u6362\u6210\u4e86 master\uff0c\u4f46\u662f\u53ef\u80fd client \u8fd8\u6ca1\u6765\u5f97\u53ca\u5207\u6362\u5230\u65b0\u7684 master\uff0c\u8fd8\u7ee7\u7eed\u5411\u65e7 master \u5199\u6570\u636e\u3002\u56e0\u6b64\u65e7 master \u518d\u6b21\u6062\u590d\u7684\u65f6\u5019\uff0c\u4f1a\u88ab\u4f5c\u4e3a\u4e00\u4e2a slave \u6302\u5230\u65b0\u7684 master \u4e0a\u53bb\uff0c\u81ea\u5df1\u7684\u6570\u636e\u4f1a\u6e05\u7a7a\uff0c\u91cd\u65b0\u4ece\u65b0\u7684 master \u590d\u5236\u6570\u636e\u3002\u800c\u65b0\u7684 master \u5e76\u6ca1\u6709\u540e\u6765 client \u5199\u5165\u7684\u6570\u636e\uff0c\u56e0\u6b64\uff0c\u8fd9\u90e8\u5206\u6570\u636e\u4e5f\u5c31\u4e22\u5931\u4e86\u3002 \u5bf9\u4e8e\u54e8\u5175 + Redis \u4e3b\u4ece\u8fd9\u79cd\u590d\u6742\u7684\u90e8\u7f72\u67b6\u6784\uff0c\u5c3d\u91cf\u5728\u6d4b\u8bd5\u73af\u5883\u548c\u751f\u4ea7\u73af\u5883\uff0c\u90fd\u8fdb\u884c\u5145\u8db3\u7684\u6d4b\u8bd5\u548c\u6f14\u7ec3\u3002","title":"\u54e8\u5175\u96c6\u7fa4\u4e3b\u8981\u673a\u5236\uff08\u57fa\u672c\u5e9f\u5f03\uff0c\u76ee\u524d\u76f4\u63a5\u4f7f\u7528redis\u539f\u751f\u96c6\u7fa4\uff09"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#sdown-odown","text":"sdown \u662f\u4e3b\u89c2\u5b95\u673a\uff0c\u5c31\u4e00\u4e2a\u54e8\u5175\u5982\u679c\u81ea\u5df1\u89c9\u5f97\u4e00\u4e2a master \u5b95\u673a\u4e86\uff0c\u90a3\u4e48\u5c31\u662f\u4e3b\u89c2\u5b95\u673a odown \u662f\u5ba2\u89c2\u5b95\u673a\uff0c\u5982\u679c quorum \u6570\u91cf\u7684\u54e8\u5175\u90fd\u89c9\u5f97\u4e00\u4e2a master \u5b95\u673a\u4e86\uff0c\u90a3\u4e48\u5c31\u662f\u5ba2\u89c2\u5b95\u673a sdown \u8fbe\u6210\u7684\u6761\u4ef6\u5f88\u7b80\u5355\uff0c\u5982\u679c\u4e00\u4e2a\u54e8\u5175 ping \u4e00\u4e2a master\uff0c\u8d85\u8fc7\u4e86 is-master-down-after-milliseconds \u6307\u5b9a\u7684\u6beb\u79d2\u6570\u4e4b\u540e\uff0c\u5c31\u4e3b\u89c2\u8ba4\u4e3a master \u5b95\u673a\u4e86\uff1b\u5982\u679c\u4e00\u4e2a\u54e8\u5175\u5728\u6307\u5b9a\u65f6\u95f4\u5185\uff0c\u6536\u5230\u4e86 quorum \u6570\u91cf\u7684\u5176\u5b83\u54e8\u5175\u4e5f\u8ba4\u4e3a\u90a3\u4e2a master \u662f sdown \u7684\uff0c\u90a3\u4e48\u5c31\u8ba4\u4e3a\u662f odown \u4e86\u3002","title":"sdown \u548c odown \u8f6c\u6362\u673a\u5236"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#_9","text":"\u54e8\u5175\u4e92\u76f8\u4e4b\u95f4\u7684\u53d1\u73b0\uff0c\u662f\u901a\u8fc7 Redis \u7684 pub/sub \u7cfb\u7edf\u5b9e\u73b0\u7684\uff0c\u6bcf\u4e2a\u54e8\u5175\u90fd\u4f1a\u5f80 __sentinel__:hello \u8fd9\u4e2a channel \u91cc\u53d1\u9001\u4e00\u4e2a\u6d88\u606f\uff0c\u8fd9\u65f6\u5019\u6240\u6709\u5176\u4ed6\u54e8\u5175\u90fd\u53ef\u4ee5\u6d88\u8d39\u5230\u8fd9\u4e2a\u6d88\u606f\uff0c\u5e76\u611f\u77e5\u5230\u5176\u4ed6\u7684\u54e8\u5175\u7684\u5b58\u5728\u3002 \u6bcf\u9694\u4e24\u79d2\u949f\uff0c\u6bcf\u4e2a\u54e8\u5175\u90fd\u4f1a\u5f80\u81ea\u5df1\u76d1\u63a7\u7684\u67d0\u4e2a master+slaves \u5bf9\u5e94\u7684 __sentinel__:hello channel \u91cc \u53d1\u9001\u4e00\u4e2a\u6d88\u606f \uff0c\u5185\u5bb9\u662f\u81ea\u5df1\u7684 host\u3001ip \u548c runid \u8fd8\u6709\u5bf9\u8fd9\u4e2a master \u7684\u76d1\u63a7\u914d\u7f6e\u3002 \u6bcf\u4e2a\u54e8\u5175\u4e5f\u4f1a\u53bb \u76d1\u542c \u81ea\u5df1\u76d1\u63a7\u7684\u6bcf\u4e2a master+slaves \u5bf9\u5e94\u7684 __sentinel__:hello channel\uff0c\u7136\u540e\u53bb\u611f\u77e5\u5230\u540c\u6837\u5728\u76d1\u542c\u8fd9\u4e2a master+slaves \u7684\u5176\u4ed6\u54e8\u5175\u7684\u5b58\u5728\u3002 \u6bcf\u4e2a\u54e8\u5175\u8fd8\u4f1a\u8ddf\u5176\u4ed6\u54e8\u5175\u4ea4\u6362\u5bf9 master \u7684\u76d1\u63a7\u914d\u7f6e\uff0c\u4e92\u76f8\u8fdb\u884c\u76d1\u63a7\u914d\u7f6e\u7684\u540c\u6b65\u3002","title":"\u54e8\u5175\u96c6\u7fa4\u7684\u81ea\u52a8\u53d1\u73b0\u673a\u5236"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#quorum-majority","text":"\u6bcf\u6b21\u4e00\u4e2a\u54e8\u5175\u8981\u505a\u4e3b\u5907\u5207\u6362\uff0c\u9996\u5148\u9700\u8981 quorum \u6570\u91cf\u7684\u54e8\u5175\u8ba4\u4e3a odown\uff0c\u7136\u540e\u9009\u4e3e\u51fa\u4e00\u4e2a\u54e8\u5175\u6765\u505a\u5207\u6362\uff0c\u8fd9\u4e2a\u54e8\u5175\u8fd8\u9700\u8981\u5f97\u5230 majority \u54e8\u5175\u7684\u6388\u6743\uff0c\u624d\u80fd\u6b63\u5f0f\u6267\u884c\u5207\u6362\u3002 \u5982\u679c quorum < majority\uff0c\u6bd4\u5982 5 \u4e2a\u54e8\u5175\uff0cmajority \u5c31\u662f 3\uff0cquorum \u8bbe\u7f6e\u4e3a 2\uff0c\u90a3\u4e48\u5c31 3 \u4e2a\u54e8\u5175\u6388\u6743\u5c31\u53ef\u4ee5\u6267\u884c\u5207\u6362\u3002 \u4f46\u662f\u5982\u679c quorum >= majority\uff0c\u90a3\u4e48\u5fc5\u987b quorum \u6570\u91cf\u7684\u54e8\u5175\u90fd\u6388\u6743\uff0c\u6bd4\u5982 5 \u4e2a\u54e8\u5175\uff0cquorum \u662f 5\uff0c\u90a3\u4e48\u5fc5\u987b 5 \u4e2a\u54e8\u5175\u90fd\u540c\u610f\u6388\u6743\uff0c\u624d\u80fd\u6267\u884c\u5207\u6362\u3002","title":"quorum \u548c majority"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#redis_4","text":"RDB \u6301\u4e45\u5316\u673a\u5236\uff0c\u662f\u5bf9 Redis \u4e2d\u7684\u6570\u636e\u6267\u884c\u5468\u671f\u6027\u7684\u6301\u4e45\u5316\u3002 RDB \u4f1a\u751f\u6210\u591a\u4e2a\u6570\u636e\u6587\u4ef6\uff0c\u6bcf\u4e2a\u6570\u636e\u6587\u4ef6\u90fd\u4ee3\u8868\u4e86\u67d0\u4e00\u4e2a\u65f6\u523b\u4e2d Redis \u7684\u6570\u636e\uff0c\u8fd9\u79cd\u591a\u4e2a\u6570\u636e\u6587\u4ef6\u7684\u65b9\u5f0f\uff0c\u975e\u5e38\u9002\u5408\u505a\u51b7\u5907\uff0c\u53ef\u4ee5\u5c06\u8fd9\u79cd\u5b8c\u6574\u7684\u6570\u636e\u6587\u4ef6\u53d1\u9001\u5230\u4e00\u4e9b\u8fdc\u7a0b\u7684\u5b89\u5168\u5b58\u50a8\u4e0a\u53bb\uff0c\u6bd4\u5982\u8bf4 Amazon \u7684 S3 \u4e91\u670d\u52a1\u4e0a\u53bb\uff0c\u5728\u56fd\u5185\u53ef\u4ee5\u662f\u963f\u91cc\u4e91\u7684 ODPS \u5206\u5e03\u5f0f\u5b58\u50a8\u4e0a\uff0c\u4ee5\u9884\u5b9a\u597d\u7684\u5907\u4efd\u7b56\u7565\u6765\u5b9a\u671f\u5907\u4efd Redis \u4e2d\u7684\u6570\u636e\u3002 RDB \u5bf9 Redis \u5bf9\u5916\u63d0\u4f9b\u7684\u8bfb\u5199\u670d\u52a1\uff0c\u5f71\u54cd\u975e\u5e38\u5c0f\uff0c\u53ef\u4ee5\u8ba9 Redis \u4fdd\u6301\u9ad8\u6027\u80fd\uff0c\u56e0\u4e3a Redis \u4e3b\u8fdb\u7a0b\u53ea\u9700\u8981 fork \u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u8ba9\u5b50\u8fdb\u7a0b\u6267\u884c\u78c1\u76d8 IO \u64cd\u4f5c\u6765\u8fdb\u884c RDB \u6301\u4e45\u5316\u5373\u53ef\u3002 \u76f8\u5bf9\u4e8e AOF \u6301\u4e45\u5316\u673a\u5236\u6765\u8bf4\uff0c\u76f4\u63a5\u57fa\u4e8e RDB \u6570\u636e\u6587\u4ef6\u6765\u91cd\u542f\u548c\u6062\u590d Redis \u8fdb\u7a0b\uff0c\u66f4\u52a0\u5feb\u901f\u3002 \u5982\u679c\u60f3\u8981\u5728 Redis \u6545\u969c\u65f6\uff0c\u5c3d\u53ef\u80fd\u5c11\u7684\u4e22\u5931\u6570\u636e\uff0c\u90a3\u4e48 RDB \u6ca1\u6709 AOF \u597d\u3002\u4e00\u822c\u6765\u8bf4\uff0cRDB \u6570\u636e\u5feb\u7167\u6587\u4ef6\uff0c\u90fd\u662f\u6bcf\u9694 5 \u5206\u949f\uff0c\u6216\u8005\u66f4\u957f\u65f6\u95f4\u751f\u6210\u4e00\u6b21\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u5f97\u63a5\u53d7\u4e00\u65e6 Redis \u8fdb\u7a0b\u5b95\u673a\uff0c\u90a3\u4e48\u4f1a\u4e22\u5931\u6700\u8fd1 5 \u5206\u949f\uff08\u751a\u81f3\u66f4\u957f\u65f6\u95f4\uff09\u7684\u6570\u636e\u3002 RDB \u6bcf\u6b21\u5728 fork \u5b50\u8fdb\u7a0b\u6765\u6267\u884c RDB \u5feb\u7167\u6570\u636e\u6587\u4ef6\u751f\u6210\u7684\u65f6\u5019\uff0c\u5982\u679c\u6570\u636e\u6587\u4ef6\u7279\u522b\u5927\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5bf9\u5ba2\u6237\u7aef\u63d0\u4f9b\u7684\u670d\u52a1\u6682\u505c\u6570\u6beb\u79d2\uff0c\u6216\u8005\u751a\u81f3\u6570\u79d2\u3002 AOF \u673a\u5236\u5bf9\u6bcf\u6761\u5199\u5165\u547d\u4ee4\u4f5c\u4e3a\u65e5\u5fd7\uff0c\u4ee5 append-only \u7684\u6a21\u5f0f\u5199\u5165\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u5728 Redis \u91cd\u542f\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u901a\u8fc7\u56de\u653e AOF \u65e5\u5fd7\u4e2d\u7684\u5199\u5165\u6307\u4ee4\u6765\u91cd\u65b0\u6784\u5efa\u6574\u4e2a\u6570\u636e\u96c6\u3002 AOF \u53ef\u4ee5\u66f4\u597d\u7684\u4fdd\u62a4\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u4e00\u822c AOF \u4f1a\u6bcf\u9694 1 \u79d2\uff0c\u901a\u8fc7\u4e00\u4e2a\u540e\u53f0\u7ebf\u7a0b\u6267\u884c\u4e00\u6b21 fsync \u64cd\u4f5c\uff0c\u6700\u591a\u4e22\u5931 1 \u79d2\u949f\u7684\u6570\u636e\u3002 AOF \u65e5\u5fd7\u6587\u4ef6\u4ee5 append-only \u6a21\u5f0f\u5199\u5165\uff0c\u6240\u4ee5\u6ca1\u6709\u4efb\u4f55\u78c1\u76d8\u5bfb\u5740\u7684\u5f00\u9500\uff0c\u5199\u5165\u6027\u80fd\u975e\u5e38\u9ad8\uff0c\u800c\u4e14\u6587\u4ef6\u4e0d\u5bb9\u6613\u7834\u635f\uff0c\u5373\u4f7f\u6587\u4ef6\u5c3e\u90e8\u7834\u635f\uff0c\u4e5f\u5f88\u5bb9\u6613\u4fee\u590d\u3002 AOF \u65e5\u5fd7\u6587\u4ef6\u5373\u4f7f\u8fc7\u5927\u7684\u65f6\u5019\uff0c\u51fa\u73b0\u540e\u53f0\u91cd\u5199\u64cd\u4f5c\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u5ba2\u6237\u7aef\u7684\u8bfb\u5199\u3002\u56e0\u4e3a\u5728 rewrite log \u7684\u65f6\u5019\uff0c\u4f1a\u5bf9\u5176\u4e2d\u7684\u6307\u4ee4\u8fdb\u884c\u538b\u7f29\uff0c\u521b\u5efa\u51fa\u4e00\u4efd\u9700\u8981\u6062\u590d\u6570\u636e\u7684\u6700\u5c0f\u65e5\u5fd7\u51fa\u6765\u3002\u5728\u521b\u5efa\u65b0\u65e5\u5fd7\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u8001\u7684\u65e5\u5fd7\u6587\u4ef6\u8fd8\u662f\u7167\u5e38\u5199\u5165\u3002\u5f53\u65b0\u7684 merge \u540e\u7684\u65e5\u5fd7\u6587\u4ef6 ready \u7684\u65f6\u5019\uff0c\u518d\u4ea4\u6362\u65b0\u8001\u65e5\u5fd7\u6587\u4ef6\u5373\u53ef\u3002 AOF \u65e5\u5fd7\u6587\u4ef6\u7684\u547d\u4ee4\u901a\u8fc7\u53ef\u8bfb\u8f83\u5f3a\u7684\u65b9\u5f0f\u8fdb\u884c\u8bb0\u5f55\uff0c\u8fd9\u4e2a\u7279\u6027\u975e\u5e38\u9002\u5408\u505a\u707e\u96be\u6027\u7684\u8bef\u5220\u9664\u7684\u7d27\u6025\u6062\u590d\u3002\u6bd4\u5982\u67d0\u4eba\u4e0d\u5c0f\u5fc3\u7528 flushall \u547d\u4ee4\u6e05\u7a7a\u4e86\u6240\u6709\u6570\u636e\uff0c\u53ea\u8981\u8fd9\u4e2a\u65f6\u5019\u540e\u53f0 rewrite \u8fd8\u6ca1\u6709\u53d1\u751f\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u7acb\u5373\u62f7\u8d1d AOF \u6587\u4ef6\uff0c\u5c06\u6700\u540e\u4e00\u6761 flushall \u547d\u4ee4\u7ed9\u5220\u4e86\uff0c\u7136\u540e\u518d\u5c06\u8be5 AOF \u6587\u4ef6\u653e\u56de\u53bb\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u6062\u590d\u673a\u5236\uff0c\u81ea\u52a8\u6062\u590d\u6240\u6709\u6570\u636e\u3002 \u5bf9\u4e8e\u540c\u4e00\u4efd\u6570\u636e\u6765\u8bf4\uff0cAOF \u65e5\u5fd7\u6587\u4ef6\u901a\u5e38\u6bd4 RDB \u6570\u636e\u5feb\u7167\u6587\u4ef6\u66f4\u5927\u3002 AOF \u5f00\u542f\u540e\uff0c\u652f\u6301\u7684\u5199 QPS \u4f1a\u6bd4 RDB \u652f\u6301\u7684\u5199 QPS \u4f4e\uff0c\u56e0\u4e3a AOF \u4e00\u822c\u4f1a\u914d\u7f6e\u6210\u6bcf\u79d2 fsync \u4e00\u6b21\u65e5\u5fd7\u6587\u4ef6\uff0c\u5f53\u7136\uff0c\u6bcf\u79d2\u4e00\u6b21 fsync \uff0c\u6027\u80fd\u4e5f\u8fd8\u662f\u5f88\u9ad8\u7684\u3002\uff08\u5982\u679c\u5b9e\u65f6\u5199\u5165\uff0c\u90a3\u4e48 QPS \u4f1a\u5927\u964d\uff0cRedis \u6027\u80fd\u4f1a\u5927\u5927\u964d\u4f4e\uff09\u3002 \u4ee5\u524d AOF \u53d1\u751f\u8fc7 bug\uff0c\u5c31\u662f\u901a\u8fc7 AOF \u8bb0\u5f55\u7684\u65e5\u5fd7\uff0c\u8fdb\u884c\u6570\u636e\u6062\u590d\u7684\u65f6\u5019\uff0c\u6ca1\u6709\u6062\u590d\u4e00\u6a21\u4e00\u6837\u7684\u6570\u636e\u51fa\u6765\u3002\u6240\u4ee5\u8bf4\uff0c\u7c7b\u4f3c AOF \u8fd9\u79cd\u8f83\u4e3a\u590d\u6742\u7684\u57fa\u4e8e\u547d\u4ee4\u65e5\u5fd7 merge \u56de\u653e\u7684\u65b9\u5f0f\uff0c\u6bd4\u57fa\u4e8e RDB \u6bcf\u6b21\u6301\u4e45\u5316\u4e00\u4efd\u5b8c\u6574\u7684\u6570\u636e\u5feb\u7167\u6587\u4ef6\u7684\u65b9\u5f0f\uff0c\u66f4\u52a0\u8106\u5f31\u4e00\u4e9b\uff0c\u5bb9\u6613\u6709 bug\u3002\u4e0d\u8fc7 AOF \u5c31\u662f\u4e3a\u4e86\u907f\u514d rewrite \u8fc7\u7a0b\u5bfc\u81f4\u7684 bug\uff0c\u56e0\u6b64\u6bcf\u6b21 rewrite \u5e76\u4e0d\u662f\u57fa\u4e8e\u65e7\u7684\u6307\u4ee4\u65e5\u5fd7\u8fdb\u884c merge \u7684\uff0c\u800c\u662f\u57fa\u4e8e\u5f53\u65f6\u5185\u5b58\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u6307\u4ee4\u7684\u91cd\u65b0\u6784\u5efa\uff0c\u8fd9\u6837\u5065\u58ee\u6027\u4f1a\u597d\u5f88\u591a\u3002 RDB \u548c AOF \u5230\u5e95\u8be5\u5982\u4f55\u9009\u62e9 \u4e0d\u8981\u4ec5\u4ec5\u4f7f\u7528 RDB\uff0c\u56e0\u4e3a\u90a3\u6837\u4f1a\u5bfc\u81f4\u4f60\u4e22\u5931\u5f88\u591a\u6570\u636e\uff1b \u4e5f\u4e0d\u8981\u4ec5\u4ec5\u4f7f\u7528 AOF\uff0c\u56e0\u4e3a\u90a3\u6837\u6709\u4e24\u4e2a\u95ee\u9898\uff1a\u7b2c\u4e00\uff0c\u4f60\u901a\u8fc7 AOF \u505a\u51b7\u5907\uff0c\u6ca1\u6709 RDB \u505a\u51b7\u5907\u6765\u7684\u6062\u590d\u901f\u5ea6\u66f4\u5feb\uff1b\u7b2c\u4e8c\uff0cRDB \u6bcf\u6b21\u7b80\u5355\u7c97\u66b4\u751f\u6210\u6570\u636e\u5feb\u7167\uff0c\u66f4\u52a0\u5065\u58ee\uff0c\u53ef\u4ee5\u907f\u514d AOF \u8fd9\u79cd\u590d\u6742\u7684\u5907\u4efd\u548c\u6062\u590d\u673a\u5236\u7684 bug\uff1b Redis \u652f\u6301\u540c\u65f6\u5f00\u542f\u5f00\u542f\u4e24\u79cd\u6301\u4e45\u5316\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u7efc\u5408\u4f7f\u7528 AOF \u548c RDB \u4e24\u79cd\u6301\u4e45\u5316\u673a\u5236\uff0c\u7528 AOF \u6765\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u4f5c\u4e3a\u6570\u636e\u6062\u590d\u7684\u7b2c\u4e00\u9009\u62e9\uff1b\u7528 RDB \u6765\u505a\u4e0d\u540c\u7a0b\u5ea6\u7684\u51b7\u5907\uff0c\u5728 AOF \u6587\u4ef6\u90fd\u4e22\u5931\u6216\u635f\u574f\u4e0d\u53ef\u7528\u7684\u65f6\u5019\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528 RDB \u6765\u8fdb\u884c\u5feb\u901f\u7684\u6570\u636e\u6062\u590d\u3002","title":"Redis \u6301\u4e45\u5316\u7684\u4e24\u79cd\u65b9\u5f0f"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#_10","text":"","title":"\u5404\u79cd\u642d\u5efa"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#_11","text":"\u914d\u7f6e\u6587\u4ef6single.conf #RDB\u6301\u4e45\u5316\u914d\u7f6e #\u5728300\u79d2(5\u5206\u949f)\u4e4b\u540e\uff0c\u5982\u679c\u81f3\u5c11\u670910\u4e2akey\u53d1\u751f\u53d8\u5316\uff0c\u5219dump\u5185\u5b58\u5feb\u7167\u3002 save 300 10 #\u538b\u7f29 rdbcompression yes #AOF\u6301\u4e45\u5316\u914d\u7f6e ## \u53ea\u6709\u5728\u201cyes\u201d\u4e0b\uff0caof\u91cd\u5199/\u6587\u4ef6\u540c\u6b65\u7b49\u7279\u6027\u624d\u4f1a\u751f\u6548 appendonly yes #\u6bcf\u79d2\u949f\u540c\u6b65\u4e00\u6b21\uff0c\u8be5\u7b56\u7565\u4e3aAOF\u7684\u7f3a\u7701\u7b56\u7565\u3002 appendfsync everysec ## \u6307\u5b9aaof\u6587\u4ef6\u540d\u79f0 appendfilename appendonly.aof #\u6570\u636e\u6587\u4ef6\u5939 dir /data #\u8bbe\u7f6e\u8bbf\u95ee\u5bc6\u7801 requirepass yourpassword #\u5141\u8bb8\u5916\u7f51\u8bbf\u95ee\uff08\u76d1\u542c0.0.0.0\uff09\uff0c\uff08\u5728\u6ca1\u6709\u8bbe\u7f6e\u5bc6\u7801\u4e14\u6ca1\u6709\u8bbe\u7f6ebind ip\u65f6\u5019\u9ed8\u8ba4\u5f00\u542f\u53ea\u76d1\u542c127.0.0.1\uff09 protected-mode no \u5bb9\u5668\u65b9\u5f0f\u542f\u52a8 mkdir data docker run -it --restart=always -p 6379:6379 --name redis -v `pwd`/data:/data -v `pwd`/single.conf:/etc/redis.conf redis redis-server /etc/redis.conf","title":"\u5355\u8282\u70b9"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#_12","text":"Redis\u7684\u96c6\u7fa4\u4e0d\u652f\u6301nat\u7c7b\u578b\u7684\u7f51\u7edc\uff0c\u6240\u4ee5\u4f7f\u7528\u5bb9\u5668\u642d\u5efa\u7684\u8bdd\u9700\u8981\u7528\u4e3b\u673a\u7f51\u7edc\u7684\u65b9\u5f0f\u63a5\u5165 --net host Redis\u955c\u50cf\u7248\u672c>5\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528\u6700\u65b0\u7248\u672c\u955c\u50cf \u96c6\u7fa4\u4f9d\u8d56\u4e24\u4e2atcp\u7aef\u53e3\u9ed8\u8ba4\u4e3ax=6379 y=x+10000=16379 \u5982\u679c\u4f7f\u7528\u9632\u706b\u5899\u9700\u8981\u6ce8\u610f\u5f00\u542f\u8fd9\u4e24\u4e2a\u7aef\u53e3\u7684\u51fa\u5165\u6808\u89c4\u5219\u3002 \u914d\u7f6e\u6587\u4ef6cluster.conf #\u542f\u7528\u96c6\u7fa4\u6a21\u5f0f cluster-enabled yes #\u96c6\u7fa4\u81ea\u52a8\u914d\u7f6e\u6587\u4ef6\uff08\u975e\u7528\u6237\u81ea\u5b9a\u4e49\u800c\u662f\u96c6\u7fa4\u81ea\u5df1\u4f7f\u7528\u7684\uff09 cluster-config-file cluster.conf #\u96c6\u7fa4\u8282\u70b9\u6700\u5927\u8d85\u65f6\u65f6\u95f4\u5355\u4f4d\u4e3a\u6beb\u79d2\uff0c\u5982\u67d0\u4e2a\u8282\u70b910\u79d2\u6ca1\u54cd\u5e94\u5c06\u89c6\u4e3a\u6389\u7ebf cluster-node-timeout 10000 #\u526f\u672c\u8282\u70b9\u6709\u6548\u6027\u6821\u9a8c\u56e0\u5b50\uff08\u7ed3\u5408\u8282\u70b9\u8d85\u65f6\u65f6\u95f4\u4f7f\u7528\uff0c\u5f53\u8282\u70b9\u4e0e\u4e3b\u8282\u70b9\u4e0a\u6b21\u540c\u6b65\u65f6\u95f4>(\u8282\u70b9\u8d85\u65f6\u65f6\u95f4*\u6821\u9a8c\u56e0\u5b50)\u540e\u8ba4\u4e3a\u6b64\u5907\u4efd\u65e0\u6548\uff0c\u4e0d\u53c2\u4e0e\u4e3b\u8282\u70b9\u6545\u969c\u8f6c\u79fb cluster-slave-validity-factor 10 #\u4e3b\u8282\u70b9\u5c06\u4fdd\u6301\u8fde\u63a5\u7684\u6700\u5c0f\u526f\u672c\u6570 cluster-migration-barrier 3 #\u5982\u679c\u5c06\u5176\u8bbe\u7f6e\u4e3a yes\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4efb\u4f55\u8282\u70b9\u672a\u8986\u76d6\u4e00\u5b9a\u767e\u5206\u6bd4\u7684\u5bc6\u94a5\u7a7a\u95f4\uff0c\u5219\u96c6\u7fa4\u5c06\u505c\u6b62\u63a5\u53d7\u5199\u5165\u3002 #\u5982\u679c\u8be5\u9009\u9879\u8bbe\u7f6e\u4e3a no\uff0c\u5373\u4f7f\u53ea\u80fd\u5904\u7406\u6709\u5173\u5bc6\u94a5\u5b50\u96c6\u7684\u8bf7\u6c42\uff0c\u96c6\u7fa4\u4ecd\u5c06\u63d0\u4f9b\u67e5\u8be2\u670d\u52a1\u3002 cluster-require-full-coverage no #\u5982\u679c\u8bbe\u7f6e\u4e3a no\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u96c6\u7fa4\u88ab\u6807\u8bb0\u4e3a\u5931\u8d25\u65f6\uff0cRedis \u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u5c06\u505c\u6b62\u670d\u52a1\u6240\u6709\u6d41\u91cf\uff0c\u6216\u8005\u5f53\u8282\u70b9\u65e0\u6cd5\u8bbf\u95ee\u65f6\u8fbe\u5230\u6cd5\u5b9a\u4eba\u6570\u6216\u672a\u8fbe\u5230\u5b8c\u5168\u8986\u76d6\u65f6\u3002\u8fd9\u53ef\u4ee5\u9632\u6b62\u4ece\u4e0d\u77e5\u9053\u96c6\u7fa4\u4e2d\u7684\u53d8\u5316\u7684\u8282\u70b9\u8bfb\u53d6\u53ef\u80fd\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u3002\u53ef\u4ee5\u5c06\u6b64\u9009\u9879\u8bbe\u7f6e\u4e3a yes \u4ee5\u5141\u8bb8\u5728\u5931\u8d25\u72b6\u6001\u671f\u95f4\u4ece\u8282\u70b9\u8bfb\u53d6\uff0c\u8fd9\u5bf9\u4e8e\u5e0c\u671b\u4f18\u5148\u8003\u8651\u8bfb\u53d6\u53ef\u7528\u6027\u4f46\u4ecd\u5e0c\u671b\u9632\u6b62\u4e0d\u4e00\u81f4\u5199\u5165\u7684\u5e94\u7528\u7a0b\u5e8f\u975e\u5e38\u6709\u7528\u3002\u5b83\u4e5f\u53ef\u4ee5\u7528\u4e8e\u4f7f\u7528\u53ea\u6709\u4e00\u4e2a\u6216\u4e24\u4e2a\u5206\u7247\u7684 Redis Cluster \u65f6\uff0c\u56e0\u4e3a\u5b83\u5141\u8bb8\u8282\u70b9\u5728\u4e3b\u8282\u70b9\u53d1\u751f\u6545\u969c\u4f46\u65e0\u6cd5\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u65f6\u7ee7\u7eed\u63d0\u4f9b\u5199\u5165\u670d\u52a1\u3002 cluster-allow-reads-when-down yes requirepass yourpassword save 600 10 #\u6328\u4e2a\u542f\u52a8\u6bcf\u4e2a\u8282\u70b9\uff08\u9700\u8981\u63d0\u524d\u5c06\u914d\u7f6e\u6587\u4ef6\u4ee5\u53ca\u5b58\u50a8\u8def\u5f84\u521b\u5efa\u597d\uff09\uff0c\u6211\u4eec\u5efa\u7acb6\u4e2a\u8282\u70b9\uff0c\u5176\u4e2d3\u4e2a\u505a\u4e3a\u4e3b\u8282\u70b9\uff08\u5b58\u6570\u636e\uff09\uff0c\u4e09\u4e2a\u4f5c\u4e3a\u4ece\u8282\u70b9\uff0c\u6570\u636e\u57283\u4e2a\u4e3b\u8282\u70b9\u4e4b\u95f4\u5747\u5206\uff08\u4fbf\u4e8e\uff09 docker run -itd --name redis1 --restart=always --net host -v `pwd`/data:/data -v `pwd`/cluster.conf:/etc/redis.conf -p 6379:6379 redis redis-server /etc/redis.conf #\u521b\u5efa\u5176\u4ed6\u8282\u70b9\u2026\u2026 #\u8fdb\u5165\u8282\u70b9\u51c6\u5907\u5efa\u7acb\u96c6\u7fa4\u8fde\u63a5 docker exec -it redis1 bash #\u96c6\u7fa4\u8fde\u63a5\u4e0d\u652f\u6301\u4e3b\u673a\u540d\uff0c\u53ea\u80fd\u4f7f\u7528ip\uff0c\u6240\u4ee5\u6bcf\u4e2a\u8282\u70b9\u7684ip\u5730\u5740\u9700\u8981\u56fa\u5b9a redis-cli -a yourpassword --cluster create 172.21.0.2:6379 172.21.0.3:6379 172.21.0.4:6379 172.21.0.5:6379 172.21.0.6:6379 172.21.0.7:6379 --cluster-replicas 1 #\u8f93\u5165yes\u8fdb\u884c\u786e\u8ba4 #\u8f93\u51fa [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. #\u5176\u4ed6\u5e38\u7528\u96c6\u7fa4\u547d\u4ee4 #fix\u547d\u4ee4\u6765\u4fee\u590d\u96c6\u7fa4\uff0c\u4ee5\u4fbf\u6839\u636e\u6bcf\u4e2a\u8282\u70b9\u662f\u5426\u5177\u6709\u6743\u5a01\u6027\u7684\u54c8\u5e0c\u69fd\u6765\u8fc1\u79fb\u5bc6\u94a5\u3002 redis-cli --cluster fix #check\u68c0\u67e5\u96c6\u7fa4\u72b6\u6001 redis-cli --cluster check #\u6dfb\u52a0\u4e3b\u8282\u70b9add-node\u540e\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u65b0\u8282\u70b9\u7684ip\u548c\u7aef\u53e3\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u73b0\u6709\u96c6\u7fa4\u4e2d\u7684\u4efb\u610f\u4e00\u4e2aip\u548c\u7aef\u53e3 redis-cli -a yourpassword --cluster add-node 172.21.0.8:6379 172.21.0.2:6379 #\u6dfb\u52a0\u4ece\u8282\u70b9\uff08\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0--cluster-master-id \u5bf9\u5e94\u7684\u4e3b\u8282\u70b9id\uff09\u6765\u6307\u5b9a\u5176\u6210\u4e3a\u7279\u5b9a\u8282\u70b9\u7684\u526f\u672c\uff0c\u5177\u4f53\u8282\u70b9id\u53ef\u4ee5\u5728\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\uff08\u81ea\u52a8\uff09\u4e2d\u83b7\u53d6\u5230 redis-cli -a yourpassword --cluster add-node 172.21.0.9:6379 172.21.0.2:6379 --cluster-slave #\u5220\u9664\u8282\u70b9del-node\u540e\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u96c6\u7fa4\u4e2d\u4efb\u610f\u4e00\u4e2a\u8282\u70b9ip\u548c\u7aef\u53e3\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u8981\u5220\u9664\u7684\u8282\u70b9id redis-cli --cluster del-node 127.0.0.1:7000 `<node-id>`","title":"\u96c6\u7fa4\u65b9\u5f0f"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/Redis%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3/#_13","text":"#\u96c6\u7fa4\u4f7f\u7528 \u5f00\u59cb #\u65e0\u78c1\u76d8\u5316\u590d\u5236master \u5728\u5185\u5b58\u4e2d\u76f4\u63a5\u521b\u5efa RDB \uff0c\u7136\u540e\u53d1\u9001\u7ed9 slave\uff0c\u4e0d\u4f1a\u5728\u81ea\u5df1\u672c\u5730\u843d\u5730\u78c1\u76d8 repl-diskless-sync yes # \u7b49\u5f85 5s \u540e\u518d\u5f00\u59cb\u590d\u5236\uff0c\u56e0\u4e3a\u8981\u7b49\u66f4\u591a slave \u91cd\u65b0\u8fde\u63a5\u8fc7\u6765 repl-diskless-sync-delay 5 #\u8981\u6c42\u81f3\u5c11\u6709 1 \u4e2a slave\u5b8c\u6210\u5199\u5165 min-slaves-to-write 1 #\u6570\u636e\u590d\u5236\u548c\u540c\u6b65\u7684\u5ef6\u8fdf\u4e0d\u80fd\u8d85\u8fc7 10 \u79d2\uff0c\u5982\u679c\u8bf4\u4e00\u65e6\u6240\u6709\u7684 slave\uff0c\u6570\u636e\u590d\u5236\u548c\u540c\u6b65\u7684\u5ef6\u8fdf\u90fd\u8d85\u8fc7\u4e86 10 \u79d2\u949f\uff0c\u90a3\u4e48\u8fd9\u4e2a\u65f6\u5019\uff0cmaster \u5c31\u4e0d\u4f1a\u518d\u63a5\u6536\u4efb\u4f55\u8bf7\u6c42\u4e86\u3002 min-slaves-max-lag 10 #\u96c6\u7fa4\u4f7f\u7528 \u7ed3\u675f","title":"\u5e38\u7528\u914d\u7f6e"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/mysql_mariadb/","text":"mysql/mariadb \u6ce8\u610f\u4e8b\u9879 mariadb/mysql \u751f\u4ea7\u5e93\u4e00\u5b9a\u8981\u8bbe\u7f6einnodb\u5f15\u64ce\u7684\u5185\u5b58\uff0c\u9ed8\u8ba4\u503c\u5f88\u5c0f\u5f71\u54cd\u6548\u7387\uff0c\u8fd8\u53ef\u4ee5\u6839\u636e\u662f\u5426\u9ad8\u5199\u5165\u6216\u9ad8\u8bfb\u53d6\u8c03\u6574\u5199\u76d8\u65f6\u95f4","title":"mysql/mariadb"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/mysql_mariadb/#mysqlmariadb","text":"","title":"mysql/mariadb"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/mysql_mariadb/#_1","text":"mariadb/mysql \u751f\u4ea7\u5e93\u4e00\u5b9a\u8981\u8bbe\u7f6einnodb\u5f15\u64ce\u7684\u5185\u5b58\uff0c\u9ed8\u8ba4\u503c\u5f88\u5c0f\u5f71\u54cd\u6548\u7387\uff0c\u8fd8\u53ef\u4ee5\u6839\u636e\u662f\u5426\u9ad8\u5199\u5165\u6216\u9ad8\u8bfb\u53d6\u8c03\u6574\u5199\u76d8\u65f6\u95f4","title":"\u6ce8\u610f\u4e8b\u9879"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/","text":"Neo4j\u76f8\u5173 \u5173\u7cfb\u56fe\u8c31\u6280\u672f\u6f14\u8fdb \u4f20\u7edf\u5173\u7cfb\u578b\u6570\u636e\u5e93\u6241\u5e73\u5316\u5b58\u50a8+sql\u67e5\u8be2 \u4f18\u70b9\uff1a\u5b9e\u73b0\u7b80\u5355\u3001\u65e0\u989d\u5916\u5b66\u4e60\u6210\u672c\u3002 \u7f3a\u70b9\uff1a\u591a\u7ea7\u5173\u8054\u6570\u636e\u67e5\u8be2\u9ebb\u70e6\uff0c\u4e14\u53d7\u9650\u4e8e\u4f20\u7edf\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u8bbe\u8ba1\u539f\u7406\uff0c\u5bf9\u56fe\u6570\u636e\u6ca1\u6709\u4e13\u95e8\u7684\u4f18\u5316\uff0c\u5728\u67e5\u8be2\u591a\u7ea7\u5927\u91cf\u6570\u636e\u65f6\u6027\u80fd\u4e0d\u4f73\u3002 \u4e13\u7528\u7684\u56fe\u6570\u636e\u5e93\u4f8b\u5982neo4j \u4f18\u70b9\uff1a\u9488\u5bf9\u56fe\u8ba1\u7b97\u4e0e\u5b58\u50a8\u505a\u4e13\u95e8\u8bbe\u8ba1\u63d0\u9ad8\u5176\u6027\u80fd\uff0ccypher\u4e13\u7528\u67e5\u8be2\u8bed\u8a00\u8f83sql\u80fd\u66f4\u6e05\u695a\u7684\u8868\u8fbe\u56fe\u4e4b\u95f4\u7684\u5173\u7cfb\u3002 \u7f3a\u70b9\uff1a\u9700\u8981\u5b66\u4e60cypher\u67e5\u8be2\u8bed\u8a00\uff0c\u6570\u636e\u7684\u589e\u5220\u6539\u67e5\u4e5f\u4e0e\u4f20\u7edf\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7565\u6709\u4e0d\u540c\u3002 \u5173\u7cfb\u56fe\u5b58\u50a8\u67e5\u8be2\u8ba1\u7b97\u89e3\u51b3\u65b9\u6848 \u901a\u8fc7Neo4j\u5b9e\u73b0\u4eba\u5458\u7684\u6279\u91cf\u521b\u5efa\uff0c\u66f4\u65b0\uff08\u521b\u5efa\u540e\u5408\u5e76\uff09\uff0c\u5220\u9664\uff0c\u591a\u7ea7\u5173\u7cfb\u67e5\u8be2\u7b49 \u793e\u533a\u7248\u642d\u5efa #\u4e3a\u4e86\u4fdd\u8bc1\u6027\u80fd\u4ee5\u53ca\u5927\u6570\u636e\u91cf\u64cd\u4f5c\u65f6\u5019\u4e0d\u5185\u5b58\u6ea2\u51fa\uff0c\u5728\u786e\u4fdd\u540c\u673a\u5668\u5176\u4ed6\u7ec4\u4ef6\u9700\u6c42\u7684\u60c5\u51b5\u4e0b\uff0c\u5c3d\u53ef\u80fd\u7ed9\u66f4\u591a\u7684\u53ef\u7528\u5185\u5b58 docker run -itd --name neo4j --restart=always -p 7474:7474 -p 7687:7687 -e=NEO4J_dbms_memory_pagecache_size=8G -e=NEO4J_dbms_memory_heap_initial__size=4G -e=NEO4J_dbms_memory_heap_max__size=32G -v /data/neo4j:/data neo4j:4.2.7 #\u4e0b\u8f7dapoc\u63d2\u4ef6\u4ee5\u63d0\u4f9b\u589e\u5f3a\u529f\u80fd\u652f\u6301\uff08\u6bd4\u5982\u5408\u5e76\u8282\u70b9\uff09\uff0c\u5730\u5740\uff1ahttps://github.com/neo4j-contrib/neo4j-apoc-procedures/releases \u7248\u672c\u53f7\u5982\u679c\u6ca1\u6709\u5b8c\u5168\u76f8\u540c\u7684\u9009\u62e9\u63a5\u8fd1\u7684\u4e5f\u53ef\u4ee5 cd /data/neo4j wget https://github.com/neo4j-contrib/neo4j-apoc-procedures/releases/download/4.2.0.4/apoc-4.2.0.4-all.jar #\u590d\u5236apoc*.jar\u5230\u5bb9\u5668\u4e2dneo4j\u76ee\u5f55\u7684plugins\u6587\u4ef6\u5939\u4e2d docker exec -it neo4j bash cp data/apoc-*.jar ./plugins/ #\u4fee\u6539conf/neo4j.conf\u914d\u7f6e\u6587\u4ef6\uff0c\u589e\u52a0\u5982\u4e0b\u4e24\u884c dbms.security.procedures.unrestricted=algo.* dbms.security.procedures.unrestricted=apoc.* #\u4fdd\u5b58\u540e\u91cd\u542f\u5bb9\u5668 docker restart neo4j \u4f7f\u7528 \u7d22\u5f15\u5efa\u7acb\u662f\u975e\u5e38\u6709\u5fc5\u8981\u7684\uff0c\u4e00\u4e2a\u7d22\u5f15\u53ef\u4ee5\u5f88\u5927\u7a0b\u5ea6\u4e0a\u964d\u4f4e\u5927\u89c4\u6a21\u6570\u636e\u7684\u67e5\u8be2\u901f\u5ea6\u3002\uff08\u5728\u5bf9\u8282\u70b9\u6309\u7167name\u5c5e\u6027\u5efa\u7acb\u4e86\u7d22\u5f15\u4e4b\u540e\uff0c\u622a\u6b62\u6211\u5199\u8fd9\u7bc7blog\u7684\u65f6\u5019\uff0c\u6570\u636e\u91cf\u4e3a\u8282\u70b9600w+,\u5173\u7cfb1100w+\uff0c\u67e5\u8be2\u4e00\u4e2a\u8282\u70b9\u4ee5\u53ca\u76f8\u5173\u8054\u7684\u8282\u70b9\u5173\u7cfb\u6d88\u8017\u7684\u65f6\u95f4\u548c\u6570\u636e\u91cf\u5f88\u5c0f\u7684\u65f6\u5019\u51e0\u4e4e\u6ca1\u6709\u4ec0\u4e48\u5dee\u522b\uff0c\u57fa\u672c\u4e0a\u90fd\u7a33\u5b9a\u572816~20ms\u5de6\u53f3\u3002\u94fe\u63a5\uff1ahttps://www.jianshu.com/p/a2497a33390f \uff09 \u4ee5\u4e0b\u6d89\u53ca\u6027\u80fd\u7684\u6d4b\u8bd5\u76f8\u5173\u7684\u673a\u5668\u914d\u7f6e\u5982\u4e0b:32G\u5185\u5b58 8\u6838\u5904\u7406\u5668 \u673a\u68b0\u786c\u76d8 \u6279\u91cf\u64cd\u4f5c\u6700\u4f73\u5b9e\u8df5 \u6279\u91cf\u521b\u5efa\u8282\u70b9\u91c7\u7528(\u7eaf\u65b0\u589e)\uff1a\u6279\u91cf\u521b\u5efa\u8282\u70b9\uff08\u6863\u6848\u8868\u8bfb\u53d6\uff09-\u63a8\u8350 \u6279\u91cf\u521b\u5efa\u8282\u70b9\u91c7\u7528(\u65b0\u589e\u4ee5\u53ca\u5305\u542b\u66f4\u65b0)\uff1a\u901a\u8fc7\u8bc1\u4ef6\u53f7\u5408\u5e76\u65b9\u5f0f\u521b\u5efa-\u589e\u91cf\u66f4\u65b0\u63a8\u8350 \u6279\u91cf\u521b\u5efa\u5173\u7cfb\u91c7\u7528\uff1a\u6839\u636e\u6237\u53f7\u521b\u5efa\u4e00\u5bb6\u4eba\u5173\u7cfb\u5b50\u56fe\u4e8b\u52a1\u65b9\u5f0f-\u63a8\u8350 \u6279\u91cf\u521b\u5efa\u5173\u7cfb\uff08\u590d\u6742\u7c7b\u578b\uff09\u91c7\u7528\uff1a\u901a\u8fc7apoc\u63d2\u4ef6\u6279\u91cf\u65b9\u5f0f\u521b\u5efa\u4eba\u8f66\u5173\u7cfb \u6279\u91cf\u5408\u5e76\u5b9e\u4f53\u8282\u70b9\u91c7\u7528\uff1a\u6839\u636e\u8bc1\u4ef6\u53f7\u7801\u5408\u5e76\u8282\u70b9-cypher\u65b9\u5f0f(\u4f9d\u8d56apoc\u63d2\u4ef6) \u6279\u91cf\u5408\u5e76\u91cd\u590d\u5173\u7cfb\uff08\u4e3b\u8981\u7531\u5408\u5e76\u8282\u70b9\u4ea7\u751f\uff09\uff1a\u5408\u5e76\u91cd\u590d\u5173\u7cfb-cypher\u65b9\u5f0f\uff08\u4f9d\u8d56apoc\u63d2\u4ef6\uff09 \u6279\u91cf\u521b\u5efa\u8282\u70b9 #python dependson:pip install py2neo from py2neo import Graph from py2neo.bulk import create_nodes g = Graph(connectionInfoParam...) keys = [\"name\", \"age\"] data = [ [\"Alice\", 33], [\"Bob\", 44], [\"Carol\", 55], ] create_nodes(g.auto(), data, labels={\"Person\"}, keys=keys) g.nodes.match(\"Person\").count() \u6279\u91cf\u521b\u5efa\u8282\u70b9\uff08\u6863\u6848\u8868\u8bfb\u53d6\uff09-\u7eaf\u65b0\u589e\u63a8\u8350 \u5199\u51651\u4e07\u6761\u8017\u65f67\u79d2\uff0c\u5199\u5165\u64cd\u4f5c\u65f6\uff0c\u6d4b\u8bd5\u673a\u5668python\u548cjava\u8fdb\u7a0b\u7684cpu\u5360\u7528\u8f83\u9ad8\uff0c\u5185\u5b58\u5408\u8ba1\u5360\u75287GB\uff0c\u78c1\u76d8\u8bfb\u51991-3MB/S\uff0c\u521d\u6b65\u63a8\u6d4b\u9700\u8981\u63d0\u5347\u5199\u5165\u6027\u80fd\u7684\u8bdd\u9700\u8981\u5728cpu\u65b9\u9762\u6269\u5bb9\u3002 \u7ed3\u5408\u8f66\u8f86\u6863\u6848\u6570\u636e\u6d4b\u8bd5\u7ed3\u679c\uff1a21\u4e2a\u5b57\u6bb51\u4e07\u6761\u6570\u636e\u5199\u51654.5\u79d2 \uff08\u4eba\u7684\u6863\u684846\u4e2a\u5b57\u6bb57\u79d2\uff09\uff0c\u5c06\u5168\u91cf\u5b57\u6bb5\u653e\u5230\u6570\u636e\u4ed3\u5e93\u4e2d\uff0c\u56fe\u6570\u636e\u5e93\u4e2d\u53ea\u5b58\u5fc5\u8981\u7684\u67e5\u8be2\u4ee5\u53ca\u76f4\u63a5\u663e\u793a\u5b57\u6bb5\u53ef\u4ee5\u6709\u6548\u63d0\u5347\u5199\u5165\u901f\u5ea6\u3002 #py2neo \u7684bulk\u63a5\u53e3\u65b9\u5f0f from py2neo import Graph import psycopg2 from py2neo.bulk import create_nodes,merge_nodes from itertools import islice import time #\u8bfb\u53d6\u4eba\u5458\u6863\u6848\u6570\u636e db=psycopg2.connect(\"dbname=demo user=postgres password=password hostipaddress port=5432\") cur=db.cursor() keys=\"gmsfhm,xm,xbmc,mzmc,xxmc,jggjmc,jgssxmc,csdjgmc,csdssxmc,csdxz,hjdpcsmc,hjdxz,xzz,lxdh,zzmmmc,zw,zy,byzkmc,whcdmc,hyzkmc,zjxymc,hklxmc,hkxzmc,hh,yhzgxdm,yhzgxmc,fqgmsfhm,fqxm,mqgmsfhm,mqxm,pogmsfhm,poxm,idcard_url,province,city,country\" keyss=keys.split(',') limit=10_000 #\u56fa\u5b9a\u8bfb\u53d6N\u6761\u6570\u636e\u7528\u6765\u6d4b\u8bd5\u5408\u5e76\u8282\u70b9 # sqls=\"select \"+keys+\" from czrkjbxx order by hh limit \"+str(limit) #\u968f\u673a\u8bfb\u53d6N\u6761\u6570\u636e sqls=\"select \"+keys+\" from czrkjbxx order by hh asc offset floor(random()*1000) limit \"+str(limit) nodes=[] #\u8fde\u63a5neo4j graph = Graph(\"bolt://ipaddress:7687\", auth=(\"neo4j\", \"neo4jpassword\")) #\u591a\u5c11\u6761\u6570\u636e\u4fdd\u5b58\u4e00\u6b21 batch_size=10000 if batch_size>limit: batch_size=limit try: cur.execute(sqls) print('query:%s' % sqls) data=cur.fetchmany(batch_size) ta0=time.time() cnt=0 while data: cnt=cnt+1 print('load data size:%s' % len(data)) for d in data: p={'xm':''} for i in range(len(keyss)): p[keyss[i]]=d[i] nodes.append(p) if len(nodes)>=batch_size: #\u542f\u52a8\u8282\u70b9\u521b\u5efa ta=time.time() create_nodes(graph.auto(),nodes,labels={'Person'}) nodes.clear() print(\"\u63d0\u4ea4 %s \u6b21\uff0c\u8017\u65f6:%s\u79d2\" % (cnt,round(time.time()-ta))) #\u542f\u52a8\u4e00\u4e2a\u81ea\u52a8\u63d0\u4ea4\u7684\u4e8b\u52a1 if len(nodes)>0: create_nodes(graph.auto(),nodes,labels={'Person'}) nodes.clear() data=cur.fetchmany(batch_size) except(IOError): print('\u53d1\u751f\u9519\u8bef') print(\"neo4j\u4e2d\u6709%s\u6761\u6570\u636e,\u603b\u8017\u65f6:%s\u79d2\" % (str(graph.nodes.match('Person').count()),round(time.time()-ta0))) cur.close() db.close() \u901a\u8fc7\u8bc1\u4ef6\u53f7\u5408\u5e76\u65b9\u5f0f\u521b\u5efa-\u589e\u91cf\u66f4\u65b0\u63a8\u8350 1\u4e07\u6761\u8017\u65f6283\u79d2 from py2neo import Graph import psycopg2 from py2neo.bulk import create_nodes,merge_nodes from itertools import islice import time #\u8bfb\u53d6\u4eba\u5458\u6863\u6848\u6570\u636e db=psycopg2.connect(\"dbname=demo user=postgres password=password host=ip port=5432\") cur=db.cursor() keys=\"gmsfhm,xm,xbmc,mzmc,xxmc,jggjmc,jgssxmc,csdjgmc,csdssxmc,csdxz,hjdpcsmc,hjdxz,xzz,lxdh,zzmmmc,zw,zy,byzkmc,whcdmc,hyzkmc,zjxymc,hklxmc,hkxzmc,hh,yhzgxdm,yhzgxmc,fqgmsfhm,fqxm,mqgmsfhm,mqxm,pogmsfhm,poxm,idcard_url,province,city,country\" keyss=keys.split(',') limit=10_000 #\u56fa\u5b9a\u8bfb\u53d6N\u6761\u6570\u636e\u7528\u6765\u6d4b\u8bd5\u5408\u5e76\u8282\u70b9 # sqls=\"select \"+keys+\" from czrkjbxx order by hh limit \"+str(limit) #\u968f\u673a\u8bfb\u53d6N\u6761\u6570\u636e sqls=\"select \"+keys+\" from czrkjbxx order by hh asc offset floor(random()*1000) limit \"+str(limit) nodes=[] #\u8fde\u63a5neo4j graph = Graph(\"bolt://ip:7687\", auth=(\"neo4j\", \"password\")) #\u591a\u5c11\u6761\u6570\u636e\u4fdd\u5b58\u4e00\u6b21 batch_size=10000 if batch_size>limit: batch_size=limit try: cur.execute(sqls) print('query:%s' % sqls) data=cur.fetchmany(batch_size) ta0=time.time() cnt=0 while data: cnt=cnt+1 print('load data size:%s' % len(data)) for d in data: p={'xm':''} for i in range(len(keyss)): p[keyss[i]]=d[i] nodes.append(p) if len(nodes)>=batch_size: #\u542f\u52a8\u8282\u70b9\u521b\u5efa ta=time.time() merge_nodes(graph.auto(),nodes,('Person','gmsfhm'),labels={'Person'}) nodes.clear() print(\"\u63d0\u4ea4 %s \u6b21\uff0c\u8017\u65f6:%s\u79d2\" % (cnt,round(time.time()-ta))) #\u542f\u52a8\u4e00\u4e2a\u81ea\u52a8\u63d0\u4ea4\u7684\u4e8b\u52a1 if len(nodes)>0: merge_nodes(graph.auto(),nodes,('Person','gmsfhm'),labels={'Person'}) nodes.clear() data=cur.fetchmany(batch_size) except(IOError): print('\u53d1\u751f\u9519\u8bef') print(\"neo4j\u4e2d\u6709%s\u6761\u6570\u636e,\u603b\u8017\u65f6:%s\u79d2\" % (str(graph.nodes.match('Person').count()),round(time.time()-ta0))) cur.close() db.close() \u901a\u8fc7apoc\u63d2\u4ef6\u6279\u91cf\u521b\u5efa\u8282\u70b9 \u5199\u51651000\u6761\u8017\u65f6217\u79d2\uff0c\u4e0d\u63a8\u8350 #\u901a\u8fc7apoc\u63d2\u4ef6\u6279\u91cf\u521b\u5efa from py2neo import Graph import psycopg2 from itertools import islice import time import simplejson def custJson(d): s=\"{\" if len(d)>0: for k in d: if d[k]: s=s+k+':\"'+d[k]+'\",' else: s=s+k+':\"\",' if len(s)>2: return s[0:-1]+'}' else: return '{}' else: return '{}' #\u8bfb\u53d6\u4eba\u5458\u6863\u6848\u6570\u636e db=psycopg2.connect(\"dbname=demo user=postgres password=password host=ip port=5432\") cur=db.cursor() keys=\"gmsfhm,xm,xbmc,mzmc,xxmc,jggjmc,jgssxmc,csdjgmc,csdssxmc,csdxz,hjdpcsmc,hjdxz,xzz,lxdh,zzmmmc,zw,zy,byzkmc,whcdmc,hyzkmc,zjxymc,hklxmc,hkxzmc,hh,yhzgxmc,fqgmsfhm,fqxm,mqgmsfhm,mqxm,pogmsfhm,poxm,idcard_url,province,city,country\" keyss=keys.split(',') limit=1_000 #\u56fa\u5b9a\u8bfb\u53d6N\u6761\u6570\u636e\u7528\u6765\u6d4b\u8bd5\u5408\u5e76\u8282\u70b9 # sqls=\"select \"+keys+\" from czrkjbxx order by hh limit \"+str(limit) #\u968f\u673a\u8bfb\u53d6N\u6761\u6570\u636e sqls=\"select \"+keys+\" from czrkjbxx order by hh asc offset floor(random()*1000) limit \"+str(limit) nodes=\"[\" #\u8fde\u63a5neo4j graph = Graph(\"bolt://ip:7687\", auth=(\"neo4j\", \"password\")) #\u591a\u5c11\u6761\u6570\u636e\u4fdd\u5b58\u4e00\u6b21 batch_size=1000 cnt=0 try: cur.execute(sqls) data=cur.fetchall() for d in data: p={'xm':''} for i in range(len(keyss)): p[keyss[i]]=d[i] nodes=nodes+custJson(p)+',' cnt=cnt+1 # print(nodes) if cnt>=batch_size: #\u542f\u52a8\u8282\u70b9\u521b\u5efa ta=time.time() graph.run('call apoc.create.nodes([\"Person\"],%s)' % (nodes[0:-1]+']')) nodes='[' cnt=0 print('\u8017\u65f6:%s' % ((time.time()-ta))) #\u542f\u52a8\u4e00\u4e2a\u81ea\u52a8\u63d0\u4ea4\u7684\u4e8b\u52a1 if cnt>0: graph.run('call apoc.create.nodes([\"Person\"],%s)' % (nodes[0:-1]+']')) nodes='[' cnt=0 # merge_nodes(graph.auto(),) except(IOError): print('\u53d1\u751f\u9519\u8bef') print(\"neo4j\u4e2d\u6709%s\u6761\u6570\u636e,\u603b\u8017\u65f6:%s\" % (str(graph.nodes.match('Person').count()),round(time.time()-ta))) cur.close() db.close() \u901a\u8fc7\u5b50\u56fe\u65b9\u5f0f\u6279\u91cf\u521b\u5efa\u8282\u70b9 \u8017\u65f6\u548cpy2neo\u7684\u6279\u91cf\u63a5\u53e3create_nodes\u57fa\u672c\u4e00\u6837 #\u901a\u8fc7subgraph\u52a0\u4e8b\u52a1\u6279\u91cf\u521b\u5efa\u8282\u70b9 from py2neo import Graph,Node,Subgraph import psycopg2 from itertools import islice import time import simplejson def custJson(d): s=\"{\" if len(d)>0: for k in d: if d[k]: s=s+k+':\"'+d[k]+'\",' else: s=s+k+':\"\",' if len(s)>2: return s[0:-1]+'}' else: return '{}' else: return '{}' #\u8bfb\u53d6\u4eba\u5458\u6863\u6848\u6570\u636e db=psycopg2.connect(\"dbname=demo user=postgres password=password host=ip port=5432\") cur=db.cursor() keys=\"gmsfhm,xm,xbmc,mzmc,xxmc,jggjmc,jgssxmc,csdjgmc,csdssxmc,csdxz,hjdpcsmc,hjdxz,xzz,lxdh,zzmmmc,zw,zy,byzkmc,whcdmc,hyzkmc,zjxymc,hklxmc,hkxzmc,hh,yhzgxmc,fqgmsfhm,fqxm,mqgmsfhm,mqxm,pogmsfhm,poxm,idcard_url,province,city,country\" keyss=keys.split(',') limit=10_000 #\u56fa\u5b9a\u8bfb\u53d6N\u6761\u6570\u636e\u7528\u6765\u6d4b\u8bd5\u5408\u5e76\u8282\u70b9 # sqls=\"select \"+keys+\" from czrkjbxx order by hh limit \"+str(limit) #\u968f\u673a\u8bfb\u53d6N\u6761\u6570\u636e sqls=\"select \"+keys+\" from czrkjbxx order by hh asc offset floor(random()*1000) limit \"+str(limit) nodes=\"[\" #\u8fde\u63a5neo4j graph = Graph(\"bolt://ipaddress:7687\", auth=(\"neo4j\", \"password\")) tx = graph.begin() nodes=[] cur.execute(sqls) data=cur.fetchall() ta=time.time() for line in data: oneNode = Node() for ki in range(len(keyss)): k=keyss[ki] oneNode[k]=line[ki] nodes.append(oneNode) nodes=Subgraph(nodes) tx.create(nodes) tx.commit() print('\u8017\u65f6:%s' % ((time.time()-ta))) \u6839\u636e\u8bc1\u4ef6\u53f7\u7801\u5408\u5e76\u8282\u70b9-cypher\u65b9\u5f0f(\u4f9d\u8d56apoc\u63d2\u4ef6) 2\u4e07\u6761\u6570\u636e\uff0c\u5b9e\u9645\u67091\u4e07\u6761\u4e0d\u91cd\u590d\u6570\u636e\uff0c\u6267\u884c\u8017\u65f62\u79d2\uff0c\u63a8\u8350 190\u4e07\u6570\u636e\u5b9e\u9645\u4e0d\u91cd\u590d\u7684100\u4e07\uff0c\u6267\u884c\u65f6\u95f44\u79d2 --cypher \u8bed\u6cd5\u5b9e\u73b0 match(p:Person) with p.gmsfhm as sfz,collect(p) as nodelist,count(*) as cnt where cnt>1 call apoc.refactor.mergeNodes(nodelist,{properties:\"combine\",mergeRels:true}) yield node return node \u5408\u5e76\u91cd\u590d\u5173\u7cfb-cypher\u65b9\u5f0f\uff08\u4f9d\u8d56apoc\u63d2\u4ef6\uff09 MATCH (a:Person)-[r:rel]-(b:Person) WITH a, b, collect(r) as rels CALL apoc.refactor.mergeRelationships(rels) YIELD rel RETURN count(rel) --\u5982\u679c\u6709\u592a\u591a\u91cd\u590d\u6570\u636e\u6700\u597d\u6bcf\u6b21\u53ea\u5904\u7406\u4e00\u90e8\u5206\uff0c\u907f\u514d\u5168\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u9020\u6210\u5185\u5b58\u6ea2\u51fa\uff0c\u5982\u4e0b match(p:Person) with p.gmsfhm as sfz,collect(p) as nodelist,count(*) as cnt where cnt>1 call apoc.refactor.mergeNodes(nodelist) yield node return node limit 10000 --\u67e5\u8be2\u6709\u591a\u5c11\u7ec4\u91cd\u590d\u6570\u636e match(p:Person) with p.gmsfhm as sfz,collect(p) as nodelist,count(*) as cnt where cnt>1 return count(nodelist) \u6839\u636e\u8bc1\u4ef6\u53f7\u5408\u5e76\u8282\u70b9-python\u65b9\u5f0f 2\u4e07\u6761\u6570\u636e\uff0c\u5b9e\u9645\u67091\u4e07\u6761\u4e0d\u91cd\u590d\u6570\u636e\uff0c\u6267\u884c\u8017\u65f6365\u79d2\uff0c\u4e0d\u63a8\u8350 #\u5408\u5e76 from py2neo import Graph import time from py2neo.bulk import create_nodes,merge_nodes graph = Graph(\"bolt://ip:7687\", auth=(\"neo4j\", \"password\")) print(\"count:\"+str(graph.nodes.match('Person').count())) nodes=graph.nodes.match('Person') # mdata=[] # for n in nodes: # mdata.append({'gmsfhm':n['gmsfhm']}) # print(mdata[0]) ta=time.time() merge_nodes(tx=graph.auto(),data=nodes,merge_key=('Person','gmsfhm')) print(\"using time:\"+str(round(time.time()-ta))) print(\"count:\"+str(graph.nodes.match('Person').count())) \u7d22\u5f15\uff08cql\uff09 CREATE INDEX ON:Person(hh) --\u521b\u5efa\u591a\u5b57\u6bb5\u7684\u8bdd\u4f7f\u7528\u65f6\u5019\u5fc5\u987b\u4e5f\u4f20\u591a\u5b57\u6bb5 CREATE INDEX ON:Person(gmsfhm) --\u67e5\u770b\u7d22\u5f15 :schema --\u5220\u9664\u7d22\u5f15 DROP INDEX ON :Person(gmsfhm,hh) \u6839\u636e\u6237\u53f7\u521b\u5efa\u4e00\u5bb6\u4eba\u5173\u7cfb\u5b50\u56fe\u4e8b\u52a1\u65b9\u5f0f-\u63a8\u8350 \u8017\u65f60.04\u79d2\uff0c\u5b9e\u6d4b\u91cd\u590d\u6267\u884c\u4e0d\u4f1a\u5bfc\u81f4\u5efa\u7acb\u591a\u4e2a\u91cd\u590d\u5173\u7cfb #\u6839\u636e\u6237\u53f7\u521b\u5efa\u4e00\u5bb6\u4eba\u7684\u5173\u7cfb-\u5b50\u56fe\u4e8b\u52a1\u65b9\u5f0f(\u63a8\u8350) from py2neo import Graph,Relationship,Subgraph import time from py2neo.matching import * graph = Graph(\"bolt://ip:7687\", auth=(\"neo4j\", \"password\")) nodeM=NodeMatcher(graph) #\u627e\u4e00\u5bb6\u4eba hh='361024002267449' nodes=nodeM.match('Person',hh=hh).all() hz=nodeM.match('Person',hh=hh,yhzgxdm='02').first() print(hz) if hz: print('\u5bb6\u4eba\u6570\u91cf:%s' % len(nodes)) ta=time.time() mData=[] tx = graph.begin() for n in nodes: if n['yhzgxdm']!='02': mData.append(Relationship(hz,'rel',n,relation=n['yhzgxmc'])) if len(mData)>0: A=Subgraph(relationships=mData) graph.create(A) tx.commit() print('over time:%s' % ((time.time()-ta))) else: print('\u6ca1\u6709\u6237\u4e3b\u7684\u975e\u6cd5\u6570\u636e') \u6839\u636e\u6237\u53f7\u521b\u5efa\u4e00\u5bb6\u4eba\u7684\u5173\u7cfb(\u4e0d\u63a8\u8350\uff0c\u4ec5\u4f9b\u53c2\u8003) \u8017\u65f6183\u79d2(\u4e0d\u63a8\u8350\u4f7f\u7528\uff0c\u4fdd\u7559\u4e0b\u6765\u4f5c\u4e3a\u5176\u4ed6\u53ef\u80fd\u573a\u666f\u7684\u5e94\u7528) #\u6839\u636e\u6237\u53f7\u521b\u5efa\u4e00\u5bb6\u4eba\u7684\u5173\u7cfb from py2neo import Graph import time from py2neo.bulk import create_nodes,merge_nodes,create_relationships from py2neo.matching import * graph = Graph(\"bolt://ip:7687\", auth=(\"neo4j\", \"password\")) nodeM=NodeMatcher(graph) #\u627e\u4e00\u5bb6\u4eba hh='110101007156971' nodes=nodeM.match('Person',hh=hh).all() print('\u5bb6\u4eba\u6570\u91cf:%s' % len(nodes)) rels=\"38,68,10,45,51,63,52,99\".split(',') relsmc=\"\u513f\u5ab3,\u914d\u5076\u7684\u66fe\u7956\u7236\u6bcd,\u914d\u5076,(\u5916)\u5b59\u5ab3\u5987,\u7236\u4eb2,\u5916\u7956\u7236,\u6bcd\u4eb2,\u8fc1\u51fa\u6216\u6b7b\u4ea1\".split(',') ta=time.time() mData=[] for rel in range(len(rels)): relItem=rels[rel] relmcItem=relsmc[rel] print('relItem:%s mc:%s' % (relItem,relmcItem)) query=\"MATCH (p:Person{hh:'%s',yhzgxdm:'02'}),(p2:Person{hh:'%s',yhzgxdm:'%s'}) where p2['gmsfhm'] is not null MERGE (p)-[:rel{relation:'%s'}]->(p2)\" % (hh,hh,relItem,relmcItem) print(\"query:%s\" % query) graph.run(query) print('over use time:%s r:%s' % (round(time.time()-ta),r)) \u901a\u8fc7apoc\u63d2\u4ef6\u6279\u91cf\u65b9\u5f0f\u521b\u5efa\u4eba\u8f66\u5173\u7cfb \u6b64\u65b9\u6cd5\u53ef\u4ee5\u907f\u514d\u540c\u65f6\u64cd\u4f5c\u6570\u636e\u8fc7\u591a\u5e26\u6765\u7684\u5185\u5b58\u6ea2\u51fa\u7b49\u95ee\u9898\u3002 call apoc.periodic.iterate(\"match(v:Vehicle) return v\",\"match(p:Person{gmsfhm:v.sfzmhm}) merge (p)-[:car {relation:'\u8f66\u4e3b'}]->(v) return v\",{batchSize:10000,parallel:true}) \u6839\u636e\u6307\u5b9a\u6761\u4ef6\u67e5\u8be2N\u5c42\u5173\u7cfb\u4eba\u4ee5\u53ca\u5173\u7cfb\u6570\u636e-cypher\u65b9\u5f0f --\u67e5\u8be2idcard\u4e3a'idcard'\u7684\u4eba\u4e3a\u4e3b\u4f53\uff0c\u5e76\u8fd4\u56de\u51763\u5c42\u5173\u7cfb\u4eba\u4ee5\u53ca\u5173\u7cfb\u6570\u636e match data=(na:Person{idcard:'idcard'})-[*1..3]-(nb:Person) return data \u907f\u514d\u5185\u5b58\u6ea2\u51fa\u7684\u6e05\u7406\u6570\u636e\uff08\u5371\u9669\uff01\uff01\uff01\uff09 call apoc.periodic.iterate(\"match(p:Person) return p\",\"delete p return p\",{batchSize:10000, parallel:true}) cypher\u5c06Label\u6807\u7b7e\u4f5c\u4e3a\u67e5\u8be2\u6761\u4ef6 match data=(na:Person)-[*1..3]-(nb) where any(label in labels(nb) WHERE label in ['Qb', 'Person']) and na.gmsfhm='123456' return data limit 100 cypher\u5c06\u591a\u5173\u7cfb\u3001\u591a\u6807\u7b7e\u548c\u53ef\u53d8\u6b65\u957f\u4f5c\u4e3a\u67e5\u8be2\u6761\u4ef6 --\u67e5\u8be2idcard\u4e3a'123456'\u7684\u4eba\u4e3a\u4e3b\u4f53\uff0c\u5173\u7cfb\u4e3arel1\u548crel2 \u8282\u70b9\u6807\u7b7e\u4e3alabel1\u548clabel2 \u4e141-3\u5c42\u7684\u5173\u7cfb\u6570\u636e match data=(na:Person)-[:rel1|rel2*1..3]-(nb) where na.gmsfhm in ['123456']and any(label in labels(nb) WHERE label in ['label1','label2']) return data","title":"Neo4j\u76f8\u5173"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#neo4j","text":"","title":"Neo4j\u76f8\u5173"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#_1","text":"\u4f20\u7edf\u5173\u7cfb\u578b\u6570\u636e\u5e93\u6241\u5e73\u5316\u5b58\u50a8+sql\u67e5\u8be2 \u4f18\u70b9\uff1a\u5b9e\u73b0\u7b80\u5355\u3001\u65e0\u989d\u5916\u5b66\u4e60\u6210\u672c\u3002 \u7f3a\u70b9\uff1a\u591a\u7ea7\u5173\u8054\u6570\u636e\u67e5\u8be2\u9ebb\u70e6\uff0c\u4e14\u53d7\u9650\u4e8e\u4f20\u7edf\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u8bbe\u8ba1\u539f\u7406\uff0c\u5bf9\u56fe\u6570\u636e\u6ca1\u6709\u4e13\u95e8\u7684\u4f18\u5316\uff0c\u5728\u67e5\u8be2\u591a\u7ea7\u5927\u91cf\u6570\u636e\u65f6\u6027\u80fd\u4e0d\u4f73\u3002 \u4e13\u7528\u7684\u56fe\u6570\u636e\u5e93\u4f8b\u5982neo4j \u4f18\u70b9\uff1a\u9488\u5bf9\u56fe\u8ba1\u7b97\u4e0e\u5b58\u50a8\u505a\u4e13\u95e8\u8bbe\u8ba1\u63d0\u9ad8\u5176\u6027\u80fd\uff0ccypher\u4e13\u7528\u67e5\u8be2\u8bed\u8a00\u8f83sql\u80fd\u66f4\u6e05\u695a\u7684\u8868\u8fbe\u56fe\u4e4b\u95f4\u7684\u5173\u7cfb\u3002 \u7f3a\u70b9\uff1a\u9700\u8981\u5b66\u4e60cypher\u67e5\u8be2\u8bed\u8a00\uff0c\u6570\u636e\u7684\u589e\u5220\u6539\u67e5\u4e5f\u4e0e\u4f20\u7edf\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7565\u6709\u4e0d\u540c\u3002","title":"\u5173\u7cfb\u56fe\u8c31\u6280\u672f\u6f14\u8fdb"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#_2","text":"\u901a\u8fc7Neo4j\u5b9e\u73b0\u4eba\u5458\u7684\u6279\u91cf\u521b\u5efa\uff0c\u66f4\u65b0\uff08\u521b\u5efa\u540e\u5408\u5e76\uff09\uff0c\u5220\u9664\uff0c\u591a\u7ea7\u5173\u7cfb\u67e5\u8be2\u7b49","title":"\u5173\u7cfb\u56fe\u5b58\u50a8\u67e5\u8be2\u8ba1\u7b97\u89e3\u51b3\u65b9\u6848"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#_3","text":"#\u4e3a\u4e86\u4fdd\u8bc1\u6027\u80fd\u4ee5\u53ca\u5927\u6570\u636e\u91cf\u64cd\u4f5c\u65f6\u5019\u4e0d\u5185\u5b58\u6ea2\u51fa\uff0c\u5728\u786e\u4fdd\u540c\u673a\u5668\u5176\u4ed6\u7ec4\u4ef6\u9700\u6c42\u7684\u60c5\u51b5\u4e0b\uff0c\u5c3d\u53ef\u80fd\u7ed9\u66f4\u591a\u7684\u53ef\u7528\u5185\u5b58 docker run -itd --name neo4j --restart=always -p 7474:7474 -p 7687:7687 -e=NEO4J_dbms_memory_pagecache_size=8G -e=NEO4J_dbms_memory_heap_initial__size=4G -e=NEO4J_dbms_memory_heap_max__size=32G -v /data/neo4j:/data neo4j:4.2.7 #\u4e0b\u8f7dapoc\u63d2\u4ef6\u4ee5\u63d0\u4f9b\u589e\u5f3a\u529f\u80fd\u652f\u6301\uff08\u6bd4\u5982\u5408\u5e76\u8282\u70b9\uff09\uff0c\u5730\u5740\uff1ahttps://github.com/neo4j-contrib/neo4j-apoc-procedures/releases \u7248\u672c\u53f7\u5982\u679c\u6ca1\u6709\u5b8c\u5168\u76f8\u540c\u7684\u9009\u62e9\u63a5\u8fd1\u7684\u4e5f\u53ef\u4ee5 cd /data/neo4j wget https://github.com/neo4j-contrib/neo4j-apoc-procedures/releases/download/4.2.0.4/apoc-4.2.0.4-all.jar #\u590d\u5236apoc*.jar\u5230\u5bb9\u5668\u4e2dneo4j\u76ee\u5f55\u7684plugins\u6587\u4ef6\u5939\u4e2d docker exec -it neo4j bash cp data/apoc-*.jar ./plugins/ #\u4fee\u6539conf/neo4j.conf\u914d\u7f6e\u6587\u4ef6\uff0c\u589e\u52a0\u5982\u4e0b\u4e24\u884c dbms.security.procedures.unrestricted=algo.* dbms.security.procedures.unrestricted=apoc.* #\u4fdd\u5b58\u540e\u91cd\u542f\u5bb9\u5668 docker restart neo4j","title":"\u793e\u533a\u7248\u642d\u5efa"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#_4","text":"\u7d22\u5f15\u5efa\u7acb\u662f\u975e\u5e38\u6709\u5fc5\u8981\u7684\uff0c\u4e00\u4e2a\u7d22\u5f15\u53ef\u4ee5\u5f88\u5927\u7a0b\u5ea6\u4e0a\u964d\u4f4e\u5927\u89c4\u6a21\u6570\u636e\u7684\u67e5\u8be2\u901f\u5ea6\u3002\uff08\u5728\u5bf9\u8282\u70b9\u6309\u7167name\u5c5e\u6027\u5efa\u7acb\u4e86\u7d22\u5f15\u4e4b\u540e\uff0c\u622a\u6b62\u6211\u5199\u8fd9\u7bc7blog\u7684\u65f6\u5019\uff0c\u6570\u636e\u91cf\u4e3a\u8282\u70b9600w+,\u5173\u7cfb1100w+\uff0c\u67e5\u8be2\u4e00\u4e2a\u8282\u70b9\u4ee5\u53ca\u76f8\u5173\u8054\u7684\u8282\u70b9\u5173\u7cfb\u6d88\u8017\u7684\u65f6\u95f4\u548c\u6570\u636e\u91cf\u5f88\u5c0f\u7684\u65f6\u5019\u51e0\u4e4e\u6ca1\u6709\u4ec0\u4e48\u5dee\u522b\uff0c\u57fa\u672c\u4e0a\u90fd\u7a33\u5b9a\u572816~20ms\u5de6\u53f3\u3002\u94fe\u63a5\uff1ahttps://www.jianshu.com/p/a2497a33390f \uff09 \u4ee5\u4e0b\u6d89\u53ca\u6027\u80fd\u7684\u6d4b\u8bd5\u76f8\u5173\u7684\u673a\u5668\u914d\u7f6e\u5982\u4e0b:32G\u5185\u5b58 8\u6838\u5904\u7406\u5668 \u673a\u68b0\u786c\u76d8","title":"\u4f7f\u7528"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#_5","text":"\u6279\u91cf\u521b\u5efa\u8282\u70b9\u91c7\u7528(\u7eaf\u65b0\u589e)\uff1a\u6279\u91cf\u521b\u5efa\u8282\u70b9\uff08\u6863\u6848\u8868\u8bfb\u53d6\uff09-\u63a8\u8350 \u6279\u91cf\u521b\u5efa\u8282\u70b9\u91c7\u7528(\u65b0\u589e\u4ee5\u53ca\u5305\u542b\u66f4\u65b0)\uff1a\u901a\u8fc7\u8bc1\u4ef6\u53f7\u5408\u5e76\u65b9\u5f0f\u521b\u5efa-\u589e\u91cf\u66f4\u65b0\u63a8\u8350 \u6279\u91cf\u521b\u5efa\u5173\u7cfb\u91c7\u7528\uff1a\u6839\u636e\u6237\u53f7\u521b\u5efa\u4e00\u5bb6\u4eba\u5173\u7cfb\u5b50\u56fe\u4e8b\u52a1\u65b9\u5f0f-\u63a8\u8350 \u6279\u91cf\u521b\u5efa\u5173\u7cfb\uff08\u590d\u6742\u7c7b\u578b\uff09\u91c7\u7528\uff1a\u901a\u8fc7apoc\u63d2\u4ef6\u6279\u91cf\u65b9\u5f0f\u521b\u5efa\u4eba\u8f66\u5173\u7cfb \u6279\u91cf\u5408\u5e76\u5b9e\u4f53\u8282\u70b9\u91c7\u7528\uff1a\u6839\u636e\u8bc1\u4ef6\u53f7\u7801\u5408\u5e76\u8282\u70b9-cypher\u65b9\u5f0f(\u4f9d\u8d56apoc\u63d2\u4ef6) \u6279\u91cf\u5408\u5e76\u91cd\u590d\u5173\u7cfb\uff08\u4e3b\u8981\u7531\u5408\u5e76\u8282\u70b9\u4ea7\u751f\uff09\uff1a\u5408\u5e76\u91cd\u590d\u5173\u7cfb-cypher\u65b9\u5f0f\uff08\u4f9d\u8d56apoc\u63d2\u4ef6\uff09","title":"\u6279\u91cf\u64cd\u4f5c\u6700\u4f73\u5b9e\u8df5"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#_6","text":"#python dependson:pip install py2neo from py2neo import Graph from py2neo.bulk import create_nodes g = Graph(connectionInfoParam...) keys = [\"name\", \"age\"] data = [ [\"Alice\", 33], [\"Bob\", 44], [\"Carol\", 55], ] create_nodes(g.auto(), data, labels={\"Person\"}, keys=keys) g.nodes.match(\"Person\").count()","title":"\u6279\u91cf\u521b\u5efa\u8282\u70b9"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#-","text":"\u5199\u51651\u4e07\u6761\u8017\u65f67\u79d2\uff0c\u5199\u5165\u64cd\u4f5c\u65f6\uff0c\u6d4b\u8bd5\u673a\u5668python\u548cjava\u8fdb\u7a0b\u7684cpu\u5360\u7528\u8f83\u9ad8\uff0c\u5185\u5b58\u5408\u8ba1\u5360\u75287GB\uff0c\u78c1\u76d8\u8bfb\u51991-3MB/S\uff0c\u521d\u6b65\u63a8\u6d4b\u9700\u8981\u63d0\u5347\u5199\u5165\u6027\u80fd\u7684\u8bdd\u9700\u8981\u5728cpu\u65b9\u9762\u6269\u5bb9\u3002 \u7ed3\u5408\u8f66\u8f86\u6863\u6848\u6570\u636e\u6d4b\u8bd5\u7ed3\u679c\uff1a21\u4e2a\u5b57\u6bb51\u4e07\u6761\u6570\u636e\u5199\u51654.5\u79d2 \uff08\u4eba\u7684\u6863\u684846\u4e2a\u5b57\u6bb57\u79d2\uff09\uff0c\u5c06\u5168\u91cf\u5b57\u6bb5\u653e\u5230\u6570\u636e\u4ed3\u5e93\u4e2d\uff0c\u56fe\u6570\u636e\u5e93\u4e2d\u53ea\u5b58\u5fc5\u8981\u7684\u67e5\u8be2\u4ee5\u53ca\u76f4\u63a5\u663e\u793a\u5b57\u6bb5\u53ef\u4ee5\u6709\u6548\u63d0\u5347\u5199\u5165\u901f\u5ea6\u3002 #py2neo \u7684bulk\u63a5\u53e3\u65b9\u5f0f from py2neo import Graph import psycopg2 from py2neo.bulk import create_nodes,merge_nodes from itertools import islice import time #\u8bfb\u53d6\u4eba\u5458\u6863\u6848\u6570\u636e db=psycopg2.connect(\"dbname=demo user=postgres password=password hostipaddress port=5432\") cur=db.cursor() keys=\"gmsfhm,xm,xbmc,mzmc,xxmc,jggjmc,jgssxmc,csdjgmc,csdssxmc,csdxz,hjdpcsmc,hjdxz,xzz,lxdh,zzmmmc,zw,zy,byzkmc,whcdmc,hyzkmc,zjxymc,hklxmc,hkxzmc,hh,yhzgxdm,yhzgxmc,fqgmsfhm,fqxm,mqgmsfhm,mqxm,pogmsfhm,poxm,idcard_url,province,city,country\" keyss=keys.split(',') limit=10_000 #\u56fa\u5b9a\u8bfb\u53d6N\u6761\u6570\u636e\u7528\u6765\u6d4b\u8bd5\u5408\u5e76\u8282\u70b9 # sqls=\"select \"+keys+\" from czrkjbxx order by hh limit \"+str(limit) #\u968f\u673a\u8bfb\u53d6N\u6761\u6570\u636e sqls=\"select \"+keys+\" from czrkjbxx order by hh asc offset floor(random()*1000) limit \"+str(limit) nodes=[] #\u8fde\u63a5neo4j graph = Graph(\"bolt://ipaddress:7687\", auth=(\"neo4j\", \"neo4jpassword\")) #\u591a\u5c11\u6761\u6570\u636e\u4fdd\u5b58\u4e00\u6b21 batch_size=10000 if batch_size>limit: batch_size=limit try: cur.execute(sqls) print('query:%s' % sqls) data=cur.fetchmany(batch_size) ta0=time.time() cnt=0 while data: cnt=cnt+1 print('load data size:%s' % len(data)) for d in data: p={'xm':''} for i in range(len(keyss)): p[keyss[i]]=d[i] nodes.append(p) if len(nodes)>=batch_size: #\u542f\u52a8\u8282\u70b9\u521b\u5efa ta=time.time() create_nodes(graph.auto(),nodes,labels={'Person'}) nodes.clear() print(\"\u63d0\u4ea4 %s \u6b21\uff0c\u8017\u65f6:%s\u79d2\" % (cnt,round(time.time()-ta))) #\u542f\u52a8\u4e00\u4e2a\u81ea\u52a8\u63d0\u4ea4\u7684\u4e8b\u52a1 if len(nodes)>0: create_nodes(graph.auto(),nodes,labels={'Person'}) nodes.clear() data=cur.fetchmany(batch_size) except(IOError): print('\u53d1\u751f\u9519\u8bef') print(\"neo4j\u4e2d\u6709%s\u6761\u6570\u636e,\u603b\u8017\u65f6:%s\u79d2\" % (str(graph.nodes.match('Person').count()),round(time.time()-ta0))) cur.close() db.close()","title":"\u6279\u91cf\u521b\u5efa\u8282\u70b9\uff08\u6863\u6848\u8868\u8bfb\u53d6\uff09-\u7eaf\u65b0\u589e\u63a8\u8350"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#-_1","text":"1\u4e07\u6761\u8017\u65f6283\u79d2 from py2neo import Graph import psycopg2 from py2neo.bulk import create_nodes,merge_nodes from itertools import islice import time #\u8bfb\u53d6\u4eba\u5458\u6863\u6848\u6570\u636e db=psycopg2.connect(\"dbname=demo user=postgres password=password host=ip port=5432\") cur=db.cursor() keys=\"gmsfhm,xm,xbmc,mzmc,xxmc,jggjmc,jgssxmc,csdjgmc,csdssxmc,csdxz,hjdpcsmc,hjdxz,xzz,lxdh,zzmmmc,zw,zy,byzkmc,whcdmc,hyzkmc,zjxymc,hklxmc,hkxzmc,hh,yhzgxdm,yhzgxmc,fqgmsfhm,fqxm,mqgmsfhm,mqxm,pogmsfhm,poxm,idcard_url,province,city,country\" keyss=keys.split(',') limit=10_000 #\u56fa\u5b9a\u8bfb\u53d6N\u6761\u6570\u636e\u7528\u6765\u6d4b\u8bd5\u5408\u5e76\u8282\u70b9 # sqls=\"select \"+keys+\" from czrkjbxx order by hh limit \"+str(limit) #\u968f\u673a\u8bfb\u53d6N\u6761\u6570\u636e sqls=\"select \"+keys+\" from czrkjbxx order by hh asc offset floor(random()*1000) limit \"+str(limit) nodes=[] #\u8fde\u63a5neo4j graph = Graph(\"bolt://ip:7687\", auth=(\"neo4j\", \"password\")) #\u591a\u5c11\u6761\u6570\u636e\u4fdd\u5b58\u4e00\u6b21 batch_size=10000 if batch_size>limit: batch_size=limit try: cur.execute(sqls) print('query:%s' % sqls) data=cur.fetchmany(batch_size) ta0=time.time() cnt=0 while data: cnt=cnt+1 print('load data size:%s' % len(data)) for d in data: p={'xm':''} for i in range(len(keyss)): p[keyss[i]]=d[i] nodes.append(p) if len(nodes)>=batch_size: #\u542f\u52a8\u8282\u70b9\u521b\u5efa ta=time.time() merge_nodes(graph.auto(),nodes,('Person','gmsfhm'),labels={'Person'}) nodes.clear() print(\"\u63d0\u4ea4 %s \u6b21\uff0c\u8017\u65f6:%s\u79d2\" % (cnt,round(time.time()-ta))) #\u542f\u52a8\u4e00\u4e2a\u81ea\u52a8\u63d0\u4ea4\u7684\u4e8b\u52a1 if len(nodes)>0: merge_nodes(graph.auto(),nodes,('Person','gmsfhm'),labels={'Person'}) nodes.clear() data=cur.fetchmany(batch_size) except(IOError): print('\u53d1\u751f\u9519\u8bef') print(\"neo4j\u4e2d\u6709%s\u6761\u6570\u636e,\u603b\u8017\u65f6:%s\u79d2\" % (str(graph.nodes.match('Person').count()),round(time.time()-ta0))) cur.close() db.close()","title":"\u901a\u8fc7\u8bc1\u4ef6\u53f7\u5408\u5e76\u65b9\u5f0f\u521b\u5efa-\u589e\u91cf\u66f4\u65b0\u63a8\u8350"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#apoc","text":"\u5199\u51651000\u6761\u8017\u65f6217\u79d2\uff0c\u4e0d\u63a8\u8350 #\u901a\u8fc7apoc\u63d2\u4ef6\u6279\u91cf\u521b\u5efa from py2neo import Graph import psycopg2 from itertools import islice import time import simplejson def custJson(d): s=\"{\" if len(d)>0: for k in d: if d[k]: s=s+k+':\"'+d[k]+'\",' else: s=s+k+':\"\",' if len(s)>2: return s[0:-1]+'}' else: return '{}' else: return '{}' #\u8bfb\u53d6\u4eba\u5458\u6863\u6848\u6570\u636e db=psycopg2.connect(\"dbname=demo user=postgres password=password host=ip port=5432\") cur=db.cursor() keys=\"gmsfhm,xm,xbmc,mzmc,xxmc,jggjmc,jgssxmc,csdjgmc,csdssxmc,csdxz,hjdpcsmc,hjdxz,xzz,lxdh,zzmmmc,zw,zy,byzkmc,whcdmc,hyzkmc,zjxymc,hklxmc,hkxzmc,hh,yhzgxmc,fqgmsfhm,fqxm,mqgmsfhm,mqxm,pogmsfhm,poxm,idcard_url,province,city,country\" keyss=keys.split(',') limit=1_000 #\u56fa\u5b9a\u8bfb\u53d6N\u6761\u6570\u636e\u7528\u6765\u6d4b\u8bd5\u5408\u5e76\u8282\u70b9 # sqls=\"select \"+keys+\" from czrkjbxx order by hh limit \"+str(limit) #\u968f\u673a\u8bfb\u53d6N\u6761\u6570\u636e sqls=\"select \"+keys+\" from czrkjbxx order by hh asc offset floor(random()*1000) limit \"+str(limit) nodes=\"[\" #\u8fde\u63a5neo4j graph = Graph(\"bolt://ip:7687\", auth=(\"neo4j\", \"password\")) #\u591a\u5c11\u6761\u6570\u636e\u4fdd\u5b58\u4e00\u6b21 batch_size=1000 cnt=0 try: cur.execute(sqls) data=cur.fetchall() for d in data: p={'xm':''} for i in range(len(keyss)): p[keyss[i]]=d[i] nodes=nodes+custJson(p)+',' cnt=cnt+1 # print(nodes) if cnt>=batch_size: #\u542f\u52a8\u8282\u70b9\u521b\u5efa ta=time.time() graph.run('call apoc.create.nodes([\"Person\"],%s)' % (nodes[0:-1]+']')) nodes='[' cnt=0 print('\u8017\u65f6:%s' % ((time.time()-ta))) #\u542f\u52a8\u4e00\u4e2a\u81ea\u52a8\u63d0\u4ea4\u7684\u4e8b\u52a1 if cnt>0: graph.run('call apoc.create.nodes([\"Person\"],%s)' % (nodes[0:-1]+']')) nodes='[' cnt=0 # merge_nodes(graph.auto(),) except(IOError): print('\u53d1\u751f\u9519\u8bef') print(\"neo4j\u4e2d\u6709%s\u6761\u6570\u636e,\u603b\u8017\u65f6:%s\" % (str(graph.nodes.match('Person').count()),round(time.time()-ta))) cur.close() db.close()","title":"\u901a\u8fc7apoc\u63d2\u4ef6\u6279\u91cf\u521b\u5efa\u8282\u70b9"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#_7","text":"\u8017\u65f6\u548cpy2neo\u7684\u6279\u91cf\u63a5\u53e3create_nodes\u57fa\u672c\u4e00\u6837 #\u901a\u8fc7subgraph\u52a0\u4e8b\u52a1\u6279\u91cf\u521b\u5efa\u8282\u70b9 from py2neo import Graph,Node,Subgraph import psycopg2 from itertools import islice import time import simplejson def custJson(d): s=\"{\" if len(d)>0: for k in d: if d[k]: s=s+k+':\"'+d[k]+'\",' else: s=s+k+':\"\",' if len(s)>2: return s[0:-1]+'}' else: return '{}' else: return '{}' #\u8bfb\u53d6\u4eba\u5458\u6863\u6848\u6570\u636e db=psycopg2.connect(\"dbname=demo user=postgres password=password host=ip port=5432\") cur=db.cursor() keys=\"gmsfhm,xm,xbmc,mzmc,xxmc,jggjmc,jgssxmc,csdjgmc,csdssxmc,csdxz,hjdpcsmc,hjdxz,xzz,lxdh,zzmmmc,zw,zy,byzkmc,whcdmc,hyzkmc,zjxymc,hklxmc,hkxzmc,hh,yhzgxmc,fqgmsfhm,fqxm,mqgmsfhm,mqxm,pogmsfhm,poxm,idcard_url,province,city,country\" keyss=keys.split(',') limit=10_000 #\u56fa\u5b9a\u8bfb\u53d6N\u6761\u6570\u636e\u7528\u6765\u6d4b\u8bd5\u5408\u5e76\u8282\u70b9 # sqls=\"select \"+keys+\" from czrkjbxx order by hh limit \"+str(limit) #\u968f\u673a\u8bfb\u53d6N\u6761\u6570\u636e sqls=\"select \"+keys+\" from czrkjbxx order by hh asc offset floor(random()*1000) limit \"+str(limit) nodes=\"[\" #\u8fde\u63a5neo4j graph = Graph(\"bolt://ipaddress:7687\", auth=(\"neo4j\", \"password\")) tx = graph.begin() nodes=[] cur.execute(sqls) data=cur.fetchall() ta=time.time() for line in data: oneNode = Node() for ki in range(len(keyss)): k=keyss[ki] oneNode[k]=line[ki] nodes.append(oneNode) nodes=Subgraph(nodes) tx.create(nodes) tx.commit() print('\u8017\u65f6:%s' % ((time.time()-ta)))","title":"\u901a\u8fc7\u5b50\u56fe\u65b9\u5f0f\u6279\u91cf\u521b\u5efa\u8282\u70b9"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#-cypherapoc","text":"2\u4e07\u6761\u6570\u636e\uff0c\u5b9e\u9645\u67091\u4e07\u6761\u4e0d\u91cd\u590d\u6570\u636e\uff0c\u6267\u884c\u8017\u65f62\u79d2\uff0c\u63a8\u8350 190\u4e07\u6570\u636e\u5b9e\u9645\u4e0d\u91cd\u590d\u7684100\u4e07\uff0c\u6267\u884c\u65f6\u95f44\u79d2 --cypher \u8bed\u6cd5\u5b9e\u73b0 match(p:Person) with p.gmsfhm as sfz,collect(p) as nodelist,count(*) as cnt where cnt>1 call apoc.refactor.mergeNodes(nodelist,{properties:\"combine\",mergeRels:true}) yield node return node","title":"\u6839\u636e\u8bc1\u4ef6\u53f7\u7801\u5408\u5e76\u8282\u70b9-cypher\u65b9\u5f0f(\u4f9d\u8d56apoc\u63d2\u4ef6)"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#-cypherapoc_1","text":"MATCH (a:Person)-[r:rel]-(b:Person) WITH a, b, collect(r) as rels CALL apoc.refactor.mergeRelationships(rels) YIELD rel RETURN count(rel) --\u5982\u679c\u6709\u592a\u591a\u91cd\u590d\u6570\u636e\u6700\u597d\u6bcf\u6b21\u53ea\u5904\u7406\u4e00\u90e8\u5206\uff0c\u907f\u514d\u5168\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u9020\u6210\u5185\u5b58\u6ea2\u51fa\uff0c\u5982\u4e0b match(p:Person) with p.gmsfhm as sfz,collect(p) as nodelist,count(*) as cnt where cnt>1 call apoc.refactor.mergeNodes(nodelist) yield node return node limit 10000 --\u67e5\u8be2\u6709\u591a\u5c11\u7ec4\u91cd\u590d\u6570\u636e match(p:Person) with p.gmsfhm as sfz,collect(p) as nodelist,count(*) as cnt where cnt>1 return count(nodelist)","title":"\u5408\u5e76\u91cd\u590d\u5173\u7cfb-cypher\u65b9\u5f0f\uff08\u4f9d\u8d56apoc\u63d2\u4ef6\uff09"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#-python","text":"2\u4e07\u6761\u6570\u636e\uff0c\u5b9e\u9645\u67091\u4e07\u6761\u4e0d\u91cd\u590d\u6570\u636e\uff0c\u6267\u884c\u8017\u65f6365\u79d2\uff0c\u4e0d\u63a8\u8350 #\u5408\u5e76 from py2neo import Graph import time from py2neo.bulk import create_nodes,merge_nodes graph = Graph(\"bolt://ip:7687\", auth=(\"neo4j\", \"password\")) print(\"count:\"+str(graph.nodes.match('Person').count())) nodes=graph.nodes.match('Person') # mdata=[] # for n in nodes: # mdata.append({'gmsfhm':n['gmsfhm']}) # print(mdata[0]) ta=time.time() merge_nodes(tx=graph.auto(),data=nodes,merge_key=('Person','gmsfhm')) print(\"using time:\"+str(round(time.time()-ta))) print(\"count:\"+str(graph.nodes.match('Person').count()))","title":"\u6839\u636e\u8bc1\u4ef6\u53f7\u5408\u5e76\u8282\u70b9-python\u65b9\u5f0f"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#cql","text":"CREATE INDEX ON:Person(hh) --\u521b\u5efa\u591a\u5b57\u6bb5\u7684\u8bdd\u4f7f\u7528\u65f6\u5019\u5fc5\u987b\u4e5f\u4f20\u591a\u5b57\u6bb5 CREATE INDEX ON:Person(gmsfhm) --\u67e5\u770b\u7d22\u5f15 :schema --\u5220\u9664\u7d22\u5f15 DROP INDEX ON :Person(gmsfhm,hh)","title":"\u7d22\u5f15\uff08cql\uff09"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#-_2","text":"\u8017\u65f60.04\u79d2\uff0c\u5b9e\u6d4b\u91cd\u590d\u6267\u884c\u4e0d\u4f1a\u5bfc\u81f4\u5efa\u7acb\u591a\u4e2a\u91cd\u590d\u5173\u7cfb #\u6839\u636e\u6237\u53f7\u521b\u5efa\u4e00\u5bb6\u4eba\u7684\u5173\u7cfb-\u5b50\u56fe\u4e8b\u52a1\u65b9\u5f0f(\u63a8\u8350) from py2neo import Graph,Relationship,Subgraph import time from py2neo.matching import * graph = Graph(\"bolt://ip:7687\", auth=(\"neo4j\", \"password\")) nodeM=NodeMatcher(graph) #\u627e\u4e00\u5bb6\u4eba hh='361024002267449' nodes=nodeM.match('Person',hh=hh).all() hz=nodeM.match('Person',hh=hh,yhzgxdm='02').first() print(hz) if hz: print('\u5bb6\u4eba\u6570\u91cf:%s' % len(nodes)) ta=time.time() mData=[] tx = graph.begin() for n in nodes: if n['yhzgxdm']!='02': mData.append(Relationship(hz,'rel',n,relation=n['yhzgxmc'])) if len(mData)>0: A=Subgraph(relationships=mData) graph.create(A) tx.commit() print('over time:%s' % ((time.time()-ta))) else: print('\u6ca1\u6709\u6237\u4e3b\u7684\u975e\u6cd5\u6570\u636e')","title":"\u6839\u636e\u6237\u53f7\u521b\u5efa\u4e00\u5bb6\u4eba\u5173\u7cfb\u5b50\u56fe\u4e8b\u52a1\u65b9\u5f0f-\u63a8\u8350"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#_8","text":"\u8017\u65f6183\u79d2(\u4e0d\u63a8\u8350\u4f7f\u7528\uff0c\u4fdd\u7559\u4e0b\u6765\u4f5c\u4e3a\u5176\u4ed6\u53ef\u80fd\u573a\u666f\u7684\u5e94\u7528) #\u6839\u636e\u6237\u53f7\u521b\u5efa\u4e00\u5bb6\u4eba\u7684\u5173\u7cfb from py2neo import Graph import time from py2neo.bulk import create_nodes,merge_nodes,create_relationships from py2neo.matching import * graph = Graph(\"bolt://ip:7687\", auth=(\"neo4j\", \"password\")) nodeM=NodeMatcher(graph) #\u627e\u4e00\u5bb6\u4eba hh='110101007156971' nodes=nodeM.match('Person',hh=hh).all() print('\u5bb6\u4eba\u6570\u91cf:%s' % len(nodes)) rels=\"38,68,10,45,51,63,52,99\".split(',') relsmc=\"\u513f\u5ab3,\u914d\u5076\u7684\u66fe\u7956\u7236\u6bcd,\u914d\u5076,(\u5916)\u5b59\u5ab3\u5987,\u7236\u4eb2,\u5916\u7956\u7236,\u6bcd\u4eb2,\u8fc1\u51fa\u6216\u6b7b\u4ea1\".split(',') ta=time.time() mData=[] for rel in range(len(rels)): relItem=rels[rel] relmcItem=relsmc[rel] print('relItem:%s mc:%s' % (relItem,relmcItem)) query=\"MATCH (p:Person{hh:'%s',yhzgxdm:'02'}),(p2:Person{hh:'%s',yhzgxdm:'%s'}) where p2['gmsfhm'] is not null MERGE (p)-[:rel{relation:'%s'}]->(p2)\" % (hh,hh,relItem,relmcItem) print(\"query:%s\" % query) graph.run(query) print('over use time:%s r:%s' % (round(time.time()-ta),r))","title":"\u6839\u636e\u6237\u53f7\u521b\u5efa\u4e00\u5bb6\u4eba\u7684\u5173\u7cfb(\u4e0d\u63a8\u8350\uff0c\u4ec5\u4f9b\u53c2\u8003)"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#apoc_1","text":"\u6b64\u65b9\u6cd5\u53ef\u4ee5\u907f\u514d\u540c\u65f6\u64cd\u4f5c\u6570\u636e\u8fc7\u591a\u5e26\u6765\u7684\u5185\u5b58\u6ea2\u51fa\u7b49\u95ee\u9898\u3002 call apoc.periodic.iterate(\"match(v:Vehicle) return v\",\"match(p:Person{gmsfhm:v.sfzmhm}) merge (p)-[:car {relation:'\u8f66\u4e3b'}]->(v) return v\",{batchSize:10000,parallel:true})","title":"\u901a\u8fc7apoc\u63d2\u4ef6\u6279\u91cf\u65b9\u5f0f\u521b\u5efa\u4eba\u8f66\u5173\u7cfb"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#n-cypher","text":"--\u67e5\u8be2idcard\u4e3a'idcard'\u7684\u4eba\u4e3a\u4e3b\u4f53\uff0c\u5e76\u8fd4\u56de\u51763\u5c42\u5173\u7cfb\u4eba\u4ee5\u53ca\u5173\u7cfb\u6570\u636e match data=(na:Person{idcard:'idcard'})-[*1..3]-(nb:Person) return data","title":"\u6839\u636e\u6307\u5b9a\u6761\u4ef6\u67e5\u8be2N\u5c42\u5173\u7cfb\u4eba\u4ee5\u53ca\u5173\u7cfb\u6570\u636e-cypher\u65b9\u5f0f"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#_9","text":"call apoc.periodic.iterate(\"match(p:Person) return p\",\"delete p return p\",{batchSize:10000, parallel:true})","title":"\u907f\u514d\u5185\u5b58\u6ea2\u51fa\u7684\u6e05\u7406\u6570\u636e\uff08\u5371\u9669\uff01\uff01\uff01\uff09"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#cypherlabel","text":"match data=(na:Person)-[*1..3]-(nb) where any(label in labels(nb) WHERE label in ['Qb', 'Person']) and na.gmsfhm='123456' return data limit 100","title":"cypher\u5c06Label\u6807\u7b7e\u4f5c\u4e3a\u67e5\u8be2\u6761\u4ef6"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/neo4j/#cypher","text":"--\u67e5\u8be2idcard\u4e3a'123456'\u7684\u4eba\u4e3a\u4e3b\u4f53\uff0c\u5173\u7cfb\u4e3arel1\u548crel2 \u8282\u70b9\u6807\u7b7e\u4e3alabel1\u548clabel2 \u4e141-3\u5c42\u7684\u5173\u7cfb\u6570\u636e match data=(na:Person)-[:rel1|rel2*1..3]-(nb) where na.gmsfhm in ['123456']and any(label in labels(nb) WHERE label in ['label1','label2']) return data","title":"cypher\u5c06\u591a\u5173\u7cfb\u3001\u591a\u6807\u7b7e\u548c\u53ef\u53d8\u6b65\u957f\u4f5c\u4e3a\u67e5\u8be2\u6761\u4ef6"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/pipelinedb/","text":"pipelinedb\u6d41\u5f0f\u6570\u636e\u5e93\u4ecb\u7ecd PipelineDB\u662f\u4e00\u4e2a\u7528\u4e8e\u5728\u65f6\u5e8f\u6570\u636e\u4e0a\u6301\u7eed\u6267\u884cSQL\u67e5\u8be2\u7684\u9ad8\u6027\u80fdPostgreSQL\u63d2\u4ef6\u3002SQL\u67e5\u8be2\u7684\u8f93\u51fa\u88ab\u6301\u4e45\u5316\u5230\u666e\u901a\u7684\u8868\u4e2d\uff0c\u53ef\u4ee5\u50cf\u5176\u5b83\u7684\u8868\u6216\u89c6\u56fe\u4e00\u6837\u8fdb\u884c\u67e5\u8be2\u3002\u53ef\u4ee5\u8ba4\u4e3a\u6301\u7eed\u67e5\u8be2\u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u9ad8\u541e\u5410\u91cf\u5e76\u4e14\u5feb\u901f\u66f4\u65b0\u7684\u7269\u5316\u89c6\u56fe\u3002PipelineDB\u53ef\u4ee5\u5728\u67d0\u4e9b\u4efb\u52a1\u573a\u666f\u4e0b\u8868\u73b0\u5f97\u5341\u5206\u4f18\u79c0\uff0c\u82e5\u8d85\u51fa\u8fd9\u4e2a\u8303\u7574\uff0c\u53ef\u80fd\u5c31\u4f1a\u540c\u5176\u5b83\u6570\u636e\u5904\u7406\u7cfb\u7edf\u4e00\u6837\u9762\u4e34\u4e00\u4e9b\u95ee\u9898\u3002 pipelinedb\u8fd0\u884c\u539f\u7406 \u6bd4\u5982\u8bf4\u6211\u4eec\u7528\u8fd9\u4e2apipelinedb\u662f\u8981\u505a\u4e00\u4ef6\u4e8b\uff1a\u6211\u4eec\u8981\u591a\u7ef4\u5ea6\u5b9e\u65f6\u7edf\u8ba1\u4e00\u4e2a\u5927\u6570\u636e\u96c6\uff0c\u4f20\u7edf\u65b9\u6cd5\u662f\u628a\u6570\u636e\u5b58\u5230\u8868\u4e2d\uff0c\u67e5\u8868\u7edf\u8ba1\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u592a\u6162\u4e86\uff0c\u4e8e\u662f\u4f60\u5c31\u9700\u8981\u7528\u5230pipelinedb\u4e86\uff0c\u5b83\u7701\u53bb\u4e86\u4f60\u628a\u6570\u636e\u5b58\u5165\u8868\u4e2d\u7684\u8fd9\u4e2a\u6b65\u9aa4\uff0c\u901a\u8fc7\u4e00\u4e2a\u7c7b\u4f3c\u7ba1\u9053\u7684\u4e1c\u897f\u628a\u6570\u636e\u4ea4\u7ed9\u5185\u5b58\u6765\u76f4\u63a5\u8ba1\u7b97\uff0c\u53ea\u4fdd\u5b58\u7edf\u8ba1\u7ed3\u679c\uff0c\u8fc7\u7a0b\u975e\u5e38\u5feb\uff0c\u4e0e\u5404\u79cd\u7edf\u8ba1\u9700\u6c42\u662f\u7edd\u914d\u3002 \u5b98\u65b9\u6587\u6863\uff1ahttps://pipelinedb-doc-cn.readthedocs.io/zh_CN/latest/introduction.html PipelineDB\u7684\u957f\u5904 PipelineDB\u88ab\u8bbe\u8ba1\u7528\u6765\u5728\u7cbe\u7b80\u540e\u7684\u6d41\u5f0f\u6570\u636e\u96c6\u4e0a\u8fdb\u884cSQL\u67e5\u8be2\u3002\u6bd4\u5982\uff1a\u6982\u8981\u548c\u805a\u5408\uff1b\u57fa\u4e8e\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\u7684\u6027\u80fd\u8ba1\u7b97\uff1b\u6587\u672c\u7d22\u5f15\u548c\u8fc7\u6ee4\uff1b\u7a7a\u95f4\u4fe1\u606f\u8fc7\u6ee4\u7b49\u3002\u901a\u8fc7\u51cf\u5c11\u6d41\u6570\u636e\u7684\u8f93\u5165\uff0cPipelineDB\u53ef\u4ee5\u663e\u8457\u5730\u51cf\u5c11\u6301\u4e45\u5316\u5230\u78c1\u76d8\u4e2d\u7684\u6570\u636e\u91cf\uff0c\u56e0\u4e3a\u4e4b\u540e\u805a\u5408\u540e\u7684\u7ed3\u679c\u88ab\u5b58\u50a8\u4e0b\u6765\u3002\u539f\u59cb\u6570\u636e\uff08foreign table\uff09\u4e00\u65e6\u88ab\u9700\u8981\u5b83\u7684\u6301\u7eed\u67e5\u8be2\u8bfb\u53d6\u540e\u5c31\u4f1a\u88ab\u9500\u6bc1\u3002 \u5927\u591a\u6570\u5199\u5165\u5230PipelineDB\u4e2d\u7684\u6570\u636e\u53ef\u4ee5\u88ab\u89c6\u4e3a \u865a\u62df\u6570\u636e\u3002\u6570\u636e\u865a\u62df\u5316\u662fPipelineDB\u8bbe\u8ba1\u7684\u7cbe\u9ad3\uff0c\u51ed\u7740\u8fd9\u79cd\u8bbe\u8ba1\uff0cPipelineDB\u53ef\u4ee5\u53ea\u5360\u7528\u8f83\u5c0f\u7684\u786c\u4ef6\u8d44\u6e90\u5b9e\u73b0\u9ad8\u6548\u7684\u5927\u6570\u636e\u91cf\u5904\u7406\u3002 PipelineDB\u7684\u76ee\u6807\u662f\u6d88\u9664\u8bb8\u591a\u6570\u636e\u4f20\u8f93\u4e2d\u7684ETL\u8fc7\u7a0b\u3002\u539f\u59cb\u6570\u636e\u6d41\u5f0f\u5199\u5165PipelineDB\uff0c\u88ab\u5df2\u58f0\u660e\u7684\u6d41\u5f0f\u67e5\u8be2\u5b9e\u65f6\u5730\u8f6c\u6362\u548c\u63d0\u53d6\uff0c\u8fd9\u4f7f\u5f97\u5b83\u5728\u5c06\u6210\u578b\u7684\u8f93\u51fa\u52a0\u8f7d\u5230\u6570\u636e\u5e93\u524d\u4e0d\u5fc5\u5468\u671f\u6027\u5730\u5904\u7406\u9897\u7c92\u6570\u636e\uff0c\u524d\u63d0\u662f\u8fd9\u4e9b\u5904\u7406\u8fc7\u7a0b\u53ef\u4ee5\u901a\u8fc7SQL\u5b9a\u4e49\u3002 \u5728PipelineDB\u7684\u8bbe\u8ba1\u7406\u5ff5\u4e2d\uff0c\u5b9e\u7528\u6027\u662f\u7b2c\u4e00\u8981\u7d20\uff0c\u8fd9\u4e5f\u662f\u6211\u4eec\u5c06\u5176\u5305\u88c5\u4e3aPostgreSQL\u63d2\u4ef6\u7684\u539f\u56e0\u3002\u6240\u6709\u6570\u636e\u5b58\u50a8\u548c\u5904\u7406\u90fd\u4ea4\u7531PostgreSQL\uff1a\u4e00\u4e2a\u6781\u5176\u7a33\u5b9a\u3001\u6210\u719f\u4ee5\u53ca\u8fd0\u7528\u5e7f\u6cdb\u7684\u6570\u636e\u5e93\u3002\u6b64\u5916\uff0cPipelineDB\u517c\u5bb9\u6d3b\u8dc3\u7684PostgreSQL\u751f\u6001\u4e2d\u7684\u6240\u6709\u5de5\u5177\u3002\u6211\u4eec\u6ca1\u6709\u4e3aPipelineDB\u8bbe\u8ba1\u7279\u6709\u7684\u8bed\u6cd5\u751a\u81f3\u662f\u5ba2\u6237\u7aef\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u5f88\u597d\u5730\u517c\u5bb9\u4efb\u4f55\u57fa\u4e8ePostgreSQL\u5f00\u53d1\u7684\u5e93\u3002 PipelineDB\u7684\u77ed\u677f \u9274\u4e8e\u6d41\u67e5\u8be2\u9700\u8981\u4e00\u4e9b \u5148\u9a8c\u77e5\u8bc6\uff0cPipelineDB\u4e0d\u662f\u4e00\u4e2a\u7279\u5b9a\u7684\u6570\u636e\u4ed3\u5e93\u3002\u6d41\u5f0f\u67e5\u8be2\u7684\u8f93\u51fa\u53ef\u80fd\u5728\u7279\u5b9a\u65b9\u5f0f\u4e0b\u88ab\u8bbf\u95ee\uff0c\u6240\u6709\u5199\u5165\u5230PipelineDB\u4e2d\u7684\u539f\u59cb\u6570\u636e\u90fd\u4e0d\u4f1a\u88ab\u6301\u4e45\u5316\u56e0\u4e3a\u5b83\u4eec\u90fd\u4f1a\u5728\u8bfb\u53d6\u540e\u88ab\u9500\u6bc1\u3002\u6b64\u5916\uff0c\u5982\u679c\u6d41\u5f0f\u8ba1\u7b97\u4e0d\u80fd\u4ee5SQL\u7684\u5f62\u5f0f\u8868\u8fbe\uff0cPipelineDB\u53ef\u80fd\u5e76\u4e0d\u662f\u4e00\u4e2a\u5408\u9002\u7684\u9009\u62e9\uff01 \u529f\u80fd \u6d41\uff08foreign table\uff09 \u6d41\u662f\u4e00\u79cd\u5141\u8bb8\u5ba2\u6237\u7aef\u5c06\u65f6\u5e8f\u6570\u636e\u5199\u5165 \u6d41\u89c6\u56fe \u7684\u62bd\u8c61\u7ba1\u9053\u3002\u6d41\u91cc\u9762\u7684\u4e00\u884c\u6570\u636e\uff08\u6216\u8005\u7b80\u5355\u79f0\u4f5c event\uff09\uff0c\u4e0e\u6570\u636e\u8868\u4e2d\u7684\u884c\u6570\u636e\u662f\u5f88\u76f8\u4f3c\u7684\uff0c\u5e76\u4e14\u4e8c\u8005\u7684\u5199\u5165\u4e5f\u662f\u5b8c\u5168\u4e00\u81f4\u7684\u3002\u7136\u800c\uff0c\u6d41\u548c\u6570\u636e\u8868\u7684\u8bed\u4e49\u662f\u5b8c\u5168\u4e0d\u540c\u7684\u3002 \u6362\u8a00\u4e4b\uff0cevent \u53ea\u4f1a\u5728\u88ab\u6240\u6709\u7684 \u6d41\u89c6\u56fe \u6d88\u8d39\u5b8c\u4e4b\u524d\u201c\u5b58\u5728\u201d\u4e8e\u6d41\u4e2d\u3002\u5373\u4f7f\u8fd9\u6837\uff0c\u7528\u6237\u4ecd\u7136\u4e0d\u80fd\u76f4\u63a5\u4ece\u6d41\u4e2d SELECT \u6570\u636e\u3002\u6d41\u552f\u4e00\u7684\u4f5c\u7528\u5c31\u662f\u5145\u5f53 \u6d41\u89c6\u56fe \u7684\u8f93\u5165\u3002 \u6d41\u89c6\u56fe \u6d41\u89c6\u56fe\uff08continuous view\uff09\u662fPipelineDB\u7684\u57fa\u7840\u6982\u5ff5\u62bd\u8c61\u3002\u6d41\u89c6\u56fe\u8ddf\u666e\u901a\u7684\u6570\u636e\u5e93\u89c6\u56fe\u975e\u5e38\u76f8\u4f3c\uff0c\u4f46\u5b83\u662f\u5c06\u6d41\u548c\u8868\u4e2d\u7684\u6570\u636e\u7ec4\u5408\u540e\u4f5c\u4e3a\u8f93\u5165\u5e76\u8fdb\u884c\u5b9e\u65f6\u589e\u91cf\u66f4\u65b0\u3002 \u6d41\u6570\u636e\u4e00\u65e6\u88ab\u6d41\u89c6\u56fe\u8bfb\u53d6\u540e\u5c31\u4f1a\u88ab\u9500\u6bc1\uff0c\u6d41\u6570\u636e\u4e0d\u4f1a\u5b58\u50a8\u5728\u4efb\u4f55\u5730\u65b9\u3002\u53ea\u6709\u8bf8\u5982 SELECT * FROM that_view \u67e5\u8be2\u8fd4\u56de\u7684\u7ed3\u679c\u624d\u4f1a\u88ab\u6301\u4e45\u5316\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6d41\u89c6\u56fe\u53ef\u4ee5\u88ab\u89c6\u4e3a\u9ad8\u541e\u5410\u91cf\u3001\u5b9e\u65f6\u7684\u7269\u5316\u89c6\u56fe\u3002 \u6d41\u8f6c\u6362 \u6d41\u8f6c\u6362\u53ef\u4ee5\u5728\u4e0d\u5b58\u50a8\u65f6\u5e8f\u7684\u60c5\u51b5\u4e0b\u5bf9\u5176\u8fdb\u884c\u5b9e\u65f6\u8f6c\u6362\u3002\u7531\u4e8e\u6570\u636e\u4e0d\u5b58\u50a8\u6570\u636e\uff0c\u6240\u4ee5\u6d41\u8f6c\u6362\u4e0d\u652f\u6301\u805a\u5408\u64cd\u4f5c\u3002\u8f6c\u6362\u540e\u7684\u6570\u636e\u65e2\u53ef\u4ee5\u4f5c\u4e3a\u53e6\u4e00\u4e2a\u6d41\u7684\u8f93\u5165\uff0c\u4e5f\u53ef\u4ee5\u5199\u5165\u5230\u5916\u90e8\u6570\u636e\u5b58\u50a8\u4e2d\u3002 \u6d41\u805a\u5408 PipelineDB\u6700\u6838\u5fc3\u7684\u8ffd\u6c42\u4e4b\u4e00\u5c31\u662f \u4fc3\u8fdb\u9ad8\u6027\u80fd\u7684\u8fde\u7eed\u805a\u5408\uff0c\u6240\u4ee5\u805a\u5408\u51fd\u6570\u6beb\u65e0\u7591\u95ee\u662fPipelineDB\u7684\u6838\u5fc3\u529f\u80fd\u3002\u8fde\u7eed\u805a\u5408\u5728\u5927\u591a\u6570\u901a\u7528\u573a\u666f\u662f\u975e\u5e38\u6709\u7528\u7684\uff0c\u5b83\u4f7f\u5f97PipelineDB\u4e2d\u6301\u4e45\u5316\u7684\u6570\u636e\u59cb\u7ec8\u4e0e\u5199\u5165\u7684\u6570\u636e\u4fdd\u6301\u540c\u6b65\u3002\u5b83\u53ef\u4ee5\u901a\u8fc7\u4e00\u5b9a\u7684\u786c\u4ef6\u5b9e\u73b0\u7a33\u5b9a\u548c\u9ad8\u541e\u5ea6\u91cf\u7684\u670d\u52a1\u3002 \u8fde\u7eed\u805a\u5408\u662f\u968f\u7740\u6d41\u89c6\u56fe\u65b0 event \u7684\u751f\u6210\u5b9e\u65f6 \u589e\u91cf\u66f4\u65b0\u7684\u3002\u5bf9\u4e8e\u5982 count \u548c sum \u4e4b\u7c7b\u7684\u7b80\u5355\u805a\u5408\uff0c\u6211\u4eec\u5f88\u5bb9\u6613\u7406\u89e3\u7ed3\u679c\u662f\u5982\u4f55\u589e\u91cf\u66f4\u65b0\u7684\u2013\u5c06\u65b0\u503c\u7d2f\u52a0\u5230\u5df2\u6709\u7ed3\u679c\u4e0a\u800c\u5df2\u3002 \u4f46\u5bf9\u66f4\u52a0\u590d\u6742\u7684\u805a\u5408\u800c\u8a00\uff0c\u5982 avg, stddev, percentile_cont \u7b49\uff0c\u9700\u8981\u66f4\u4f18\u5316\u7684\u67b6\u6784\u6765\u652f\u6301\u9ad8\u6548\u7684\u589e\u91cf\u66f4\u65b0\uff0cPipelineDB\u5728\u5185\u90e8\u81ea\u52a8\u5b9e\u73b0\u4e86\u8fd9\u4e9b\u590d\u6742\u7684\u903b\u8f91\u3002 \u6d41\u5173\u8054 \u6d41\u89c6\u56fe \u7684\u5e76\u975e\u53ea\u9760select \u6d41\uff08foreign table\uff09 \u4ea7\u751f\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5c06\u8f93\u5165\u7684\u65f6\u5e8f\u6570\u636e\u548c\u9759\u6001\u7684PipelineDB\u6570\u636e\u8868\u7ec4\u5408\u540e\u5f97\u5230\uff0c\u8fd9\u53ef\u4ee5\u7528\u79f0\u4f5c\u6d41-\u8868\u5173\u8054\u7684\u65b9\u5f0f\u5b9e\u73b0\u3002 \u6d41-\u8868\u5173\u8054 \u6d41-\u8868\u5173\u8054\u5728 event\u5230\u8fbe\u65f6 \u5c06\u5176\u4e0e\u8868\u4e2d\u5339\u914d\u7684\u884c\u6570\u636e\u7ec4\u5408\u3002\u6362\u8a00\u4e4b\uff0c\u5982\u679c\u5728\u8868\u6570\u636e\u5728 event \u88ab\u8bfb\u53d6\u540e\u624d\u88ab\u63d2\u5165\uff0c\u5373\u4f7f\u662f\u5339\u914d\u7684\uff0c\u4e5f\u4e0d\u4f1a\u5bf9\u6d41\u89c6\u56fe\u4ea7\u751f\u5f71\u54cd\u3002\u65b0\u6570\u636e\u53ea\u4f1a\u5728 event\u88ab\u8bfb\u53d6\u65f6 \u4ea7\u751f\u3002\u5373\u4f7f\u6d41-\u8868\u5173\u8054\u4e2d\u7684\u8868\u88ab\u6e05\u7a7a\u4e86\uff0c\u6d41\u89c6\u56fe\u4e2d\u7684\u6570\u636e\u4e5f\u4e0d\u4f1a\u53d8\u5316\u3002 \u6d41-\u6d41\u5173\u8054 \u76ee\u524d\u4e0d\u652f\u6301\u6d41\u4e4b\u95f4\u7684\u5173\u8054\uff0c\u8fd9\u4e2a\u529f\u80fd\u53ef\u80fd\u4f1a\u51fa\u73b0\u5728\u5c06\u6765\u7684\u7248\u672c\u4e2d\u3002 \u8bd1\u8005\u6ce8\uff1a 2019\u5e745\u67081\u65e5\uff0cPipelineDB\u516c\u53f8\u5ba3\u5e03\u52a0\u5165Confluent\uff08Kafka\u7684\u516c\u53f8\uff09\uff0c\u5b98\u65b9\u7248\u5c06\u4f1a\u505c\u7559\u57281.0.0\uff0c\u8be6\u60c5\u89c1 \u5b98\u65b9\u62a5\u9053(https://www.pipelinedb.com/blog/pipelinedb-is-joining-confluent)\u3002 pipelinedb\u4f5c\u8005\u7ed9\u51fa\u5efa\u8bae\uff1a1\u3001\u4f7f\u7528confluent\u7684ksql\uff08\u5546\u4e1a\u8f6f\u4ef6\uff09\u4ee3\u66ffpipelinedb 2\u3001\u5982\u679c\u8fd8\u662f\u949f\u7231pg\u7cfb\u5217\uff0ctimescaledb \u6269\u5c55\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9 \u6ed1\u52a8\u7a97\u53e3 \u7531\u4e8e \u6d41\u89c6\u56fe \u662f\u5b9e\u65f6\u589e\u91cf\u66f4\u65b0\u7684\uff0cPipelineDB\u53ef\u4ee5\u5728\u66f4\u65b0\u6d41\u89c6\u56fe\u7ed3\u679c\u96c6\u65f6\u8003\u8651\u5f53\u524d\u65f6\u95f4\u3002WHERE \u5b50\u53e5\u4e2d\u5305\u542b\u4e0e \u5f53\u524d\u65f6\u95f4 \u76f8\u5173\u4fe1\u606f\u7684\u67e5\u8be2\u88ab\u79f0\u4f5c \u6ed1\u52a8\u7a97\u53e3\u67e5\u8be2\u3002\u6ed1\u52a8\u7684 WHERE \u5b50\u53e5\u8fc7\u6ee4\u6216\u63a5\u6536\u5230\u7684 event \u96c6\u5408\u662f\u968f\u65f6\u95f4\u6301\u7eed\u53d8\u5316\u7684\u3002 \u5185\u7f6e\u51fd\u6570 \u6211\u4eec\u52aa\u529b\u4fdd\u8bc1PipelineDB\u540cPostgreSQL\u768410.1+\u548c11.0+\u7248\u672c\u4fdd\u6301\u5b8c\u5168\u517c\u5bb9\u3002\u56e0\u6b64\uff0c\u6240\u6709 PostgreSQL\u5185\u7f6e\u51fd\u6570 \u90fd\u53ef\u4ee5\u76f4\u63a5\u5728PipelineDB\u4e2d\u4f7f\u7528\u3002 PipelineDB\u7279\u6709\u51fd\u6570 \u5177\u4f53\u67e5\u770b\uff1ahttps://pipelinedb-doc-cn.readthedocs.io/zh_CN/latest/builtin.html#id4","title":"pipelinedb\u6d41\u5f0f\u6570\u636e\u5e93\u4ecb\u7ecd"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/pipelinedb/#pipelinedb","text":"PipelineDB\u662f\u4e00\u4e2a\u7528\u4e8e\u5728\u65f6\u5e8f\u6570\u636e\u4e0a\u6301\u7eed\u6267\u884cSQL\u67e5\u8be2\u7684\u9ad8\u6027\u80fdPostgreSQL\u63d2\u4ef6\u3002SQL\u67e5\u8be2\u7684\u8f93\u51fa\u88ab\u6301\u4e45\u5316\u5230\u666e\u901a\u7684\u8868\u4e2d\uff0c\u53ef\u4ee5\u50cf\u5176\u5b83\u7684\u8868\u6216\u89c6\u56fe\u4e00\u6837\u8fdb\u884c\u67e5\u8be2\u3002\u53ef\u4ee5\u8ba4\u4e3a\u6301\u7eed\u67e5\u8be2\u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u9ad8\u541e\u5410\u91cf\u5e76\u4e14\u5feb\u901f\u66f4\u65b0\u7684\u7269\u5316\u89c6\u56fe\u3002PipelineDB\u53ef\u4ee5\u5728\u67d0\u4e9b\u4efb\u52a1\u573a\u666f\u4e0b\u8868\u73b0\u5f97\u5341\u5206\u4f18\u79c0\uff0c\u82e5\u8d85\u51fa\u8fd9\u4e2a\u8303\u7574\uff0c\u53ef\u80fd\u5c31\u4f1a\u540c\u5176\u5b83\u6570\u636e\u5904\u7406\u7cfb\u7edf\u4e00\u6837\u9762\u4e34\u4e00\u4e9b\u95ee\u9898\u3002 pipelinedb\u8fd0\u884c\u539f\u7406 \u6bd4\u5982\u8bf4\u6211\u4eec\u7528\u8fd9\u4e2apipelinedb\u662f\u8981\u505a\u4e00\u4ef6\u4e8b\uff1a\u6211\u4eec\u8981\u591a\u7ef4\u5ea6\u5b9e\u65f6\u7edf\u8ba1\u4e00\u4e2a\u5927\u6570\u636e\u96c6\uff0c\u4f20\u7edf\u65b9\u6cd5\u662f\u628a\u6570\u636e\u5b58\u5230\u8868\u4e2d\uff0c\u67e5\u8868\u7edf\u8ba1\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u592a\u6162\u4e86\uff0c\u4e8e\u662f\u4f60\u5c31\u9700\u8981\u7528\u5230pipelinedb\u4e86\uff0c\u5b83\u7701\u53bb\u4e86\u4f60\u628a\u6570\u636e\u5b58\u5165\u8868\u4e2d\u7684\u8fd9\u4e2a\u6b65\u9aa4\uff0c\u901a\u8fc7\u4e00\u4e2a\u7c7b\u4f3c\u7ba1\u9053\u7684\u4e1c\u897f\u628a\u6570\u636e\u4ea4\u7ed9\u5185\u5b58\u6765\u76f4\u63a5\u8ba1\u7b97\uff0c\u53ea\u4fdd\u5b58\u7edf\u8ba1\u7ed3\u679c\uff0c\u8fc7\u7a0b\u975e\u5e38\u5feb\uff0c\u4e0e\u5404\u79cd\u7edf\u8ba1\u9700\u6c42\u662f\u7edd\u914d\u3002 \u5b98\u65b9\u6587\u6863\uff1ahttps://pipelinedb-doc-cn.readthedocs.io/zh_CN/latest/introduction.html","title":"pipelinedb\u6d41\u5f0f\u6570\u636e\u5e93\u4ecb\u7ecd"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/pipelinedb/#pipelinedb_1","text":"PipelineDB\u88ab\u8bbe\u8ba1\u7528\u6765\u5728\u7cbe\u7b80\u540e\u7684\u6d41\u5f0f\u6570\u636e\u96c6\u4e0a\u8fdb\u884cSQL\u67e5\u8be2\u3002\u6bd4\u5982\uff1a\u6982\u8981\u548c\u805a\u5408\uff1b\u57fa\u4e8e\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\u7684\u6027\u80fd\u8ba1\u7b97\uff1b\u6587\u672c\u7d22\u5f15\u548c\u8fc7\u6ee4\uff1b\u7a7a\u95f4\u4fe1\u606f\u8fc7\u6ee4\u7b49\u3002\u901a\u8fc7\u51cf\u5c11\u6d41\u6570\u636e\u7684\u8f93\u5165\uff0cPipelineDB\u53ef\u4ee5\u663e\u8457\u5730\u51cf\u5c11\u6301\u4e45\u5316\u5230\u78c1\u76d8\u4e2d\u7684\u6570\u636e\u91cf\uff0c\u56e0\u4e3a\u4e4b\u540e\u805a\u5408\u540e\u7684\u7ed3\u679c\u88ab\u5b58\u50a8\u4e0b\u6765\u3002\u539f\u59cb\u6570\u636e\uff08foreign table\uff09\u4e00\u65e6\u88ab\u9700\u8981\u5b83\u7684\u6301\u7eed\u67e5\u8be2\u8bfb\u53d6\u540e\u5c31\u4f1a\u88ab\u9500\u6bc1\u3002 \u5927\u591a\u6570\u5199\u5165\u5230PipelineDB\u4e2d\u7684\u6570\u636e\u53ef\u4ee5\u88ab\u89c6\u4e3a \u865a\u62df\u6570\u636e\u3002\u6570\u636e\u865a\u62df\u5316\u662fPipelineDB\u8bbe\u8ba1\u7684\u7cbe\u9ad3\uff0c\u51ed\u7740\u8fd9\u79cd\u8bbe\u8ba1\uff0cPipelineDB\u53ef\u4ee5\u53ea\u5360\u7528\u8f83\u5c0f\u7684\u786c\u4ef6\u8d44\u6e90\u5b9e\u73b0\u9ad8\u6548\u7684\u5927\u6570\u636e\u91cf\u5904\u7406\u3002 PipelineDB\u7684\u76ee\u6807\u662f\u6d88\u9664\u8bb8\u591a\u6570\u636e\u4f20\u8f93\u4e2d\u7684ETL\u8fc7\u7a0b\u3002\u539f\u59cb\u6570\u636e\u6d41\u5f0f\u5199\u5165PipelineDB\uff0c\u88ab\u5df2\u58f0\u660e\u7684\u6d41\u5f0f\u67e5\u8be2\u5b9e\u65f6\u5730\u8f6c\u6362\u548c\u63d0\u53d6\uff0c\u8fd9\u4f7f\u5f97\u5b83\u5728\u5c06\u6210\u578b\u7684\u8f93\u51fa\u52a0\u8f7d\u5230\u6570\u636e\u5e93\u524d\u4e0d\u5fc5\u5468\u671f\u6027\u5730\u5904\u7406\u9897\u7c92\u6570\u636e\uff0c\u524d\u63d0\u662f\u8fd9\u4e9b\u5904\u7406\u8fc7\u7a0b\u53ef\u4ee5\u901a\u8fc7SQL\u5b9a\u4e49\u3002 \u5728PipelineDB\u7684\u8bbe\u8ba1\u7406\u5ff5\u4e2d\uff0c\u5b9e\u7528\u6027\u662f\u7b2c\u4e00\u8981\u7d20\uff0c\u8fd9\u4e5f\u662f\u6211\u4eec\u5c06\u5176\u5305\u88c5\u4e3aPostgreSQL\u63d2\u4ef6\u7684\u539f\u56e0\u3002\u6240\u6709\u6570\u636e\u5b58\u50a8\u548c\u5904\u7406\u90fd\u4ea4\u7531PostgreSQL\uff1a\u4e00\u4e2a\u6781\u5176\u7a33\u5b9a\u3001\u6210\u719f\u4ee5\u53ca\u8fd0\u7528\u5e7f\u6cdb\u7684\u6570\u636e\u5e93\u3002\u6b64\u5916\uff0cPipelineDB\u517c\u5bb9\u6d3b\u8dc3\u7684PostgreSQL\u751f\u6001\u4e2d\u7684\u6240\u6709\u5de5\u5177\u3002\u6211\u4eec\u6ca1\u6709\u4e3aPipelineDB\u8bbe\u8ba1\u7279\u6709\u7684\u8bed\u6cd5\u751a\u81f3\u662f\u5ba2\u6237\u7aef\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u5f88\u597d\u5730\u517c\u5bb9\u4efb\u4f55\u57fa\u4e8ePostgreSQL\u5f00\u53d1\u7684\u5e93\u3002","title":"PipelineDB\u7684\u957f\u5904"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/pipelinedb/#pipelinedb_2","text":"\u9274\u4e8e\u6d41\u67e5\u8be2\u9700\u8981\u4e00\u4e9b \u5148\u9a8c\u77e5\u8bc6\uff0cPipelineDB\u4e0d\u662f\u4e00\u4e2a\u7279\u5b9a\u7684\u6570\u636e\u4ed3\u5e93\u3002\u6d41\u5f0f\u67e5\u8be2\u7684\u8f93\u51fa\u53ef\u80fd\u5728\u7279\u5b9a\u65b9\u5f0f\u4e0b\u88ab\u8bbf\u95ee\uff0c\u6240\u6709\u5199\u5165\u5230PipelineDB\u4e2d\u7684\u539f\u59cb\u6570\u636e\u90fd\u4e0d\u4f1a\u88ab\u6301\u4e45\u5316\u56e0\u4e3a\u5b83\u4eec\u90fd\u4f1a\u5728\u8bfb\u53d6\u540e\u88ab\u9500\u6bc1\u3002\u6b64\u5916\uff0c\u5982\u679c\u6d41\u5f0f\u8ba1\u7b97\u4e0d\u80fd\u4ee5SQL\u7684\u5f62\u5f0f\u8868\u8fbe\uff0cPipelineDB\u53ef\u80fd\u5e76\u4e0d\u662f\u4e00\u4e2a\u5408\u9002\u7684\u9009\u62e9\uff01","title":"PipelineDB\u7684\u77ed\u677f"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/pipelinedb/#_1","text":"","title":"\u529f\u80fd"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/pipelinedb/#foreign-table","text":"\u6d41\u662f\u4e00\u79cd\u5141\u8bb8\u5ba2\u6237\u7aef\u5c06\u65f6\u5e8f\u6570\u636e\u5199\u5165 \u6d41\u89c6\u56fe \u7684\u62bd\u8c61\u7ba1\u9053\u3002\u6d41\u91cc\u9762\u7684\u4e00\u884c\u6570\u636e\uff08\u6216\u8005\u7b80\u5355\u79f0\u4f5c event\uff09\uff0c\u4e0e\u6570\u636e\u8868\u4e2d\u7684\u884c\u6570\u636e\u662f\u5f88\u76f8\u4f3c\u7684\uff0c\u5e76\u4e14\u4e8c\u8005\u7684\u5199\u5165\u4e5f\u662f\u5b8c\u5168\u4e00\u81f4\u7684\u3002\u7136\u800c\uff0c\u6d41\u548c\u6570\u636e\u8868\u7684\u8bed\u4e49\u662f\u5b8c\u5168\u4e0d\u540c\u7684\u3002 \u6362\u8a00\u4e4b\uff0cevent \u53ea\u4f1a\u5728\u88ab\u6240\u6709\u7684 \u6d41\u89c6\u56fe \u6d88\u8d39\u5b8c\u4e4b\u524d\u201c\u5b58\u5728\u201d\u4e8e\u6d41\u4e2d\u3002\u5373\u4f7f\u8fd9\u6837\uff0c\u7528\u6237\u4ecd\u7136\u4e0d\u80fd\u76f4\u63a5\u4ece\u6d41\u4e2d SELECT \u6570\u636e\u3002\u6d41\u552f\u4e00\u7684\u4f5c\u7528\u5c31\u662f\u5145\u5f53 \u6d41\u89c6\u56fe \u7684\u8f93\u5165\u3002","title":"\u6d41\uff08foreign table\uff09"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/pipelinedb/#_2","text":"\u6d41\u89c6\u56fe\uff08continuous view\uff09\u662fPipelineDB\u7684\u57fa\u7840\u6982\u5ff5\u62bd\u8c61\u3002\u6d41\u89c6\u56fe\u8ddf\u666e\u901a\u7684\u6570\u636e\u5e93\u89c6\u56fe\u975e\u5e38\u76f8\u4f3c\uff0c\u4f46\u5b83\u662f\u5c06\u6d41\u548c\u8868\u4e2d\u7684\u6570\u636e\u7ec4\u5408\u540e\u4f5c\u4e3a\u8f93\u5165\u5e76\u8fdb\u884c\u5b9e\u65f6\u589e\u91cf\u66f4\u65b0\u3002 \u6d41\u6570\u636e\u4e00\u65e6\u88ab\u6d41\u89c6\u56fe\u8bfb\u53d6\u540e\u5c31\u4f1a\u88ab\u9500\u6bc1\uff0c\u6d41\u6570\u636e\u4e0d\u4f1a\u5b58\u50a8\u5728\u4efb\u4f55\u5730\u65b9\u3002\u53ea\u6709\u8bf8\u5982 SELECT * FROM that_view \u67e5\u8be2\u8fd4\u56de\u7684\u7ed3\u679c\u624d\u4f1a\u88ab\u6301\u4e45\u5316\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6d41\u89c6\u56fe\u53ef\u4ee5\u88ab\u89c6\u4e3a\u9ad8\u541e\u5410\u91cf\u3001\u5b9e\u65f6\u7684\u7269\u5316\u89c6\u56fe\u3002","title":"\u6d41\u89c6\u56fe"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/pipelinedb/#_3","text":"\u6d41\u8f6c\u6362\u53ef\u4ee5\u5728\u4e0d\u5b58\u50a8\u65f6\u5e8f\u7684\u60c5\u51b5\u4e0b\u5bf9\u5176\u8fdb\u884c\u5b9e\u65f6\u8f6c\u6362\u3002\u7531\u4e8e\u6570\u636e\u4e0d\u5b58\u50a8\u6570\u636e\uff0c\u6240\u4ee5\u6d41\u8f6c\u6362\u4e0d\u652f\u6301\u805a\u5408\u64cd\u4f5c\u3002\u8f6c\u6362\u540e\u7684\u6570\u636e\u65e2\u53ef\u4ee5\u4f5c\u4e3a\u53e6\u4e00\u4e2a\u6d41\u7684\u8f93\u5165\uff0c\u4e5f\u53ef\u4ee5\u5199\u5165\u5230\u5916\u90e8\u6570\u636e\u5b58\u50a8\u4e2d\u3002","title":"\u6d41\u8f6c\u6362"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/pipelinedb/#_4","text":"PipelineDB\u6700\u6838\u5fc3\u7684\u8ffd\u6c42\u4e4b\u4e00\u5c31\u662f \u4fc3\u8fdb\u9ad8\u6027\u80fd\u7684\u8fde\u7eed\u805a\u5408\uff0c\u6240\u4ee5\u805a\u5408\u51fd\u6570\u6beb\u65e0\u7591\u95ee\u662fPipelineDB\u7684\u6838\u5fc3\u529f\u80fd\u3002\u8fde\u7eed\u805a\u5408\u5728\u5927\u591a\u6570\u901a\u7528\u573a\u666f\u662f\u975e\u5e38\u6709\u7528\u7684\uff0c\u5b83\u4f7f\u5f97PipelineDB\u4e2d\u6301\u4e45\u5316\u7684\u6570\u636e\u59cb\u7ec8\u4e0e\u5199\u5165\u7684\u6570\u636e\u4fdd\u6301\u540c\u6b65\u3002\u5b83\u53ef\u4ee5\u901a\u8fc7\u4e00\u5b9a\u7684\u786c\u4ef6\u5b9e\u73b0\u7a33\u5b9a\u548c\u9ad8\u541e\u5ea6\u91cf\u7684\u670d\u52a1\u3002 \u8fde\u7eed\u805a\u5408\u662f\u968f\u7740\u6d41\u89c6\u56fe\u65b0 event \u7684\u751f\u6210\u5b9e\u65f6 \u589e\u91cf\u66f4\u65b0\u7684\u3002\u5bf9\u4e8e\u5982 count \u548c sum \u4e4b\u7c7b\u7684\u7b80\u5355\u805a\u5408\uff0c\u6211\u4eec\u5f88\u5bb9\u6613\u7406\u89e3\u7ed3\u679c\u662f\u5982\u4f55\u589e\u91cf\u66f4\u65b0\u7684\u2013\u5c06\u65b0\u503c\u7d2f\u52a0\u5230\u5df2\u6709\u7ed3\u679c\u4e0a\u800c\u5df2\u3002 \u4f46\u5bf9\u66f4\u52a0\u590d\u6742\u7684\u805a\u5408\u800c\u8a00\uff0c\u5982 avg, stddev, percentile_cont \u7b49\uff0c\u9700\u8981\u66f4\u4f18\u5316\u7684\u67b6\u6784\u6765\u652f\u6301\u9ad8\u6548\u7684\u589e\u91cf\u66f4\u65b0\uff0cPipelineDB\u5728\u5185\u90e8\u81ea\u52a8\u5b9e\u73b0\u4e86\u8fd9\u4e9b\u590d\u6742\u7684\u903b\u8f91\u3002","title":"\u6d41\u805a\u5408"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/pipelinedb/#_5","text":"\u6d41\u89c6\u56fe \u7684\u5e76\u975e\u53ea\u9760select \u6d41\uff08foreign table\uff09 \u4ea7\u751f\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5c06\u8f93\u5165\u7684\u65f6\u5e8f\u6570\u636e\u548c\u9759\u6001\u7684PipelineDB\u6570\u636e\u8868\u7ec4\u5408\u540e\u5f97\u5230\uff0c\u8fd9\u53ef\u4ee5\u7528\u79f0\u4f5c\u6d41-\u8868\u5173\u8054\u7684\u65b9\u5f0f\u5b9e\u73b0\u3002 \u6d41-\u8868\u5173\u8054 \u6d41-\u8868\u5173\u8054\u5728 event\u5230\u8fbe\u65f6 \u5c06\u5176\u4e0e\u8868\u4e2d\u5339\u914d\u7684\u884c\u6570\u636e\u7ec4\u5408\u3002\u6362\u8a00\u4e4b\uff0c\u5982\u679c\u5728\u8868\u6570\u636e\u5728 event \u88ab\u8bfb\u53d6\u540e\u624d\u88ab\u63d2\u5165\uff0c\u5373\u4f7f\u662f\u5339\u914d\u7684\uff0c\u4e5f\u4e0d\u4f1a\u5bf9\u6d41\u89c6\u56fe\u4ea7\u751f\u5f71\u54cd\u3002\u65b0\u6570\u636e\u53ea\u4f1a\u5728 event\u88ab\u8bfb\u53d6\u65f6 \u4ea7\u751f\u3002\u5373\u4f7f\u6d41-\u8868\u5173\u8054\u4e2d\u7684\u8868\u88ab\u6e05\u7a7a\u4e86\uff0c\u6d41\u89c6\u56fe\u4e2d\u7684\u6570\u636e\u4e5f\u4e0d\u4f1a\u53d8\u5316\u3002 \u6d41-\u6d41\u5173\u8054 \u76ee\u524d\u4e0d\u652f\u6301\u6d41\u4e4b\u95f4\u7684\u5173\u8054\uff0c\u8fd9\u4e2a\u529f\u80fd\u53ef\u80fd\u4f1a\u51fa\u73b0\u5728\u5c06\u6765\u7684\u7248\u672c\u4e2d\u3002 \u8bd1\u8005\u6ce8\uff1a 2019\u5e745\u67081\u65e5\uff0cPipelineDB\u516c\u53f8\u5ba3\u5e03\u52a0\u5165Confluent\uff08Kafka\u7684\u516c\u53f8\uff09\uff0c\u5b98\u65b9\u7248\u5c06\u4f1a\u505c\u7559\u57281.0.0\uff0c\u8be6\u60c5\u89c1 \u5b98\u65b9\u62a5\u9053(https://www.pipelinedb.com/blog/pipelinedb-is-joining-confluent)\u3002 pipelinedb\u4f5c\u8005\u7ed9\u51fa\u5efa\u8bae\uff1a1\u3001\u4f7f\u7528confluent\u7684ksql\uff08\u5546\u4e1a\u8f6f\u4ef6\uff09\u4ee3\u66ffpipelinedb 2\u3001\u5982\u679c\u8fd8\u662f\u949f\u7231pg\u7cfb\u5217\uff0ctimescaledb \u6269\u5c55\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9","title":"\u6d41\u5173\u8054"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/pipelinedb/#_6","text":"\u7531\u4e8e \u6d41\u89c6\u56fe \u662f\u5b9e\u65f6\u589e\u91cf\u66f4\u65b0\u7684\uff0cPipelineDB\u53ef\u4ee5\u5728\u66f4\u65b0\u6d41\u89c6\u56fe\u7ed3\u679c\u96c6\u65f6\u8003\u8651\u5f53\u524d\u65f6\u95f4\u3002WHERE \u5b50\u53e5\u4e2d\u5305\u542b\u4e0e \u5f53\u524d\u65f6\u95f4 \u76f8\u5173\u4fe1\u606f\u7684\u67e5\u8be2\u88ab\u79f0\u4f5c \u6ed1\u52a8\u7a97\u53e3\u67e5\u8be2\u3002\u6ed1\u52a8\u7684 WHERE \u5b50\u53e5\u8fc7\u6ee4\u6216\u63a5\u6536\u5230\u7684 event \u96c6\u5408\u662f\u968f\u65f6\u95f4\u6301\u7eed\u53d8\u5316\u7684\u3002","title":"\u6ed1\u52a8\u7a97\u53e3"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/pipelinedb/#_7","text":"\u6211\u4eec\u52aa\u529b\u4fdd\u8bc1PipelineDB\u540cPostgreSQL\u768410.1+\u548c11.0+\u7248\u672c\u4fdd\u6301\u5b8c\u5168\u517c\u5bb9\u3002\u56e0\u6b64\uff0c\u6240\u6709 PostgreSQL\u5185\u7f6e\u51fd\u6570 \u90fd\u53ef\u4ee5\u76f4\u63a5\u5728PipelineDB\u4e2d\u4f7f\u7528\u3002","title":"\u5185\u7f6e\u51fd\u6570"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/pipelinedb/#pipelinedb_3","text":"\u5177\u4f53\u67e5\u770b\uff1ahttps://pipelinedb-doc-cn.readthedocs.io/zh_CN/latest/builtin.html#id4","title":"PipelineDB\u7279\u6709\u51fd\u6570"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/timescaledb/","text":"\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5e93\u7b80\u79f0\u65f6\u5e8f\u6570\u636e\u5e93(Time Series Database)\uff0c\u7528\u4e8e\u5904\u7406\u5e26\u65f6\u95f4\u6807\u7b7e(\u6309\u7167\u65f6\u95f4\u7684\u987a\u5e8f\u53d8\u5316\uff0c\u5373\u65f6\u95f4\u5e8f\u5217\u5316)\u7684\u6570\u636e\uff0c\u5e26\u65f6\u95f4\u6807\u7b7e\u7684\u6570\u636e\u4e5f\u79f0\u4e3a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u3002 \u65f6\u5e8f\u6570\u636e\u7684\u51e0\u4e2a\u7279\u70b9 \u57fa\u672c\u4e0a\u90fd\u662f\u63d2\u5165\uff0c\u6ca1\u6709\u66f4\u65b0\u7684\u9700\u6c42\u3002 \u5199\u591a\u4e8e\u8bfb\uff1a95%-99%\u7684\u64cd\u4f5c\u90fd\u662f\u5199\u64cd\u4f5c \u987a\u5e8f\u5199\uff1a\u7531\u4e8e\u662f\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u56e0\u6b64\u6570\u636e\u591a\u4e3a\u8ffd\u52a0\u5f0f\u5199\u5165\uff0c\u800c\u4e14\u51e0\u4e4e\u90fd\u662f\u5b9e\u65f6\u5199\u5165\uff0c\u5f88\u5c11\u4f1a\u5199\u5165\u51e0\u5929\u524d\u7684\u6570\u636e\u3002 \u5f88\u5c11\u66f4\u65b0\uff1a\u6570\u636e\u5199\u5165\u4e4b\u540e\uff0c\u4e0d\u4f1a\u66f4\u65b0 \u533a\u5757\uff08bulk\uff09\u5220\u9664\uff1a\u57fa\u672c\u6ca1\u6709\u968f\u673a\u5220\u9664\uff0c\u591a\u6570\u662f\u4ece\u4e00\u4e2a\u65f6\u95f4\u70b9\u5f00\u59cb\u5230\u67d0\u4e00\u65f6\u95f4\u70b9\u7ed3\u675f\u7684\u6574\u6bb5\u6570\u636e\u5220\u9664\u3002\u6bd4\u5982\u5220\u9664\u4e0a\u4e2a\u6708\uff0c\u6216\u80057\u5929\u524d\u7684\u6570\u636e\u3002\u5f88\u5c11\u51fa\u73b0\u5220\u9664\u5355\u72ec\u67d0\u4e2a\u6307\u6807\u7684\u6570\u636e\uff0c\u6216\u8005\u8df3\u8dc3\u65f6\u95f4\u6bb5\u7684\u6570\u636e\u3002 \u6570\u636e\u8bfb\u53d6\uff08\u67e5\u8be2\uff09 \u987a\u5e8f\u8bfb\uff1a\u57fa\u672c\u90fd\u662f\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u8bfb\u53d6\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u6570\u636e\u3002 \u57fa\u6570\u5927\uff1a\u57fa\u672c\u6570\u636e\u5927\uff0c\u8d85\u8fc7\u5185\u5b58\u5927\u5c0f\uff0c\u8981\u9009\u53d6\u7684\u53ea\u662f\u5176\u4e00\u5c0f\u90e8\u5206\uff0c\u4e14\u6ca1\u6709\u89c4\u5f8b\uff0c\u7f13\u5b58\u51e0\u4e4e\u4e0d\u8d77\u4efb\u4f55\u4f5c\u7528\u3002 \u5373\u4f7f\u8bfb\u53d6\u64cd\u4f5c\u76f8\u5bf9\u5199\u6765\u8bf4\u8f83\u5c11\uff0c\u4f46\u662f\u8bfb\u64cd\u4f5c\u7684\u54cd\u5e94\u65f6\u95f4\u8981\u6c42\u5f88\u9ad8\uff0c\u9664\u975e\u4f60\u662f\u53ea\u505a\u540e\u53f0\u62a5\u8868\u751f\u6210\uff0c\u5426\u5219\u4e00\u65e6\u6709\u4ea4\u4e92\u6027\u64cd\u4f5c\uff0c\u5fc5\u987b\u8981\u6c42\u5feb\u901f\u54cd\u5e94\u3002\u4e3a\u4e86\u63d0\u9ad8\u8bfb\u53d6\u7684\u54cd\u5e94\u65f6\u95f4\uff0c\u6709\u4e24\u79cd\u7b56\u7565\uff1a \u4e00\u662f\u4ee5\u5199\u6027\u80fd\u4f18\u5148\uff0c\u4e0d\u4e3a\u8bfb\u53d6\u505a\u5b58\u50a8\u4f18\u5316\uff0c\u4f46\u662f\u901a\u8fc7\u5206\u5e03\u5f0f\u548c\u5e76\u53d1\u8bfb\uff0c\u6765\u63d0\u9ad8\u8bfb\u53d6\u7684\u901f\u5ea6\u3002 \u4e8c\u5c31\u662f\u5728\u5199\u5165\u7684\u65f6\u5019\u5c31\u8003\u8651\u5230\u8bfb\u7684\u6027\u80fd\u95ee\u9898\uff0c\u5c06\u7edf\u4e00\u6307\u6807\u3001\u65f6\u95f4\u6bb5\u7684\u6570\u636e\u5199\u5165\u5230\u540c\u4e00\u6570\u636e\u5757\u4e2d\uff0c\u4e3a\u8bfb\u53d6\u8fdb\u884c\u5199\u5165\u4f18\u5316\u3002 \u5206\u5e03\u5f0f\uff08\u96c6\u7fa4\uff09 TSDB \u5e94\u8be5\u5929\u751f\u5c31\u8981\u8003\u8651\u5230\u5206\u5e03\u5f0f\u548c\u5206\u533a\u7b49\u7279\u6027\uff0c\u5c06\u5b58\u50a8\u548c\u67e5\u8be2\u5206\u53d1\u5230\u4e0d\u540c\u7684\u670d\u52a1\u5668\uff0c\u4ee5\u652f\u6491\u5927\u89c4\u6a21\u7684\u6570\u636e\u91c7\u96c6\u548c\u67e5\u8be2\u8bf7\u6c42\u3002 \u540c\u65f6\uff0c\u5b83\u4e5f\u5e94\u8be5\u662f\u80fd\u6269\u5c55\u548c\u81ea\u52a8\u5931\u8d25\u5207\u6362\uff08Fault-tolerant\uff09\u7684\u3002\u968f\u7740\u6570\u636e\u91cf\u7684\u589e\u957f\uff0c\u6240\u9700\u670d\u52a1\u5668\u7684\u53f0\u6570\u4e5f\u4f1a\u589e\u52a0\uff0c\u80fd\u52a8\u6001\u7684\u589e\u51cf\u670d\u52a1\u5668\u5219\u662f\u4e00\u4e2a\u57fa\u672c\u8981\u6c42\u3002\u540c\u65f6\uff0c\u968f\u7740\u670d\u52a1\u5668\u7684\u589e\u591a\uff0c\u5404\u79cd\u670d\u52a1\u5668\u8f6f\u4ef6\u6216\u8005\u7f51\u7edc\u6545\u969c\u53d1\u751f\u7684\u6982\u7387\u4e5f\u4f1a\u589e\u5927\uff0c\u8fd9\u65f6\u5019\u5931\u8d25\u5207\u6362\u4e5f\u663e\u5f97\u5f88\u91cd\u8981\uff0c\u4e0d\u80fd\u56e0\u4e3a\u4e00\u53f0\u673a\u5668\u7684\u5931\u6548\u800c\u5bfc\u81f4\u6574\u4e2a\u96c6\u7fa4\u4e0d\u53ef\u5de5\u4f5c\u3002 \u6570\u636e\u57fa\u672c\u4e0a\u90fd\u6709\u65f6\u95f4\u5c5e\u6027\uff0c\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\u4e0d\u65ad\u4ea7\u751f\u65b0\u7684\u6570\u636e\u3002 \u6570\u636e\u91cf\u5927\uff0c\u6bcf\u79d2\u949f\u9700\u8981\u5199\u5165\u5343\u4e07\u3001\u4e0a\u4ebf\u6761\u6570\u636e \u4fdd\u7559\u7b56\u7565\uff08Retention Policies\uff0c\u6216\u81ea\u52a8\u5220\u9664\u3001\u538b\u7f29\uff09 \u81ea\u52a8\u5220\u9664\u5c31\u662f\u4e3a\u6570\u636e\u8bbe\u7f6e TTL\uff0c\u8fc7\u4e86\u6307\u5b9a\u7684 TTL \u5219\u81ea\u52a8\u5220\u9664\u76f8\u5173\u6570\u636e\uff0c\u4ee5\u8282\u7701\u5b58\u50a8\u7a7a\u95f4\u540c\u65f6\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\u3002\u5982\u679c\u4e0d\u5220\u9664\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u538b\u7f29\uff0c\u6216\u8005\u518d\u91c7\u6837\uff08Resampling\uff09\uff0c\u6bd4\u5982\u5bf9\u6700\u8fd1 1 \u5929\u7684\u6570\u636e\u6211\u4eec\u53ef\u80fd\u9700\u8981\u7cbe\u786e\u5230\u79d2\uff0c\u800c\u67e5\u8be2 1 \u5e74\u7684\u6570\u636e\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7cbe\u786e\u5230\u5929\uff0c\u8fd9\u65f6\u5019\uff0c\u6d77\u91cf\u7684\u6570\u636e\u4e00\u5e74\u53ea\u9700\u8981 365 \u4e2a\u70b9\u6765\u5b58\u50a8\uff0c\u5927\u5927\u8282\u7701\u4e86\u5b58\u50a8\u7a7a\u95f4\u3002 \u4e1a\u52a1\u65b9\u5e38\u89c1\u9700\u6c42 \u83b7\u53d6\u6700\u65b0\u72b6\u6001\uff0c\u67e5\u8be2\u6700\u8fd1\u7684\u6570\u636e(\u4f8b\u5982\u4f20\u611f\u5668\u6700\u65b0\u7684\u72b6\u6001) \u5c55\u793a\u533a\u95f4\u7edf\u8ba1\uff0c\u6307\u5b9a\u65f6\u95f4\u8303\u56f4\uff0c\u67e5\u8be2\u7edf\u8ba1\u4fe1\u606f\uff0c\u4f8b\u5982\u5e73\u5747\u503c\uff0c\u6700\u5927\u503c\uff0c\u6700\u5c0f\u503c\uff0c\u8ba1\u6570\u7b49\u3002\u3002\u3002 \u83b7\u53d6\u5f02\u5e38\u6570\u636e\uff0c\u6839\u636e\u6307\u5b9a\u6761\u4ef6\uff0c\u7b5b\u9009\u5f02\u5e38\u6570\u636e \u5e38\u89c1\u4e1a\u52a1\u573a\u666f \u76d1\u63a7\u8f6f\u4ef6\u7cfb\u7edf\uff1a \u865a\u62df\u673a\u3001\u5bb9\u5668\u3001\u670d\u52a1\u3001\u5e94\u7528 \u76d1\u63a7\u7269\u7406\u7cfb\u7edf\uff1a \u6c34\u6587\u76d1\u63a7\u3001\u5236\u9020\u4e1a\u5de5\u5382\u4e2d\u7684\u8bbe\u5907\u76d1\u63a7\u3001\u56fd\u5bb6\u5b89\u5168\u76f8\u5173\u7684\u6570\u636e\u76d1\u63a7\u3001\u901a\u8baf\u76d1\u63a7\u3001\u4f20\u611f\u5668\u6570\u636e\u3001\u8840\u7cd6\u4eea\u3001\u8840\u538b\u53d8\u5316\u3001\u5fc3\u7387\u7b49 \u8d44\u4ea7\u8ddf\u8e2a\u5e94\u7528\uff1a \u6c7d\u8f66\u3001\u5361\u8f66\u3001\u7269\u7406\u5bb9\u5668\u3001\u8fd0\u8d27\u6258\u76d8 \u91d1\u878d\u4ea4\u6613\u7cfb\u7edf\uff1a \u4f20\u7edf\u8bc1\u5238\u3001\u65b0\u5174\u7684\u52a0\u5bc6\u6570\u5b57\u8d27\u5e01 \u4e8b\u4ef6\u5e94\u7528\u7a0b\u5e8f\uff1a \u8ddf\u8e2a\u7528\u6237\u3001\u5ba2\u6237\u7684\u4ea4\u4e92\u6570\u636e \u5546\u4e1a\u667a\u80fd\u5de5\u5177\uff1a \u8ddf\u8e2a\u5173\u952e\u6307\u6807\u548c\u4e1a\u52a1\u7684\u603b\u4f53\u5065\u5eb7\u60c5\u51b5 \u5728\u4e92\u8054\u7f51\u884c\u4e1a\u4e2d\uff0c\u4e5f\u6709\u7740\u975e\u5e38\u591a\u7684\u65f6\u5e8f\u6570\u636e\uff0c\u4f8b\u5982\u7528\u6237\u8bbf\u95ee\u7f51\u7ad9\u7684\u884c\u4e3a\u8f68\u8ff9\uff0c\u5e94\u7528\u7a0b\u5e8f\u4ea7\u751f\u7684\u65e5\u5fd7\u6570\u636e\u7b49\u7b49\u3002 \u4e00\u4e9b\u57fa\u672c\u6982\u5ff5(\u4e0d\u540c\u7684\u65f6\u5e8f\u6570\u636e\u5e93\u79f0\u547c\u7565\u6709\u4e0d\u540c) Metric: \u5ea6\u91cf\uff0c\u76f8\u5f53\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u7684 table\u3002 Data point: \u6570\u636e\u70b9\uff0c\u76f8\u5f53\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u7684 row\u3002 Timestamp\uff1a\u65f6\u95f4\u6233\uff0c\u4ee3\u8868\u6570\u636e\u70b9\u4ea7\u751f\u7684\u65f6\u95f4\u3002 Field: \u5ea6\u91cf\u4e0b\u7684\u4e0d\u540c\u5b57\u6bb5\u3002\u6bd4\u5982\u4f4d\u7f6e\u8fd9\u4e2a\u5ea6\u91cf\u5177\u6709\u7ecf\u5ea6\u548c\u7eac\u5ea6\u4e24\u4e2a field\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\u5b58\u653e\u7684\u662f\u968f\u65f6\u95f4\u6233\u800c\u53d8\u5316\u7684\u6570\u636e\u3002 Tag: \u6807\u7b7e\u3002\u4e00\u822c\u5b58\u653e\u7684\u662f\u4e0d\u968f\u65f6\u95f4\u6233\u53d8\u5316\u7684\u4fe1\u606f\u3002timestamp \u52a0\u4e0a\u6240\u6709\u7684 tags \u53ef\u4ee5\u89c6\u4e3a table \u7684 primary key\u3002 \u4f8b\u5982\u91c7\u96c6\u6709\u5173\u98ce\u7684\u6570\u636e\uff0c\u5ea6\u91cf\u4e3a Wind\uff0c\u6bcf\u6761\u6570\u636e\u90fd\u6709\u65f6\u95f4\u6233timestamp\uff0c\u4e24\u4e2a\u5b57\u6bb5 field\uff1adirection(\u98ce\u5411)\u3001speed(\u98ce\u901f)\uff0c\u4e24\u4e2atag\uff1asensor(\u4f20\u611f\u5668\u7f16\u53f7)\u3001city(\u57ce\u5e02)\u3002\u7b2c\u4e00\u884c\u548c\u7b2c\u4e09\u884c\uff0c\u5b58\u653e\u7684\u90fd\u662f sensor \u7f16\u53f7\u4e3a86F-2RT8\u7684\u8bbe\u5907\uff0c\u57ce\u5e02\u662f\u6df1\u5733\u3002\u968f\u7740\u65f6\u95f4\u7684\u53d8\u5316\uff0c\u98ce\u5411\u548c\u98ce\u901f\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u98ce\u5411\u4ece56.4\u53d8\u4e3a45.6\uff0c\u98ce\u901f\u4ece2.9\u53d8\u4e3a3.6\u3002 \u9700\u8981\u89e3\u51b3\u7684\u51e0\u4e2a\u95ee\u9898 \u65f6\u5e8f\u6570\u636e\u7684\u5199\u5165\uff1a\u5982\u4f55\u652f\u6301\u6bcf\u79d2\u949f\u6210\u5343\u4e0a\u4ebf\u6761\u6570\u636e\u7684\u5199\u5165\u3002 \u65f6\u5e8f\u6570\u636e\u7684\u8bfb\u53d6\uff1a\u5982\u4f55\u652f\u6301\u5728\u79d2\u7ea7\u5bf9\u4e0a\u4ebf\u6761\u6570\u636e\u7684\u5206\u7ec4\u805a\u5408\u8fd0\u7b97\u3002 \u6210\u672c\u654f\u611f\uff1a\u6d77\u91cf\u6570\u636e\u5b58\u50a8\u5e26\u6765\u7684\u6210\u672c\u95ee\u9898\u3002\u5982\u4f55\u4ee5\u66f4\u4f4e\u6210\u672c\u5b58\u50a8\u6570\u636e\uff0c\u5c06\u6210\u4e3a\u65f6\u5e8f\u6570\u636e\u5e93\u9700\u8981\u89e3\u51b3\u7684\u91cd\u4e2d\u4e4b\u91cd\u3002 \u5e38\u89c1\u65f6\u5e8f\u6570\u636e\u5e93 \u65f6\u5e8f\u6570\u636e\u5e93\u51fa\u73b0\u7684\u65f6\u95f4\u8f83\u665a\uff0c\u76ee\u524d\u8f83\u6210\u719f\u7684\u65f6\u5e8f\u6570\u636e\u5e93\u90fd\u4ec5\u67092\u30013\u5e74\u7684\u5386\u53f2\u3002 InfluxDB(\u5355\u673a\u7248\u514d\u8d39\uff0c\u96c6\u7fa4\u7248\u6536\u8d39)\u6700\u6210\u719f\uff0cKairosdb(\u5e95\u5c42\u4f7f\u7528Cassandra)\uff0cOpenTsdb(\u5e95\u5c42\u4f7f\u7528HBase)\uff0cberingei(Facebook\u5f00\u6e90)\uff0cTimeScaleDB(\u5e95\u5c42\u57fa\u4e8ePostgreSQL)\uff0cTSDB(\u767e\u5ea6\u5f00\u6e90)\uff0cHiTSDB(\u963f\u91cc\u5f00\u6e90\uff0c\u5e95\u5c42\u662fPostgreSQL)\uff0cMatrixDB\uff08\u56fd\u4ea7\uff0c\u636e\u8bf4\u5199\u5165\u6027\u80fd\u6bd4InfluxDB\u5feb\u51e0\u5341\u500d\uff1ahttps://zhuanlan.zhihu.com/p/374151291 \uff09","title":"Timescaledb"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/timescaledb/#_1","text":"\u57fa\u672c\u4e0a\u90fd\u662f\u63d2\u5165\uff0c\u6ca1\u6709\u66f4\u65b0\u7684\u9700\u6c42\u3002 \u5199\u591a\u4e8e\u8bfb\uff1a95%-99%\u7684\u64cd\u4f5c\u90fd\u662f\u5199\u64cd\u4f5c \u987a\u5e8f\u5199\uff1a\u7531\u4e8e\u662f\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u56e0\u6b64\u6570\u636e\u591a\u4e3a\u8ffd\u52a0\u5f0f\u5199\u5165\uff0c\u800c\u4e14\u51e0\u4e4e\u90fd\u662f\u5b9e\u65f6\u5199\u5165\uff0c\u5f88\u5c11\u4f1a\u5199\u5165\u51e0\u5929\u524d\u7684\u6570\u636e\u3002 \u5f88\u5c11\u66f4\u65b0\uff1a\u6570\u636e\u5199\u5165\u4e4b\u540e\uff0c\u4e0d\u4f1a\u66f4\u65b0 \u533a\u5757\uff08bulk\uff09\u5220\u9664\uff1a\u57fa\u672c\u6ca1\u6709\u968f\u673a\u5220\u9664\uff0c\u591a\u6570\u662f\u4ece\u4e00\u4e2a\u65f6\u95f4\u70b9\u5f00\u59cb\u5230\u67d0\u4e00\u65f6\u95f4\u70b9\u7ed3\u675f\u7684\u6574\u6bb5\u6570\u636e\u5220\u9664\u3002\u6bd4\u5982\u5220\u9664\u4e0a\u4e2a\u6708\uff0c\u6216\u80057\u5929\u524d\u7684\u6570\u636e\u3002\u5f88\u5c11\u51fa\u73b0\u5220\u9664\u5355\u72ec\u67d0\u4e2a\u6307\u6807\u7684\u6570\u636e\uff0c\u6216\u8005\u8df3\u8dc3\u65f6\u95f4\u6bb5\u7684\u6570\u636e\u3002 \u6570\u636e\u8bfb\u53d6\uff08\u67e5\u8be2\uff09 \u987a\u5e8f\u8bfb\uff1a\u57fa\u672c\u90fd\u662f\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u8bfb\u53d6\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u6570\u636e\u3002 \u57fa\u6570\u5927\uff1a\u57fa\u672c\u6570\u636e\u5927\uff0c\u8d85\u8fc7\u5185\u5b58\u5927\u5c0f\uff0c\u8981\u9009\u53d6\u7684\u53ea\u662f\u5176\u4e00\u5c0f\u90e8\u5206\uff0c\u4e14\u6ca1\u6709\u89c4\u5f8b\uff0c\u7f13\u5b58\u51e0\u4e4e\u4e0d\u8d77\u4efb\u4f55\u4f5c\u7528\u3002 \u5373\u4f7f\u8bfb\u53d6\u64cd\u4f5c\u76f8\u5bf9\u5199\u6765\u8bf4\u8f83\u5c11\uff0c\u4f46\u662f\u8bfb\u64cd\u4f5c\u7684\u54cd\u5e94\u65f6\u95f4\u8981\u6c42\u5f88\u9ad8\uff0c\u9664\u975e\u4f60\u662f\u53ea\u505a\u540e\u53f0\u62a5\u8868\u751f\u6210\uff0c\u5426\u5219\u4e00\u65e6\u6709\u4ea4\u4e92\u6027\u64cd\u4f5c\uff0c\u5fc5\u987b\u8981\u6c42\u5feb\u901f\u54cd\u5e94\u3002\u4e3a\u4e86\u63d0\u9ad8\u8bfb\u53d6\u7684\u54cd\u5e94\u65f6\u95f4\uff0c\u6709\u4e24\u79cd\u7b56\u7565\uff1a \u4e00\u662f\u4ee5\u5199\u6027\u80fd\u4f18\u5148\uff0c\u4e0d\u4e3a\u8bfb\u53d6\u505a\u5b58\u50a8\u4f18\u5316\uff0c\u4f46\u662f\u901a\u8fc7\u5206\u5e03\u5f0f\u548c\u5e76\u53d1\u8bfb\uff0c\u6765\u63d0\u9ad8\u8bfb\u53d6\u7684\u901f\u5ea6\u3002 \u4e8c\u5c31\u662f\u5728\u5199\u5165\u7684\u65f6\u5019\u5c31\u8003\u8651\u5230\u8bfb\u7684\u6027\u80fd\u95ee\u9898\uff0c\u5c06\u7edf\u4e00\u6307\u6807\u3001\u65f6\u95f4\u6bb5\u7684\u6570\u636e\u5199\u5165\u5230\u540c\u4e00\u6570\u636e\u5757\u4e2d\uff0c\u4e3a\u8bfb\u53d6\u8fdb\u884c\u5199\u5165\u4f18\u5316\u3002 \u5206\u5e03\u5f0f\uff08\u96c6\u7fa4\uff09 TSDB \u5e94\u8be5\u5929\u751f\u5c31\u8981\u8003\u8651\u5230\u5206\u5e03\u5f0f\u548c\u5206\u533a\u7b49\u7279\u6027\uff0c\u5c06\u5b58\u50a8\u548c\u67e5\u8be2\u5206\u53d1\u5230\u4e0d\u540c\u7684\u670d\u52a1\u5668\uff0c\u4ee5\u652f\u6491\u5927\u89c4\u6a21\u7684\u6570\u636e\u91c7\u96c6\u548c\u67e5\u8be2\u8bf7\u6c42\u3002 \u540c\u65f6\uff0c\u5b83\u4e5f\u5e94\u8be5\u662f\u80fd\u6269\u5c55\u548c\u81ea\u52a8\u5931\u8d25\u5207\u6362\uff08Fault-tolerant\uff09\u7684\u3002\u968f\u7740\u6570\u636e\u91cf\u7684\u589e\u957f\uff0c\u6240\u9700\u670d\u52a1\u5668\u7684\u53f0\u6570\u4e5f\u4f1a\u589e\u52a0\uff0c\u80fd\u52a8\u6001\u7684\u589e\u51cf\u670d\u52a1\u5668\u5219\u662f\u4e00\u4e2a\u57fa\u672c\u8981\u6c42\u3002\u540c\u65f6\uff0c\u968f\u7740\u670d\u52a1\u5668\u7684\u589e\u591a\uff0c\u5404\u79cd\u670d\u52a1\u5668\u8f6f\u4ef6\u6216\u8005\u7f51\u7edc\u6545\u969c\u53d1\u751f\u7684\u6982\u7387\u4e5f\u4f1a\u589e\u5927\uff0c\u8fd9\u65f6\u5019\u5931\u8d25\u5207\u6362\u4e5f\u663e\u5f97\u5f88\u91cd\u8981\uff0c\u4e0d\u80fd\u56e0\u4e3a\u4e00\u53f0\u673a\u5668\u7684\u5931\u6548\u800c\u5bfc\u81f4\u6574\u4e2a\u96c6\u7fa4\u4e0d\u53ef\u5de5\u4f5c\u3002 \u6570\u636e\u57fa\u672c\u4e0a\u90fd\u6709\u65f6\u95f4\u5c5e\u6027\uff0c\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\u4e0d\u65ad\u4ea7\u751f\u65b0\u7684\u6570\u636e\u3002 \u6570\u636e\u91cf\u5927\uff0c\u6bcf\u79d2\u949f\u9700\u8981\u5199\u5165\u5343\u4e07\u3001\u4e0a\u4ebf\u6761\u6570\u636e \u4fdd\u7559\u7b56\u7565\uff08Retention Policies\uff0c\u6216\u81ea\u52a8\u5220\u9664\u3001\u538b\u7f29\uff09 \u81ea\u52a8\u5220\u9664\u5c31\u662f\u4e3a\u6570\u636e\u8bbe\u7f6e TTL\uff0c\u8fc7\u4e86\u6307\u5b9a\u7684 TTL \u5219\u81ea\u52a8\u5220\u9664\u76f8\u5173\u6570\u636e\uff0c\u4ee5\u8282\u7701\u5b58\u50a8\u7a7a\u95f4\u540c\u65f6\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\u3002\u5982\u679c\u4e0d\u5220\u9664\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u538b\u7f29\uff0c\u6216\u8005\u518d\u91c7\u6837\uff08Resampling\uff09\uff0c\u6bd4\u5982\u5bf9\u6700\u8fd1 1 \u5929\u7684\u6570\u636e\u6211\u4eec\u53ef\u80fd\u9700\u8981\u7cbe\u786e\u5230\u79d2\uff0c\u800c\u67e5\u8be2 1 \u5e74\u7684\u6570\u636e\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7cbe\u786e\u5230\u5929\uff0c\u8fd9\u65f6\u5019\uff0c\u6d77\u91cf\u7684\u6570\u636e\u4e00\u5e74\u53ea\u9700\u8981 365 \u4e2a\u70b9\u6765\u5b58\u50a8\uff0c\u5927\u5927\u8282\u7701\u4e86\u5b58\u50a8\u7a7a\u95f4\u3002","title":"\u65f6\u5e8f\u6570\u636e\u7684\u51e0\u4e2a\u7279\u70b9"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/timescaledb/#_2","text":"\u83b7\u53d6\u6700\u65b0\u72b6\u6001\uff0c\u67e5\u8be2\u6700\u8fd1\u7684\u6570\u636e(\u4f8b\u5982\u4f20\u611f\u5668\u6700\u65b0\u7684\u72b6\u6001) \u5c55\u793a\u533a\u95f4\u7edf\u8ba1\uff0c\u6307\u5b9a\u65f6\u95f4\u8303\u56f4\uff0c\u67e5\u8be2\u7edf\u8ba1\u4fe1\u606f\uff0c\u4f8b\u5982\u5e73\u5747\u503c\uff0c\u6700\u5927\u503c\uff0c\u6700\u5c0f\u503c\uff0c\u8ba1\u6570\u7b49\u3002\u3002\u3002 \u83b7\u53d6\u5f02\u5e38\u6570\u636e\uff0c\u6839\u636e\u6307\u5b9a\u6761\u4ef6\uff0c\u7b5b\u9009\u5f02\u5e38\u6570\u636e","title":"\u4e1a\u52a1\u65b9\u5e38\u89c1\u9700\u6c42"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/timescaledb/#_3","text":"\u76d1\u63a7\u8f6f\u4ef6\u7cfb\u7edf\uff1a \u865a\u62df\u673a\u3001\u5bb9\u5668\u3001\u670d\u52a1\u3001\u5e94\u7528 \u76d1\u63a7\u7269\u7406\u7cfb\u7edf\uff1a \u6c34\u6587\u76d1\u63a7\u3001\u5236\u9020\u4e1a\u5de5\u5382\u4e2d\u7684\u8bbe\u5907\u76d1\u63a7\u3001\u56fd\u5bb6\u5b89\u5168\u76f8\u5173\u7684\u6570\u636e\u76d1\u63a7\u3001\u901a\u8baf\u76d1\u63a7\u3001\u4f20\u611f\u5668\u6570\u636e\u3001\u8840\u7cd6\u4eea\u3001\u8840\u538b\u53d8\u5316\u3001\u5fc3\u7387\u7b49 \u8d44\u4ea7\u8ddf\u8e2a\u5e94\u7528\uff1a \u6c7d\u8f66\u3001\u5361\u8f66\u3001\u7269\u7406\u5bb9\u5668\u3001\u8fd0\u8d27\u6258\u76d8 \u91d1\u878d\u4ea4\u6613\u7cfb\u7edf\uff1a \u4f20\u7edf\u8bc1\u5238\u3001\u65b0\u5174\u7684\u52a0\u5bc6\u6570\u5b57\u8d27\u5e01 \u4e8b\u4ef6\u5e94\u7528\u7a0b\u5e8f\uff1a \u8ddf\u8e2a\u7528\u6237\u3001\u5ba2\u6237\u7684\u4ea4\u4e92\u6570\u636e \u5546\u4e1a\u667a\u80fd\u5de5\u5177\uff1a \u8ddf\u8e2a\u5173\u952e\u6307\u6807\u548c\u4e1a\u52a1\u7684\u603b\u4f53\u5065\u5eb7\u60c5\u51b5 \u5728\u4e92\u8054\u7f51\u884c\u4e1a\u4e2d\uff0c\u4e5f\u6709\u7740\u975e\u5e38\u591a\u7684\u65f6\u5e8f\u6570\u636e\uff0c\u4f8b\u5982\u7528\u6237\u8bbf\u95ee\u7f51\u7ad9\u7684\u884c\u4e3a\u8f68\u8ff9\uff0c\u5e94\u7528\u7a0b\u5e8f\u4ea7\u751f\u7684\u65e5\u5fd7\u6570\u636e\u7b49\u7b49\u3002 \u4e00\u4e9b\u57fa\u672c\u6982\u5ff5(\u4e0d\u540c\u7684\u65f6\u5e8f\u6570\u636e\u5e93\u79f0\u547c\u7565\u6709\u4e0d\u540c) Metric: \u5ea6\u91cf\uff0c\u76f8\u5f53\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u7684 table\u3002 Data point: \u6570\u636e\u70b9\uff0c\u76f8\u5f53\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u7684 row\u3002 Timestamp\uff1a\u65f6\u95f4\u6233\uff0c\u4ee3\u8868\u6570\u636e\u70b9\u4ea7\u751f\u7684\u65f6\u95f4\u3002 Field: \u5ea6\u91cf\u4e0b\u7684\u4e0d\u540c\u5b57\u6bb5\u3002\u6bd4\u5982\u4f4d\u7f6e\u8fd9\u4e2a\u5ea6\u91cf\u5177\u6709\u7ecf\u5ea6\u548c\u7eac\u5ea6\u4e24\u4e2a field\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\u5b58\u653e\u7684\u662f\u968f\u65f6\u95f4\u6233\u800c\u53d8\u5316\u7684\u6570\u636e\u3002 Tag: \u6807\u7b7e\u3002\u4e00\u822c\u5b58\u653e\u7684\u662f\u4e0d\u968f\u65f6\u95f4\u6233\u53d8\u5316\u7684\u4fe1\u606f\u3002timestamp \u52a0\u4e0a\u6240\u6709\u7684 tags \u53ef\u4ee5\u89c6\u4e3a table \u7684 primary key\u3002 \u4f8b\u5982\u91c7\u96c6\u6709\u5173\u98ce\u7684\u6570\u636e\uff0c\u5ea6\u91cf\u4e3a Wind\uff0c\u6bcf\u6761\u6570\u636e\u90fd\u6709\u65f6\u95f4\u6233timestamp\uff0c\u4e24\u4e2a\u5b57\u6bb5 field\uff1adirection(\u98ce\u5411)\u3001speed(\u98ce\u901f)\uff0c\u4e24\u4e2atag\uff1asensor(\u4f20\u611f\u5668\u7f16\u53f7)\u3001city(\u57ce\u5e02)\u3002\u7b2c\u4e00\u884c\u548c\u7b2c\u4e09\u884c\uff0c\u5b58\u653e\u7684\u90fd\u662f sensor \u7f16\u53f7\u4e3a86F-2RT8\u7684\u8bbe\u5907\uff0c\u57ce\u5e02\u662f\u6df1\u5733\u3002\u968f\u7740\u65f6\u95f4\u7684\u53d8\u5316\uff0c\u98ce\u5411\u548c\u98ce\u901f\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u98ce\u5411\u4ece56.4\u53d8\u4e3a45.6\uff0c\u98ce\u901f\u4ece2.9\u53d8\u4e3a3.6\u3002","title":"\u5e38\u89c1\u4e1a\u52a1\u573a\u666f"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/timescaledb/#_4","text":"\u65f6\u5e8f\u6570\u636e\u7684\u5199\u5165\uff1a\u5982\u4f55\u652f\u6301\u6bcf\u79d2\u949f\u6210\u5343\u4e0a\u4ebf\u6761\u6570\u636e\u7684\u5199\u5165\u3002 \u65f6\u5e8f\u6570\u636e\u7684\u8bfb\u53d6\uff1a\u5982\u4f55\u652f\u6301\u5728\u79d2\u7ea7\u5bf9\u4e0a\u4ebf\u6761\u6570\u636e\u7684\u5206\u7ec4\u805a\u5408\u8fd0\u7b97\u3002 \u6210\u672c\u654f\u611f\uff1a\u6d77\u91cf\u6570\u636e\u5b58\u50a8\u5e26\u6765\u7684\u6210\u672c\u95ee\u9898\u3002\u5982\u4f55\u4ee5\u66f4\u4f4e\u6210\u672c\u5b58\u50a8\u6570\u636e\uff0c\u5c06\u6210\u4e3a\u65f6\u5e8f\u6570\u636e\u5e93\u9700\u8981\u89e3\u51b3\u7684\u91cd\u4e2d\u4e4b\u91cd\u3002","title":"\u9700\u8981\u89e3\u51b3\u7684\u51e0\u4e2a\u95ee\u9898"},{"location":"%E6%95%B0%E6%8D%AE%E5%BA%93/timescaledb/#_5","text":"\u65f6\u5e8f\u6570\u636e\u5e93\u51fa\u73b0\u7684\u65f6\u95f4\u8f83\u665a\uff0c\u76ee\u524d\u8f83\u6210\u719f\u7684\u65f6\u5e8f\u6570\u636e\u5e93\u90fd\u4ec5\u67092\u30013\u5e74\u7684\u5386\u53f2\u3002 InfluxDB(\u5355\u673a\u7248\u514d\u8d39\uff0c\u96c6\u7fa4\u7248\u6536\u8d39)\u6700\u6210\u719f\uff0cKairosdb(\u5e95\u5c42\u4f7f\u7528Cassandra)\uff0cOpenTsdb(\u5e95\u5c42\u4f7f\u7528HBase)\uff0cberingei(Facebook\u5f00\u6e90)\uff0cTimeScaleDB(\u5e95\u5c42\u57fa\u4e8ePostgreSQL)\uff0cTSDB(\u767e\u5ea6\u5f00\u6e90)\uff0cHiTSDB(\u963f\u91cc\u5f00\u6e90\uff0c\u5e95\u5c42\u662fPostgreSQL)\uff0cMatrixDB\uff08\u56fd\u4ea7\uff0c\u636e\u8bf4\u5199\u5165\u6027\u80fd\u6bd4InfluxDB\u5feb\u51e0\u5341\u500d\uff1ahttps://zhuanlan.zhihu.com/p/374151291 \uff09","title":"\u5e38\u89c1\u65f6\u5e8f\u6570\u636e\u5e93"},{"location":"%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/empty/","text":"\u5360\u4f4d\u7f6e","title":"\u5360\u4f4d\u7f6e"},{"location":"%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/empty/#_1","text":"","title":"\u5360\u4f4d\u7f6e"},{"location":"%E7%81%B5%E6%9E%A2/%E7%BB%8F%E7%BB%9C%E5%B9%B2%E6%94%AF/","text":"\u7ecf\u7edc\u5e72\u652f \u7ecf\u7edc\u5929\u5e72 \u7532\u80c6\u4e59\u809d\u4e19\u5c0f\u80a0\uff0c\u4e01\u5fc3\u620a\u80c3\u5df1\u813e\u4e61\u3002 \u5e9a\u5c5e\u5927\u80a0\u8f9b\u5c5e\u80ba\uff0c\u58ec\u4e3a\u8180\u80f1\u7678\u80be\u810f\u3002 \u4e09\u7126\u4ea6\u5411\u58ec\u4e2d\u5bc4\uff0c\u5fc3\u5305\u540c\u5f52\u4e8e\u7678\u6c34\u3002 \u7ecf\u7edc\u5730\u652f \u80ba\u5bc5\u5927\u536f\u80c3\u8fb0\u5bab\uff0c \u813e\u5df3\u5fc3\u5348\u5c0f\u672a\u4e2d\uff0c \u7533\u80f1\u9149\u80be\u5fc3\u5305\u620c\uff0c \u4ea5\u7126\u5b50\u80c6\u4e11\u809d\u901a\u3002 \u5730\u652f\u4e3b\u8981\u53ef\u7528\u4e8e\u8fa9\u8bc1\u4e0e\u9a8c\u8bc1\u7597\u6548","title":"\u7ecf\u7edc\u5e72\u652f"},{"location":"%E7%81%B5%E6%9E%A2/%E7%BB%8F%E7%BB%9C%E5%B9%B2%E6%94%AF/#_1","text":"","title":"\u7ecf\u7edc\u5e72\u652f"},{"location":"%E7%81%B5%E6%9E%A2/%E7%BB%8F%E7%BB%9C%E5%B9%B2%E6%94%AF/#_2","text":"\u7532\u80c6\u4e59\u809d\u4e19\u5c0f\u80a0\uff0c\u4e01\u5fc3\u620a\u80c3\u5df1\u813e\u4e61\u3002 \u5e9a\u5c5e\u5927\u80a0\u8f9b\u5c5e\u80ba\uff0c\u58ec\u4e3a\u8180\u80f1\u7678\u80be\u810f\u3002 \u4e09\u7126\u4ea6\u5411\u58ec\u4e2d\u5bc4\uff0c\u5fc3\u5305\u540c\u5f52\u4e8e\u7678\u6c34\u3002","title":"\u7ecf\u7edc\u5929\u5e72"},{"location":"%E7%81%B5%E6%9E%A2/%E7%BB%8F%E7%BB%9C%E5%B9%B2%E6%94%AF/#_3","text":"\u80ba\u5bc5\u5927\u536f\u80c3\u8fb0\u5bab\uff0c \u813e\u5df3\u5fc3\u5348\u5c0f\u672a\u4e2d\uff0c \u7533\u80f1\u9149\u80be\u5fc3\u5305\u620c\uff0c \u4ea5\u7126\u5b50\u80c6\u4e11\u809d\u901a\u3002 \u5730\u652f\u4e3b\u8981\u53ef\u7528\u4e8e\u8fa9\u8bc1\u4e0e\u9a8c\u8bc1\u7597\u6548","title":"\u7ecf\u7edc\u5730\u652f"},{"location":"%E7%81%B5%E6%9E%A2/%E9%AB%98%E8%A1%80%E5%8E%8B%E8%BE%A8%E8%AF%81%E4%B8%8E%E6%96%B9%E9%92%88/","text":"\u9ad8\u8840\u538b#\u4e3b\u8981\u7531\u4e8e\u809d\u80be\u9634\u9633\u5931\u8c03\uff0c\u4e5f\u53ef\u517c\u5939\u75f0\u6e7f\uff0c\u5176\u4e2d\uff1a \u809d\u9633\u4e0a\u4ea2\u8005\u53ef\u89c1\u5934\u75db\u3001\u9762\u7ea2\u8033\u8d64\u3001\u53e3\u5e72\u3001\u5fc3\u70e6\u6613\u6012\u3001\u4fbf\u79d8\u3001\u82d4\u9ec4\u3001\u8109\u5f26\u6709\u529b\uff1b \u809d\u80be\u9634\u865a\u8005\u53ef\u89c1\u7729\u6655\u8033\u9e23\u3001\u8170\u9178\u817f\u8f6f\u3001\u5fc3\u60b8\u4e0d\u5bd0\u3001\u820c\u8d28\u7ea2\u3001\u8109\u5f26\u6570\uff1b \u517c\u5939\u75f0\u6e7f\u53ef\u89c1\u80f8\u95f7\u3001\u5fc3\u60b8\u3001\u80a2\u4f53\u9ebb\u6728\u3001\u5f62\u4f53\u591a\u80d6\u3001\u820c\u8d28\u7ea2\u3001\u8109\u5f26\u6ed1\u3002 \u8fa8\u8bc1\u5206\u7ecf \u6309\u7ecf\u7edc\u75c5\u5019\u5c5e\u4e8e#\u624b\u5c11\u9634\u5fc3\u7ecf#\u3001#\u8db3\u5c11\u9634\u80be\u7ecf#\u3001#\u8db3\u53a5\u9634\u809d\u7ecf# \u5de1\u7ecf\u53d6\u7a74 \u5fc3\u7ecf\uff1a#\u795e\u95e8# \u80be\u7ecf\uff1a#\u592a\u6eaa# \u809d\u7ecf\uff1a#\u884c\u95f4#\u3001#\u592a\u51b2# \u968f\u8bc1\u53d6\u7a74 \u9ad8\u8840\u538b\uff1a#\u66f2\u6c60#\u3001#\u8db3\u4e09\u91cc# \u5931\u7720\uff1a#\u4e09\u9634\u4ea4# \u5fc3\u60b8\uff1a#\u5185\u5173# \u75f0\u6e7f\uff1a#\u4e30\u9686# \u65b9\u9488 \u6bcf\u6b21\u53d61~2\u7a74\uff0c\u7528#\u6cfb\u6cd5#\uff0c\u5341\u5929\u4e00\u4e2a\u7597\u7a0b\uff0c\u5982\u6709\u6c14\u4fc3\u3001\u7cbe\u795e\u5446\u6ede\u840e\u75b2\u3001\u5c3f\u9891\u7b49\u9633\u865a\u75c7\u72b6\u8005\uff0c\u53ef\u91c7\u7528\u827e\u5377\u6e29\u548c\u7078\u6cd5\uff0c\u53d6\u795e\u9619\u3001\u5173\u5143\u3001\u540d\u95e8\u4e09\u7a74\uff0c\u6bcf\u65e5\u7078\u4e00\u4e2a\u7a74\u4f4d\uff0c\u6bcf\u6b21\u4e00\u5c0f\u65f6\u8fde\u7eed\u65bd\u7078\u575a\u63011-3\u4e2a\u6708\u3002","title":"\u9ad8\u8840\u538b\u8fa8\u8bc1\u4e0e\u65b9\u9488"},{"location":"%E7%81%B5%E6%9E%A2/%E9%AB%98%E8%A1%80%E5%8E%8B%E8%BE%A8%E8%AF%81%E4%B8%8E%E6%96%B9%E9%92%88/#_1","text":"\u809d\u9633\u4e0a\u4ea2\u8005\u53ef\u89c1\u5934\u75db\u3001\u9762\u7ea2\u8033\u8d64\u3001\u53e3\u5e72\u3001\u5fc3\u70e6\u6613\u6012\u3001\u4fbf\u79d8\u3001\u82d4\u9ec4\u3001\u8109\u5f26\u6709\u529b\uff1b \u809d\u80be\u9634\u865a\u8005\u53ef\u89c1\u7729\u6655\u8033\u9e23\u3001\u8170\u9178\u817f\u8f6f\u3001\u5fc3\u60b8\u4e0d\u5bd0\u3001\u820c\u8d28\u7ea2\u3001\u8109\u5f26\u6570\uff1b \u517c\u5939\u75f0\u6e7f\u53ef\u89c1\u80f8\u95f7\u3001\u5fc3\u60b8\u3001\u80a2\u4f53\u9ebb\u6728\u3001\u5f62\u4f53\u591a\u80d6\u3001\u820c\u8d28\u7ea2\u3001\u8109\u5f26\u6ed1\u3002","title":"\u9ad8\u8840\u538b#\u4e3b\u8981\u7531\u4e8e\u809d\u80be\u9634\u9633\u5931\u8c03\uff0c\u4e5f\u53ef\u517c\u5939\u75f0\u6e7f\uff0c\u5176\u4e2d\uff1a"},{"location":"%E7%81%B5%E6%9E%A2/%E9%AB%98%E8%A1%80%E5%8E%8B%E8%BE%A8%E8%AF%81%E4%B8%8E%E6%96%B9%E9%92%88/#_2","text":"\u6309\u7ecf\u7edc\u75c5\u5019\u5c5e\u4e8e#\u624b\u5c11\u9634\u5fc3\u7ecf#\u3001#\u8db3\u5c11\u9634\u80be\u7ecf#\u3001#\u8db3\u53a5\u9634\u809d\u7ecf#","title":"\u8fa8\u8bc1\u5206\u7ecf"},{"location":"%E7%81%B5%E6%9E%A2/%E9%AB%98%E8%A1%80%E5%8E%8B%E8%BE%A8%E8%AF%81%E4%B8%8E%E6%96%B9%E9%92%88/#_3","text":"\u5fc3\u7ecf\uff1a#\u795e\u95e8# \u80be\u7ecf\uff1a#\u592a\u6eaa# \u809d\u7ecf\uff1a#\u884c\u95f4#\u3001#\u592a\u51b2#","title":"\u5de1\u7ecf\u53d6\u7a74"},{"location":"%E7%81%B5%E6%9E%A2/%E9%AB%98%E8%A1%80%E5%8E%8B%E8%BE%A8%E8%AF%81%E4%B8%8E%E6%96%B9%E9%92%88/#_4","text":"\u9ad8\u8840\u538b\uff1a#\u66f2\u6c60#\u3001#\u8db3\u4e09\u91cc# \u5931\u7720\uff1a#\u4e09\u9634\u4ea4# \u5fc3\u60b8\uff1a#\u5185\u5173# \u75f0\u6e7f\uff1a#\u4e30\u9686#","title":"\u968f\u8bc1\u53d6\u7a74"},{"location":"%E7%81%B5%E6%9E%A2/%E9%AB%98%E8%A1%80%E5%8E%8B%E8%BE%A8%E8%AF%81%E4%B8%8E%E6%96%B9%E9%92%88/#_5","text":"\u6bcf\u6b21\u53d61~2\u7a74\uff0c\u7528#\u6cfb\u6cd5#\uff0c\u5341\u5929\u4e00\u4e2a\u7597\u7a0b\uff0c\u5982\u6709\u6c14\u4fc3\u3001\u7cbe\u795e\u5446\u6ede\u840e\u75b2\u3001\u5c3f\u9891\u7b49\u9633\u865a\u75c7\u72b6\u8005\uff0c\u53ef\u91c7\u7528\u827e\u5377\u6e29\u548c\u7078\u6cd5\uff0c\u53d6\u795e\u9619\u3001\u5173\u5143\u3001\u540d\u95e8\u4e09\u7a74\uff0c\u6bcf\u65e5\u7078\u4e00\u4e2a\u7a74\u4f4d\uff0c\u6bcf\u6b21\u4e00\u5c0f\u65f6\u8fde\u7eed\u65bd\u7078\u575a\u63011-3\u4e2a\u6708\u3002","title":"\u65b9\u9488"}]}